<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>财富评分算法测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { border: 1px solid #ccc; margin: 20px 0; padding: 15px; }
        .score-detail { margin: 5px 0; }
        .total-score { font-weight: bold; color: #d32f2f; }
        .warning { color: #ff9800; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>财富评分算法测试</h1>
    
    <div class="test-case">
        <h2>案例1：男，1973年2月2日18时</h2>
        <div>八字：壬子 癸丑 己巳 癸酉</div>
        <div id="case1-result"></div>
    </div>
    
    <div class="test-case">
        <h2>案例2：女，1978年7月22日2时</h2>
        <div>八字：戊午 己未 乙酉 丁丑</div>
        <div id="case2-result"></div>
    </div>

    <script>
        // 简化的辅助函数
        function getStemElement(stem) {
            const elementMap = {
                '甲': '木', '乙': '木',
                '丙': '火', '丁': '火',
                '戊': '土', '己': '土',
                '庚': '金', '辛': '金',
                '壬': '水', '癸': '水'
            };
            return elementMap[stem] || '土';
        }
        
        function getBranchElement(branch) {
            const elementMap = {
                '寅': '木', '卯': '木',
                '巳': '火', '午': '火',
                '申': '金', '酉': '金',
                '亥': '水', '子': '水',
                '辰': '土', '戌': '土', '丑': '土', '未': '土'
            };
            return elementMap[branch] || '土';
        }
        
        function isWealth(dayElement, element) {
            const wealthMap = {
                '木': ['土'], '火': ['金'], '土': ['水'], '金': ['木'], '水': ['火']
            };
            return wealthMap[dayElement]?.includes(element);
        }
        
        function countWealthStars(pillars) {
            const dayElement = getStemElement(pillars.day.charAt(0));
            let count = 0;
            
            // 检查天干
            [pillars.year, pillars.month, pillars.hour].forEach(pillar => {
                const stem = pillar.charAt(0);
                if (isWealth(dayElement, getStemElement(stem))) {
                    count++;
                }
            });
            
            // 检查地支
            [pillars.year, pillars.month, pillars.day, pillars.hour].forEach(pillar => {
                const branch = pillar.charAt(1);
                if (isWealth(dayElement, getBranchElement(branch))) {
                    count++;
                }
            });
            
            return count;
        }
        
        function calculateSimpleDayStrength(pillars) {
            const dayStem = pillars.day.charAt(0);
            const monthBranch = pillars.month.charAt(1);
            
            let strength = 40; // 基础值
            
            // 月令对日主的影响
            const seasonMap = {
                '甲': ['寅', '卯'], '乙': ['寅', '卯'],
                '丙': ['午', '巳'], '丁': ['午', '巳'],
                '戊': ['辰', '戌', '丑', '未'], '己': ['辰', '戌', '丑', '未'],
                '庚': ['申', '酉'], '辛': ['申', '酉'],
                '壬': ['子', '亥'], '癸': ['子', '亥']
            };
            
            if (seasonMap[dayStem]?.includes(monthBranch)) {
                strength += 25; // 日主当令
            } else {
                strength -= 10; // 日主失令
            }
            
            return Math.max(10, Math.min(100, strength));
        }
        
        function testCase(pillars, caseName) {
            const dayElement = getStemElement(pillars.day.charAt(0));
            const dayStrength = calculateSimpleDayStrength(pillars);
            const wealthCount = countWealthStars(pillars);
            
            let result = `<h3>详细分析：</h3>`;
            result += `<div class="score-detail">日主：${pillars.day.charAt(0)}${dayElement}</div>`;
            result += `<div class="score-detail">日主强度：${dayStrength}分</div>`;
            result += `<div class="score-detail">财星数量：${wealthCount}个</div>`;
            
            // 判断格局
            if (dayStrength < 40 && wealthCount >= 3) {
                result += `<div class="error">格局：身不胜财（应该低分）</div>`;
            } else if (dayStrength <= 30 && wealthCount >= 2) {
                result += `<div class="warning">格局：可能从财格</div>`;
            } else {
                result += `<div>格局：普通格局</div>`;
            }
            
            // 财星详细分析
            result += `<h4>财星分布：</h4>`;
            ['year', 'month', 'day', 'hour'].forEach(pos => {
                const pillar = pillars[pos];
                const stem = pillar.charAt(0);
                const branch = pillar.charAt(1);
                const stemElement = getStemElement(stem);
                const branchElement = getBranchElement(branch);
                
                let posResult = `${pos}: ${pillar} - `;
                if (isWealth(dayElement, stemElement)) {
                    posResult += `天干${stem}(${stemElement})为财星 `;
                }
                if (isWealth(dayElement, branchElement)) {
                    posResult += `地支${branch}(${branchElement})为财星`;
                }
                if (!isWealth(dayElement, stemElement) && !isWealth(dayElement, branchElement)) {
                    posResult += '无财星';
                }
                result += `<div class="score-detail">${posResult}</div>`;
            });
            
            return result;
        }
        
        // 测试案例
        const case1 = {
            year: '壬子',
            month: '癸丑',
            day: '己巳',
            hour: '癸酉'
        };
        
        const case2 = {
            year: '戊午',
            month: '己未',
            day: '乙酉',
            hour: '丁丑'
        };
        
        document.getElementById('case1-result').innerHTML = testCase(case1, '案例1');
        document.getElementById('case2-result').innerHTML = testCase(case2, '案例2');
    </script>
</body>
</html>