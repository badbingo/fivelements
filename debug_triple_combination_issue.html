<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三合局检测问题分析</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .case-analysis {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .correct {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .bazi-chart {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .pillar {
            border: 2px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .pillar-title {
            font-weight: bold;
            color: #666;
            font-size: 12px;
        }
        .stem {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .branch {
            font-size: 18px;
            font-weight: bold;
            color: #666;
        }
        .analysis-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>三合局检测严重错误分析</h1>
        
        <div class="case-analysis">
            <h2>用户案例</h2>
            <p><strong>八字：</strong>戊子，乙丑，己卯，戊辰</p>
            <p><strong>大运：</strong>丁卯</p>
            <p><strong>流年：</strong>乙巳</p>
        </div>
        
        <div class="bazi-chart">
            <div class="pillar">
                <div class="pillar-title">年柱</div>
                <div class="stem">戊</div>
                <div class="branch">子</div>
            </div>
            <div class="pillar">
                <div class="pillar-title">月柱</div>
                <div class="stem">乙</div>
                <div class="branch">丑</div>
            </div>
            <div class="pillar">
                <div class="pillar-title">日柱</div>
                <div class="stem">己</div>
                <div class="branch">卯</div>
            </div>
            <div class="pillar">
                <div class="pillar-title">时柱</div>
                <div class="stem">戊</div>
                <div class="branch">辰</div>
            </div>
            <div class="pillar">
                <div class="pillar-title">大运</div>
                <div class="stem">丁</div>
                <div class="branch">卯</div>
            </div>
            <div class="pillar">
                <div class="pillar-title">流年</div>
                <div class="stem">乙</div>
                <div class="branch">巳</div>
            </div>
        </div>
        
        <div class="analysis-section">
            <h3>地支分析</h3>
            <p><strong>实际存在的地支：</strong>子、丑、卯、辰、卯（大运）、巳（流年）</p>
            <p><strong>地支位置：</strong></p>
            <ul>
                <li>年支：子</li>
                <li>月支：丑</li>
                <li>日支：卯</li>
                <li>时支：辰</li>
                <li>大运：卯</li>
                <li>流年：巳</li>
            </ul>
        </div>
        
        <div class="analysis-section">
            <h3>系统错误检测的三合局</h3>
            
            <div class="error">
                <h4>❌ 错误1：申子辰三合水（半三合）</h4>
                <p><strong>系统声称：</strong>子辰是本命局里的，形成半三合</p>
                <p><strong>实际问题：</strong></p>
                <ul>
                    <li>申根本不存在于八字中</li>
                    <li>子（年支）和辰（时支）不相邻，中间隔着丑、卯</li>
                    <li>不相邻的地支不能形成合化</li>
                </ul>
            </div>
            
            <div class="error">
                <h4>❌ 错误2：巳酉丑三合金（半三合）</h4>
                <p><strong>系统声称：</strong>巳酉半三合金</p>
                <p><strong>实际问题：</strong></p>
                <ul>
                    <li>酉根本不存在于八字中</li>
                    <li>只有巳（流年）和丑（月支），缺少酉</li>
                    <li>巳和丑也不相邻</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section">
            <h3>正确的地支关系分析</h3>
            
            <div class="correct">
                <h4>✅ 实际存在的地支关系</h4>
                <p><strong>相邻地支检查：</strong></p>
                <ul>
                    <li>年月：子丑（相邻，可能有六合关系）</li>
                    <li>月日：丑卯（相邻，无特殊关系）</li>
                    <li>日时：卯辰（相邻，无特殊关系）</li>
                </ul>
                
                <p><strong>六合关系：</strong></p>
                <ul>
                    <li>子丑合土：年支子与月支丑相邻，可以合化</li>
                </ul>
                
                <p><strong>三合局：</strong></p>
                <ul>
                    <li>无任何真正的三合局成立</li>
                    <li>申子辰：缺申，且子辰不相邻</li>
                    <li>巳酉丑：缺酉，且巳丑不相邻</li>
                    <li>亥卯未：只有卯，缺亥未</li>
                    <li>寅午戌：全部缺失</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section">
            <h3>问题根源分析</h3>
            <div class="error">
                <h4>系统缺陷</h4>
                <ol>
                    <li><strong>缺少存在性验证：</strong>系统没有验证三合局成员是否真实存在</li>
                    <li><strong>缺少相邻性检查：</strong>系统没有检查地支是否相邻</li>
                    <li><strong>错误的匹配逻辑：</strong>只要找到三合局中的任意两个地支就认为成立</li>
                    <li><strong>忽略位置关系：</strong>没有考虑地支在四柱中的实际位置</li>
                </ol>
            </div>
        </div>
        
        <div class="analysis-section">
            <h3>修复方案</h3>
            <div class="correct">
                <h4>必要的修复措施</h4>
                <ol>
                    <li><strong>添加存在性验证：</strong>确保所有三合局成员都真实存在于八字中</li>
                    <li><strong>添加相邻性检查：</strong>只有相邻的地支才能形成合化</li>
                    <li><strong>修正匹配逻辑：</strong>严格按照传统命理规则判断三合局</li>
                    <li><strong>位置关系验证：</strong>考虑地支在四柱、大运、流年中的实际位置</li>
                </ol>
            </div>
        </div>
        
        <button onclick="analyzeCurrentLogic()">分析当前系统逻辑</button>
        <div id="analysis-result"></div>
    </div>
    
    <script>
        function analyzeCurrentLogic() {
            const result = document.getElementById('analysis-result');
            
            // 模拟当前系统的错误逻辑
            const branches = ['子', '丑', '卯', '辰', '卯', '巳'];
            const tripleCombinations = {
                '申子辰': { element: 'water', branches: ['申', '子', '辰'] },
                '亥卯未': { element: 'wood', branches: ['亥', '卯', '未'] },
                '寅午戌': { element: 'fire', branches: ['寅', '午', '戌'] },
                '巳酉丑': { element: 'metal', branches: ['巳', '酉', '丑'] }
            };
            
            let analysis = '<h3>当前系统错误逻辑分析</h3>';
            analysis += '<p><strong>实际地支：</strong>' + branches.join('、') + '</p>';
            
            for (const combo in tripleCombinations) {
                const info = tripleCombinations[combo];
                const matches = info.branches.filter(branch => branches.includes(branch));
                
                analysis += `<div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">`;
                analysis += `<strong>${combo}三合${info.element}局：</strong><br>`;
                analysis += `需要：${info.branches.join('、')}<br>`;
                analysis += `找到：${matches.join('、')} (${matches.length}个)<br>`;
                
                if (matches.length >= 2) {
                    analysis += `<span style="color: red;">❌ 系统错误判断为半三合成立</span><br>`;
                    
                    // 检查缺失的地支
                    const missing = info.branches.filter(branch => !branches.includes(branch));
                    if (missing.length > 0) {
                        analysis += `<span style="color: red;">缺失地支：${missing.join('、')}</span><br>`;
                    }
                    
                    // 检查相邻性
                    if (matches.length === 2) {
                        const positions = [];
                        matches.forEach(branch => {
                            const indices = branches.map((b, i) => b === branch ? i : -1).filter(i => i !== -1);
                            positions.push(...indices);
                        });
                        
                        const isAdjacent = Math.abs(positions[0] - positions[1]) === 1;
                        if (!isAdjacent) {
                            analysis += `<span style="color: red;">位置：${positions.join('、')}，不相邻，不能合化</span><br>`;
                        }
                    }
                } else {
                    analysis += `<span style="color: green;">✅ 正确：不足以形成三合局</span><br>`;
                }
                
                analysis += `</div>`;
            }
            
            result.innerHTML = analysis;
        }
    </script>
</body>
</html>