<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>特定八字财富分析</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .bazi-info { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .score-breakdown { background: #fff8e1; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .analysis-section { background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .highlight { color: #d32f2f; font-weight: bold; }
        .good { color: #388e3c; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>特定八字财富分析 - 戊午，己未，乙酉，丁丑</h1>
        
        <div class="bazi-info">
            <h2>八字信息</h2>
            <p><strong>性别：</strong>女</p>
            <p><strong>出生时间：</strong>1978年7月22日2时</p>
            <p><strong>八字：</strong>戊午，己未，乙酉，丁丑</p>
            <p><strong>实际资产：</strong>超过2亿</p>
        </div>
        
        <div class="score-breakdown">
            <h2>财富评分详细分解</h2>
            <div id="scoreDetails"></div>
        </div>
        
        <div class="analysis-section">
            <h2>格局分析</h2>
            <div id="patternAnalysis"></div>
        </div>
        
        <div class="analysis-section">
            <h2>问题诊断</h2>
            <div id="problemDiagnosis"></div>
        </div>
    </div>

    <script src="js/lunar.js"></script>
    <script>
        // 测试八字：戊午，己未，乙酉，丁丑
        const testPillars = {
            year: '戊午',
            month: '己未', 
            day: '乙酉',
            hour: '丁丑'
        };
        
        // 从bazinew.html复制必要的函数
        function getStemElement(stem) {
            const stemElements = {
                '甲': '木', '乙': '木', '丙': '火', '丁': '火', '戊': '土',
                '己': '土', '庚': '金', '辛': '金', '壬': '水', '癸': '水'
            };
            return stemElements[stem] || '未知';
        }
        
        function getBranchElement(branch) {
            const branchElements = {
                '子': '水', '丑': '土', '寅': '木', '卯': '木', '辰': '土', '巳': '火',
                '午': '火', '未': '土', '申': '金', '酉': '金', '戌': '土', '亥': '水'
            };
            return branchElements[branch] || '未知';
        }
        
        function isWealth(dayElement, element) {
            const wealthMap = {
                '木': ['土'], '火': ['金'], '土': ['水'], '金': ['木'], '水': ['火']
            };
            return wealthMap[dayElement]?.includes(element);
        }
        
        function getZhengCai(dayStem) {
            const zhengCaiMap = {
                '甲': '己', '乙': '戊', '丙': '辛', '丁': '庚', '戊': '癸',
                '己': '壬', '庚': '乙', '辛': '甲', '壬': '丁', '癸': '丙'
            };
            return zhengCaiMap[dayStem];
        }
        
        function getPianCai(dayStem) {
            const pianCaiMap = {
                '甲': '戊', '乙': '己', '丙': '庚', '丁': '辛', '戊': '壬',
                '己': '癸', '庚': '甲', '辛': '乙', '壬': '丙', '癸': '丁'
            };
            return pianCaiMap[dayStem];
        }
        
        function calculateSimpleDayStrength(pillars) {
            const dayElement = getStemElement(pillars.day.charAt(0));
            const monthBranch = pillars.month.charAt(1);
            let strength = 50; // 基础强度
            
            // 月令影响
            const seasonStrength = {
                '木': { '寅': 30, '卯': 25, '辰': 10, '巳': -10, '午': -15, '未': -5, '申': -20, '酉': -25, '戌': -5, '亥': 15, '子': 10, '丑': 5 },
                '火': { '寅': 15, '卯': 10, '辰': 5, '巳': 25, '午': 30, '未': 15, '申': -5, '酉': -10, '戌': 10, '亥': -20, '子': -25, '丑': -5 },
                '土': { '寅': -5, '卯': -10, '辰': 20, '巳': 10, '午': 15, '未': 25, '申': 5, '酉': 0, '戌': 20, '亥': -10, '子': -15, '丑': 25 },
                '金': { '寅': -20, '卯': -25, '辰': -5, '巳': -10, '午': -15, '未': -5, '申': 25, '酉': 30, '戌': 10, '亥': 5, '子': 0, '丑': 15 },
                '水': { '寅': 10, '卯': 5, '辰': -5, '巳': -25, '午': -30, '未': -15, '申': 15, '酉': 10, '戌': -10, '亥': 25, '子': 30, '丑': 5 }
            };
            
            strength += seasonStrength[dayElement]?.[monthBranch] || 0;
            
            // 其他柱的影响
            const positions = ['year', 'month', 'hour'];
            positions.forEach(pos => {
                const stem = pillars[pos].charAt(0);
                const branch = pillars[pos].charAt(1);
                const stemElement = getStemElement(stem);
                const branchElement = getBranchElement(branch);
                
                // 同类帮扶
                if (stemElement === dayElement) strength += 8;
                if (branchElement === dayElement) strength += 5;
                
                // 印星生扶
                const yinElements = { '木': ['水'], '火': ['木'], '土': ['火'], '金': ['土'], '水': ['金'] };
                if (yinElements[dayElement]?.includes(stemElement)) strength += 6;
                if (yinElements[dayElement]?.includes(branchElement)) strength += 4;
                
                // 官杀克制
                const guanShaElements = { '木': ['金'], '火': ['水'], '土': ['木'], '金': ['火'], '水': ['土'] };
                if (guanShaElements[dayElement]?.includes(stemElement)) strength -= 6;
                if (guanShaElements[dayElement]?.includes(branchElement)) strength -= 4;
                
                // 食伤泄气
                const shiShangElements = { '木': ['火'], '火': ['土'], '土': ['金'], '金': ['水'], '水': ['木'] };
                if (shiShangElements[dayElement]?.includes(stemElement)) strength -= 4;
                if (shiShangElements[dayElement]?.includes(branchElement)) strength -= 3;
                
                // 财星耗气
                if (isWealth(dayElement, stemElement)) strength -= 5;
                if (isWealth(dayElement, branchElement)) strength -= 3;
            });
            
            return Math.max(10, Math.min(100, strength));
        }
        
        function analyzeWealth() {
            const dayElement = getStemElement(testPillars.day.charAt(0)); // 乙木
            const dayStrength = calculateSimpleDayStrength(testPillars);
            
            // 分析财星分布
            let wealthCount = 0;
            let wealthDetails = [];
            const positions = ['year', 'month', 'day', 'hour'];
            
            positions.forEach(pos => {
                const stem = testPillars[pos].charAt(0);
                const branch = testPillars[pos].charAt(1);
                const stemElement = getStemElement(stem);
                const branchElement = getBranchElement(branch);
                
                if (isWealth(dayElement, stemElement)) {
                    wealthCount++;
                    wealthDetails.push(`${pos}干${stem}(${stemElement})`);
                }
                if (isWealth(dayElement, branchElement)) {
                    wealthCount++;
                    wealthDetails.push(`${pos}支${branch}(${branchElement})`);
                }
            });
            
            // 分析比劫
            let biJieCount = 0;
            positions.forEach(pos => {
                const stem = testPillars[pos].charAt(0);
                const branch = testPillars[pos].charAt(1);
                const stemElement = getStemElement(stem);
                const branchElement = getBranchElement(branch);
                
                if (stemElement === dayElement) biJieCount++;
                if (branchElement === dayElement) biJieCount++;
            });
            
            // 分析印星
            let yinCount = 0;
            const yinElements = ['水']; // 乙木的印星是水
            positions.forEach(pos => {
                const stem = testPillars[pos].charAt(0);
                const branch = testPillars[pos].charAt(1);
                const stemElement = getStemElement(stem);
                const branchElement = getBranchElement(branch);
                
                if (yinElements.includes(stemElement)) yinCount++;
                if (yinElements.includes(branchElement)) yinCount++;
            });
            
            return {
                dayElement,
                dayStrength,
                wealthCount,
                wealthDetails,
                biJieCount,
                yinCount
            };
        }
        
        function displayAnalysis() {
            const analysis = analyzeWealth();
            
            document.getElementById('scoreDetails').innerHTML = `
                <h3>基础信息</h3>
                <p><strong>日主：</strong>${testPillars.day.charAt(0)}(${analysis.dayElement})</p>
                <p><strong>日主强度：</strong><span class="${analysis.dayStrength < 40 ? 'highlight' : 'good'}">${analysis.dayStrength}</span></p>
                <p><strong>财星数量：</strong><span class="${analysis.wealthCount >= 4 ? 'good' : 'highlight'}">${analysis.wealthCount}</span></p>
                <p><strong>财星分布：</strong>${analysis.wealthDetails.join(', ')}</p>
                <p><strong>比劫数量：</strong>${analysis.biJieCount}</p>
                <p><strong>印星数量：</strong>${analysis.yinCount}</p>
            `;
            
            document.getElementById('patternAnalysis').innerHTML = `
                <h3>格局判断</h3>
                <p><strong>八字特点：</strong></p>
                <ul>
                    <li>乙木日主，生于未月（土旺季节）</li>
                    <li>四柱财星极多：戊土、己土、丁火克制乙木</li>
                    <li>无比劫帮身，无印星生身</li>
                    <li>典型的"身弱财多"格局</li>
                </ul>
                
                <h3>现实验证</h3>
                <p class="good">实际资产超过2亿，证明这是一个极佳的财富格局</p>
            `;
            
            document.getElementById('problemDiagnosis').innerHTML = `
                <h3>评分偏低的可能原因</h3>
                <ol>
                    <li><span class="highlight">"身弱财多"被误判为负面格局</span>
                        <br>→ 算法可能过度惩罚身弱的情况</li>
                    <li><span class="highlight">未识别"弃命从财"格局</span>
                        <br>→ 身极弱、财极旺时应该是从财格，反而是大富之命</li>
                    <li><span class="highlight">财星过多被扣分</span>
                        <br>→ 算法可能认为财星太多是负担，但实际上财多身弱在特定条件下是大富格局</li>
                    <li><span class="highlight">缺乏现实验证机制</span>
                        <br>→ 需要根据实际案例调整评分权重</li>
                </ol>
                
                <h3>建议修正方向</h3>
                <ul>
                    <li>重新评估"从财格"的识别条件</li>
                    <li>对于财星极多的情况，应该加分而非扣分</li>
                    <li>考虑添加"弃命从财"的特殊加分机制</li>
                    <li>调整身弱财多的评分逻辑</li>
                </ul>
            `;
        }
        
        // 页面加载完成后执行分析
        window.onload = function() {
            displayAnalysis();
        };
    </script>
</body>
</html>