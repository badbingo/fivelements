<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字计算器 - 麦八字教学网</title>
    <link rel="stylesheet" href="../css/style1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/navigation.css">
    <script defer src="../js/navigation.js"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2NHJXGKS0Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2NHJXGKS0Y');
    </script>
    
    <style>
        /* 新增互动学习区域样式 */
        .learning-section {
            margin-top: 40px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .learning-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .learning-tab {
            padding: 12px 25px;
            background: rgba(237, 28, 36, 0.1);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid rgba(237, 28, 36, 0.3);
        }
        
        .learning-tab:hover {
            background: rgba(237, 28, 36, 0.2);
            transform: translateY(-3px);
        }
        
        .learning-tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 5px 15px rgba(237, 28, 36, 0.3);
        }
        
        .learning-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .learning-content.active {
            display: block;
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(237, 28, 36, 0.1);
        }
        
        .analysis-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .analysis-result {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(237, 28, 36, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .analysis-detail {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        
        .highlight {
            background: rgba(255, 235, 59, 0.3);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .wuxing-balance {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }
        
        .wuxing-item {
            text-align: center;
            flex: 1;
        }
        
        .wuxing-bar {
            height: 120px;
            width: 30px;
            background: #f0f0f0;
            margin: 0 auto 10px;
            position: relative;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .wuxing-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: height 1s ease;
        }
        
        .wood .wuxing-fill { background: #2e7d32; }
        .fire .wuxing-fill { background: #c62828; }
        .earth .wuxing-fill { background: #8d6e63; }
        .metal .wuxing-fill { background: #1565c0; }
        .water .wuxing-fill { background: #0277bd; }
        
        .wuxing-label {
            font-weight: 600;
        }
        
        .wuxing-value {
            font-size: 0.9rem;
            color: #666;
        }
        
        .special-patterns {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .pattern-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #eee;
            transition: all 0.3s ease;
        }
        
        .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .pattern-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pattern-desc {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.6;
        }
        
        .pattern-active {
            background: rgba(237, 28, 36, 0.05);
            border-color: rgba(237, 28, 36, 0.3);
        }
        
        .luck-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .luck-table th {
            background: rgba(237, 28, 36, 0.1);
            padding: 12px;
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .luck-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #eee;
        }
        
        .luck-current {
            background: rgba(255, 235, 59, 0.3);
            font-weight: 600;
        }
        
        .luck-good {
            background: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
        }
        
        .luck-bad {
            background: rgba(244, 67, 54, 0.1);
            color: #c62828;
        }
        
        .interactive-hint {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(237, 28, 36, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .interactive-hint i {
            color: var(--primary-color);
            font-size: 1.5rem;
        }
        
        .interactive-hint p {
            margin: 0;
            font-size: 0.95rem;
            color: #555;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 五行颜色类增强 */
        .wuxing-wood { color: #2e7d32; font-weight: 600; background-color: rgba(46, 125, 50, 0.1); padding: 2px 5px; border-radius: 3px; }
        .wuxing-fire { color: #c62828; font-weight: 600; background-color: rgba(198, 40, 40, 0.1); padding: 2px 5px; border-radius: 3px; }
        .wuxing-earth { color: #8d6e63; font-weight: 600; background-color: rgba(141, 110, 99, 0.1); padding: 2px 5px; border-radius: 3px; }
        .wuxing-metal { color: #1565c0; font-weight: 600; background-color: rgba(21, 101, 192, 0.1); padding: 2px 5px; border-radius: 3px; }
        .wuxing-water { color: #0277bd; font-weight: 600; background-color: rgba(2, 119, 189, 0.1); padding: 2px 5px; border-radius: 3px; }
        
        /* 十神颜色类 */
        .shen-bishang { color: #4a148c; background-color: rgba(74, 20, 140, 0.1); }
        .shen-jiecai { color: #6a1b9a; background-color: rgba(106, 27, 154, 0.1); }
        .shen-shishen { color: #ab47bc; background-color: rgba(171, 71, 188, 0.1); }
        .shen-shangguan { color: #7b1fa2; background-color: rgba(123, 31, 162, 0.1); }
        .shen-zhengyin { color: #4527a0; background-color: rgba(69, 39, 160, 0.1); }
        .shen-pianyin { color: #5e35b1; background-color: rgba(94, 53, 177, 0.1); }
        .shen-zhengguan { color: #283593; background-color: rgba(40, 53, 147, 0.1); }
        .shen-qisha { color: #303f9f; background-color: rgba(48, 63, 159, 0.1); }
        .shen-zhengcai { color: #0277bd; background-color: rgba(2, 119, 189, 0.1); }
        .shen-piancai { color: #0288d1; background-color: rgba(2, 136, 209, 0.1); }
        
        /* 点击交互效果 */
        .clickable-element {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .clickable-element:hover {
            transform: scale(1.05);
        }
        
        .clickable-element:active {
            transform: scale(0.95);
        }
        
        .clickable-element.active {
            box-shadow: 0 0 0 3px rgba(237, 28, 36, 0.3);
        }
        
        /* 教学提示框 */
        .teaching-tip {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 350px;
            z-index: 1000;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.5s ease;
            border-left: 5px solid var(--primary-color);
        }
        
        .teaching-tip.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .teaching-tip h4 {
            margin-top: 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .teaching-tip p {
            margin-bottom: 0;
            line-height: 1.6;
        }
        
        .close-tip {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #999;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .learning-tabs {
                overflow-x: auto;
                padding-bottom: 10px;
                flex-wrap: nowrap;
                justify-content: flex-start;
            }
            
            .learning-tab {
                flex-shrink: 0;
            }
            
            .wuxing-balance {
                flex-wrap: wrap;
            }
            
            .wuxing-item {
                flex: 0 0 calc(20% - 8px);
            }
            
            .special-patterns {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <main class="content-container">
        <div class="content-title">
            <h1>八字计算器</h1>
            <p>输入您的出生信息，生成完整八字命盘并学习命理知识</p>
        </div>

        <div class="content-section">
            <div class="calculator-form">
                <div class="form-header">
                    <h2 style="color: white;"><i class="fas fa-user-circle"></i> 基本信息输入</h2>
                    <p style="color: white;">请填写您的出生信息以生成八字命盘</p>
                </div>
                <form id="bazi-form" class="elegant-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-date"><i class="far fa-calendar-alt"></i> 出生日期</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar-day"></i>
                                <input type="date" id="birth-date" name="birth-date" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="far fa-clock"></i> 出生时间</label>
                            <div class="time-select-group">
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-start"></i>
                                    <select id="birth-hour" name="birth-hour" required>
                                        <option value="">-- 时 --</option>
                                        <script>
                                            for(let i=0; i<24; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}时</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-end"></i>
                                    <select id="birth-minute" name="birth-minute" required>
                                        <option value="">-- 分 --</option>
                                        <script>
                                            for(let i=0; i<60; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}分</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone"><i class="fas fa-globe-asia"></i> 出生地区</label>
                            <div class="select-with-icon">
                                <i class="fas fa-map-marker-alt"></i>
                                <select id="timezone" name="timezone" required>
                                    <option value="8">中国标准时间 (UTC+8)</option>
                                    <option value="-8">太平洋时间 (UTC-8)</option>
                                    <option value="-5">东部时间 (UTC-5)</option>
                                    <option value="0">格林尼治时间 (UTC+0)</option>
                                    <option value="9">日本标准时间 (UTC+9)</option>
                                    <option value="-7">山地时间 (UTC-7)</option>
                                    <option value="-6">中部时间 (UTC-6)</option>
                                    <option value="1">中欧时间 (UTC+1)</option>
                                    <option value="10">澳大利亚东部时间 (UTC+10)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-venus-mars"></i> 性别</label>
                            <div class="gender-group">
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="male" checked>
                                    <span class="gender-icon"><i class="fas fa-mars"></i></span>
                                    <span class="gender-text">男</span>
                                </label>
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="female">
                                    <span class="gender-icon"><i class="fas fa-venus"></i></span>
                                    <span class="gender-text">女</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-calculator"></i> 计算八字</button>
                        <button type="reset" class="btn btn-secondary"><i class="fas fa-redo"></i> 重置</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="content-section" id="result-section" style="display: none;">
            <div class="result-header">
                <h2><i class="fas fa-chart-pie"></i> 八字命盘结果</h2>
                <div class="result-actions">
                    <button id="print-btn" class="btn btn-action"><i class="fas fa-print"></i> 打印</button>
                    <button id="save-btn" class="btn btn-action"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
            
            <div class="bazi-result">
                <div class="basic-info-card">
                    <h3><i class="fas fa-info-circle"></i> 基本信息</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">出生日期：</span>
                            <span class="info-value" id="result-date">1984年1月1日</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出生时间：</span>
                            <span class="info-value" id="result-time">23:00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">农历日期：</span>
                            <span class="info-value" id="result-lunar">癸亥年腊月初八</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">生肖：</span>
                            <span class="info-value" id="result-zodiac">鼠</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">命宫：</span>
                            <span class="info-value" id="result-minggong">卯宫</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">身宫：</span>
                            <span class="info-value" id="result-shengong">酉宫</span>
                        </div>
                    </div>
                </div>
                
                <div class="bazi-table-container">
                    <table class="bazi-elegant-table">
                        <thead>
                            <tr>
                                <th>四柱</th>
                                <th>年柱</th>
                                <th>月柱</th>
                                <th>日柱</th>
                                <th>时柱</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="pillar-label">天干</td>
                                <td class="wuxing-water" id="year-stem">癸<br><span class="ten-god">(比肩)</span></td>
                                <td class="wuxing-earth" id="month-stem">己<br><span class="ten-god">(劫财)</span></td>
                                <td class="wuxing-fire" id="day-stem">丙<br><span class="ten-god">(日元)</span></td>
                                <td class="wuxing-fire" id="hour-stem">丁<br><span class="ten-god">(伤官)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">地支</td>
                                <td class="wuxing-water" id="year-branch">亥<br><span class="ten-god">(正官)</span></td>
                                <td class="wuxing-earth" id="month-branch">丑<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-wood" id="day-branch">寅<br><span class="ten-god">(偏印)</span></td>
                                <td class="wuxing-wood" id="hour-branch">卯<br><span class="ten-god">(正印)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">藏干</td>
                                <td class="wuxing-water" id="year-hidden-god">壬(七杀)<br>甲(偏印)</td>
                                <td class="wuxing-earth" id="month-hidden-god">己(劫财)<br>癸(比肩)<br>辛(正财)</td>
                                <td class="wuxing-wood" id="day-hidden-god">甲(偏印)<br>丙(比肩)<br>戊(食神)</td>
                                <td class="wuxing-wood" id="hour-hidden-god">乙(正印)</td>
                            </tr>
                            <tr>
                                <td class="pillar-label">空亡</td>
                                <td id="year-void">戌亥</td>
                                <td id="month-void">戌亥</td>
                                <td id="day-void">戌亥</td>
                                <td id="hour-void">戌亥</td>
                            </tr>
                            <tr>
                                <td class="pillar-label">纳音</td>
                                <td id="year-nayin">大海水</td>
                                <td id="month-nayin">霹雳火</td>
                                <td id="day-nayin">炉中火</td>
                                <td id="hour-nayin">炉中火</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 新增的互动学习区域 -->
            <div class="learning-section" id="learning-section" style="display: none;">
                <h3><i class="fas fa-graduation-cap"></i> 八字命盘分析学习</h3>
                <p>点击下方标签，学习您八字命盘中的各种命理知识</p>
                
                <div class="learning-tabs">
                    <div class="learning-tab active" data-tab="strength">身强身弱分析</div>
                    <div class="learning-tab" data-tab="tengod">十神分析</div>
                    <div class="learning-tab" data-tab="wuxing">五行平衡分析</div>
                    <div class="learning-tab" data-tab="patterns">特殊组合分析</div>
                    <div class="learning-tab" data-tab="usegod">用神与忌神</div>
                    <div class="learning-tab" data-tab="luck">命盘运势分析</div>
                </div>
                
                <div class="learning-content active" id="strength-content">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
                
                <div class="learning-content" id="tengod-content">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
                
                <div class="learning-content" id="wuxing-content">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
                
                <div class="learning-content" id="patterns-content">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
                
                <div class="learning-content" id="usegod-content">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
                
                <div class="learning-content" id="luck-content">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 麦八字教学网. 保留所有权利.</p>
            <p>传承经典命理文化，科学学习八字知识</p>
        </div>
    </footer>
    
    <!-- 教学提示框 -->
    <div class="teaching-tip" id="teaching-tip">
        <button class="close-tip">&times;</button>
        <h4><i class="fas fa-lightbulb"></i> 学习提示</h4>
        <p id="tip-content">点击八字表格中的元素，可以查看它们在命理分析中的具体作用和解释。</p>
    </div>

    <script src="../js/lunar.js"></script>
    <script src="../js/main1.js"></script>
    
    <script>
        // 八字分析核心逻辑
        class BaziAnalyzer {
            constructor(baziData) {
                this.baziData = baziData;
                this.dayStem = baziData.dayStem;
                this.stems = [baziData.yearStem, baziData.monthStem, baziData.dayStem, baziData.hourStem];
                this.branches = [baziData.yearBranch, baziData.monthBranch, baziData.dayBranch, baziData.hourBranch];
                this.hiddenStems = baziData.hiddenStems;
                this.gender = baziData.gender;
                this.tenGods = this.calculateTenGods();
                this.wuxingCount = this.countWuxing();
                this.strength = this.analyzeStrength();
                this.patterns = this.identifyPatterns();
                this.useGod = this.determineUseGod();
                this.luck = this.calculateLuck();
            }
            
            // 计算十神关系
            calculateTenGods() {
                const tenGodMap = {
                    '甲': { '甲':'比肩', '乙':'劫财', '丙':'食神', '丁':'伤官', '戊':'偏财', '己':'正财', '庚':'七杀', '辛':'正官', '壬':'偏印', '癸':'正印' },
                    '乙': { '甲':'劫财', '乙':'比肩', '丙':'伤官', '丁':'食神', '戊':'正财', '己':'偏财', '庚':'正官', '辛':'七杀', '壬':'正印', '癸':'偏印' },
                    '丙': { '甲':'偏印', '乙':'正印', '丙':'比肩', '丁':'劫财', '戊':'食神', '己':'伤官', '庚':'偏财', '辛':'正财', '壬':'七杀', '癸':'正官' },
                    '丁': { '甲':'正印', '乙':'偏印', '丙':'劫财', '丁':'比肩', '戊':'伤官', '己':'食神', '庚':'正财', '辛':'偏财', '壬':'正官', '癸':'七杀' },
                    '戊': { '甲':'七杀', '乙':'正官', '丙':'偏印', '丁':'正印', '戊':'比肩', '己':'劫财', '庚':'食神', '辛':'伤官', '壬':'偏财', '癸':'正财' },
                    '己': { '甲':'正官', '乙':'七杀', '丙':'正印', '丁':'偏印', '戊':'劫财', '己':'比肩', '庚':'伤官', '辛':'食神', '壬':'正财', '癸':'偏财' },
                    '庚': { '甲':'偏财', '乙':'正财', '丙':'七杀', '丁':'正官', '戊':'偏印', '己':'正印', '庚':'比肩', '辛':'劫财', '壬':'食神', '癸':'伤官' },
                    '辛': { '甲':'正财', '乙':'偏财', '丙':'正官', '丁':'七杀', '戊':'正印', '己':'偏印', '庚':'劫财', '辛':'比肩', '壬':'伤官', '癸':'食神' },
                    '壬': { '甲':'食神', '乙':'伤官', '丙':'偏财', '丁':'正财', '戊':'七杀', '己':'正官', '庚':'偏印', '辛':'正印', '壬':'比肩', '癸':'劫财' },
                    '癸': { '甲':'伤官', '乙':'食神', '丙':'正财', '丁':'偏财', '戊':'正官', '己':'七杀', '庚':'正印', '辛':'偏印', '壬':'劫财', '癸':'比肩' }
                };
                
                const tenGods = {};
                for (let i = 0; i < 4; i++) {
                    tenGods[`stem${i}`] = tenGodMap[this.dayStem][this.stems[i]];
                    tenGods[`branch${i}`] = tenGodMap[this.dayStem][this.branches[i]];
                    
                    // 处理藏干十神
                    if (this.hiddenStems[i]) {
                        const hiddenGods = this.hiddenStems[i].split(',').map(item => {
                            const [stem, god] = item.split('(');
                            return `${stem}(${tenGodMap[this.dayStem][stem]})`;
                        });
                        tenGods[`hidden${i}`] = hiddenGods.join('<br>');
                    }
                }
                
                return tenGods;
            }
            
            // 统计五行数量
            countWuxing() {
                const wuxingMap = {
                    '甲': '木', '乙': '木', '寅': '木', '卯': '木',
                    '丙': '火', '丁': '火', '巳': '火', '午': '火',
                    '戊': '土', '己': '土', '辰': '土', '戌': '土', '丑': '土', '未': '土',
                    '庚': '金', '辛': '金', '申': '金', '酉': '金',
                    '壬': '水', '癸': '水', '亥': '水', '子': '水'
                };
                
                const count = { '木': 0, '火': 0, '土': 0, '金': 0, '水': 0 };
                
                // 统计天干地支五行
                [...this.stems, ...this.branches].forEach(item => {
                    count[wuxingMap[item]]++;
                });
                
                // 统计藏干五行
                this.hiddenStems.forEach(hidden => {
                    if (hidden) {
                        hidden.split(',').forEach(item => {
                            const stem = item.split('(')[0];
                            count[wuxingMap[stem]] += 0.5; // 藏干按0.5计算
                        });
                    }
                });
                
                return count;
            }
            
            // 分析身强身弱
            analyzeStrength() {
                const wuxing = this.wuxingCount;
                const dayStem = this.dayStem;
                const monthBranch = this.branches[1];
                
                // 五行比例
                const total = Object.values(wuxing).reduce((a, b) => a + b, 0);
                const dayElement = this.getWuxing(dayStem);
                const dayElementRatio = wuxing[dayElement] / total;
                
                // 得令判断
                const seasonStrength = this.getSeasonStrength(dayStem, monthBranch);
                
                // 得地判断
                const rootStrength = this.getRootStrength();
                
                // 得势判断
                const supportStrength = this.getSupportStrength();
                
                // 综合判断
                let strength;
                if (dayElementRatio > 0.35 && seasonStrength > 0.6 && rootStrength > 0.6) {
                    strength = '身强';
                } else if (dayElementRatio < 0.25 && seasonStrength < 0.4 && rootStrength < 0.4) {
                    strength = '身弱';
                } else if ((dayElementRatio > 0.3 && supportStrength > 0.5) || 
                          (seasonStrength > 0.5 && rootStrength > 0.5)) {
                    strength = '偏强';
                } else {
                    strength = '偏弱';
                }
                
                return {
                    strength,
                    dayElement,
                    dayElementRatio: (dayElementRatio * 100).toFixed(1),
                    seasonStrength: (seasonStrength * 100).toFixed(0),
                    rootStrength: (rootStrength * 100).toFixed(0),
                    supportStrength: (supportStrength * 100).toFixed(0),
                    reasoning: this.getStrengthReasoning(strength)
                };
            }
            
            getSeasonStrength(dayStem, monthBranch) {
                const seasonMap = {
                    '寅': ['甲', '丙', '戊'], // 春木旺
                    '卯': ['甲', '乙'],
                    '辰': ['乙', '戊', '癸'],
                    '巳': ['丙', '戊', '庚'], // 夏火旺
                    '午': ['丁', '己'],
                    '未': ['己', '丁', '乙'],
                    '申': ['庚', '壬', '戊'], // 秋金旺
                    '酉': ['辛'],
                    '戌': ['辛', '丁', '戊'],
                    '亥': ['壬', '甲'], // 冬水旺
                    '子': ['癸'],
                    '丑': ['己', '癸', '辛']
                };
                
                const monthStems = seasonMap[monthBranch] || [];
                const dayElement = this.getWuxing(dayStem);
                
                // 判断是否得令
                if (monthStems.includes(dayStem)) {
                    return 0.8; // 本气透出
                }
                
                // 判断是否得生
                const generatingElements = {
                    '木': ['水'],
                    '火': ['木'],
                    '土': ['火'],
                    '金': ['土'],
                    '水': ['金']
                };
                
                const generating = generatingElements[dayElement] || [];
                if (monthStems.some(stem => generating.includes(this.getWuxing(stem)))) {
                    return 0.6; // 得生
                }
                
                // 判断是否被克
                const controllingElements = {
                    '木': ['金'],
                    '火': ['水'],
                    '土': ['木'],
                    '金': ['火'],
                    '水': ['土']
                };
                
                const controlling = controllingElements[dayElement] || [];
                if (monthStems.some(stem => controlling.includes(this.getWuxing(stem)))) {
                    return 0.3; // 被克
                }
                
                return 0.5; // 中性
            }
            
            getRootStrength() {
                const dayStem = this.dayStem;
                const dayBranch = this.branches[2];
                const rootMap = {
                    '甲': ['寅', '卯', '辰'], 
                    '乙': ['寅', '卯', '辰'],
                    '丙': ['巳', '午', '未'],
                    '丁': ['巳', '午', '未'],
                    '戊': ['辰', '戌', '丑', '未'],
                    '己': ['辰', '戌', '丑', '未'],
                    '庚': ['申', '酉', '戌'],
                    '辛': ['申', '酉', '戌'],
                    '壬': ['亥', '子', '丑'],
                    '癸': ['亥', '子', '丑']
                };
                
                // 日支是否为根
                const hasRoot = rootMap[dayStem]?.includes(dayBranch) || false;
                
                // 其他地支是否有根
                const otherRoots = this.branches.filter((_, i) => i !== 2)
                    .filter(branch => rootMap[dayStem]?.includes(branch)).length;
                
                return hasRoot ? 0.7 + otherRoots * 0.1 : otherRoots * 0.2;
            }
            
            getSupportStrength() {
                const dayElement = this.getWuxing(this.dayStem);
                const generatingElements = {
                    '木': ['水'],
                    '火': ['木'],
                    '土': ['火'],
                    '金': ['土'],
                    '水': ['金']
                };
                
                const generating = generatingElements[dayElement] || [];
                const same = [dayElement];
                
                let support = 0;
                [...this.stems, ...this.branches].forEach(item => {
                    const element = this.getWuxing(item);
                    if (generating.includes(element)) support += 0.1;
                    if (same.includes(element)) support += 0.15;
                });
                
                // 藏干支持
                this.hiddenStems.forEach(hidden => {
                    if (hidden) {
                        hidden.split(',').forEach(item => {
                            const stem = item.split('(')[0];
                            const element = this.getWuxing(stem);
                            if (generating.includes(element)) support += 0.05;
                            if (same.includes(element)) support += 0.08;
                        });
                    }
                });
                
                return Math.min(support, 1);
            }
            
            getStrengthReasoning(strength) {
                const dayElement = this.getWuxing(this.dayStem);
                const reasoning = {
                    '身强': `您的八字日主${this.dayStem}(${dayElement})得令、得地、得势，五行中${dayElement}元素旺盛，属于身强的命格。身强之人通常精力充沛，行动力强，但需注意避免过于强势和急躁。`,
                    '偏强': `您的八字日主${this.dayStem}(${dayElement})在五行中力量较强，但并非极强。这种命格通常具有较好的抗压能力，做事有韧性，但需注意平衡，避免过于自我。`,
                    '偏弱': `您的八字日主${this.dayStem}(${dayElement})在五行中力量偏弱。这种命格通常较为敏感细腻，但抗压能力稍弱，适合团队合作或借助他人力量发展。`,
                    '身弱': `您的八字日主${this.dayStem}(${dayElement})不得令、不得地、不得势，五行中${dayElement}元素较弱，属于身弱的命格。身弱之人通常较为温和，但容易受外界影响，需注意培养自信和决断力。`
                };
                
                return reasoning[strength] || '您的八字命格较为平衡，无明显偏强偏弱特征。';
            }
            
            // 识别特殊组合
            identifyPatterns() {
                const patterns = [];
                const stems = this.stems.join('');
                const branches = this.branches.join('');
                const dayStem = this.dayStem;
                const dayBranch = this.branches[2];
                
                // 木火通明
                if ((stems.match(/[甲乙丙丁]/g) || []).length >= 3 && 
                    (branches.match(/[寅卯巳午]/g) || []).length >= 2) {
                    patterns.push({
                        name: '木火通明',
                        description: '木火相生，智慧超群，文采斐然。适合从事文化教育、创意策划等工作。'
                    });
                }
                
                // 印绶护身
                if (this.tenGods.stem0.includes('印') || this.tenGods.stem1.includes('印') || 
                    this.tenGods.hidden0?.includes('印') || this.tenGods.hidden1?.includes('印')) {
                    patterns.push({
                        name: '印绶护身',
                        description: '印星透干或藏支，象征有贵人扶持，学业运佳，晚年福厚。'
                    });
                }
                
                // 日坐长生
                const changshengMap = {
                    '甲': '亥', '乙': '午', '丙': '寅', '丁': '酉', '戊': '寅',
                    '己': '酉', '庚': '巳', '辛': '子', '壬': '申', '癸': '卯'
                };
                if (dayBranch === changshengMap[dayStem]) {
                    patterns.push({
                        name: '日坐长生',
                        description: '日支为长生之地，象征生命力强，发展潜力大，中年后运势提升。'
                    });
                }
                
                // 三合局/半合局
                const sanheMap = {
                    '木': ['亥', '卯', '未'],
                    '火': ['寅', '午', '戌'],
                    '金': ['巳', '酉', '丑'],
                    '水': ['申', '子', '辰']
                };
                
                Object.entries(sanheMap).forEach(([element, branches]) => {
                    const count = branches.filter(b => this.branches.includes(b)).length;
                    if (count >= 2) {
                        patterns.push({
                            name: `${element}局${count === 2 ? '半合' : '三合'}`,
                            description: `地支形成${element}局，增强${element}的力量，影响性格和运势。`
                        });
                    }
                });
                
                return patterns.length > 0 ? patterns : [{
                    name: '普通格局',
                    description: '您的八字无明显特殊组合，属于普通格局。'
                }];
            }
            
            // 确定用神忌神
            determineUseGod() {
                const { strength, dayElement } = this.strength;
                const wuxing = this.wuxingCount;
                
                // 五行生克关系
                const generating = {  // 生我的
                    '木': '水',
                    '火': '木',
                    '土': '火',
                    '金': '土',
                    '水': '金'
                };
                
                const controlling = {  // 克我的
                    '木': '金',
                    '火': '水',
                    '土': '木',
                    '金': '火',
                    'h2o': '土'
                };
                
                const generated = {  // 我生的
                    '木': '火',
                    '火': '土',
                    '土': '金',
                    '金': '水',
                    '水': '木'
                };
                
                const controlled = {  // 我克的
                    '木': '土',
                    '火': '金',
                    '土': '水',
                    '金': '木',
                    '水': '火'
                };
                
                let useGod, hateGod;
                
                if (strength.includes('强')) {
                    // 身强宜克泄耗
                    useGod = [controlling[dayElement], generated[dayElement], controlled[dayElement]];
                    hateGod = [generating[dayElement], dayElement];
                } else {
                    // 身弱宜生扶
                    useGod = [generating[dayElement], dayElement];
                    hateGod = [controlling[dayElement], generated[dayElement], controlled[dayElement]];
                }
                
                // 根据五行平衡调整
                const sortedWuxing = Object.entries(wuxing).sort((a, b) => a[1] - b[1]);
                const weakest = sortedWuxing[0][0];
                const strongest = sortedWuxing[sortedWuxing.length - 1][0];
                
                if (!useGod.includes(weakest) && !hateGod.includes(weakest)) {
                    useGod.push(weakest);
                }
                
                if (!hateGod.includes(strongest) && !useGod.includes(strongest)) {
                    hateGod.push(strongest);
                }
                
                return {
                    useGod: [...new Set(useGod)],
                    hateGod: [...new Set(hateGod)],
                    suggestion: this.getUseGodSuggestion(useGod, hateGod)
                };
            }
            
            getUseGodSuggestion(useGod, hateGod) {
                const elementNames = { '木': '木', '火': '火', '土': '土', '金': '金', '水': '水' };
                const colorMap = { '木': '绿色', '火': '红色', '土': '黄色', '金': '白色', '水': '黑色' };
                const directionMap = { '木': '东方', '火': '南方', '土': '中部', '金': '西方', '水': '北方' };
                const industryMap = {
                    '木': '教育、文化、出版、园艺',
                    '火': '能源、娱乐、餐饮、传媒',
                    '土': '房地产、建筑、农业',
                    '金': '金融、法律、机械、珠宝',
                    '水': '物流、旅游、贸易、渔业'
                };
                
                const useElements = useGod.map(el => elementNames[el]).join('、');
                const hateElements = hateGod.map(el => elementNames[el]).join('、');
                
                let suggestion = `您的八字用神为${useElements}，喜神为${useGod[0]}，忌神为${hateElements}。\n\n`;
                suggestion += `建议：\n`;
                suggestion += `1. 职业选择：适合${useGod.map(el => industryMap[el]).join('或')}等行业\n`;
                suggestion += `2. 颜色搭配：多使用${useGod.map(el => colorMap[el]).join('、')}，少用${hateGod.map(el => colorMap[el]).join('、')}\n`;
                suggestion += `3. 方位选择：适合${useGod.map(el => directionMap[el]).join('、')}发展，${hateGod.map(el => directionMap[el]).join('、')}不利\n`;
                
                return suggestion;
            }
            
            // 计算大运流年
            calculateLuck() {
                const birthYear = parseInt(this.baziData.birthDate.split('-')[0]);
                const gender = this.gender;
                const dayStem = this.dayStem;
                
                // 大运排法（简化版）
                const maleLuckOrder = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                const femaleLuckOrder = ['癸', '壬', '辛', '庚', '己', '戊', '丁', '丙', '乙', '甲'];
                
                const isYang = ['甲', '丙', '戊', '庚', '壬'].includes(dayStem);
                const luckOrder = (gender === 'male' && isYang) || (gender === 'female' && !isYang) ? 
                    maleLuckOrder : femaleLuckOrder;
                
                const currentIndex = luckOrder.indexOf(this.baziData.yearStem);
                const luckCycles = [];
                
                for (let i = 0; i < 8; i++) {
                    const stemIndex = (currentIndex + i) % 10;
                    const branchIndex = (stemIndex + 2) % 12; // 简化配对
                    
                    const stem = luckOrder[stemIndex];
                    const branch = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'][branchIndex];
                    
                    const startAge = i * 10 + 1;
                    const startYear = birthYear + startAge - 1;
                    
                    luckCycles.push({
                        stem,
                        branch,
                        stemBranch: stem + branch,
                        startAge,
                        endAge: startAge + 9,
                        startYear,
                        endYear: startYear + 9,
                        element: this.getWuxing(stem),
                        luckType: this.analyzeLuckType(stem, branch)
                    });
                }
                
                // 当前大运
                const currentYear = new Date().getFullYear();
                const currentLuck = luckCycles.find(luck => 
                    currentYear >= luck.startYear && currentYear <= luck.endYear) || luckCycles[0];
                
                // 流年分析
                const currentStemBranch = this.getCurrentYearStemBranch(currentYear);
                
                return {
                    luckCycles,
                    currentLuck,
                    currentYear,
                    currentStemBranch,
                    yearAnalysis: this.analyzeYearLuck(currentStemBranch, currentLuck)
                };
            }
            
            analyzeLuckType(stem, branch) {
                const dayElement = this.getWuxing(this.dayStem);
                const stemElement = this.getWuxing(stem);
                const branchElement = this.getWuxing(branch);
                
                // 用神判断
                const { useGod, hateGod } = this.useGod;
                
                if (useGod.includes(stemElement) || useGod.includes(branchElement)) {
                    return 'good';
                } else if (hateGod.includes(stemElement) || hateGod.includes(branchElement)) {
                    return 'bad';
                }
                return 'neutral';
            }
            
            getCurrentYearStemBranch(year) {
                const stemList = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                const branchList = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                
                const startYear = 1984; // 甲子年
                const offset = (year - startYear) % 60;
                const stemIndex = offset % 10;
                const branchIndex = offset % 12;
                
                return stemList[stemIndex] + branchList[branchIndex];
            }
            
            analyzeYearLuck(yearStemBranch, currentLuck) {
                const yearStem = yearStemBranch[0];
                const yearBranch = yearStemBranch[1];
                
                // 流年与命盘关系
                const clashes = this.checkClashes(yearBranch);
                const combinations = this.checkCombinations(yearBranch);
                
                // 流年十神
                const yearTenGod = this.tenGods.stem0.replace(/.+\((.+)\)/, '$1'); // 简化处理
                
                // 流年吉凶
                const { useGod, hateGod } = this.useGod;
                const yearStemElement = this.getWuxing(yearStem);
                const yearBranchElement = this.getWuxing(yearBranch);
                
                let luckType;
                if (useGod.includes(yearStemElement) || useGod.includes(yearBranchElement)) {
                    luckType = 'good';
                } else if (hateGod.includes(yearStemElement) || hateGod.includes(yearBranchElement)) {
                    luckType = 'bad';
                } else {
                    luckType = 'neutral';
                }
                
                return {
                    stemBranch: yearStemBranch,
                    stem: yearStem,
                    branch: yearBranch,
                    tenGod: yearTenGod,
                    luckType,
                    clashes,
                    combinations,
                    suggestion: this.getYearSuggestion(yearStemBranch, luckType, clashes, combinations)
                };
            }
            
            checkClashes(yearBranch) {
                const clashMap = {
                    '子': '午', '丑': '未', '寅': '申', '卯': '酉', '辰': '戌', '巳': '亥',
                    '午': '子', '未': '丑', '申': '寅', '酉': '卯', '戌': '辰', '亥': '巳'
                };
                
                return this.branches
                    .filter(branch => clashMap[branch] === yearBranch)
                    .map(branch => `${branch}冲${yearBranch}`);
            }
            
            checkCombinations(yearBranch) {
                const combinationMap = {
                    '子': ['丑'],
                    '寅': ['亥'],
                    '卯': ['戌'],
                    '辰': ['酉'],
                    '巳': ['申'],
                    '午': ['未'],
                    '未': ['午'],
                    '申': ['巳'],
                    '酉': ['辰'],
                    '戌': ['卯'],
                    '亥': ['寅'],
                    '丑': ['子']
                };
                
                return this.branches
                    .filter(branch => combinationMap[branch]?.includes(yearBranch))
                    .map(branch => `${branch}合${yearBranch}`);
            }
            
            getYearSuggestion(yearStemBranch, luckType, clashes, combinations) {
                let suggestion = '';
                
                if (luckType === 'good') {
                    suggestion += `${yearStemBranch}年是您的吉运年，适合开拓进取，把握机会。`;
                } else if (luckType === 'bad') {
                    suggestion += `${yearStemBranch}年运势较弱，需谨慎行事，守成为上。`;
                } else {
                    suggestion += `${yearStemBranch}年运势平稳，宜稳扎稳打，积累资源。`;
                }
                
                if (clashes.length > 0) {
                    suggestion += ` 注意：流年与命盘形成${clashes.join('、')}，易有变动冲突，需提前防范。`;
                }
                
                if (combinations.length > 0) {
                    suggestion += ` 流年与命盘形成${combinations.join('、')}，人际关系和合作运较好。`;
                }
                
                return suggestion;
            }
            
            // 辅助方法
            getWuxing(ganzhi) {
                const wuxingMap = {
                    '甲': '木', '乙': '木', '寅': '木', '卯': '木',
                    '丙': '火', '丁': '火', '巳': '火', '午': '火',
                    '戊': '土', '己': '土', '辰': '土', '戌': '土', '丑': '土', '未': '土',
                    '庚': '金', '辛': '金', '申': '金', '酉': '金',
                    '壬': '水', '癸': '水', '亥': '水', '子': '水'
                };
                return wuxingMap[ganzhi] || '';
            }
            
            getElementClass(element) {
                return {
                    '木': 'wuxing-wood',
                    '火': 'wuxing-fire',
                    '土': 'wuxing-earth',
                    '金': 'wuxing-metal',
                    '水': 'wuxing-water'
                }[element] || '';
            }
            
            getTenGodClass(tenGod) {
                return {
                    '比肩': 'shen-bishang',
                    '劫财': 'shen-jiecai',
                    '食神': 'shen-shishen',
                    '伤官': 'shen-shangguan',
                    '偏印': 'shen-pianyin',
                    '正印': 'shen-zhengyin',
                    '七杀': 'shen-qisha',
                    '正官': 'shen-zhengguan',
                    '偏财': 'shen-piancai',
                    '正财': 'shen-zhengcai'
                }[tenGod] || '';
            }
        }
        
        // 页面交互逻辑
        document.addEventListener('DOMContentLoaded', function() {
            // 显示结果区域
            document.getElementById('bazi-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 获取表单数据
                const birthDate = document.getElementById('birth-date').value;
                const birthHour = parseInt(document.getElementById('birth-hour').value);
                const birthMinute = parseInt(document.getElementById('birth-minute').value);
                const timezone = parseInt(document.getElementById('timezone').value);
                const gender = document.querySelector('input[name="gender"]:checked').value;
                
                // 生成八字数据（模拟，实际应调用专业八字计算库）
                const baziData = generateBaziData(birthDate, birthHour, birthMinute, timezone, gender);
                
                // 显示结果
                displayBaziResult(baziData);
                
                // 分析八字
                const analyzer = new BaziAnalyzer(baziData);
                
                // 显示分析结果
                displayAnalysisResults(analyzer);
                
                document.getElementById('result-section').style.display = 'block';
                document.getElementById('learning-section').style.display = 'block';
                setTimeout(function() {
                    document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            });
            
            // 生成八字数据（模拟）
            function generateBaziData(birthDate, hour, minute, timezone, gender) {
                // 这里应该是调用专业的八字计算库
                // 以下为模拟数据，实际应用中需要替换为真实计算逻辑
                const dateParts = birthDate.split('-');
                const year = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]);
                const day = parseInt(dateParts[2]);
                
                // 模拟根据日期计算八字
                const stems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                const branches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                
                // 年柱 (简化计算)
                const yearIndex = (year - 4) % 60;
                const yearStem = stems[yearIndex % 10];
                const yearBranch = branches[yearIndex % 12];
                
                // 月柱 (简化计算)
                const monthIndex = (yearIndex * 12 + month + 12) % 60;
                const monthStem = stems[monthIndex % 10];
                const monthBranch = branches[monthIndex % 12];
                
                // 日柱 (简化计算)
                const dayIndex = (yearIndex * 365 + month * 30 + day) % 60;
                const dayStem = stems[dayIndex % 10];
                const dayBranch = branches[dayIndex % 12];
                
                // 时柱 (简化计算)
                const hourIndex = (dayIndex * 12 + Math.floor(hour / 2)) % 60;
                const hourStem = stems[hourIndex % 10];
                const hourBranch = branches[hourIndex % 12];
                
                // 藏干 (模拟)
                const hiddenStems = [
                    getHiddenStems(yearBranch),
                    getHiddenStems(monthBranch),
                    getHiddenStems(dayBranch),
                    getHiddenStems(hourBranch)
                ];
                
                // 空亡 (模拟)
                const voidList = ['戌亥', '申酉', '午未', '辰巳', '寅卯', '子丑'];
                const voidIndex = (yearIndex + monthIndex) % 6;
                const voidData = voidList[voidIndex];
                
                // 纳音 (模拟)
                const nayinList = ['海中金', '炉中火', '大林木', '路旁土', '剑锋金', '山头火'];
                const nayinIndex = (yearIndex + monthIndex + dayIndex) % 6;
                const nayinData = nayinList[nayinIndex];
                
                return {
                    birthDate,
                    hour,
                    minute,
                    timezone,
                    gender,
                    yearStem,
                    yearBranch,
                    monthStem,
                    monthBranch,
                    dayStem,
                    dayBranch,
                    hourStem,
                    hourBranch,
                    hiddenStems,
                    voidData,
                    nayinData,
                    lunarDate: getLunarDate(year, month, day)
                };
            }
            
            function getHiddenStems(branch) {
                const hiddenMap = {
                    '子': '癸(正印)',
                    '丑': '己(劫财),癸(正印),辛(正财)',
                    '寅': '甲(偏印),丙(比肩),戊(食神)',
                    '卯': '乙(正印)',
                    '辰': '戊(食神),乙(正印),癸(正印)',
                    '巳': '丙(比肩),戊(食神),庚(偏财)',
                    '午': '丁(劫财),己(伤官)',
                    '未': '己(伤官),丁(劫财),乙(正印)',
                    '申': '庚(偏财),壬(七杀),戊(食神)',
                    '酉': '辛(正财)',
                    '戌': '戊(食神),辛(正财),丁(劫财)',
                    '亥': '壬(七杀),甲(偏印)'
                };
                return hiddenMap[branch] || '';
            }
            
            function getLunarDate(year, month, day) {
                // 这里应该是调用农历计算库
                // 模拟返回数据
                const lunarMonths = ['正', '二', '三', '四', '五', '六', '七', '八', '九', '十', '冬', '腊'];
                const lunarDays = ['初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
                                  '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
                                  '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'];
                
                const zodiacs = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];
                const zodiac = zodiacs[(year - 4) % 12];
                
                return {
                    year: year + '年',
                    month: lunarMonths[month - 1] + '月',
                    day: lunarDays[day - 1],
                    zodiac
                };
            }
            
            // 显示八字结果
            function displayBaziResult(baziData) {
                document.getElementById('result-date').textContent = baziData.birthDate;
                document.getElementById('result-time').textContent = `${baziData.hour}:${baziData.minute.toString().padStart(2, '0')}`;
                
                const lunar = baziData.lunarDate;
                document.getElementById('result-lunar').textContent = `${lunar.year}${lunar.month}${lunar.day}`;
                document.getElementById('result-zodiac').textContent = lunar.zodiac;
                
                // 更新八字表格
                document.getElementById('year-stem').innerHTML = `${baziData.yearStem}<br><span class="ten-god">(比肩)</span>`;
                document.getElementById('month-stem').innerHTML = `${baziData.monthStem}<br><span class="ten-god">(劫财)</span>`;
                document.getElementById('day-stem').innerHTML = `${baziData.dayStem}<br><span class="ten-god">(日元)</span>`;
                document.getElementById('hour-stem').innerHTML = `${baziData.hourStem}<br><span class="ten-god">(伤官)</span>`;
                
                document.getElementById('year-branch').innerHTML = `${baziData.yearBranch}<br><span class="ten-god">(正官)</span>`;
                document.getElementById('month-branch').innerHTML = `${baziData.monthBranch}<br><span class="ten-god">(正印)</span>`;
                document.getElementById('day-branch').innerHTML = `${baziData.dayBranch}<br><span class="ten-god">(偏印)</span>`;
                document.getElementById('hour-branch').innerHTML = `${baziData.hourBranch}<br><span class="ten-god">(正印)</span>`;
                
                document.getElementById('year-hidden-god').innerHTML = baziData.hiddenStems[0];
                document.getElementById('month-hidden-god').innerHTML = baziData.hiddenStems[1];
                document.getElementById('day-hidden-god').innerHTML = baziData.hiddenStems[2];
                document.getElementById('hour-hidden-god').innerHTML = baziData.hiddenStems[3];
                
                document.getElementById('year-void').textContent = baziData.voidData;
                document.getElementById('month-void').textContent = baziData.voidData;
                document.getElementById('day-void').textContent = baziData.voidData;
                document.getElementById('hour-void').textContent = baziData.voidData;
                
                document.getElementById('year-nayin').textContent = baziData.nayinData;
                document.getElementById('month-nayin').textContent = baziData.nayinData;
                document.getElementById('day-nayin').textContent = baziData.nayinData;
                document.getElementById('hour-nayin').textContent = baziData.nayinData;
                
                // 更新五行类
                updateWuxingClasses();
            }
            
            function updateWuxingClasses() {
                const wuxingMap = {
                    '甲': 'wood', '乙': 'wood', '寅': 'wood', '卯': 'wood',
                    '丙': 'fire', '丁': 'fire', '巳': 'fire', '午': 'fire',
                    '戊': 'earth', '己': 'earth', '辰': 'earth', '戌': 'earth', '丑': 'earth', '未': 'earth',
                    '庚': 'metal', '辛': 'metal', '申': 'metal', '酉': 'metal',
                    '壬': 'water', '癸': 'water', '亥': 'water', '子': 'water'
                };
                
                // 更新天干地支的五行类
                const stems = document.querySelectorAll('[id$="-stem"]');
                stems.forEach(el => {
                    const ganzhi = el.textContent.trim().charAt(0);
                    el.className = `wuxing-${wuxingMap[ganzhi]}`;
                });
                
                const branches = document.querySelectorAll('[id$="-branch"]');
                branches.forEach(el => {
                    const ganzhi = el.textContent.trim().charAt(0);
                    el.className = `wuxing-${wuxingMap[ganzhi]}`;
                });
                
                const hiddenGods = document.querySelectorAll('[id$="-hidden-god"]');
                hiddenGods.forEach(el => {
                    const ganzhi = el.textContent.trim().charAt(0);
                    if (wuxingMap[ganzhi]) {
                        el.className = `wuxing-${wuxingMap[ganzhi]}`;
                    }
                });
            }
            
            // 显示分析结果
            function displayAnalysisResults(analyzer) {
                displayStrengthAnalysis(analyzer);
                displayTenGodAnalysis(analyzer);
                displayWuxingAnalysis(analyzer);
                displayPatternsAnalysis(analyzer);
                displayUseGodAnalysis(analyzer);
                displayLuckAnalysis(analyzer);
            }
            
            function displayStrengthAnalysis(analyzer) {
                const { strength, dayElement, reasoning } = analyzer.strength;
                const content = `
                    <div class="analysis-card">
                        <h4 class="analysis-title"><i class="fas fa-weight"></i> 身强身弱分析</h4>
                        <div class="analysis-result">
                            您的八字日主为<span class="wuxing-${analyzer.getElementClass(dayElement)}">${analyzer.dayStem}(${dayElement})</span>，综合分析五行生克关系，属于<strong>${strength}</strong>的命格。
                        </div>
                        <div class="analysis-detail">
                            <p><strong>分析依据：</strong></p>
                            ${reasoning}
                            <p><strong>${strength}特点：</strong> ${analyzer.getStrengthReasoning(strength)}</p>
                        </div>
                    </div>
                    
                    <div class="interactive-hint">
                        <i class="fas fa-lightbulb"></i>
                        <p><strong>学习提示：</strong> 点击八字表格中的天干地支，查看它们在身强身弱分析中的作用。</p>
                    </div>
                `;
                
                document.getElementById('strength-content').innerHTML = content;
            }
            
            function displayTenGodAnalysis(analyzer) {
                const tenGods = analyzer.tenGods;
                const content = `
                    <div class="analysis-card">
                        <h4 class="analysis-title"><i class="fas fa-chess"></i> 十神分析</h4>
                        <div class="analysis-result">
                            您的八字中十神分布如下：
                            ${Object.values(tenGods).filter(god => god && typeof god === 'string').map(god => {
                                const shen = god.replace(/.+\((.+)\)/, '$1');
                                return `<span class="${analyzer.getTenGodClass(shen)}">${shen}</span>`;
                            }).join('、')}
                        </div>
                        <div class="analysis-detail">
                            <p><strong>主要十神解析：</strong></p>
                            <ul>
                                <li><span class="${analyzer.getTenGodClass('比肩')}">年干${analyzer.baziData.yearStem}比肩</span>：代表兄弟姐妹、朋友同事，象征独立自主与竞争</li>
                                <li><span class="${analyzer.getTenGodClass('劫财')}">月干${analyzer.baziData.monthStem}劫财</span>：代表竞争关系，象征合作与分享</li>
                                <li><span class="${analyzer.getTenGodClass('正印')}">月支${analyzer.baziData.monthBranch}藏干正印</span>：代表学识与贵人，象征智慧与保护</li>
                                <li><span class="${analyzer.getTenGodClass('伤官')}">时干${analyzer.baziData.hourStem}伤官</span>：代表才华与创意，象征艺术天赋</li>
                            </ul>
                            <p><strong>十神互动：</strong> 点击下方十神卡片，查看详细解释。</p>
                        </div>
                    </div>
                    
                    <div class="interactive-hint">
                        <i class="fas fa-mouse-pointer"></i>
                        <p><strong>互动学习：</strong> 点击下方十神卡片，了解它们在您命盘中的具体表现。</p>
                    </div>
                    
                    <div class="special-patterns">
                        <div class="pattern-card clickable-element" data-tengod="bishang">
                            <div class="pattern-name"><i class="fas fa-people-arrows"></i> 比肩</div>
                            <div class="pattern-desc">代表兄弟姐妹、朋友同事，象征竞争、独立与自我主张。您的年干${analyzer.baziData.yearStem}为比肩，显示您有较强的独立性和竞争意识。</div>
                        </div>
                        <div class="pattern-card clickable-element" data-tengod="jiecai">
                            <div class="pattern-name"><i class="fas fa-handshake"></i> 劫财</div>
                            <div class="pattern-desc">代表竞争、破财、朋友关系，象征合作与竞争的平衡。您的月干${analyzer.baziData.monthStem}为劫财，需注意财务管理和人际关系。</div>
                        </div>
                        <div class="pattern-card clickable-element" data-tengod="shishen">
                            <div class="pattern-name"><i class="fas fa-utensils"></i> 食神</div>
                            <div class="pattern-desc">代表才华、创造力、享乐，象征艺术天赋和生活享受。您的八字中${analyzer.baziData.dayStem}日主食神，显示您有艺术天赋。</div>
                        </div>
                        <div class="pattern-card clickable-element" data-tengod="shangguan">
                            <div class="pattern-name"><i class="fas fa-paint-brush"></i> 伤官</div>
                            <div class="pattern-desc">代表才华、反叛、自由，象征创新思维和表达能力。您的时干${analyzer.baziData.hourStem}为伤官，显示您有创造力和表达能力。</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('tengod-content').innerHTML = content;
            }
            
            function displayWuxingAnalysis(analyzer) {
                const wuxing = analyzer.wuxingCount;
                const total = Object.values(wuxing).reduce((a, b) => a + b, 0);
                const percentages = {};
                
                Object.keys(wuxing).forEach(key => {
                    percentages[key] = ((wuxing[key] / total) * 100).toFixed(1);
                });
                
                const content = `
                    <div class="analysis-card">
                        <h4 class="analysis-title"><i class="fas fa-balance-scale"></i> 五行平衡分析</h4>
                        <div class="analysis-result">
                            您的八字五行分布：
                            ${Object.entries(wuxing).map(([element, count]) => 
                                `<span class="wuxing-${analyzer.getElementClass(element)}">${element}</span> ${count > 2 ? '旺' : count > 1 ? '平' : '弱'}`
                            ).join('，')}
                        </div>
                        
                        <div class="wuxing-balance">
                            ${Object.entries(wuxing).map(([element, count]) => `
                                <div class="wuxing-item ${analyzer.getElementClass(element)}">
                                    <div class="wuxing-bar">
                                        <div class="wuxing-fill" style="height: ${percentages[element]}%"></div>
                                    </div>
                                    <div class="wuxing-label">${element}</div>
                                    <div class="wuxing-value">${count.toFixed(1)}/${total.toFixed(1)}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="analysis-detail">
                            <p><strong>五行生克关系：</strong></p>
                            <ul>
                                ${analyzer.getWuxingRelationships().map(relation => `<li>${relation}</li>`).join('')}
                            </ul>
                            <p><strong>调和建议：</strong> ${analyzer.getWuxingSuggestions()}</p>
                        </div>
                    </div>
                    
                    <div class="interactive-hint">
                        <i class="fas fa-project-diagram"></i>
                        <p><strong>互动学习：</strong> 点击五行柱状图，查看该五行在您命盘中的具体表现和生克关系。</p>
                    </div>
                `;
                
                document.getElementById('wuxing-content').innerHTML = content;
            }
            
            function displayPatternsAnalysis(analyzer) {
                const content = `
                    <div class="analysis-card">
                        <h4 class="analysis-title"><i class="fas fa-star"></i> 特殊组合分析</h4>
                        <div class="analysis-result">
                            您的八字中存在以下特殊组合：
                            ${analyzer.patterns.map(pattern => `<span class="highlight">${pattern.name}</span>`).join('、')}
                        </div>
                        <div class="analysis-detail">
                            <p><strong>特殊组合解析：</strong></p>
                            <ul>
                                ${analyzer.patterns.map(pattern => `
                                    <li><strong>${pattern.name}</strong>：${pattern.description}</li>
                                `).join('')}
                            </ul>
                            ${analyzer.patterns.some(p => p.name.includes('冲')) ? `
                                <p><strong>潜在问题：</strong> 命盘中有冲克组合，需注意健康和工作稳定性。</p>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="interactive-hint">
                        <i class="fas fa-search-plus"></i>
                        <p><strong>探索发现：</strong> 点击下方特殊组合卡片，了解它们对您命运的具体影响。</p>
                    </div>
                    
                    <div class="special-patterns">
                        ${analyzer.patterns.map(pattern => `
                            <div class="pattern-card ${pattern.name.includes('冲') ? '' : 'pattern-active'}">
                                <div class="pattern-name"><i class="fas ${getPatternIcon(pattern.name)}"></i> ${pattern.name}</div>
                                <div class="pattern-desc">${pattern.description}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                document.getElementById('patterns-content').innerHTML = content;
            }
            
            function getPatternIcon(patternName) {
                const iconMap = {
                    '木火通明': 'fa-brain',
                    '印绶护身': 'fa-shield-alt',
                    '日坐长生': 'fa-seedling',
                    '三合': 'fa-link',
                    '冲': 'fa-bolt',
                    '普通格局': 'fa-star'
                };
                
                for (const key in iconMap) {
                    if (patternName.includes(key)) {
                        return iconMap[key];
                    }
                }
                return 'fa-star';
            }
            
            function displayUseGodAnalysis(analyzer) {
                const { useGod, hateGod, suggestion } = analyzer.useGod;
                const content = `
                    <div class="analysis-card">
                        <h4 class="analysis-title"><i class="fas fa-magic"></i> 用神与忌神分析</h4>
                        <div class="analysis-result">
                            您的八字用神为${useGod.map(el => `<span class="wuxing-${analyzer.getElementClass(el)}">${el}</span>`).join('、')}，
                            忌神为${hateGod.map(el => `<span class="wuxing-${analyzer.getElementClass(el)}">${el}</span>`).join('、')}。
                        </div>
                        <div class="analysis-detail">
                            <p><strong>用神分析：</strong></p>
                            <ul>
                                ${useGod.map(el => `
                                    <li><span class="wuxing-${analyzer.getElementClass(el)}">${el}</span>为${el === useGod[0] ? '第一用神' : '喜神'}：
                                    ${getUseGodDescription(el, analyzer.strength.strength)}</li>
                                `).join('')}
                            </ul>
                            
                            <p><strong>忌神分析：</strong></p>
                            <ul>
                                ${hateGod.map(el => `
                                    <li><span class="wuxing-${analyzer.getElementClass(el)}">${el}</span>：
                                    ${getHateGodDescription(el, analyzer.strength.strength)}</li>
                                `).join('')}
                            </ul>
                            
                            <p><strong>应用建议：</strong></p>
                            ${suggestion.split('\n').map(line => `<p>${line}</p>`).join('')}
                        </div>
                    </div>
                    
                    <div class="interactive-hint">
                        <i class="fas fa-question-circle"></i>
                        <p><strong>学习思考：</strong> 为什么${useGod[0]}是您的用神？点击八字中的五行元素，查看它们在用神分析中的作用。</p>
                    </div>
                `;
                
                document.getElementById('usegod-content').innerHTML = content;
            }
            
            function getUseGodDescription(element, strength) {
                const descriptions = {
                    '木': strength.includes('强') ? '可泄身强之势，调和命局' : '可生扶日主，增强能量',
                    '火': strength.includes('强') ? '可耗身强之势，平衡五行' : '可温暖命局，增强活力',
                    '土': strength.includes('强') ? '可泄身强之势，稳定命局' : '可培育万物，增强承载力',
                    '金': strength.includes('强') ? '可克身强木势，调节平衡' : '可增强决断力，提升财运',
                    '水': strength.includes('强') ? '可制身强火势，调和命局' : '可滋润命局，增强智慧'
                };
                return descriptions[element] || '有助于平衡命局五行';
            }
            
            function getHateGodDescription(element, strength) {
                const descriptions = {
                    '木': strength.includes('强') ? '会增强身强之势，导致失衡' : '会克制用神，削弱命局',
                    '火': strength.includes('强') ? '会加剧身强之势，导致急躁' : '会消耗用神，减弱能量',
                    '土': strength.includes('强') ? '会增强身强之势，导致固执' : '会克制用神，阻碍发展',
                    '金': strength.includes('强') ? '会克制用神，不利发展' : '会增强忌神力量，削弱日主',
                    '水': strength.includes('强') ? '会生扶忌神，不利平衡' : '会克制用神，减弱活力'
                };
                return descriptions[element] || '不利于命局平衡，需避免';
            }
            
            function displayLuckAnalysis(analyzer) {
                const { luckCycles, currentLuck, currentYear, currentStemBranch, yearAnalysis } = analyzer.luck;
                const content = `
                    <div class="analysis-card">
                        <h4 class="analysis-title"><i class="fas fa-chart-line"></i> 命盘运势分析</h4>
                        <div class="analysis-result">
                            您当前处于<span class="luck-${currentLuck.luckType}">${currentLuck.stemBranch}大运(${currentLuck.startYear}-${currentLuck.endYear})</span>，
                            ${currentYear}年为<span class="wuxing-${analyzer.getElementClass(currentStemBranch[0])}">${currentStemBranch}</span>年，
                            流年与命盘形成<span class="highlight">${yearAnalysis.combinations.join('、') || '无明显特殊组合'}</span>之势。
                        </div>
                        <div class="analysis-detail">
                            <p><strong>大运分析：</strong></p>
                            <table class="luck-table">
                                <thead>
                                    <tr>
                                        <th>大运</th>
                                        <th>年龄</th>
                                        <th>年份</th>
                                        <th>五行</th>
                                        <th>吉凶</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${luckCycles.map(luck => `
                                        <tr class="${luck === currentLuck ? 'luck-current' : ''}">
                                            <td>${luck.stemBranch}</td>
                                            <td>${luck.startAge}-${luck.endAge}</td>
                                            <td>${luck.startYear}-${luck.endYear}</td>
                                            <td>${luck.element}</td>
                                            <td class="luck-${luck.luckType}">${luck.luckType === 'good' ? '吉' : luck.luckType === 'bad' ? '凶' : '平'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            
                            <p><strong>${currentYear}年流年分析：</strong></p>
                            <ul>
                                <li>流年天干<span class="wuxing-${analyzer.getElementClass(yearAnalysis.stem)}">${yearAnalysis.stem}</span>为${yearAnalysis.tenGod}，${getYearStemAnalysis(yearAnalysis.stem, yearAnalysis.tenGod)}</li>
                                <li>流年地支<span class="wuxing-${analyzer.getElementClass(yearAnalysis.branch)}">${yearAnalysis.branch}</span>${getYearBranchAnalysis(yearAnalysis.branch, analyzer.baziData)}</li>
                                <li>整体运势：${yearAnalysis.suggestion}</li>
                                <li>有利月份：${getFavorableMonths(yearAnalysis.stemBranch)}</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="interactive-hint">
                        <i class="fas fa-calendar-alt"></i>
                        <p><strong>运势探索：</strong> 点击上方大运表格中的不同行，查看各个时期的详细运势分析。</p>
                    </div>
                `;
                
                document.getElementById('luck-content').innerHTML = content;
            }
            
            function getYearStemAnalysis(stem, tenGod) {
                const analysisMap = {
                    '比肩': '象征独立自主，适合个人发展，但需注意人际关系',
                    '劫财': '易有财务往来，需注意理财，避免借贷纠纷',
                    '食神': '才华展现，适合创意工作，生活享受较多',
                    '伤官': '思维活跃，创意丰富，但需注意言行',
                    '偏财': '偏财运佳，有意外收入机会，但需谨慎投资',
                    '正财': '正财运稳定，适合踏实工作获取收入',
                    '七杀': '压力较大，但也是突破机会，需勇敢面对',
                    '正官': '事业运佳，易得领导赏识，适合职场发展',
                    '偏印': '学习运佳，适合进修，易得长辈指点',
                    '正印': '贵人运强，学业事业得助，心境平和'
                };
                return analysisMap[tenGod] || '对命盘影响较为中性';
            }
            
            function getYearBranchAnalysis(branch, baziData) {
                const branchEffects = {
                    '子': '流动性强，可能有远行或变动',
                    '丑': '稳定发展，需耐心积累',
                    '寅': '新的开始，充满活力',
                    '卯': '人际关系活跃，合作机会多',
                    '辰': '变动较大，需灵活应对',
                    '巳': '事业发展，需把握机会',
                    '午': '热情高涨，但需防冲动',
                    '未': '稳定成长，注重实际',
                    '申': '变化多端，需随机应变',
                    '酉': '专注力强，适合精细化工作',
                    '戌': '压力与机遇并存',
                    '亥': '思维活跃，灵感丰富'
                };
                
                let effect = branchEffects[branch] || '';
                
                // 检查是否与命盘有冲合
                const clashes = ['子午', '丑未', '寅申', '卯酉', '辰戌', '巳亥'];
                const combinations = ['子丑', '寅亥', '卯戌', '辰酉', '巳申', '午未'];
                
                const yearBranch = branch;
                let relation = '';
                
                for (const pillar of ['year', 'month', 'day', 'hour']) {
                    const pillarBranch = baziData[`${pillar}Branch`];
                    
                    // 检查冲
                    if (clashes.some(pair => 
                        (pair.includes(yearBranch) && pair.includes(pillarBranch)) &&
                        yearBranch !== pillarBranch)) {
                        relation += `与${pillar}柱${pillarBranch}相冲 `;
                    }
                    
                    // 检查合
                    if (combinations.some(pair => 
                        (pair.includes(yearBranch) && pair.includes(pillarBranch)) &&
                        yearBranch !== pillarBranch)) {
                        relation += `与${pillar}柱${pillarBranch}相合 `;
                    }
                }
                
                if (relation) {
                    effect += `（${relation.trim()}）`;
                }
                
                return effect;
            }
            
            function getFavorableMonths(stemBranch) {
                // 简化版，实际应根据五行生克判断
                const stem = stemBranch[0];
                const favorableElements = {
                    '甲': '水木旺的冬春季节（11月-3月）',
                    '乙': '水木旺的冬春季节（11月-3月）',
                    '丙': '木火旺的春夏季节（2月-6月）',
                    '丁': '木火旺的春夏季节（2月-6月）',
                    '戊': '火土旺的夏季（5月-8月）',
                    '己': '火土旺的夏季（5月-8月）',
                    '庚': '土金旺的夏秋季节（7月-10月）',
                    '辛': '土金旺的夏秋季节（7月-10月）',
                    '壬': '金水旺的秋冬季节（9月-1月）',
                    '癸': '金水旺的秋冬季节（9月-1月）'
                };
                
                return favorableElements[stem] || '四季皆宜';
            }
            
            // 学习标签切换
            const tabs = document.querySelectorAll('.learning-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // 移除所有active类
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.learning-content').forEach(c => c.classList.remove('active'));
                    
                    // 添加当前active类
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-content').classList.add('active');
                });
            });
            
            // 点击交互元素
            document.addEventListener('click', function(e) {
                const clickable = e.target.closest('.clickable-element');
                if (clickable) {
                    // 移除所有active类
                    document.querySelectorAll('.clickable-element').forEach(el => el.classList.remove('active'));
                    
                    // 添加当前active类
                    clickable.classList.add('active');
                    
                    // 根据数据类型显示不同提示
                    const tengod = clickable.getAttribute('data-tengod');
                    if (tengod) {
                        showTeachingTip('您点击了' + getTenGodName(tengod) + '，这是八字中的一种十神关系...');
                    }
                }
            });
            
            // 教学提示框控制
            const teachingTip = document.getElementById('teaching-tip');
            const closeTip = document.querySelector('.close-tip');
            
            closeTip.addEventListener('click', function() {
                teachingTip.classList.remove('show');
            });
            
            // 点击八字表格元素
            const baziElements = document.querySelectorAll('.bazi-elegant-table td');
            baziElements.forEach(el => {
                el.addEventListener('click', function() {
                    const content = this.textContent.trim();
                    if (content) {
                        showTeachingTip('您点击了' + content + '，这是八字中的一个重要元素...');
                    }
                });
            });
            
            // 点击五行柱状图
            document.addEventListener('click', function(e) {
                const wuxingItem = e.target.closest('.wuxing-item');
                if (wuxingItem) {
                    const wuxing = wuxingItem.querySelector('.wuxing-label').textContent;
                    showTeachingTip('您点击了五行中的' + wuxing + '，它在您的命盘中...');
                }
            });
            
            // 点击大运表格行
            document.addEventListener('click', function(e) {
                const luckRow = e.target.closest('.luck-table tbody tr');
                if (luckRow) {
                    const period = luckRow.querySelector('td:first-child').textContent;
                    showTeachingTip('您点击了' + period + '大运，这是您人生中的一个重要阶段...');
                }
            });
            
            // 辅助函数
            function showTeachingTip(message) {
                document.getElementById('tip-content').textContent = message;
                teachingTip.classList.add('show');
                
                // 8秒后自动隐藏
                setTimeout(() => {
                    teachingTip.classList.remove('show');
                }, 8000);
            }
            
            function getTenGodName(key) {
                const names = {
                    'bishang': '比肩',
                    'jiecai': '劫财',
                    'shishen': '食神',
                    'shangguan': '伤官',
                    'zhengyin': '正印',
                    'pianyin': '偏印',
                    'zhengguan': '正官',
                    'qisha': '七杀',
                    'zhengcai': '正财',
                    'piancai': '偏财'
                };
                return names[key] || '十神';
            }
            
            // 打印和保存按钮
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });
            
            document.getElementById('save-btn').addEventListener('click', function() {
                alert('八字命盘已保存（模拟功能）');
            });
        });
    </script>
</body>
</html>
