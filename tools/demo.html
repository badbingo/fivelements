<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字计算器 - 麦八字教学网</title>
    <link rel="stylesheet" href="../css/style1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/navigation.css">
    <script defer src="../js/navigation.js"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2NHJXGKS0Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-2NHJXGKS0Y');
    </script>
    
    <style>
        /* 新增分析卡片样式 */
        .analysis-section {
            margin-top: 40px;
        }
        
        .analysis-tabs {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
        }
        
        .analysis-tab {
            padding: 12px 25px;
            cursor: pointer;
            background: rgba(237, 28, 36, 0.1);
            margin-right: 5px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .analysis-tab i {
            font-size: 1.1em;
        }
        
        .analysis-tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .analysis-tab:hover:not(.active) {
            background: rgba(237, 28, 36, 0.2);
        }
        
        .analysis-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .analysis-content.active {
            display: block;
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .analysis-card h3 i {
            font-size: 1.2em;
        }
        
        .analysis-result {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(237, 28, 36, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }
        
        .analysis-details {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
        }
        
        .analysis-details h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .wuxing-balance {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }
        
        .wuxing-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            border-radius: 8px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .wuxing-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: currentColor;
            opacity: 0.3;
        }
        
        .wuxing-item .wuxing-bar {
            height: 8px;
            background: currentColor;
            margin-top: 10px;
            border-radius: 4px;
            transition: width 1s ease;
            width: 0;
        }
        
        .wuxing-item .wuxing-value {
            font-size: 0.9rem;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .ten-god-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .ten-god-item {
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border-left: 3px solid;
        }
        
        .ten-god-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .ten-god-item h5 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05rem;
        }
        
        .ten-god-item p {
            font-size: 0.95rem;
            color: #555;
            line-height: 1.6;
        }
        
        .special-combination {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-color);
        }
        
        .combination-icon {
            font-size: 2rem;
            margin-right: 15px;
            color: var(--primary-color);
            flex-shrink: 0;
        }
        
        .combination-content h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .combination-content p {
            color: #555;
            line-height: 1.7;
        }
        
        .luck-cycle {
            margin-top: 30px;
        }
        
        .luck-cycle h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .luck-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .luck-table th {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 500;
        }
        
        .luck-table td {
            padding: 12px;
            border: 1px solid #eee;
            text-align: center;
        }
        
        .luck-table tr:nth-child(even) {
            background: rgba(237, 28, 36, 0.03);
        }
        
        .current-luck {
            background: rgba(237, 28, 36, 0.1) !important;
            font-weight: 600;
        }
        
        .luck-note {
            margin-top: 15px;
            font-size: 0.95rem;
            color: #666;
            line-height: 1.7;
            padding: 15px;
            background: rgba(237, 28, 36, 0.05);
            border-radius: 8px;
        }
        
        /* 五行雷达图样式 */
        .wuxing-chart-container {
            margin: 30px 0;
            display: flex;
            justify-content: center;
        }
        
        .wuxing-chart {
            width: 300px;
            height: 300px;
            position: relative;
        }
        
        .wuxing-axis {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .wuxing-label {
            position: absolute;
            font-weight: bold;
            transform: translate(-50%, -50%);
        }
        
        .wuxing-polygon {
            fill: rgba(237, 28, 36, 0.2);
            stroke: var(--primary-color);
            stroke-width: 2;
        }
        
        .wuxing-point {
            fill: var(--primary-color);
            stroke: white;
            stroke-width: 2;
        }
        
        /* 交互式学习元素 */
        .interactive-element {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .interactive-element:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        .element-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            white-space: nowrap;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 100;
            margin-bottom: 10px;
        }
        
        .element-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }
        
        .interactive-element:hover .element-tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        /* 学习提示样式 */
        .learning-tip {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .learning-tip h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .learning-tip p {
            color: #555;
            line-height: 1.7;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .analysis-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 5px;
            }
            
            .analysis-tab {
                flex-shrink: 0;
                padding: 10px 15px;
                font-size: 0.95rem;
            }
            
            .wuxing-balance {
                flex-direction: column;
            }
            
            .ten-god-grid {
                grid-template-columns: 1fr;
            }
            
            .wuxing-chart {
                width: 250px;
                height: 250px;
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <main class="content-container">
        <div class="content-title">
            <h1>八字计算器</h1>
            <p>输入您的出生信息，自动生成完整八字命盘及详细分析</p>
        </div>

        <div class="content-section">
            <div class="calculator-form">
                <div class="form-header">
                    <h2 style="color: white;"><i class="fas fa-user-circle"></i> 基本信息输入</h2>
                    <p style="color: white;">请填写您的出生信息以生成八字命盘</p>
                </div>
                <form id="bazi-form" class="elegant-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-date"><i class="far fa-calendar-alt"></i> 出生日期</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar-day"></i>
                                <input type="date" id="birth-date" name="birth-date" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="far fa-clock"></i> 出生时间</label>
                            <div class="time-select-group">
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-start"></i>
                                    <select id="birth-hour" name="birth-hour" required>
                                        <option value="">-- 时 --</option>
                                        <script>
                                            for(let i=0; i<24; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}时</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-end"></i>
                                    <select id="birth-minute" name="birth-minute" required>
                                        <option value="">-- 分 --</option>
                                        <script>
                                            for(let i=0; i<60; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}分</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone"><i class="fas fa-globe-asia"></i> 出生地区</label>
                            <div class="select-with-icon">
                                <i class="fas fa-map-marker-alt"></i>
                                <select id="timezone" name="timezone" required>
                                    <option value="8">中国标准时间 (UTC+8)</option>
                                    <option value="-8">太平洋时间 (UTC-8)</option>
                                    <option value="-5">东部时间 (UTC-5)</option>
                                    <option value="0">格林尼治时间 (UTC+0)</option>
                                    <option value="9">日本标准时间 (UTC+9)</option>
                                    <option value="-7">山地时间 (UTC-7)</option>
                                    <option value="-6">中部时间 (UTC-6)</option>
                                    <option value="1">中欧时间 (UTC+1)</option>
                                    <option value="10">澳大利亚东部时间 (UTC+10)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-venus-mars"></i> 性别</label>
                            <div class="gender-group">
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="male" checked>
                                    <span class="gender-icon"><i class="fas fa-mars"></i></span>
                                    <span class="gender-text">男</span>
                                </label>
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="female">
                                    <span class="gender-icon"><i class="fas fa-venus"></i></span>
                                    <span class="gender-text">女</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-calculator"></i> 计算八字</button>
                        <button type="reset" class="btn btn-secondary"><i class="fas fa-redo"></i> 重置</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="content-section" id="result-section" style="display: none;">
            <div class="result-header">
                <h2><i class="fas fa-chart-pie"></i> 八字命盘结果</h2>
                <div class="result-actions">
                    <button id="print-btn" class="btn btn-action"><i class="fas fa-print"></i> 打印</button>
                    <button id="save-btn" class="btn btn-action"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
            
            <div class="bazi-result">
                <div class="basic-info-card">
                    <h3><i class="fas fa-info-circle"></i> 基本信息</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">出生日期：</span>
                            <span class="info-value" id="result-date">1984年1月1日</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出生时间：</span>
                            <span class="info-value" id="result-time">23:00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">农历日期：</span>
                            <span class="info-value" id="result-lunar">癸亥年腊月初八</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">生肖：</span>
                            <span class="info-value" id="result-zodiac">鼠</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">命宫：</span>
                            <span class="info-value" id="result-minggong">卯宫</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">身宫：</span>
                            <span class="info-value" id="result-shengong">酉宫</span>
                        </div>
                    </div>
                </div>
                
                <div class="bazi-table-container">
                    <table class="bazi-elegant-table">
                        <thead>
                            <tr>
                                <th>四柱</th>
                                <th>年柱</th>
                                <th>月柱</th>
                                <th>日柱</th>
                                <th>时柱</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="pillar-label">天干</td>
                                <td class="wuxing-wood" id="year-stem">甲<br><span class="ten-god">(比肩)</span></td>
                                <td class="wuxing-wood" id="month-stem">乙<br><span class="ten-god">(劫财)</span></td>
                                <td class="wuxing-fire" id="day-stem">丙<br><span class="ten-god">(日元)</span></td>
                                <td class="wuxing-fire" id="hour-stem">丁<br><span class="ten-god">(伤官)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">地支</td>
                                <td class="wuxing-water" id="year-branch">子<br><span class="ten-god">(正官)</span></td>
                                <td class="wuxing-earth" id="month-branch">丑<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-wood" id="day-branch">寅<br><span class="ten-god">(偏印)</span></td>
                                <td class="wuxing-wood" id="hour-branch">卯<br><span class="ten-god">(正印)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">藏干</td>
                                <td class="wuxing-water" id="year-hidden-god">癸<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-earth" id="month-hidden-god">己(正财)<br>癸(正印)<br>辛(正官)</td>
                                <td class="wuxing-wood" id="day-hidden-god">甲(比肩)<br>丙(劫财)<br>戊(食神)</td>
                                <td class="wuxing-wood" id="hour-hidden-god">乙<br><span class="ten-god">(劫财)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">空亡</td>
                                <td id="year-void">戌亥</td>
                                <td id="month-void">戌亥</td>
                                <td id="day-void">戌亥</td>
                                <td id="hour-void">戌亥</td>
                            </tr>
                            <tr>
                                <td class="pillar-label">纳音</td>
                                <td id="year-nayin">海中金</td>
                                <td id="month-nayin">海中金</td>
                                <td id="day-nayin">炉中火</td>
                                <td id="hour-nayin">炉中火</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- 新增的互动分析部分 -->
                <div class="analysis-section">
                    <h2><i class="fas fa-chart-line"></i> 八字详细分析</h2>
                    <p>以下是根据您的八字命盘进行的专业分析，点击各选项卡查看不同方面的分析结果。</p>
                    
                    <div class="analysis-tabs">
                        <div class="analysis-tab active" data-tab="strength">
                            <i class="fas fa-weight"></i> 身强身弱
                        </div>
                        <div class="analysis-tab" data-tab="ten-gods">
                            <i class="fas fa-users"></i> 十神分析
                        </div>
                        <div class="analysis-tab" data-tab="wuxing">
                            <i class="fas fa-leaf"></i> 五行平衡
                        </div>
                        <div class="analysis-tab" data-tab="combinations">
                            <i class="fas fa-puzzle-piece"></i> 特殊组合
                        </div>
                        <div class="analysis-tab" data-tab="useful-god">
                            <i class="fas fa-thumbs-up"></i> 用神忌神
                        </div>
                        <div class="analysis-tab" data-tab="luck">
                            <i class="fas fa-calendar-alt"></i> 运势分析
                        </div>
                    </div>
                    
                    <!-- 身强身弱分析 -->
                    <div class="analysis-content active" id="strength-content">
                        <div class="analysis-card">
                            <h3><i class="fas fa-weight"></i> 身强身弱分析</h3>
                            <div class="analysis-result" id="strength-result">
                                根据您的八字分析，您的日主属于<strong>身强</strong>格局。
                            </div>
                            <div class="analysis-details">
                                <h4><i class="fas fa-info-circle"></i> 分析依据</h4>
                                <p>身强身弱是八字分析的基础，主要看日主（出生日的天干）在整个命局中的强弱程度。判断依据包括：</p>
                                <ul>
                                    <li>月令（出生月份的地支）对日主的生助情况</li>
                                    <li>其他天干地支对日主的生克关系</li>
                                    <li>地支藏干对日主的影响</li>
                                </ul>
                                
                                <div class="learning-tip">
                                    <h4><i class="fas fa-lightbulb"></i> 学习提示：什么是身强身弱？</h4>
                                    <p>身强身弱是八字分析中判断日主（出生日的天干）能量强弱的概念。身强表示日主能量旺盛，能担财官；身弱则表示日主能量不足，需要生扶。身强身弱的判断需要考虑月令、其他干支的生克关系以及地支藏干的影响。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 十神分析 -->
                    <div class="analysis-content" id="ten-gods-content">
                        <div class="analysis-card">
                            <h3><i class="fas fa-users"></i> 十神分析</h3>
                            <div class="analysis-result">
                                十神是八字分析中描述各干支与日主关系的系统，反映了命局中各种力量的分布。
                            </div>
                            
                            <div class="ten-god-grid">
                                <div class="ten-god-item" style="border-left-color: #2e7d32;">
                                    <h5><i class="fas fa-user"></i> 比肩</h5>
                                    <p>比肩代表兄弟姐妹、朋友同事，性格独立自主，有竞争意识。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #c62828;">
                                    <h5><i class="fas fa-user-friends"></i> 劫财</h5>
                                    <p>劫财代表竞争、破财，性格外向活跃，但容易冲动消费。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #1565c0;">
                                    <h5><i class="fas fa-male"></i> 食神</h5>
                                    <p>食神代表才华、口福，性格温和有创意，擅长艺术表达。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #0277bd;">
                                    <h5><i class="fas fa-female"></i> 伤官</h5>
                                    <p>伤官代表才华、反叛，聪明但任性，不喜受约束。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #8d6e63;">
                                    <h5><i class="fas fa-yen-sign"></i> 正财</h5>
                                    <p>正财代表稳定收入、妻子，性格务实，重视物质基础。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #5d4037;">
                                    <h5><i class="fas fa-money-bill-wave"></i> 偏财</h5>
                                    <p>偏财代表意外之财、父亲，性格慷慨，投资理财能力强。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #c62828;">
                                    <h5><i class="fas fa-gavel"></i> 正官</h5>
                                    <p>正官代表职位、名誉，性格正直，有责任感和管理能力。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #d32f2f;">
                                    <h5><i class="fas fa-user-shield"></i> 七杀</h5>
                                    <p>七杀代表压力、竞争，性格果断，有领导力但易冲动。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #2e7d32;">
                                    <h5><i class="fas fa-book"></i> 正印</h5>
                                    <p>正印代表学问、母亲，性格仁慈，学习能力强，重传统。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #388e3c;">
                                    <h5><i class="fas fa-book-open"></i> 偏印</h5>
                                    <p>偏印代表特殊才能、继母，性格内向，擅长研究但多疑。</p>
                                </div>
                            </div>
                            
                            <div class="analysis-details">
                                <h4><i class="fas fa-info-circle"></i> 您的十神分布特点</h4>
                                <p id="ten-god-distribution">您的命局中正印和偏印较多，显示您有较强的学习能力和智慧...</p>
                                
                                <div class="learning-tip">
                                    <h4><i class="fas fa-lightbulb"></i> 学习提示：如何理解十神？</h4>
                                    <p>十神是八字分析中描述各干支与日主关系的系统。它以日主（出生日的天干）为中心，将其他天干地支分为十种不同的"神"，每种"神"代表不同的人事关系和性格特征。理解十神是分析八字的基础。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 五行平衡分析 -->
                    <div class="analysis-content" id="wuxing-content">
                        <div class="analysis-card">
                            <h3><i class="fas fa-leaf"></i> 五行平衡分析</h3>
                            <div class="analysis-result">
                                五行平衡是八字分析的重要指标，理想的命局应该五行流通，不过旺也不过弱。
                            </div>
                            
                            <div class="wuxing-balance">
                                <div class="wuxing-item wuxing-wood">
                                    木<br>
                                    <div class="wuxing-bar" style="width: 60%;"></div>
                                    <div class="wuxing-value">60% (旺)</div>
                                </div>
                                <div class="wuxing-item wuxing-fire">
                                    火<br>
                                    <div class="wuxing-bar" style="width: 30%;"></div>
                                    <div class="wuxing-value">30% (弱)</div>
                                </div>
                                <div class="wuxing-item wuxing-earth">
                                    土<br>
                                    <div class="wuxing-bar" style="width: 40%;"></div>
                                    <div class="wuxing-value">40% (平)</div>
                                </div>
                                <div class="wuxing-item wuxing-metal">
                                    金<br>
                                    <div class="wuxing-bar" style="width: 20%;"></div>
                                    <div class="wuxing-value">20% (弱)</div>
                                </div>
                                <div class="wuxing-item wuxing-water">
                                    水<br>
                                    <div class="wuxing-bar" style="width: 50%;"></div>
                                    <div class="wuxing-value">50% (平)</div>
                                </div>
                            </div>
                            
                            <div class="wuxing-chart-container">
                                <div class="wuxing-chart" id="wuxing-chart">
                                    <!-- 五行雷达图将通过JS动态生成 -->
                                </div>
                            </div>
                            
                            <div class="analysis-details">
                                <h4><i class="fas fa-info-circle"></i> 您的五行特点</h4>
                                <p id="wuxing-analysis">您的命局中木元素较旺，火元素较弱...</p>
                                
                                <div class="learning-tip">
                                    <h4><i class="fas fa-lightbulb"></i> 学习提示：五行相生相克</h4>
                                    <p>五行指木、火、土、金、水五种基本元素，它们之间存在相生相克的关系：<br>
                                    相生：木生火，火生土，土生金，金生水，水生木<br>
                                    相克：木克土，土克水，水克火，火克金，金克木</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 特殊组合分析 -->
                    <div class="analysis-content" id="combinations-content">
                        <div class="analysis-card">
                            <h3><i class="fas fa-puzzle-piece"></i> 特殊组合分析</h3>
                            <div class="analysis-result">
                                八字中的特殊组合会对命局产生重要影响，以下是您命局中的特殊组合。
                            </div>
                            
                            <div class="special-combination">
                                <div class="combination-icon">
                                    <i class="fas fa-dragon"></i>
                                </div>
                                <div class="combination-content">
                                    <h4>三合局 - 木局</h4>
                                    <p>您的命局中年支、日支和时支形成了三合木局，增强了木的能量，代表您有较强的适应能力和人际关系。</p>
                                </div>
                            </div>
                            
                            <div class="special-combination">
                                <div class="combination-icon">
                                    <i class="fas fa-yin-yang"></i>
                                </div>
                                <div class="combination-content">
                                    <h4>天干相合 - 甲己合土</h4>
                                    <p>您的年干和月干形成了甲己合土的特殊组合，这种合化会影响您的性格和运势发展。</p>
                                </div>
                            </div>
                            
                            <div class="analysis-details">
                                <h4><i class="fas fa-info-circle"></i> 特殊组合的影响</h4>
                                <p>特殊组合会对命局产生重要影响，可能改变五行的力量分布或带来特殊的运势特征...</p>
                                
                                <div class="learning-tip">
                                    <h4><i class="fas fa-lightbulb"></i> 学习提示：常见的特殊组合</h4>
                                    <p>八字中常见的特殊组合包括：三合局（如申子辰合水）、六合（如子丑合土）、三会局（如寅卯辰会木）、天干五合（如甲己合土）等。这些组合会增强或改变某些五行的力量。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 用神忌神分析 -->
                    <div class="analysis-content" id="useful-god-content">
                        <div class="analysis-card">
                            <h3><i class="fas fa-thumbs-up"></i> 用神与忌神分析</h3>
                            <div class="analysis-result">
                                用神是命局中最需要的五行，忌神则是需要避免的五行。根据您的八字分析：
                            </div>
                            
                            <div class="ten-god-grid">
                                <div class="ten-god-item" style="border-left-color: #2e7d32; background-color: rgba(46, 125, 50, 0.1);">
                                    <h5><i class="fas fa-check-circle"></i> 用神 - 金</h5>
                                    <p>金可以克制您命局中过旺的木，平衡五行，是您最需要的元素。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #c62828; background-color: rgba(198, 40, 40, 0.1);">
                                    <h5><i class="fas fa-times-circle"></i> 忌神 - 木</h5>
                                    <p>木在您命局中已经过旺，过多木元素会加剧五行失衡。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #0277bd; background-color: rgba(2, 119, 189, 0.1);">
                                    <h5><i class="fas fa-check-circle"></i> 喜神 - 水</h5>
                                    <p>水可以生木，但也能生火，适度水元素对您有益。</p>
                                </div>
                                <div class="ten-god-item" style="border-left-color: #d32f2f; background-color: rgba(211, 47, 47, 0.1);">
                                    <h5><i class="fas fa-times-circle"></i> 仇神 - 火</h5>
                                    <p>火会消耗木，但您命局中火已足够，过多火不利。</p>
                                </div>
                            </div>
                            
                            <div class="analysis-details">
                                <h4><i class="fas fa-info-circle"></i> 用神应用建议</h4>
                                <p>了解用神和忌神后，可以在生活中加以应用：</p>
                                <ul>
                                    <li>选择职业：适合金属性行业如金融、机械、法律等</li>
                                    <li>颜色选择：多使用白色、金色等金属性颜色</li>
                                    <li>方位选择：西方和西北方对您有利</li>
                                    <li>人际关系：与属猴、属鸡的人合作更顺利</li>
                                </ul>
                                
                                <div class="learning-tip">
                                    <h4><i class="fas fa-lightbulb"></i> 学习提示：如何确定用神？</h4>
                                    <p>用神是根据八字五行平衡和日主强弱来确定的。基本原则是：身强宜克泄，身弱宜生扶。用神可以平衡命局，增强好运，而忌神则会破坏平衡，带来不利影响。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 运势分析 -->
                    <div class="analysis-content" id="luck-content">
                        <div class="analysis-card">
                            <h3><i class="fas fa-calendar-alt"></i> 运势分析</h3>
                            <div class="analysis-result">
                                大运和流年运势分析可以帮助您了解人生不同阶段的运势走向。
                            </div>
                            
                            <div class="luck-cycle">
                                <h4><i class="fas fa-clock"></i> 大运走势</h4>
                                <p>大运是十年一换的运势周期，影响人生不同阶段的整体运势。</p>
                                
                                <table class="luck-table">
                                    <thead>
                                        <tr>
                                            <th>大运</th>
                                            <th>起止年龄</th>
                                            <th>干支</th>
                                            <th>运势特点</th>
                                        </tr>
                                    </thead>
                                    <tbody id="luck-table-body">
                                        <tr>
                                            <td>第一步大运</td>
                                            <td>5-15岁</td>
                                            <td>甲子</td>
                                            <td>早年运势平稳，学习能力强</td>
                                        </tr>
                                        <tr class="current-luck">
                                            <td>第二步大运</td>
                                            <td>15-25岁</td>
                                            <td>乙丑</td>
                                            <td>事业起步期，有贵人相助</td>
                                        </tr>
                                        <tr>
                                            <td>第三步大运</td>
                                            <td>25-35岁</td>
                                            <td>丙寅</td>
                                            <td>事业发展期，但压力增大</td>
                                        </tr>
                                        <tr>
                                            <td>第四步大运</td>
                                            <td>35-45岁</td>
                                            <td>丁卯</td>
                                            <td>财运上升，注意健康</td>
                                        </tr>
                                        <tr>
                                            <td>第五步大运</td>
                                            <td>45-55岁</td>
                                            <td>戊辰</td>
                                            <td>事业稳定，家庭幸福</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div class="luck-note">
                                    <p><strong>当前大运提示：</strong> 您目前正处于乙丑大运(15-25岁)，这十年事业发展较为顺利，有贵人相助，但要注意理财规划，避免不必要的开支。</p>
                                </div>
                            </div>
                            
                            <div class="luck-cycle">
                                <h4><i class="fas fa-calendar-day"></i> 2025年流年运势</h4>
                                <p>流年是每年变化的运势，影响当年的具体事件和机遇。</p>
                                
                                <div class="special-combination">
                                    <div class="combination-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="combination-content">
                                        <h4>乙巳年运势分析</h4>
                                        <p>2025年是乙巳年，天干乙木为您的劫财，地支巳火为您的食神。这一年整体运势平稳，事业发展有机会，但要注意人际关系和财务管理。</p>
                                    </div>
                                </div>
                                
                                <div class="luck-note">
                                    <p><strong>2025年建议：</strong> 今年适合学习新技能或拓展人脉，投资需谨慎，健康方面注意肝胆和眼睛的保养。</p>
                                </div>
                            </div>
                            
                            <div class="analysis-details">
                                <h4><i class="fas fa-info-circle"></i> 运势分析方法</h4>
                                <p>运势分析主要看大运和流年与命局的互动关系：</p>
                                <ul>
                                    <li>大运干支与命局干支的生克关系</li>
                                    <li>流年干支与大运、命局的组合</li>
                                    <li>特殊组合的出现和影响</li>
                                </ul>
                                
                                <div class="learning-tip">
                                    <h4><i class="fas fa-lightbulb"></i> 学习提示：大运和流年</h4>
                                    <p>大运是十年一换的运势周期，影响人生不同阶段的整体运势走向；流年是每年变化的运势，影响具体年份的吉凶事件。分析运势时要同时考虑大运和流年与命局的互动关系。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 麦八字教学网. 保留所有权利.</p>
            <p>传承经典命理文化，科学学习八字知识</p>
        </div>
    </footer>
     <script src="../js/lunar.js"></script>
    <script>
        // 八字分析主函数
        class BaziAnalyzer {
            constructor() {
                this.lunar = null;
                this.bazi = null;
                this.solarDate = null;
                this.gender = 'male';
            }
            
            // 从表单获取数据并计算八字
            calculateFromForm(formData) {
                const [year, month, day] = formData.birthDate.split('-').map(Number);
                const hour = parseInt(formData.birthHour);
                const minute = parseInt(formData.birthMinute);
                const timezone = parseInt(formData.timezone);
                this.gender = formData.gender;
                
                // 创建阳历日期对象
                this.solarDate = new Date(year, month - 1, day, hour, minute);
                
                // 计算农历和八字
                this.lunar = Lunar.fromDate(this.solarDate);
                this.bazi = this.lunar.getBaZi();
                
                return this.analyzeBazi();
            }
            
            // 分析八字数据
            analyzeBazi() {
                if (!this.bazi) return null;
                
                // 获取四柱
                const pillars = this.bazi.getPillars();
                
                // 1. 身强身弱分析
                const strength = this.analyzeStrength(pillars);
                
                // 2. 十神分析
                const tenGods = this.analyzeTenGods(pillars);
                
                // 3. 五行平衡分析
                const wuxing = this.analyzeWuxing(pillars);
                
                // 4. 特殊组合分析
                const combinations = this.analyzeCombinations(pillars);
                
                // 5. 用神忌神分析
                const usefulGods = this.analyzeUsefulGods(strength, wuxing);
                
                // 6. 运势分析
                const luck = this.analyzeLuck();
                
                return {
                    pillars,
                    strength,
                    tenGods,
                    wuxing,
                    combinations,
                    usefulGods,
                    luck,
                    solarDate: this.solarDate,
                    lunarDate: this.lunar
                };
            }
            
            // 身强身弱分析
            analyzeStrength(pillars) {
                const dayStem = pillars.day.stem; // 日主
                const monthBranch = pillars.month.branch; // 月令
                
                // 计算得令、得地、得势
                let score = 0;
                
                // 1. 得令（月令对日主的影响）
                const monthRelation = this.getStemBranchRelation(dayStem, monthBranch);
                if (['same', 'bornBy', 'helpBy'].includes(monthRelation)) {
                    score += 2;
                } else if (['restBy', 'consumeBy'].includes(monthRelation)) {
                    score -= 1;
                }
                
                // 2. 得地（地支藏干对日主的影响）
                pillars.forEach(pillar => {
                    const hiddenStems = pillar.branch.getHideStems();
                    hiddenStems.forEach(stem => {
                        const relation = this.getStemRelation(dayStem, stem);
                        if (relation === 'same') score += 0.5;
                        if (['bornBy', 'helpBy'].includes(relation)) score += 0.3;
                    });
                });
                
                // 3. 得势（天干对日主的影响）
                pillars.forEach(pillar => {
                    const relation = this.getStemRelation(dayStem, pillar.stem);
                    if (relation === 'same') score += 1;
                    if (['bornBy', 'helpBy'].includes(relation)) score += 0.5;
                });
                
                // 判断身强身弱
                let result = '身中';
                if (score >= 3) result = '身强';
                if (score <= 1) result = '身弱';
                
                return {
                    score,
                    result,
                    analysis: this.getStrengthAnalysis(result, dayStem)
                };
            }
            
            // 十神分析
            analyzeTenGods(pillars) {
                const dayStem = pillars.day.stem;
                const tenGodsMap = {};
                
                // 分析天干十神
                pillars.forEach(pillar => {
                    const stem = pillar.stem;
                    const relation = this.getStemRelation(dayStem, stem);
                    tenGodsMap[relation] = (tenGodsMap[relation] || 0) + 1;
                });
                
                // 分析地支藏干十神
                pillars.forEach(pillar => {
                    const hiddenStems = pillar.branch.getHideStems();
                    hiddenStems.forEach(stem => {
                        const relation = this.getStemRelation(dayStem, stem);
                        tenGodsMap[relation] = (tenGodsMap[relation] || 0) + 0.5;
                    });
                });
                
                // 十神解释
                const tenGodsInfo = {
                    'same': { name: '比肩', desc: '代表兄弟姐妹、朋友同事，性格独立自主' },
                    'helpBy': { name: '劫财', desc: '代表竞争、破财，性格外向活跃' },
                    'bornBy': { name: '食神', desc: '代表才华、口福，性格温和有创意' },
                    'bornOf': { name: '伤官', desc: '代表才华、反叛，聪明但任性' },
                    'consumeBy': { name: '正财', desc: '代表稳定收入、妻子，性格务实' },
                    'consumeOf': { name: '偏财', desc: '代表意外之财、父亲，性格慷慨' },
                    'restBy': { name: '正官', desc: '代表职位、名誉，性格正直' },
                    'restOf': { name: '七杀', desc: '代表压力、竞争，性格果断' },
                    'helpOf': { name: '正印', desc: '代表学问、母亲，性格仁慈' },
                    'bornTo': { name: '偏印', desc: '代表特殊才能、继母，性格内向' }
                };
                
                // 生成十神分布分析
                let distribution = '';
                Object.entries(tenGodsMap).forEach(([relation, count]) => {
                    const info = tenGodsInfo[relation];
                    if (info && count > 0) {
                        distribution += `${info.name}(${count.toFixed(1)}) `;
                    }
                });
                
                return {
                    map: tenGodsMap,
                    info: tenGodsInfo,
                    distribution,
                    analysis: this.getTenGodsAnalysis(tenGodsMap, tenGodsInfo)
                };
            }
            
            // 五行平衡分析
            analyzeWuxing(pillars) {
                const wuxingMap = { '木': 0, '火': 0, '土': 0, '金': 0, '水': 0 };
                
                // 统计天干五行
                pillars.forEach(pillar => {
                    const stemWuxing = pillar.stem.getWuXing();
                    wuxingMap[stemWuxing] += 1;
                });
                
                // 统计地支五行
                pillars.forEach(pillar => {
                    const branchWuxing = pillar.branch.getWuXing();
                    wuxingMap[branchWuxing] += 1;
                });
                
                // 统计藏干五行
                pillars.forEach(pillar => {
                    const hiddenStems = pillar.branch.getHideStems();
                    hiddenStems.forEach(stem => {
                        const wuxing = stem.getWuXing();
                        wuxingMap[wuxing] += 0.5;
                    });
                });
                
                // 计算五行百分比
                const total = Object.values(wuxingMap).reduce((a, b) => a + b, 0);
                const wuxingPercent = {};
                Object.keys(wuxingMap).forEach(key => {
                    wuxingPercent[key] = Math.round((wuxingMap[key] / total) * 100);
                });
                
                return {
                    map: wuxingMap,
                    percent: wuxingPercent,
                    analysis: this.getWuxingAnalysis(wuxingMap)
                };
            }
            
            // 特殊组合分析
            analyzeCombinations(pillars) {
                const combinations = [];
                
                // 检查三合局
                const branches = pillars.map(p => p.branch);
                const sanhe = this.checkSanhe(branches);
                if (sanhe) combinations.push(sanhe);
                
                // 检查六合
                const liuhe = this.checkLiuhe(branches);
                if (liuhe) combinations.push(liuhe);
                
                // 检查天干五合
                const stems = pillars.map(p => p.stem);
                const wuhe = this.checkWuhe(stems);
                if (wuhe) combinations.push(wuhe);
                
                return {
                    list: combinations,
                    analysis: this.getCombinationAnalysis(combinations)
                };
            }
            
            // 用神忌神分析
            analyzeUsefulGods(strength, wuxing) {
                const dayStem = this.bazi.getPillars().day.stem;
                const dayWuxing = dayStem.getWuXing();
                const wuxingOrder = ['木', '火', '土', '金', '水'];
                
                // 根据身强身弱确定用神
                let useful = [], avoid = [];
                
                if (strength.result === '身强') {
                    // 身强宜克泄
                    useful.push(wuxingOrder[(wuxingOrder.indexOf(dayWuxing) + 2 % 5]); // 克
                    useful.push(wuxingOrder[(wuxingOrder.indexOf(dayWuxing) + 1 % 5]); // 泄
                    avoid.push(dayWuxing); // 忌同类
                    avoid.push(wuxingOrder[(wuxingOrder.indexOf(dayWuxing) + 4 % 5]); // 忌生
                } else {
                    // 身弱宜生扶
                    useful.push(wuxingOrder[(wuxingOrder.indexOf(dayWuxing) + 4 % 5]); // 生
                    useful.push(dayWuxing); // 扶
                    avoid.push(wuxingOrder[(wuxingOrder.indexOf(dayWuxing) + 2 % 5]); // 忌克
                    avoid.push(wuxingOrder[(wuxingOrder.indexOf(dayWuxing) + 1 % 5]); // 忌泄
                }
                
                // 考虑五行平衡调整
                Object.entries(wuxing.percent).forEach(([wx, percent]) => {
                    if (percent < 20 && useful.includes(wx)) {
                        useful = useful.filter(w => w !== wx);
                    }
                    if (percent > 60 && !avoid.includes(wx)) {
                        avoid.push(wx);
                    }
                });
                
                return {
                    useful: [...new Set(useful)],
                    avoid: [...new Set(avoid)],
                    analysis: this.getUsefulGodsAnalysis(useful, avoid, strength.result)
                };
            }
            
            // 运势分析
            analyzeLuck() {
                const dayStem = this.bazi.getPillars().day.stem;
                const genderModifier = this.gender === 'male' ? 1 : -1;
                const luckPillars = this.bazi.getLuckPillars(genderModifier);
                
                // 大运分析
                const luckCycles = luckPillars.map((pillar, index) => {
                    const startAge = index * 10;
                    const endAge = (index + 1) * 10;
                    
                    return {
                        name: `第${index + 1}步大运`,
                        ageRange: `${startAge}-${endAge}岁`,
                        ganzhi: pillar.toString(),
                        description: this.getLuckDescription(pillar, dayStem)
                    };
                });
                
                // 流年分析
                const currentYear = new Date().getFullYear();
                const yearPillar = this.lunar.getYearPillar(currentYear);
                const yearAnalysis = this.getYearLuckAnalysis(yearPillar, dayStem);
                
                return {
                    cycles: luckCycles,
                    currentYear: {
                        year: currentYear,
                        ganzhi: yearPillar.toString(),
                        analysis: yearAnalysis
                    }
                };
            }
            
            /* 辅助分析方法 */
            getStemRelation(dayStem, targetStem) {
                // 获取天干与日主的关系
                return dayStem.getRelation(targetStem);
            }
            
            getStemBranchRelation(dayStem, branch) {
                // 获取地支与日主的关系
                const mainStem = branch.getHideStems()[0]; // 取地支主气
                return this.getStemRelation(dayStem, mainStem);
            }
            
            checkSanhe(branches) {
                // 检查三合局
                const sanheGroups = [
                    ['申', '子', '辰'], // 水局
                    ['亥', '卯', '未'], // 木局
                    ['寅', '午', '戌'], // 火局
                    ['巳', '酉', '丑']  // 金局
                ];
                
                for (const group of sanheGroups) {
                    const found = group.filter(b => branches.some(p => p.toString() === b));
                    if (found.length >= 2) {
                        return {
                            type: '三合局',
                            elements: group,
                            found,
                            wuxing: this.getSanheWuxing(group),
                            description: this.getSanheDescription(group)
                        };
                    }
                }
                return null;
            }
            
            checkLiuhe(branches) {
                // 检查六合
                const liuhePairs = [
                    ['子', '丑'], ['寅', '亥'], ['卯', '戌'],
                    ['辰', '酉'], ['巳', '申'], ['午', '未']
                ];
                
                for (const pair of liuhePairs) {
                    if (branches.some(b => b.toString() === pair[0]) && 
                        branches.some(b => b.toString() === pair[1])) {
                        return {
                            type: '六合',
                            pair,
                            description: this.getLiuheDescription(pair)
                        };
                    }
                }
                return null;
            }
            
            checkWuhe(stems) {
                // 检查天干五合
                const wuhePairs = [
                    ['甲', '己'], ['乙', '庚'], ['丙', '辛'],
                    ['丁', '壬'], ['戊', '癸']
                ];
                
                for (const pair of wuhePairs) {
                    if (stems.some(s => s.toString() === pair[0]) && 
                        stems.some(s => s.toString() === pair[1])) {
                        return {
                            type: '天干五合',
                            pair,
                            description: this.getWuheDescription(pair)
                        };
                    }
                }
                return null;
            }
            
            /* 分析结果生成方法 */
            getStrengthAnalysis(result, dayStem) {
                const wuxing = dayStem.getWuXing();
                const wuxingNames = { '木': '木', '火': '火', '土': '土', '金': '金', '水': '水' };
                
                if (result === '身强') {
                    return `您的日主${wuxingNames[wuxing]}能量旺盛，属于身强格局。身强的人通常精力充沛，抗压能力强，能担财官，但要注意避免过于刚强或固执。适合从事需要魄力和决断力的工作。`;
                } else if (result === '身弱') {
                    return `您的日主${wuxingNames[wuxing]}能量偏弱，属于身弱格局。身弱的人通常性格温和，但容易疲劳或缺乏自信。需要加强自身能量，适合团队合作或借助他人力量发展。`;
                } else {
                    return `您的日主${wuxingNames[wuxing]}能量适中，属于中和格局。中和的人通常适应能力强，性格平衡，但要注意保持五行流通，避免极端。`;
                }
            }
            
            getTenGodsAnalysis(tenGodsMap, tenGodsInfo) {
                let analysis = '您的命局中';
                const presentGods = Object.entries(tenGodsMap)
                    .filter(([_, count]) => count > 0)
                    .map(([rel, _]) => tenGodsInfo[rel].name);
                
                if (presentGods.length > 0) {
                    analysis += presentGods.join('、') + '较多，';
                    
                    // 特殊十神组合分析
                    if (tenGodsMap['restOf'] && tenGodsMap['helpOf']) {
                        analysis += '七杀与正印同现，表示您能化解压力，将挑战转化为动力；';
                    }
                    
                    if (tenGodsMap['consumeBy'] && tenGodsMap['bornBy']) {
                        analysis += '正财与食神搭配，显示您有通过才华获得财富的能力；';
                    }
                    
                    if (tenGodsMap['same'] >= 2 && tenGodsMap['helpBy'] >= 2) {
                        analysis += '比肩劫财多现，提示您要注意人际关系和财务管理；';
                    }
                }
                
                analysis += '这些十神组合影响着您的性格和命运走向。';
                return analysis;
            }
            
            getWuxingAnalysis(wuxingMap) {
                const sorted = Object.entries(wuxingMap).sort((a, b) => b[1] - a[1]);
                const strongest = sorted[0];
                const weakest = sorted[sorted.length - 1];
                
                let analysis = `您的命局中${strongest[0]}元素最旺(${strongest[1].toFixed(1)})，${weakest[0]}元素最弱(${weakest[1].toFixed(1)})。`;
                
                // 五行失衡提示
                if (strongest[1] / weakest[1] > 5) {
                    analysis += '五行严重失衡，需要注意健康和生活调节；';
                } else if (strongest[1] / weakest[1] > 3) {
                    analysis += '五行明显失衡，某些方面需要加强；';
                }
                
                // 五行特性分析
                analysis += `${strongest[0]}旺代表${this.getWuxingTrait(strongest[0])}，而${weakest[0]}弱可能导致${this.getWuxingWeakness(weakest[0])}。`;
                
                return analysis;
            }
            
            getCombinationAnalysis(combinations) {
                if (combinations.length === 0) {
                    return '您的命局中没有明显的特殊组合，整体格局较为平稳。';
                }
                
                let analysis = '您的命局中有以下特殊组合：';
                combinations.forEach(comb => {
                    analysis += `${comb.type}(${comb.elements ? comb.elements.join('、') : comb.pair.join('、')})，${comb.description}；`;
                });
                
                analysis += '这些组合会对您的命运产生特定影响。';
                return analysis;
            }
            
            getUsefulGodsAnalysis(useful, avoid, strength) {
                let analysis = `根据${strength}的特点，`;
                analysis += `您的用神是${useful.join('、')}，可以增强命局平衡；`;
                analysis += `忌神是${avoid.join('、')}，过多会破坏平衡。`;
                
                analysis += '在生活中可以多接触用神五行相关的事物，如：';
                useful.forEach(wx => {
                    analysis += `${wx}属性的颜色、方位、行业等；`;
                });
                
                return analysis;
            }
            
            getLuckDescription(pillar, dayStem) {
                const stemRel = this.getStemRelation(dayStem, pillar.stem);
                const branchRel = this.getStemBranchRelation(dayStem, pillar.branch);
                
                let desc = '';
                if (['same', 'helpBy'].includes(stemRel)) {
                    desc += '竞争较多，';
                }
                if (['bornBy', 'bornOf'].includes(stemRel)) {
                    desc += '才华展现，';
                }
                if (['consumeBy', 'consumeOf'].includes(stemRel)) {
                    desc += '财运变化，';
                }
                if (['restBy', 'restOf'].includes(stemRel)) {
                    desc += '事业压力，';
                }
                
                return desc || '运势平稳，需把握机会';
            }
            
            getYearLuckAnalysis(yearPillar, dayStem) {
                const stemRel = this.getStemRelation(dayStem, yearPillar.stem);
                const branchRel = this.getStemBranchRelation(dayStem, yearPillar.branch);
                
                let analysis = '今年';
                if (['same', 'helpBy'].includes(stemRel)) {
                    analysis += '人际关系活跃，但要注意竞争；';
                }
                if (['bornBy', 'bornOf'].includes(stemRel)) {
                    analysis += '创造力强，适合学习发展；';
                }
                if (['consumeBy', 'consumeOf'].includes(stemRel)) {
                    analysis += '财运波动，需谨慎理财；';
                }
                if (['restBy', 'restOf'].includes(stemRel)) {
                    analysis += '事业有压力，也是晋升机会；';
                }
                
                return analysis || '整体运势平稳，宜稳扎稳打';
            }
            
            /* 其他辅助方法 */
            getSanheWuxing(group) {
                if (group.includes('申')) return '水';
                if (group.includes('亥')) return '木';
                if (group.includes('寅')) return '火';
                return '金';
            }
            
            getSanheDescription(group) {
                const wuxing = this.getSanheWuxing(group);
                return `增强${wuxing}的力量，带来${wuxing}属性的特质`;
            }
            
            getLiuheDescription(pair) {
                const combinations = {
                    '子丑': '化土，增强土元素',
                    '寅亥': '化木，增强木元素',
                    '卯戌': '化火，增强火元素',
                    '辰酉': '化金，增强金元素',
                    '巳申': '化水，增强水元素',
                    '午未': '化土，增强土元素'
                };
                return combinations[pair.join('')] || '产生特殊影响';
            }
            
            getWuheDescription(pair) {
                const combinations = {
                    '甲己': '化土，增强土元素',
                    '乙庚': '化金，增强金元素',
                    '丙辛': '化水，增强水元素',
                    '丁壬': '化木，增强木元素',
                    '戊癸': '化火，增强火元素'
                };
                return combinations[pair.join('')] || '产生特殊影响';
            }
            
            getWuxingTrait(wuxing) {
                const traits = {
                    '木': '有活力、成长力强',
                    '火': '热情、积极',
                    '土': '稳重、务实',
                    '金': '果断、坚毅',
                    '水': '智慧、灵活'
                };
                return traits[wuxing] || '';
            }
            
            getWuxingWeakness(wuxing) {
                const weaknesses = {
                    '木': '缺乏决断力',
                    '火': '缺乏热情',
                    '土': '缺乏稳定性',
                    '金': '缺乏果断',
                    '水': '缺乏灵活性'
                };
                return weaknesses[wuxing] || '';
            }
        }

        // 页面交互逻辑
        document.addEventListener('DOMContentLoaded', function() {
            const analyzer = new BaziAnalyzer();
            
            // 表单提交处理
            document.getElementById('bazi-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    birthDate: document.getElementById('birth-date').value,
                    birthHour: document.getElementById('birth-hour').value,
                    birthMinute: document.getElementById('birth-minute').value,
                    timezone: document.getElementById('timezone').value,
                    gender: document.querySelector('input[name="gender"]:checked').value
                };
                
                // 计算八字并分析
                const result = analyzer.calculateFromForm(formData);
                if (!result) {
                    alert('请输入有效的出生信息');
                    return;
                }
                
                // 更新八字排盘显示
                updateBaziDisplay(result.pillars);
                
                // 更新基本信息显示
                updateBasicInfo(result);
                
                // 更新分析结果
                updateAnalysisResults(result);
                
                // 显示结果区域
                document.getElementById('result-section').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
                }, 100);
            });
            
            // 更新八字排盘显示
            function updateBaziDisplay(pillars) {
                // 年柱
                document.getElementById('year-stem').innerHTML = `${pillars.year.stem}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.year.stem)})</span>`;
                document.getElementById('year-branch').innerHTML = `${pillars.year.branch}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.year.branch.getHideStems()[0])})</span>`;
                document.getElementById('year-hidden-god').innerHTML = pillars.year.branch.getHideStems().map(s => `${s}(${getTenGodName(pillars.day.stem, s)})`).join('<br>');
                
                // 月柱
                document.getElementById('month-stem').innerHTML = `${pillars.month.stem}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.month.stem)})</span>`;
                document.getElementById('month-branch').innerHTML = `${pillars.month.branch}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.month.branch.getHideStems()[0])})</span>`;
                document.getElementById('month-hidden-god').innerHTML = pillars.month.branch.getHideStems().map(s => `${s}(${getTenGodName(pillars.day.stem, s)})`).join('<br>');
                
                // 日柱
                document.getElementById('day-stem').innerHTML = `${pillars.day.stem}<br><span class="ten-god">(日元)</span>`;
                document.getElementById('day-branch').innerHTML = `${pillars.day.branch}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.day.branch.getHideStems()[0])})</span>`;
                document.getElementById('day-hidden-god').innerHTML = pillars.day.branch.getHideStems().map(s => `${s}(${getTenGodName(pillars.day.stem, s)})`).join('<br>');
                
                // 时柱
                document.getElementById('hour-stem').innerHTML = `${pillars.hour.stem}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.hour.stem)})</span>`;
                document.getElementById('hour-branch').innerHTML = `${pillars.hour.branch}<br><span class="ten-god">(${getTenGodName(pillars.day.stem, pillars.hour.branch.getHideStems()[0])})</span>`;
                document.getElementById('hour-hidden-god').innerHTML = pillars.hour.branch.getHideStems().map(s => `${s}(${getTenGodName(pillars.day.stem, s)})`).join('<br>');
                
                // 空亡
                document.getElementById('year-void').textContent = pillars.year.getXunKong();
                document.getElementById('month-void').textContent = pillars.month.getXunKong();
                document.getElementById('day-void').textContent = pillars.day.getXunKong();
                document.getElementById('hour-void').textContent = pillars.hour.getXunKong();
                
                // 纳音
                document.getElementById('year-nayin').textContent = pillars.year.getNaYin();
                document.getElementById('month-nayin').textContent = pillars.month.getNaYin();
                document.getElementById('day-nayin').textContent = pillars.day.getNaYin();
                document.getElementById('hour-nayin').textContent = pillars.hour.getNaYin();
                
                // 设置五行颜色类
                setWuxingClass('year-stem', pillars.year.stem);
                setWuxingClass('month-stem', pillars.month.stem);
                setWuxingClass('day-stem', pillars.day.stem);
                setWuxingClass('hour-stem', pillars.hour.stem);
                
                setWuxingClass('year-branch', pillars.year.branch);
                setWuxingClass('month-branch', pillars.month.branch);
                setWuxingClass('day-branch', pillars.day.branch);
                setWuxingClass('hour-branch', pillars.hour.branch);
            }
            
            // 更新基本信息显示
            function updateBasicInfo(result) {
                const date = result.solarDate;
                document.getElementById('result-date').textContent = `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                document.getElementById('result-time').textContent = `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
                document.getElementById('result-lunar').textContent = result.lunarDate.toString();
                document.getElementById('result-zodiac').textContent = result.lunarDate.getYearShengXiao();
                
                // 命宫身宫计算 (简化版)
                const hour = date.getHours();
                const month = date.getMonth() + 1;
                const minggong = ((hour + 1) % 12 + month - 1) % 12;
                const shengong = ((hour + 7) % 12 + month - 1) % 12;
                
                const branches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                document.getElementById('result-minggong').textContent = branches[minggong] + '宫';
                document.getElementById('result-shengong').textContent = branches[shengong] + '宫';
            }
            
            // 更新分析结果
            function updateAnalysisResults(result) {
                // 1. 身强身弱分析
                document.getElementById('strength-result').innerHTML = 
                    `根据您的八字分析，您的日主属于<strong>${result.strength.result}</strong>格局。`;
                
                // 2. 十神分析
                document.getElementById('ten-god-distribution').textContent = result.tenGods.analysis;
                
                // 3. 五行平衡分析
                const wuxingValues = [
                    result.wuxing.percent['木'] || 0,
                    result.wuxing.percent['火'] || 0,
                    result.wuxing.percent['土'] || 0,
                    result.wuxing.percent['金'] || 0,
                    result.wuxing.percent['水'] || 0
                ];
                
                drawWuxingChart(wuxingValues);
                
                // 更新五行柱状图
                const wuxingItems = ['木', '火', '土', '金', '水'];
                document.querySelectorAll('.wuxing-bar').forEach((bar, i) => {
                    bar.style.width = `${wuxingValues[i]}%`;
                });
                
                document.querySelectorAll('.wuxing-value').forEach((value, i) => {
                    value.textContent = `${wuxingValues[i]}% (${getWuxingStrength(wuxingValues[i])})`;
                });
                
                document.getElementById('wuxing-analysis').textContent = result.wuxing.analysis;
                
                // 4. 特殊组合分析
                document.getElementById('combinations-analysis').textContent = result.combinations.analysis;
                
                // 5. 用神忌神分析
                document.getElementById('useful-gods-analysis').textContent = result.usefulGods.analysis;
                
                // 6. 运势分析
                const luckTableBody = document.getElementById('luck-table-body');
                luckTableBody.innerHTML = '';
                
                result.luck.cycles.forEach((cycle, index) => {
                    const row = document.createElement('tr');
                    if (index === 1) row.classList.add('current-luck'); // 假设第二步大运是当前大运
                    
                    row.innerHTML = `
                        <td>${cycle.name}</td>
                        <td>${cycle.ageRange}</td>
                        <td>${cycle.ganzhi}</td>
                        <td>${cycle.description}</td>
                    `;
                    luckTableBody.appendChild(row);
                });
                
                document.getElementById('current-year-luck').textContent = 
                    `${result.luck.currentYear.year}年(${result.luck.currentYear.ganzhi})运势：${result.luck.currentYear.analysis}`;
            }
            
            // 辅助函数：获取十神名称
            function getTenGodName(dayStem, targetStem) {
                const relation = dayStem.getRelation(targetStem);
                const map = {
                    'same': '比肩',
                    'helpBy': '劫财',
                    'bornBy': '食神',
                    'bornOf': '伤官',
                    'consumeBy': '正财',
                    'consumeOf': '偏财',
                    'restBy': '正官',
                    'restOf': '七杀',
                    'helpOf': '正印',
                    'bornTo': '偏印'
                };
                return map[relation] || '';
            }
            
            // 辅助函数：设置五行颜色类
            function setWuxingClass(elementId, stemOrBranch) {
                const element = document.getElementById(elementId);
                const wuxing = stemOrBranch.getWuXing();
                element.className = `wuxing-${wuxing.toLowerCase()}`;
            }
            
            // 辅助函数：获取五行强弱描述
            function getWuxingStrength(value) {
                if (value >= 70) return '旺';
                if (value >= 40) return '平';
                return '弱';
            }
            
            // 五行雷达图绘制
            function drawWuxingChart(data) {
                const container = document.getElementById('wuxing-chart');
                container.innerHTML = '';
                
                const width = 300;
                const height = 300;
                const center = { x: width / 2, y: height / 2 };
                const radius = 120;
                const angles = [0, 72, 144, 216, 288]; // 五行的角度
                const labels = ['木', '火', '土', '金', '水'];
                const colors = ['#2e7d32', '#c62828', '#8d6e63', '#1565c0', '#0277bd'];
                
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.setAttribute('width', width);
                svg.setAttribute('height', height);
                svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
                container.appendChild(svg);
                
                // 绘制五边形网格
                const gridPoints = angles.map((angle, i) => {
                    const radian = (angle - 90) * Math.PI / 180;
                    return {
                        x: center.x + radius * Math.cos(radian),
                        y: center.y + radius * Math.sin(radian)
                    };
                });
                
                // 绘制五边形
                const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                polygon.setAttribute('points', gridPoints.map(p => `${p.x},${p.y}`).join(' '));
                polygon.setAttribute('class', 'wuxing-polygon');
                polygon.setAttribute('stroke-dasharray', '5,5');
                svg.appendChild(polygon);
                
                // 绘制五行轴线
                angles.forEach((angle, i) => {
                    const radian = (angle - 90) * Math.PI / 180;
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute('x1', center.x);
                    line.setAttribute('y1', center.y);
                    line.setAttribute('x2', center.x + radius * Math.cos(radian));
                    line.setAttribute('y2', center.y + radius * Math.sin(radian));
                    line.setAttribute('stroke', '#ddd');
                    line.setAttribute('stroke-width', '1');
                    svg.appendChild(line);
                    
                    // 添加五行标签
                    const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    label.setAttribute('x', center.x + (radius + 30) * Math.cos(radian));
                    label.setAttribute('y', center.y + (radius + 30) * Math.sin(radian));
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('dominant-baseline', 'middle');
                    label.setAttribute('font-weight', 'bold');
                    label.setAttribute('fill', colors[i]);
                    label.textContent = labels[i];
                    svg.appendChild(label);
                });
                
                // 绘制数据多边形
                const dataPoints = angles.map((angle, i) => {
                    const value = data[i] / 100 * radius;
                    const radian = (angle - 90) * Math.PI / 180;
                    return {
                        x: center.x + value * Math.cos(radian),
                        y: center.y + value * Math.sin(radian)
                    };
                });
                
                const dataPolygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                dataPolygon.setAttribute('points', dataPoints.map(p => `${p.x},${p.y}`).join(' '));
                dataPolygon.setAttribute('class', 'wuxing-polygon');
                dataPolygon.setAttribute('fill', 'rgba(237, 28, 36, 0.3)');
                svg.appendChild(dataPolygon);
                
                // 绘制数据点
                dataPoints.forEach((point, i) => {
                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute('cx', point.x);
                    circle.setAttribute('cy', point.y);
                    circle.setAttribute('r', 6);
                    circle.setAttribute('class', 'wuxing-point');
                    circle.setAttribute('fill', colors[i]);
                    svg.appendChild(circle);
                    
                    // 添加数值标签
                    const valueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    valueLabel.setAttribute('x', point.x);
                    valueLabel.setAttribute('y', point.y - 15);
                    valueLabel.setAttribute('text-anchor', 'middle');
                    valueLabel.setAttribute('font-size', '12');
                    valueLabel.setAttribute('fill', colors[i]);
                    valueLabel.textContent = `${data[i]}%`;
                    svg.appendChild(valueLabel);
                });
            }
            
            // 选项卡切换
            const tabs = document.querySelectorAll('.analysis-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.analysis-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-content`).classList.add('active');
                });
            });
            
            // 打印功能
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });
            
            // 保存功能
            document.getElementById('save-btn').addEventListener('click', function() {
                alert('保存功能将在后续版本中实现');
            });
        });
    </script>
</body>
</html>
