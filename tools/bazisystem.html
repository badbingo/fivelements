<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="机缘八字命理测算系统，融合未来科技与传统智慧">
    <meta name="keywords" content="机缘命理,八字,算命,未来科技,数字命盘">
    <title>机缘命理 - 未来科技命理系统</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.css">
    <link rel="stylesheet" href="../css/stylew.css">
    <link rel="stylesheet" href="../css/style1.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2NHJXGKS0Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-2NHJXGKS0Y');
    </script>
</head>
<body>
    <div class="background-overlay"></div>
    
    <header class="main-header">
        <div class="container header-container">
            <div class="logo-container">
                <div class="logo-text">
                    <h1>麦八字</h1>
                    <p class="slogan">我命由我不由天</p>
                </div>
            </div>
            
            <nav class="main-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="../index.html" class="nav-link">
                            <i class="fas fa-home"></i> 七步速成法
                        </a>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link">
                            <i class="fas fa-book-open"></i> 基础知识 <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="../basics/bazi-process.html" class="dropdown-link">八字介绍</a></li>
                            <li><a href="../basics/bazi-chart.html" class="dropdown-link">八字排盘</a></li>
                            <li><a href="../basics/yen-strength.html" class="dropdown-link">日元强弱分析</a></li>
                            <li><a href="../basics/elements.html" class="dropdown-link">天干地支意象</a></li>
                            <li><a href="../basics/wuxing.html" class="dropdown-link">五行生克</a></li>
                            <li><a href="../basics/balance.html" class="dropdown-link">五行平衡</a></li>
                            <li><a href="../basics/ten-gods.html" class="dropdown-link">十神关系</a></li>
                            <li><a href="../basics/combinations.html" class="dropdown-link">合冲破害</a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link">
                            <i class="fas fa-chart-line"></i> 进阶知识 <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="../advanced/tomb.html" class="dropdown-link">四大墓库</a></li>
                            <li><a href="../advanced/personality.html" class="dropdown-link">性格分析</a></li>
                            <li><a href="../advanced/wealth.html" class="dropdown-link">财运分析</a></li>
                            <li><a href="../advanced/career.html" class="dropdown-link">事业分析</a></li>
                            <li><a href="../advanced/marriage.html" class="dropdown-link">婚姻分析</a></li>
                            <li><a href="../advanced/health.html" class="dropdown-link">健康分析</a></li>
                            <li><a href="../advanced/luck.html" class="dropdown-link">大运流年</a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link">
                            <i class="fas fa-shapes"></i> 八字格局 <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="../patterns/common.html" class="dropdown-link">常见格局</a></li>
                            <li><a href="../patterns/special.html" class="dropdown-link">特殊格局</a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link active">
                            <i class="fas fa-tools"></i> 工具 <i class="fas fa-chevron-down dropdown-icon"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="calculator.html" class="dropdown-link">八字计算器</a></li>
                            <li><a href="reference.html" class="dropdown-link">速查表</a></li>
                            <li><a href="bazi-test.html" class="dropdown-link">八字试题</a></li>
                            <li><a href="bazi.html" class="dropdown-link active">机缘命理系统</a></li>
                            <li><a href="hehun.html" class="dropdown-link">八字合婚</a></li>
                        </ul>
                    </li>
                    
                    <li class="nav-item">
                        <a href="../about.html" class="nav-link">
                            <i class="fas fa-info-circle"></i> 关于我们
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <header class="minimal-header">
        <h1 class="header-title">机缘<span class="ming-character">命</span>理系统</h1>
        <div class="header-subtitle">未来科技 · 传统智慧 · 数字命盘</div>
    </header>   
    
    <div class="minimal-container">
        <main class="minimal-main">
            <section class="input-section" id="input-section">
                <div class="section-header">
                    <i class="fas fa-id-card"></i>
                    <h2>请输入您的信息</h2>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name"><i class="fas fa-user-astronaut"></i> 姓名</label>
                        <input type="text" id="name" placeholder="请输入您的姓名">
                    </div>
                    <div class="form-group">
                        <label for="gender"><i class="fas fa-venus-mars"></i> 性别</label>
                        <select id="gender" required>
                            <option value="">请选择</option>
                            <option value="male">男</option>
                            <option value="female">女</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birth-date"><i class="fas fa-calendar-alt"></i> 出生日期</label>
                        <input type="date" id="birth-date" required>
                    </div>
                    <div class="form-group">
                        <label for="birth-time"><i class="fas fa-clock"></i> 出生时辰</label>
                        <div class="time-period-selector" id="time-period-selector">
                            <div class="time-period-option" data-hour="23" data-minute="0">子时 (23-1)</div>
                            <div class="time-period-option" data-hour="1" data-minute="0">丑时 (1-3)</div>
                            <div class="time-period-option" data-hour="3" data-minute="0">寅时 (3-5)</div>
                            <div class="time-period-option" data-hour="5" data-minute="0">卯时 (5-7)</div>
                            <div class="time-period-option" data-hour="7" data-minute="0">辰时 (7-9)</div>
                            <div class="time-period-option" data-hour="9" data-minute="0">巳时 (9-11)</div>
                            <div class="time-period-option" data-hour="11" data-minute="0">午时 (11-13)</div>
                            <div class="time-period-option" data-hour="13" data-minute="0">未时 (13-15)</div>
                            <div class="time-period-option" data-hour="15" data-minute="0">申时 (15-17)</div>
                            <div class="time-period-option" data-hour="17" data-minute="0">酉时 (17-19)</div>
                            <div class="time-period-option" data-hour="19" data-minute="0">戌时 (19-21)</div>
                            <div class="time-period-option" data-hour="21" data-minute="0">亥时 (21-23)</div>
                        </div>
                        <input type="hidden" id="birth-time" required>
                    </div>
                </div>

                <div class="saved-profiles" id="saved-profiles">
                    <div class="saved-profiles-title">
                        <i class="fas fa-history"></i> 已付费用户记录
                    </div>
                    <div class="saved-profiles-list" id="saved-profiles-list">
                        <!-- 历史记录将动态加载 -->
                    </div>
                </div>
                
                <div class="calculate-btn-container">
                    <button id="pay-btn"><i class="fas fa-credit-card"></i> 点击付费</button>
                    <button id="calculate-btn" style="display:none;"><i class="fas fa-brain"></i> 开始量子测算</button>
                </div>
            </section>
            
            <section class="result-section" id="result-section">
                <!-- 结果部分保持不变 -->
                <!-- ...原有结果部分代码... -->
            </section>
        </main>
    </div>

    <!-- 支付模态框 -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <span id="close-payment-modal" class="close">&times;</span>
            <h2>支付测算费用</h2>
            <div class="modal-body">
                <p>每次测算费用：<strong>9.9元</strong></p>
                <p>请点击下方按钮完成支付：</p>
                <button id="zpay-btn" class="zpay-button">前往ZPay支付</button>
                <div class="payment-terms">
                    <p><small>支付成功后，您可以输入信息开始测算</small></p>
                    <p><small>一次付费只能测算一个人的八字</small></p>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 麦八字教学网. 保留所有权利.</p>
            <p>传承经典命理文化，科学学习八字知识</p>
        </div>
    </footer>

    <!-- 外部脚本引用 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@latest/dist/lunar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- 本地脚本 -->
    <script src="../js/lunar.js"></script>
    <script src="../js/bazi.js"></script>
    
    <script>
    // 新增支付相关代码
    document.addEventListener('DOMContentLoaded', function() {
        const payBtn = document.getElementById('pay-btn');
        const calculateBtn = document.getElementById('calculate-btn');
        const paymentModal = document.getElementById('payment-modal');
        const closePaymentModal = document.getElementById('close-payment-modal');
        const zpayBtn = document.getElementById('zpay-btn');
        
        // 检查是否已付费
        function checkPaymentStatus() {
            const paidUsers = JSON.parse(localStorage.getItem('baziPaidUsers') || [];
            return paidUsers.length > 0;
        }
        
        // 初始化支付按钮状态
        function initPaymentButton() {
            if (checkPaymentStatus()) {
                payBtn.style.display = 'none';
                calculateBtn.style.display = 'block';
            } else {
                payBtn.style.display = 'block';
                calculateBtn.style.display = 'none';
            }
        }
        
        // 打开支付模态框
        payBtn.addEventListener('click', function() {
            paymentModal.style.display = 'block';
        });
        
        // 关闭支付模态框
        closePaymentModal.addEventListener('click', function() {
            paymentModal.style.display = 'none';
        });
        
        // 点击模态框外部关闭
        window.addEventListener('click', function(event) {
            if (event.target === paymentModal) {
                paymentModal.style.display = 'none';
            }
        });
        
        // 模拟ZPay支付
        zpayBtn.addEventListener('click', function() {
            // 显示支付中状态
            zpayBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 支付处理中...';
            zpayBtn.disabled = true;
            
            // 模拟支付过程
            setTimeout(function() {
                // 支付成功后的处理
                const paidUsers = JSON.parse(localStorage.getItem('baziPaidUsers') || [];
                const paymentId = 'pay_' + Date.now();
                
                // 记录支付成功的用户
                paidUsers.push({
                    paymentId: paymentId,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('baziPaidUsers', JSON.stringify(paidUsers));
                
                // 关闭支付模态框
                paymentModal.style.display = 'none';
                
                // 更新按钮状态
                initPaymentButton();
                
                // 重置支付按钮
                zpayBtn.innerHTML = '前往ZPay支付';
                zpayBtn.disabled = false;
                
                alert('支付成功！您现在可以开始测算');
            }, 2000);
        });
        
        // 初始化
        initPaymentButton();
        
        // 修改calculateBtn的点击事件
        calculateBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // 检查是否已付费
            if (!checkPaymentStatus()) {
                alert('请先完成支付');
                payBtn.style.display = 'block';
                calculateBtn.style.display = 'none';
                return;
            }
            
            // 原有计算逻辑
            calculateBazi(e);
        });
        
        // 修改保存个人资料的逻辑
        function saveProfile(birthData) {
            const profiles = JSON.parse(localStorage.getItem('baziProfiles') || [];
            const paidUsers = JSON.parse(localStorage.getItem('baziPaidUsers') || '[]');
            
            // 检查是否已付费
            if (paidUsers.length === 0) {
                alert('请先完成支付');
                return;
            }
            
            const existingIndex = profiles.findIndex(function(p) {
                return p.date === birthData.date && 
                       p.time === birthData.time && 
                       p.gender === birthData.gender;
            });
            
            if (existingIndex >= 0) {
                profiles[existingIndex] = birthData;
            } else {
                profiles.push(birthData);
            }
            
            if (profiles.length > 8) {
                profiles.shift();
            }
            
            localStorage.setItem('baziProfiles', JSON.stringify(profiles));
            loadSavedProfiles();
        }
        
        // 修改加载历史记录的逻辑
        function loadSavedProfiles() {
            const profiles = JSON.parse(localStorage.getItem('baziProfiles') || []);
            savedProfilesList.innerHTML = '';
            
            if (profiles.length === 0) {
                savedProfilesList.innerHTML = '<div style="color:var(--text-light);font-size:14px;">暂无测算记录</div>';
                return;
            }
            
            profiles.forEach(function(profile, index) {
                const hour = parseInt(profile.time.split(':')[0]);
                const timeMap = {
                    23: '子时', 0: '子时',
                    1: '丑时', 3: '寅时',
                    5: '卯时', 7: '辰时',
                    9: '巳时', 11: '午时',
                    13: '未时', 15: '申时',
                    17: '酉时', 19: '戌时',
                    21: '亥时'
                };
                
                const profileElement = document.createElement('div');
                profileElement.className = 'saved-profile';
                profileElement.innerHTML = `
                    <span class="profile-content">
                        ${profile.name || '匿名'} · 
                        ${profile.date.replace(/-/g, '/')} · 
                        ${timeMap[hour]} · 
                        ${profile.gender === 'male' ? '男' : '女'}
                    </span>
                    <span class="remove-profile-btn" data-index="${index}">
                        <i class="fas fa-times"></i>
                    </span>
                `;
                
                profileElement.querySelector('.profile-content').addEventListener('click', function() {
                    // 检查是否已付费
                    if (!checkPaymentStatus()) {
                        alert('请先完成支付以查看历史记录');
                        return;
                    }
                    loadProfile(profile);
                });
                
                profileElement.querySelector('.remove-profile-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    removeProfile(index);
                });
                
                savedProfilesList.appendChild(profileElement);
            });
        }
    });
    </script>
</body>
</html>
