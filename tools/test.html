<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字计算器 - 麦八字教学网</title>
    <link rel="stylesheet" href="../css/style1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/navigation.css">
    <script defer src="../js/navigation.js"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2NHJXGKS0Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-2NHJXGKS0Y');
    </script>
    
    <style>
        /* New CSS for interactive analysis features */
        .analysis-section {
            margin-top: 40px;
        }
        
        .analysis-tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(237, 28, 36, 0.2);
        }
        
        .analysis-tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }
        
        .analysis-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .analysis-tab:hover:not(.active) {
            color: var(--dark-gray);
            border-bottom-color: rgba(237, 28, 36, 0.3);
        }
        
        .analysis-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .analysis-content.active {
            display: block;
        }
        
        .strength-meter {
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }
        
        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, #2e7d32, #4caf50);
            width: 0;
            transition: width 1s ease;
        }
        
        .strength-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            font-size: 0.8rem;
        }
        
        .wuxing-balance {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }
        
        .wuxing-item {
            flex: 1;
            text-align: center;
            padding: 15px 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .wuxing-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .wuxing-wood { background-color: rgba(46, 125, 50, 0.1); border-top: 3px solid #2e7d32; }
        .wuxing-fire { background-color: rgba(198, 40, 40, 0.1); border-top: 3px solid #c62828; }
        .wuxing-earth { background-color: rgba(141, 110, 99, 0.1); border-top: 3px solid #8d6e63; }
        .wuxing-metal { background-color: rgba(21, 101, 192, 0.1); border-top: 3px solid #1565c0; }
        .wuxing-water { background-color: rgba(2, 119, 189, 0.1); border-top: 3px solid #0277bd; }
        
        .wuxing-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .wuxing-count {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .special-combination {
            background: rgba(255, 235, 59, 0.1);
            border-left: 4px solid #FFD700;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .special-combination h4 {
            color: #FFD700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .special-combination h4 i {
            margin-right: 10px;
        }
        
        .god-analysis {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .god-card {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .god-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .god-card.useful {
            border-top: 3px solid #4caf50;
        }
        
        .god-card.harmful {
            border-top: 3px solid #f44336;
        }
        
        .god-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .god-type {
            font-size: 0.9rem;
            color: #666;
        }
        
        .luck-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .luck-table th {
            background: rgba(237, 28, 36, 0.1);
            padding: 12px;
            text-align: center;
            font-weight: 600;
        }
        
        .luck-table td {
            padding: 12px;
            border: 1px solid #eee;
            text-align: center;
        }
        
        .luck-table tr:nth-child(even) {
            background: rgba(237, 28, 36, 0.02);
        }
        
        .luck-table .current {
            background: rgba(255, 235, 59, 0.2);
            font-weight: 600;
        }
        
        .analysis-note {
            background: rgba(227, 242, 253, 0.5);
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .analysis-note h4 {
            color: #1565C0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .analysis-note h4 i {
            margin-right: 10px;
        }
        
        .highlight {
            background: rgba(255, 235, 59, 0.3);
            padding: 0 3px;
            border-radius: 3px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .wuxing-balance {
                flex-direction: column;
            }
            
            .god-card {
                min-width: calc(50% - 15px);
            }
            
            .analysis-tab {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <main class="content-container">
        <div class="content-title">
            <h1>八字计算器</h1>
            <p>输入您的出生信息，自动生成完整八字命盘</p>
        </div>

        <div class="content-section">
            <div class="calculator-form">
                <div class="form-header">
                    <h2 style="color: white;"><i class="fas fa-user-circle"></i> 基本信息输入</h2>
                    <p style="color: white;">请填写您的出生信息以生成八字命盘</p>
                </div>
                <form id="bazi-form" class="elegant-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-date"><i class="far fa-calendar-alt"></i> 出生日期</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar-day"></i>
                                <input type="date" id="birth-date" name="birth-date" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="far fa-clock"></i> 出生时间</label>
                            <div class="time-select-group">
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-start"></i>
                                    <select id="birth-hour" name="birth-hour" required>
                                        <option value="">-- 时 --</option>
                                        <script>
                                            for(let i=0; i<24; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}时</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-end"></i>
                                    <select id="birth-minute" name="birth-minute" required>
                                        <option value="">-- 分 --</option>
                                        <script>
                                            for(let i=0; i<60; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}分</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone"><i class="fas fa-globe-asia"></i> 出生地区</label>
                            <div class="select-with-icon">
                                <i class="fas fa-map-marker-alt"></i>
                                <select id="timezone" name="timezone" required>
                                    <option value="8">中国标准时间 (UTC+8)</option>
                                    <option value="-8">太平洋时间 (UTC-8)</option>
                                    <option value="-5">东部时间 (UTC-5)</option>
                                    <option value="0">格林尼治时间 (UTC+0)</option>
                                    <option value="9">日本标准时间 (UTC+9)</option>
                                    <option value="-7">山地时间 (UTC-7)</option>
                                    <option value="-6">中部时间 (UTC-6)</option>
                                    <option value="1">中欧时间 (UTC+1)</option>
                                    <option value="10">澳大利亚东部时间 (UTC+10)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-venus-mars"></i> 性别</label>
                            <div class="gender-group">
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="male" checked>
                                    <span class="gender-icon"><i class="fas fa-mars"></i></span>
                                    <span class="gender-text">男</span>
                                </label>
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="female">
                                    <span class="gender-icon"><i class="fas fa-venus"></i></span>
                                    <span class="gender-text">女</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-calculator"></i> 计算八字</button>
                        <button type="reset" class="btn btn-secondary"><i class="fas fa-redo"></i> 重置</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="content-section" id="result-section" style="display: none;">
            <div class="result-header">
                <h2><i class="fas fa-chart-pie"></i> 八字命盘结果</h2>
                <div class="result-actions">
                    <button id="print-btn" class="btn btn-action"><i class="fas fa-print"></i> 打印</button>
                    <button id="save-btn" class="btn btn-action"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
            
            <div class="bazi-result">
                <div class="basic-info-card">
                    <h3><i class="fas fa-info-circle"></i> 基本信息</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">出生日期：</span>
                            <span class="info-value" id="result-date">1984年1月1日</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出生时间：</span>
                            <span class="info-value" id="result-time">23:00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">农历日期：</span>
                            <span class="info-value" id="result-lunar">癸亥年腊月初八</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">生肖：</span>
                            <span class="info-value" id="result-zodiac">鼠</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">命宫：</span>
                            <span class="info-value" id="result-minggong">卯宫</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">身宫：</span>
                            <span class="info-value" id="result-shengong">酉宫</span>
                        </div>
                    </div>
                </div>
                
                <div class="bazi-table-container">
                    <table class="bazi-elegant-table">
                        <thead>
                            <tr>
                                <th>四柱</th>
                                <th>年柱</th>
                                <th>月柱</th>
                                <th>日柱</th>
                                <th>时柱</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="pillar-label">天干</td>
                                <td class="wuxing-wood" id="year-stem">甲<br><span class="ten-god">(比肩)</span></td>
                                <td class="wuxing-wood" id="month-stem">乙<br><span class="ten-god">(劫财)</span></td>
                                <td class="wuxing-fire" id="day-stem">丙<br><span class="ten-god">(日元)</span></td>
                                <td class="wuxing-fire" id="hour-stem">丁<br><span class="ten-god">(伤官)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">地支</td>
                                <td class="wuxing-water" id="year-branch">子<br><span class="ten-god">(正官)</span></td>
                                <td class="wuxing-earth" id="month-branch">丑<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-wood" id="day-branch">寅<br><span class="ten-god">(偏印)</span></td>
                                <td class="wuxing-wood" id="hour-branch">卯<br><span class="ten-god">(正印)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">藏干</td>
                                <td class="wuxing-water" id="year-hidden-god">癸<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-earth" id="month-hidden-god">己(正财)<br>癸(正印)<br>辛(正官)</td>
                                <td class="wuxing-wood" id="day-hidden-god">甲(比肩)<br>丙(劫财)<br>戊(食神)</td>
                                <td class="wuxing-wood" id="hour-hidden-god">乙<br><span class="ten-god">(劫财)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">空亡</td>
                                <td id="year-void">戌亥</td>
                                <td id="month-void">戌亥</td>
                                <td id="day-void">戌亥</td>
                                <td id="hour-void">戌亥</td>
                            </tr>
                            <tr>
                                <td class="pillar-label">纳音</td>
                                <td id="year-nayin">海中金</td>
                                <td id="month-nayin">海中金</td>
                                <td id="day-nayin">炉中火</td>
                                <td id="hour-nayin">炉中火</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- New Interactive Analysis Section -->
                <div class="analysis-section">
                    <h3><i class="fas fa-chart-line"></i> 八字分析</h3>
                    
                    <div class="analysis-tabs">
                        <div class="analysis-tab active" data-tab="strength">身强身弱</div>
                        <div class="analysis-tab" data-tab="wuxing">五行平衡</div>
                        <div class="analysis-tab" data-tab="tenshen">十神分析</div>
                        <div class="analysis-tab" data-tab="combinations">特殊组合</div>
                        <div class="analysis-tab" data-tab="useful-gods">用神忌神</div>
                        <div class="analysis-tab" data-tab="luck">运势分析</div>
                    </div>
                    
                    <div class="analysis-content active" id="strength-content">
                        <h4>日主强弱分析</h4>
                        <p>您的日主为 <span class="highlight" id="day-master-element">丙火</span>，分析如下：</p>
                        
                        <div class="strength-meter">
                            <div class="strength-fill" id="strength-meter-fill"></div>
                            <div class="strength-label" id="strength-label">中等偏强</div>
                        </div>
                        
                        <div class="analysis-note">
                            <h4><i class="fas fa-lightbulb"></i> 分析说明</h4>
                            <p id="strength-analysis">根据八字分析，您的日主丙火得月令丑土泄气，但得年支子水相克，时支卯木相生，整体属于中等偏强。身强之人通常精力充沛，行动力强，但需要注意火过旺可能导致性格急躁。</p>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="wuxing-content">
                        <h4>五行平衡分析</h4>
                        <p>您的八字五行分布如下：</p>
                        
                        <div class="wuxing-balance">
                            <div class="wuxing-item wuxing-wood">
                                <div class="wuxing-name">木</div>
                                <div class="wuxing-count" id="wood-count">3</div>
                            </div>
                            <div class="wuxing-item wuxing-fire">
                                <div class="wuxing-name">火</div>
                                <div class="wuxing-count" id="fire-count">2</div>
                            </div>
                            <div class="wuxing-item wuxing-earth">
                                <div class="wuxing-name">土</div>
                                <div class="wuxing-count" id="earth-count">1</div>
                            </div>
                            <div class="wuxing-item wuxing-metal">
                                <div class="wuxing-name">金</div>
                                <div class="wuxing-count" id="metal-count">1</div>
                            </div>
                            <div class="wuxing-item wuxing-water">
                                <div class="wuxing-name">水</div>
                                <div class="wuxing-count" id="water-count">1</div>
                            </div>
                        </div>
                        
                        <div class="analysis-note">
                            <h4><i class="fas fa-lightbulb"></i> 五行分析</h4>
                            <p id="wuxing-analysis">您的八字中木元素最为旺盛（3个），火元素次之（2个），土、金、水各1个。木旺生火，导致火势较旺，建议适当补充金、水元素以达到平衡。五行平衡有助于整体运势的和谐发展。</p>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="tenshen-content">
                        <h4>十神分析</h4>
                        <p>您的八字十神分布如下：</p>
                        
                        <div class="god-analysis">
                            <div class="god-card useful">
                                <div class="god-name">正印</div>
                                <div class="god-type">2个</div>
                                <div class="god-desc">主学业、贵人</div>
                            </div>
                            <div class="god-card useful">
                                <div class="god-name">偏印</div>
                                <div class="god-type">1个</div>
                                <div class="god-desc">主特殊才能</div>
                            </div>
                            <div class="god-card">
                                <div class="god-name">比肩</div>
                                <div class="god-type">1个</div>
                                <div class="god-desc">主兄弟朋友</div>
                            </div>
                            <div class="god-card">
                                <div class="god-name">劫财</div>
                                <div class="god-type">1个</div>
                                <div class="god-desc">主竞争消耗</div>
                            </div>
                            <div class="god-card harmful">
                                <div class="god-name">正官</div>
                                <div class="god-type">1个</div>
                                <div class="god-desc">主压力责任</div>
                            </div>
                            <div class="god-card">
                                <div class="god-name">伤官</div>
                                <div class="god-type">1个</div>
                                <div class="god-desc">主才华创意</div>
                            </div>
                        </div>
                        
                        <div class="analysis-note">
                            <h4><i class="fas fa-lightbulb"></i> 十神分析</h4>
                            <p id="tenshen-analysis">您的八字中印星较多（正印2个，偏印1个），显示您可能学业运佳，容易得到长辈或贵人的帮助。伤官透出，表示您可能有艺术才华或创意能力。正官出现但被印星化解，显示您能够将压力转化为动力。</p>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="combinations-content">
                        <h4>特殊组合分析</h4>
                        <p>您的八字中存在以下特殊组合：</p>
                        
                        <div class="special-combination">
                            <h4><i class="fas fa-star"></i> 木火通明</h4>
                            <p>年柱甲木生丙火，时柱丁火透出，形成木火通明之象，主聪明才智，文章显达。</p>
                        </div>
                        
                        <div class="special-combination">
                            <h4><i class="fas fa-star"></i> 印绶护身</h4>
                            <p>月支丑土藏己土正印，时支卯木为正印，形成印绶护身格局，主学业有成，得贵人扶持。</p>
                        </div>
                        
                        <div class="analysis-note">
                            <h4><i class="fas fa-lightbulb"></i> 组合分析</h4>
                            <p id="combination-analysis">您的八字中木火相生，形成"木火通明"的有利组合，有利于智力发展和文化成就。同时印星有力，形成保护格局，一生中容易得到长辈、老师的帮助和指导。</p>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="useful-gods-content">
                        <h4>用神与忌神分析</h4>
                        <p>根据您的八字分析，用神与忌神如下：</p>
                        
                        <div class="god-analysis">
                            <div class="god-card useful">
                                <div class="god-name">金</div>
                                <div class="god-type">用神</div>
                                <div class="god-desc">制木生水</div>
                            </div>
                            <div class="god-card useful">
                                <div class="god-name">水</div>
                                <div class="god-type">喜神</div>
                                <div class="god-desc">调候降火</div>
                            </div>
                            <div class="god-card harmful">
                                <div class="god-name">木</div>
                                <div class="god-type">忌神</div>
                                <div class="god-desc">生火过旺</div>
                            </div>
                            <div class="god-card">
                                <div class="god-name">火</div>
                                <div class="god-type">闲神</div>
                                <div class="god-desc">日主本气</div>
                            </div>
                        </div>
                        
                        <div class="analysis-note">
                            <h4><i class="fas fa-lightbulb"></i> 用神建议</h4>
                            <p id="useful-gods-analysis">您的八字以金为用神，水为喜神。建议在生活中多接触金属性的物品、颜色(白色、金色)和方位(西方)。可以适当增加水属性的元素，如黑色、蓝色，北方方位有利。减少木属性的过度影响，避免绿色过多。</p>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="luck-content">
                        <h4>大运流年分析</h4>
                        <p>您的大运走势如下：</p>
                        
                        <table class="luck-table">
                            <thead>
                                <tr>
                                    <th>大运</th>
                                    <th>起止年龄</th>
                                    <th>天干地支</th>
                                    <th>五行</th>
                                    <th>运势特点</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1-10岁</td>
                                    <td>1984-1993</td>
                                    <td>壬寅</td>
                                    <td>水木</td>
                                    <td>早年学业运佳</td>
                                </tr>
                                <tr class="current">
                                    <td>11-20岁</td>
                                    <td>1994-2003</td>
                                    <td>辛丑</td>
                                    <td>金土</td>
                                    <td>金运助用神，关键成长期</td>
                                </tr>
                                <tr>
                                    <td>21-30岁</td>
                                    <td>2004-2013</td>
                                    <td>庚子</td>
                                    <td>金水</td>
                                    <td>事业起步，贵人相助</td>
                                </tr>
                                <tr>
                                    <td>31-40岁</td>
                                    <td>2014-2023</td>
                                    <td>己亥</td>
                                    <td>土水</td>
                                    <td>稳定发展期</td>
                                </tr>
                                <tr>
                                    <td>41-50岁</td>
                                    <td>2024-2033</td>
                                    <td>戊戌</td>
                                    <td>土土</td>
                                    <td>需防土重火晦</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="analysis-note">
                            <h4><i class="fas fa-lightbulb"></i> 运势建议</h4>
                            <p id="luck-analysis">您当前处于辛丑大运(11-20岁)，金土运助用神，是人生关键成长期。2025年流年乙巳，木火旺盛，需注意情绪管理和健康保养。建议把握金水年份(如2026丙午年)的发展机会。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 麦八字教学网. 保留所有权利.</p>
            <p>传承经典命理文化，科学学习八字知识</p>
        </div>
    </footer>
    <!-- 引入Lunar.js 1.7.2 -->
    <script src="../js/lunar.js"></script>
    
    <script>
        // 验证Lunar.js版本
        if(typeof Lunar !== 'undefined' && Lunar.VERSION === '1.7.2') {
            console.log('正确加载了LUNAR.JS 1.7.2版本');
        } else {
            console.error('LUNAR.JS版本不正确或未加载');
        }

        // 交互分析功能
        document.addEventListener('DOMContentLoaded', function() {
            // 标签切换功能
            const tabs = document.querySelectorAll('.analysis-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.analysis-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.analysis-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-content').classList.add('active');
                });
            });
            
            // 打印功能
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });
            
            // 保存功能
            document.getElementById('save-btn').addEventListener('click', function() {
                alert('八字命盘已保存（实际应用中这里会实现保存功能）');
            });
            
            // 表单提交处理
            document.getElementById('bazi-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateBazi();
            });
        });
        
        // 八字计算函数
        function calculateBazi() {
            // 获取表单数据
            const birthDate = document.getElementById('birth-date').value;
            const birthHour = document.getElementById('birth-hour').value;
            const birthMinute = document.getElementById('birth-minute').value;
            const timezone = document.getElementById('timezone').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            
            if(!birthDate || !birthHour || !birthMinute) {
                alert('请填写完整的出生信息');
                return;
            }
            
            // 解析日期
            const dateParts = birthDate.split('-');
            const year = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]);
            const day = parseInt(dateParts[2]);
            const hour = parseInt(birthHour);
            const minute = parseInt(birthMinute);
            
            try {
                // 使用lunar.js计算八字
                const solarDate = new Date(year, month-1, day, hour, minute);
                const lunarDate = Lunar.fromDate(solarDate);
                
                // 计算八字四柱
                const bazi = lunarDate.getBazi(hour, timezone);
                
                // 显示结果区域
                document.getElementById('result-section').style.display = 'block';
                
                // 填充基本信息
                document.getElementById('result-date').textContent = `${year}年${month}月${day}日`;
                document.getElementById('result-time').textContent = `${hour}:${minute < 10 ? '0' + minute : minute}`;
                document.getElementById('result-lunar').textContent = lunarDate.toString();
                document.getElementById('result-zodiac').textContent = lunarDate.getYearShengXiao();
                
                // 填充八字表格
                document.getElementById('year-stem').innerHTML = `${bazi.year.stem}<br><span class="ten-god">(${getTenGodName(bazi.year.stemGod)})</span>`;
                document.getElementById('month-stem').innerHTML = `${bazi.month.stem}<br><span class="ten-god">(${getTenGodName(bazi.month.stemGod)})</span>`;
                document.getElementById('day-stem').innerHTML = `${bazi.day.stem}<br><span class="ten-god">(日元)</span>`;
                document.getElementById('hour-stem').innerHTML = `${bazi.hour.stem}<br><span class="ten-god">(${getTenGodName(bazi.hour.stemGod)})</span>`;
                
                document.getElementById('year-branch').innerHTML = `${bazi.year.branch}<br><span class="ten-god">(${getTenGodName(bazi.year.branchGod)})</span>`;
                document.getElementById('month-branch').innerHTML = `${bazi.month.branch}<br><span class="ten-god">(${getTenGodName(bazi.month.branchGod)})</span>`;
                document.getElementById('day-branch').innerHTML = `${bazi.day.branch}<br><span class="ten-god">(${getTenGodName(bazi.day.branchGod)})</span>`;
                document.getElementById('hour-branch').innerHTML = `${bazi.hour.branch}<br><span class="ten-god">(${getTenGodName(bazi.hour.branchGod)})</span>`;
                
                // 填充藏干
                document.getElementById('year-hidden-god').innerHTML = formatHiddenGods(bazi.year.hiddenGods);
                document.getElementById('month-hidden-god').innerHTML = formatHiddenGods(bazi.month.hiddenGods);
                document.getElementById('day-hidden-god').innerHTML = formatHiddenGods(bazi.day.hiddenGods);
                document.getElementById('hour-hidden-god').innerHTML = formatHiddenGods(bazi.hour.hiddenGods);
                
                // 填充空亡
                document.getElementById('year-void').textContent = bazi.year.void || '无';
                document.getElementById('month-void').textContent = bazi.month.void || '无';
                document.getElementById('day-void').textContent = bazi.day.void || '无';
                document.getElementById('hour-void').textContent = bazi.hour.void || '无';
                
                // 填充纳音
                document.getElementById('year-nayin').textContent = bazi.year.nayin || '未知';
                document.getElementById('month-nayin').textContent = bazi.month.nayin || '未知';
                document.getElementById('day-nayin').textContent = bazi.day.nayin || '未知';
                document.getElementById('hour-nayin').textContent = bazi.hour.nayin || '未知';
                
                // 更新分析部分
                updateAnalysis(bazi, lunarDate);
                
                // 滚动到结果区域
                document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
                
            } catch (e) {
                console.error('八字计算错误:', e);
                alert('八字计算出错，请检查输入信息是否正确');
            }
        }
        
        // 辅助函数：格式化藏干显示
        function formatHiddenGods(hiddenGods) {
            if(!hiddenGods || hiddenGods.length === 0) return '无';
            return hiddenGods.map(god => `${god.stem}(${getTenGodName(god.tenGod)})`).join('<br>');
        }
        
        // 辅助函数：获取十神名称
        function getTenGodName(tenGod) {
            const tenGodNames = {
                '比肩': '比肩',
                '劫财': '劫财',
                '食神': '食神',
                '伤官': '伤官',
                '偏财': '偏财',
                '正财': '正财',
                '七杀': '七杀',
                '正官': '正官',
                '偏印': '偏印',
                '正印': '正印'
            };
            return tenGodNames[tenGod] || tenGod;
        }
        
        // 更新分析数据
        function updateAnalysis(bazi, lunarDate) {
            // 日主强弱分析
            const dayMaster = bazi.day.stem;
            document.getElementById('day-master-element').textContent = dayMaster;
            
            // 计算日主强度
            const strength = calculateDayMasterStrength(bazi);
            document.getElementById('strength-meter-fill').style.width = `${strength.percentage}%`;
            document.getElementById('strength-label').textContent = strength.level;
            document.getElementById('strength-analysis').textContent = strength.analysis;
            
            // 五行计数
            const wuxingCount = countWuxing(bazi);
            
            // 更新五行显示
            document.getElementById('wood-count').textContent = wuxingCount.wood;
            document.getElementById('fire-count').textContent = wuxingCount.fire;
            document.getElementById('earth-count').textContent = wuxingCount.earth;
            document.getElementById('metal-count').textContent = wuxingCount.metal;
            document.getElementById('water-count').textContent = wuxingCount.water;
            
            // 五行分析
            const wuxingAnalysis = generateWuxingAnalysis(wuxingCount, dayMaster);
            document.getElementById('wuxing-analysis').textContent = wuxingAnalysis;
            
            // 十神分析
            const tenGodAnalysis = analyzeTenGods(bazi);
            document.getElementById('tenshen-analysis').textContent = tenGodAnalysis.analysis;
            
            // 特殊组合
            const combinations = findSpecialCombinations(bazi);
            updateCombinationsDisplay(combinations);
            
            // 用神忌神
            const usefulGods = determineUsefulGods(bazi, wuxingCount, strength);
            updateUsefulGodsDisplay(usefulGods);
            
            // 运势分析
            const luckAnalysis = analyzeLuck(bazi, lunarDate);
            document.getElementById('luck-analysis').textContent = luckAnalysis;
        }
        
        // 计算日主强度
        function calculateDayMasterStrength(bazi) {
            // 简化的强度计算逻辑
            let strength = 50; // 基础值50%
            
            // 月令影响
            const monthBranch = bazi.month.branch;
            const dayStem = bazi.day.stem;
            
            // 根据五行生克关系调整强度
            // 这里需要根据实际八字理论实现更精确的计算
            if(isSameWuxing(dayStem, monthBranch)) {
                strength += 20; // 得月令
            } else if(isGeneratingWuxing(monthBranch, dayStem)) {
                strength += 10; // 月令生
            } else if(isOvercomingWuxing(monthBranch, dayStem)) {
                strength -= 15; // 月令克
            }
            
            // 其他柱的影响
            // 这里可以添加更复杂的计算逻辑
            
            // 确保在0-100范围内
            strength = Math.max(0, Math.min(100, strength));
            
            // 确定强度等级
            let level, analysis;
            if(strength > 70) {
                level = '身强';
                analysis = `您的日主${bazi.day.stem}得月令相助，八字身强。身强之人通常精力充沛，行动力强，能担财官，但需要注意避免过于刚强。`;
            } else if(strength > 40) {
                level = '中等偏强';
                analysis = `您的日主${bazi.day.stem}力量中等偏强。这种八字通常性格平衡，适应能力强，但需要注意五行平衡。`;
            } else if(strength > 30) {
                level = '中等偏弱';
                analysis = `您的日主${bazi.day.stem}力量中等偏弱。建议寻找生扶的五行作为用神，增强自身能量。`;
            } else {
                level = '身弱';
                analysis = `您的日主${bazi.day.stem}力量较弱。身弱之人通常需要印比帮扶，建议多接触生扶日主的五行元素。`;
            }
            
            return {
                percentage: strength,
                level: level,
                analysis: analysis
            };
        }
        
        // 计算五行分布
        function countWuxing(bazi) {
            const wuxingCount = {
                wood: 0,
                fire: 0,
                earth: 0,
                metal: 0,
                water: 0
            };
            
            // 计算天干地支的五行
            const pillars = [bazi.year, bazi.month, bazi.day, bazi.hour];
            pillars.forEach(pillar => {
                wuxingCount[getWuxingElement(pillar.stem)]++;
                wuxingCount[getWuxingElement(pillar.branch)]++;
                
                // 计算藏干的五行
                if(pillar.hiddenGods && pillar.hiddenGods.length > 0) {
                    pillar.hiddenGods.forEach(god => {
                        wuxingCount[getWuxingElement(god.stem)]++;
                    });
                }
            });
            
            return wuxingCount;
        }
        
        // 获取五行属性
        function getWuxingElement(ganzhi) {
            const woodStems = ['甲', '乙', '寅', '卯'];
            const fireStems = ['丙', '丁', '巳', '午'];
            const earthStems = ['戊', '己', '丑', '辰', '未', '戌'];
            const metalStems = ['庚', '辛', '申', '酉'];
            const waterStems = ['壬', '癸', '亥', '子'];
            
            if(woodStems.includes(ganzhi)) return 'wood';
            if(fireStems.includes(ganzhi)) return 'fire';
            if(earthStems.includes(ganzhi)) return 'earth';
            if(metalStems.includes(ganzhi)) return 'metal';
            if(waterStems.includes(ganzhi)) return 'water';
            return 'earth'; // 默认
        }
        
        // 生成五行分析
        function generateWuxingAnalysis(wuxingCount, dayMaster) {
            const dayElement = getWuxingElement(dayMaster);
            const elementNames = {
                wood: '木', fire: '火', earth: '土', metal: '金', water: '水'
            };
            
            let analysis = `您的八字中`;
            
            // 找出最多的五行
            let maxElement = 'wood';
            let maxCount = wuxingCount.wood;
            for(const element in wuxingCount) {
                if(wuxingCount[element] > maxCount) {
                    maxCount = wuxingCount[element];
                    maxElement = element;
                }
            }
            
            analysis += `${elementNames[maxElement]}元素最为旺盛（${maxCount}个），`;
            
            // 分析日主与其他五行的关系
            if(maxElement === dayElement) {
                analysis += `与日主相同，增强了日主力量。`;
            } else if(isGeneratingWuxing(maxElement, dayElement)) {
                analysis += `生助日主${elementNames[dayElement]}，对日主有利。`;
            } else if(isOvercomingWuxing(maxElement, dayElement)) {
                analysis += `克制日主${elementNames[dayElement]}，可能对日主造成压力。`;
            } else {
                analysis += `与日主${elementNames[dayElement]}关系中性。`;
            }
            
            analysis += `建议适当调整五行平衡，以达到命局和谐。`;
            
            return analysis;
        }
        
        // 其他辅助函数和分析函数
        // ...（根据实际需求实现更多分析功能）
        
        // 五行相生关系
        function isGeneratingWuxing(fromElement, toElement) {
            const generating = {
                wood: ['fire'],
                fire: ['earth'],
                earth: ['metal'],
                metal: ['water'],
                water: ['wood']
            };
            return generating[fromElement] && generating[fromElement].includes(toElement);
        }
        
        // 五行相克关系
        function isOvercomingWuxing(fromElement, toElement) {
            const overcoming = {
                wood: ['earth'],
                earth: ['water'],
                water: ['fire'],
                fire: ['metal'],
                metal: ['wood']
            };
            return overcoming[fromElement] && overcoming[fromElement].includes(toElement);
        }
        
        // 五行相同
        function isSameWuxing(element1, element2) {
            return getWuxingElement(element1) === getWuxingElement(element2);
        }
    </script>
</body>
</html>
