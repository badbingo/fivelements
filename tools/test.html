<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字计算器 - 麦八字教学网</title>
    <link rel="stylesheet" href="../css/style1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/navigation.css">
    <script defer src="../js/navigation.js"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2NHJXGKS0Y"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-2NHJXGKS0Y');
    </script>
    
    <style>
        /* 新增分析卡片样式 */
        .analysis-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(237, 28, 36, 0.2);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .analysis-card h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(237, 28, 36, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analysis-card h3 i {
            color: var(--accent-color);
        }
        
        .analysis-content {
            line-height: 1.8;
            color: #444;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .analysis-item {
            background: rgba(255, 255, 255, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }
        
        .analysis-item-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .analysis-item-content {
            color: #555;
            line-height: 1.6;
        }
        
        /* 五行平衡图表 */
        .wuxing-chart-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .wuxing-chart {
            width: 100%;
            max-width: 500px;
            height: 300px;
        }
        
        /* 用神忌神标签 */
        .god-tag {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-right: 8px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .useful-god {
            background-color: rgba(46, 125, 50, 0.1);
            color: #2e7d32;
            border: 1px solid rgba(46, 125, 50, 0.3);
        }
        
        .harmful-god {
            background-color: rgba(198, 40, 40, 0.1);
            color: #c62828;
            border: 1px solid rgba(198, 40, 40, 0.3);
        }
        
        /* 交互式元素 */
        .interactive-element {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .interactive-element:hover {
            color: var(--primary-color);
        }
        
        .interactive-element::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .interactive-element:hover::after {
            width: 100%;
        }
        
        /* 工具提示 */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* 选项卡样式 */
        .tab-container {
            margin: 30px 0;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid rgba(237, 28, 36, 0.2);
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 运势时间轴 */
        .timeline-item {
            position: relative;
            padding-left: 30px;
            margin-bottom: 30px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--primary-color);
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 7px;
            top: 20px;
            bottom: -30px;
            width: 1px;
            background: rgba(237, 28, 36, 0.3);
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .timeline-year {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .timeline-content {
            background: rgba(255, 255, 255, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-buttons {
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <main class="content-container">
        <div class="content-title">
            <h1>八字计算器</h1>
            <p>输入您的出生信息，自动生成完整八字命盘及详细分析</p>
        </div>

        <div class="content-section">
            <div class="calculator-form">
                <div class="form-header">
                    <h2 style="color: white;"><i class="fas fa-user-circle"></i> 基本信息输入</h2>
                    <p style="color: white;">请填写您的出生信息以生成八字命盘</p>
                </div>
                <form id="bazi-form" class="elegant-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-date"><i class="far fa-calendar-alt"></i> 出生日期</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar-day"></i>
                                <input type="date" id="birth-date" name="birth-date" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="far fa-clock"></i> 出生时间</label>
                            <div class="time-select-group">
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-start"></i>
                                    <select id="birth-hour" name="birth-hour" required>
                                        <option value="">-- 时 --</option>
                                        <script>
                                            for(let i=0; i<24; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}时</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                                <div class="select-with-icon">
                                    <i class="fas fa-hourglass-end"></i>
                                    <select id="birth-minute" name="birth-minute" required>
                                        <option value="">-- 分 --</option>
                                        <script>
                                            for(let i=0; i<60; i++) {
                                                document.write(`<option value="${i}">${i < 10 ? '0' + i : i}分</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="timezone"><i class="fas fa-globe-asia"></i> 出生地区</label>
                            <div class="select-with-icon">
                                <i class="fas fa-map-marker-alt"></i>
                                <select id="timezone" name="timezone" required>
                                    <option value="8">中国标准时间 (UTC+8)</option>
                                    <option value="-8">太平洋时间 (UTC-8)</option>
                                    <option value="-5">东部时间 (UTC-5)</option>
                                    <option value="0">格林尼治时间 (UTC+0)</option>
                                    <option value="9">日本标准时间 (UTC+9)</option>
                                    <option value="-7">山地时间 (UTC-7)</option>
                                    <option value="-6">中部时间 (UTC-6)</option>
                                    <option value="1">中欧时间 (UTC+1)</option>
                                    <option value="10">澳大利亚东部时间 (UTC+10)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-venus-mars"></i> 性别</label>
                            <div class="gender-group">
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="male" checked>
                                    <span class="gender-icon"><i class="fas fa-mars"></i></span>
                                    <span class="gender-text">男</span>
                                </label>
                                <label class="gender-option">
                                    <input type="radio" name="gender" value="female">
                                    <span class="gender-icon"><i class="fas fa-venus"></i></span>
                                    <span class="gender-text">女</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-calculator"></i> 计算八字</button>
                        <button type="reset" class="btn btn-secondary"><i class="fas fa-redo"></i> 重置</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="content-section" id="result-section" style="display: none;">
            <div class="result-header">
                <h2><i class="fas fa-chart-pie"></i> 八字命盘结果</h2>
                <div class="result-actions">
                    <button id="print-btn" class="btn btn-action"><i class="fas fa-print"></i> 打印</button>
                    <button id="save-btn" class="btn btn-action"><i class="fas fa-save"></i> 保存</button>
                </div>
            </div>
            
            <div class="bazi-result">
                <div class="basic-info-card">
                    <h3><i class="fas fa-info-circle"></i> 基本信息</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">出生日期：</span>
                            <span class="info-value" id="result-date">1984年1月1日</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">出生时间：</span>
                            <span class="info-value" id="result-time">23:00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">农历日期：</span>
                            <span class="info-value" id="result-lunar">癸亥年腊月初八</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">生肖：</span>
                            <span class="info-value" id="result-zodiac">鼠</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">命宫：</span>
                            <span class="info-value" id="result-minggong">卯宫</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">身宫：</span>
                            <span class="info-value" id="result-shengong">酉宫</span>
                        </div>
                    </div>
                </div>
                
                <div class="bazi-table-container">
                    <table class="bazi-elegant-table">
                        <thead>
                            <tr>
                                <th>四柱</th>
                                <th>年柱</th>
                                <th>月柱</th>
                                <th>日柱</th>
                                <th>时柱</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="pillar-label">天干</td>
                                <td class="wuxing-wood" id="year-stem">甲<br><span class="ten-god">(比肩)</span></td>
                                <td class="wuxing-wood" id="month-stem">乙<br><span class="ten-god">(劫财)</span></td>
                                <td class="wuxing-fire" id="day-stem">丙<br><span class="ten-god">(日元)</span></td>
                                <td class="wuxing-fire" id="hour-stem">丁<br><span class="ten-god">(伤官)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">地支</td>
                                <td class="wuxing-water" id="year-branch">子<br><span class="ten-god">(正官)</span></td>
                                <td class="wuxing-earth" id="month-branch">丑<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-wood" id="day-branch">寅<br><span class="ten-god">(偏印)</span></td>
                                <td class="wuxing-wood" id="hour-branch">卯<br><span class="ten-god">(正印)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">藏干</td>
                                <td class="wuxing-water" id="year-hidden-god">癸<br><span class="ten-god">(正印)</span></td>
                                <td class="wuxing-earth" id="month-hidden-god">己(正财)<br>癸(正印)<br>辛(正官)</td>
                                <td class="wuxing-wood" id="day-hidden-god">甲(比肩)<br>丙(劫财)<br>戊(食神)</td>
                                <td class="wuxing-wood" id="hour-hidden-god">乙<br><span class="ten-god">(劫财)</span></td>
                            </tr>
                            <tr>
                                <td class="pillar-label">空亡</td>
                                <td id="year-void">戌亥</td>
                                <td id="month-void">戌亥</td>
                                <td id="day-void">戌亥</td>
                                <td id="hour-void">戌亥</td>
                            </tr>
                            <tr>
                                <td class="pillar-label">纳音</td>
                                <td id="year-nayin">海中金</td>
                                <td id="month-nayin">海中金</td>
                                <td id="day-nayin">炉中火</td>
                                <td id="hour-nayin">炉中火</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 新增的分析部分 -->
            <div class="analysis-card">
                <h3><i class="fas fa-balance-scale"></i> 身强身弱分析</h3>
                <div class="analysis-content" id="strength-analysis">
                    <!-- 这里将通过JavaScript动态生成内容 -->
                </div>
            </div>
            
            <div class="analysis-card">
                <h3><i class="fas fa-project-diagram"></i> 十神关系分析</h3>
                <div class="analysis-content" id="ten-god-analysis">
                    <!-- 这里将通过JavaScript动态生成内容 -->
                </div>
            </div>
            
            <div class="analysis-card">
                <h3><i class="fas fa-yin-yang"></i> 五行平衡分析</h3>
                <div class="analysis-content">
                    <div id="wuxing-balance-analysis">
                        <!-- 这里将通过JavaScript动态生成内容 -->
                    </div>
                    <div class="wuxing-chart-container">
                        <div class="wuxing-chart" id="wuxing-chart">
                            <!-- 五行图表将通过JavaScript生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-card">
                <h3><i class="fas fa-star"></i> 特殊组合分析</h3>
                <div class="analysis-content" id="special-combo-analysis">
                    <!-- 这里将通过JavaScript动态生成内容 -->
                </div>
            </div>
            
            <div class="analysis-card">
                <h3><i class="fas fa-thumbs-up"></i> 用神与忌神分析</h3>
                <div class="analysis-content">
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <div class="analysis-item-title"><i class="fas fa-heart"></i> 喜用神</div>
                            <div class="analysis-item-content" id="useful-gods">
                                <!-- 这里将通过JavaScript动态生成内容 -->
                            </div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-item-title"><i class="fas fa-times-circle"></i> 忌神</div>
                            <div class="analysis-item-content" id="harmful-gods">
                                <!-- 这里将通过JavaScript动态生成内容 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-card">
                <h3><i class="fas fa-hourglass-half"></i> 命盘运势分析</h3>
                <div class="analysis-content">
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-button active" data-tab="luck-current">当前运势</button>
                            <button class="tab-button" data-tab="luck-decade">大运走势</button>
                            <button class="tab-button" data-tab="luck-year">流年分析</button>
                        </div>
                        
                        <div class="tab-content active" id="luck-current">
                            <div id="current-luck-analysis">
                                <!-- 当前运势内容 -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="luck-decade">
                            <div id="decade-luck-analysis">
                                <!-- 大运走势内容 -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="luck-year">
                            <div id="year-luck-analysis">
                                <!-- 流年分析内容 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analysis-card">
                <h3><i class="fas fa-graduation-cap"></i> 八字学习建议</h3>
                <div class="analysis-content" id="learning-suggestions">
                    <!-- 这里将通过JavaScript动态生成内容 -->
                </div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 麦八字教学网. 保留所有权利.</p>
            <p>传承经典命理文化，科学学习八字知识</p>
        </div>
    </footer>
    
    <script src="../js/lunar.js"></script>
    
    <script>
        // 新增的JavaScript代码
        document.addEventListener('DOMContentLoaded', function() {
            // 选项卡功能
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 移除所有按钮和内容的active类
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 添加active类到当前按钮和对应内容
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // 打印功能
            document.getElementById('print-btn').addEventListener('click', function() {
                window.print();
            });
            
            // 保存功能
            document.getElementById('save-btn').addEventListener('click', function() {
                const resultSection = document.getElementById('result-section');
                html2canvas(resultSection).then(canvas => {
                    const link = document.createElement('a');
                    link.download = '八字命盘分析.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            });
            
            // 表单提交处理
            document.getElementById('bazi-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateBazi();
            });
        });
        
        // 八字计算函数
        function calculateBazi() {
    try {
        // 1. 获取输入数据
        const birthDate = document.getElementById('birth-date').value;
        const birthHour = document.getElementById('birth-hour').value;
        const birthMinute = document.getElementById('birth-minute').value;
        const timezone = document.getElementById('timezone').value;
        const gender = document.querySelector('input[name="gender"]:checked').value;

        // 2. 验证输入
        if (!birthDate || birthHour === "" || birthMinute === "") {
            throw new Error("请填写完整的出生信息");
        }

        // 3. 解析日期
        const [year, month, day] = birthDate.split('-').map(Number);
        const hour = parseInt(birthHour);
        const minute = parseInt(birthMinute);

        // 4. 验证日期有效性
        if (isNaN(year) || year < 1900 || year > 2100) throw new Error("年份应在1900-2100之间");
        if (isNaN(month) || month < 1 || month > 12) throw new Error("月份无效");
        if (isNaN(day) || day < 1 || day > 31) throw new Error("日期无效");
        if (isNaN(hour) || hour < 0 || hour > 23) throw new Error("小时无效");
        if (isNaN(minute) || minute < 0 || minute > 59) throw new Error("分钟无效");

        // 5. 创建日期对象
        const solarDate = new Date(year, month - 1, day, hour, minute);
        if (isNaN(solarDate.getTime())) throw new Error("无效的日期");

        // 6. 计算八字
        const lunar = Lunar.fromDate(solarDate);
        if (!lunar) throw new Error("农历日期转换失败");
        
        const baZi = lunar.getBaZi();
        if (!baZi || baZi.length !== 4) throw new Error("八字计算失败");
        
        const [yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi] = baZi;
        const dayGan = dayGanZhi.substring(0, 1);

        // 7. 显示排盘结果
        displayBaziResult(lunar, baZi, solarDate);

        // 8. 生成详细分析
        generateFullAnalysis(lunar, gender, {
            yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi, dayGan
        });

        // 9. 显示结果区域
        document.getElementById('result-section').style.display = 'block';
        document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });

    } catch (error) {
        console.error("八字计算错误:", error);
        alert(error.message || "计算八字时出错");
    }
}

// 显示排盘结果
function displayBaziResult(lunar, baZi, solarDate) {
    const [yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi] = baZi;
    const dayGan = dayGanZhi.substring(0, 1);

    // 显示基本信息
    document.getElementById('result-date').textContent = 
        `${solarDate.getFullYear()}年${solarDate.getMonth() + 1}月${solarDate.getDate()}日`;
    document.getElementById('result-time').textContent = 
        `${solarDate.getHours().toString().padStart(2, '0')}:${solarDate.getMinutes().toString().padStart(2, '0')}`;
    document.getElementById('result-lunar').textContent = 
        `${lunar.getYearInGanZhi()}年${lunar.getMonthInChinese()}${lunar.getDayInChinese()}`;
    document.getElementById('result-zodiac').textContent = lunar.getYearShengXiao();

    // 更新四柱信息
    updatePillarInfo('year', yearGanZhi, dayGan, lunar);
    updatePillarInfo('month', monthGanZhi, dayGan, lunar);
    updatePillarInfo('day', dayGanZhi, dayGan, lunar);
    updatePillarInfo('hour', hourGanZhi, dayGan, lunar);
}

// 更新单个柱的信息
function updatePillarInfo(type, ganZhi, dayGan, lunar) {
    const gan = ganZhi.substring(0, 1);
    const zhi = ganZhi.substring(1);
    
    // 天干
    document.getElementById(`${type}-stem`).innerHTML = 
        `${gan}<br><span class="ten-god">(${getTenGod(dayGan, gan)})</span>`;
    
    // 地支
    document.getElementById(`${type}-branch`).innerHTML = 
        `${zhi}<br><span class="ten-god">(${getTenGod(dayGan, zhi)})</span>`;
    
    // 藏干
    document.getElementById(`${type}-hidden-god`).innerHTML = 
        getHiddenStems(zhi).map(stem => `${stem}(${getTenGod(dayGan, stem)})`).join('<br>');
    
    // 空亡
    document.getElementById(`${type}-void`).textContent = getVoid(zhi);
    
    // 纳音
    document.getElementById(`${type}-nayin`).textContent = getNaYin(ganZhi);
}

// 生成完整分析
function generateFullAnalysis(lunar, gender, {yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi, dayGan}) {
    // 1. 身强身弱分析
    generateStrengthAnalysis(dayGan, monthGanZhi.substring(1), [yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi]);
    
    // 2. 十神关系分析
    generateTenGodAnalysis(dayGan, yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi);
    
    // 3. 五行平衡分析
    generateWuxingAnalysis([yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi]);
    
    // 4. 特殊组合分析
    generateSpecialCombinationAnalysis(yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi);
    
    // 5. 用神与忌神分析
    generateUsefulHarmfulAnalysis(dayGan, [yearGanZhi, monthGanZhi, dayGanZhi, hourGanZhi]);
    
    // 6. 运势分析
    generateLuckAnalysis(lunar, gender, yearGanZhi);
    
    // 7. 学习建议
    generateLearningSuggestions(dayGan);
}

/* ================ 分析模块实现 ================ */

// 1. 身强身弱分析
function generateStrengthAnalysis(dayGan, monthZhi, pillars) {
    const seasonStrength = analyzeSeasonStrength(monthZhi, dayGan);
    const landStrength = analyzeLandStrength(dayGan, pillars);
    const supportStrength = analyzeSupportStrength(dayGan, pillars);
    
    const strengthLevel = determineStrengthLevel(
        seasonStrength.strength,
        landStrength.strength,
        supportStrength.strength
    );
    
    document.getElementById('strength-analysis').innerHTML = `
        <p>日主<strong class="wuxing-${getElementClass(dayGan)}">${dayGan}</strong>生于${monthZhi}月：</p>
        <p><strong>${getStrengthResult(strengthLevel)}</strong></p>
        <div class="analysis-grid">
            <div class="analysis-item">
                <div class="analysis-item-title"><i class="fas fa-leaf"></i> 得令情况</div>
                <div class="analysis-item-content">${seasonStrength.desc}</div>
            </div>
            <div class="analysis-item">
                <div class="analysis-item-title"><i class="fas fa-water"></i> 得地情况</div>
                <div class="analysis-item-content">${landStrength.desc}</div>
            </div>
            <div class="analysis-item">
                <div class="analysis-item-title"><i class="fas fa-users"></i> 得势情况</div>
                <div class="analysis-item-content">${supportStrength.desc}</div>
            </div>
        </div>
    `;
}

// 2. 十神关系分析
function generateTenGodAnalysis(dayGan, ...pillars) {
    const tenGods = {
        '比肩': { count: 0, icon: 'fas fa-user', meaning: '独立自主，竞争意识强' },
        '劫财': { count: 0, icon: 'fas fa-users', meaning: '重朋友，易破财' },
        '食神': { count: 0, icon: 'fas fa-utensils', meaning: '才华横溢，享乐主义' },
        '伤官': { count: 0, icon: 'fas fa-brain', meaning: '聪明叛逆，创意十足' },
        '偏财': { count: 0, icon: 'fas fa-money-bill-wave', meaning: '意外之财，慷慨大方' },
        '正财': { count: 0, icon: 'fas fa-money-bill-alt', meaning: '稳定收入，勤俭节约' },
        '七杀': { count: 0, icon: 'fas fa-shield-alt', meaning: '压力动力，果断勇敢' },
        '正官': { count: 0, icon: 'fas fa-user-tie', meaning: '责任感强，遵纪守法' },
        '偏印': { count: 0, icon: 'fas fa-book', meaning: '特殊才能，学习能力强' },
        '正印': { count: 0, icon: 'fas fa-graduation-cap', meaning: '学识渊博，慈悲为怀' }
    };

    // 统计十神数量
    pillars.forEach(pillar => {
        const gan = pillar.substring(0, 1);
        const zhi = pillar.substring(1);
        
        // 天干十神
        tenGods[getTenGod(dayGan, gan)].count += 1;
        
        // 地支藏干十神
        getHiddenStems(zhi).forEach(stem => {
            tenGods[getTenGod(dayGan, stem)].count += 0.3;
        });
    });

    // 生成HTML
    let html = '<p>十神关系体现命主的社会关系和性格特征：</p><div class="analysis-grid">';
    
    Object.entries(tenGods)
        .filter(([_, data]) => data.count > 0)
        .sort((a, b) => b[1].count - a[1].count)
        .forEach(([name, data]) => {
            html += `
                <div class="analysis-item">
                    <div class="analysis-item-title"><i class="${data.icon}"></i> ${name}</div>
                    <div class="analysis-item-content">
                        <strong>${data.count.toFixed(1)}</strong> - ${data.meaning}
                    </div>
                </div>
            `;
        });

    html += '</div>';
    document.getElementById('ten-god-analysis').innerHTML = html;
}

// 3. 五行平衡分析
function generateWuxingAnalysis(pillars) {
    const elements = { '木': 0, '火': 0, '土': 0, '金': 0, '水': 0 };
    
    // 统计五行力量
    pillars.forEach(pillar => {
        const gan = pillar.substring(0, 1);
        const zhi = pillar.substring(1);
        
        elements[getElementByGan(gan)] += 1;
        elements[getElementByZhi(zhi)] += 1;
        getHiddenStems(zhi).forEach(stem => {
            elements[getElementByGan(stem)] += 0.5;
        });
    });
    
    // 分析平衡
    const total = Object.values(elements).reduce((sum, val) => sum + val, 0);
    const average = total / 5;
    let imbalance = [];
    
    Object.entries(elements).forEach(([elem, count]) => {
        const ratio = count / average;
        if (ratio > 1.5) imbalance.push(`${elem}过旺`);
        else if (ratio < 0.5) imbalance.push(`${elem}过弱`);
    });
    
    // 生成HTML
    let html = '<p>五行平衡是八字分析的重要基础：</p><div class="analysis-grid">';
    
    Object.entries(elements)
        .sort((a, b) => b[1] - a[1])
        .forEach(([elem, count]) => {
            html += `
                <div class="analysis-item">
                    <div class="analysis-item-title"><i class="${getWuxingIcon(elem)} wuxing-${elem}"></i> ${elem}</div>
                    <div class="analysis-item-content">
                        ${count.toFixed(1)} - ${getWuxingStrengthLevel(count, average)}
                    </div>
                </div>
            `;
        });
    
    html += `</div><p>${imbalance.length > 0 ? 
        `您的八字五行${imbalance.join('，')}，需要注意平衡。` : 
        '您的八字五行分布相对均衡。'}</p>`;
    
    document.getElementById('wuxing-balance-analysis').innerHTML = html;
    generateWuxingChart(elements);
}

// 4. 特殊组合分析
function generateSpecialCombinationAnalysis(...pillars) {
    const zhis = pillars.map(p => p.substring(1));
    const combinations = [];
    
    // 检查三合局
    const sanHe = [
        ['申', '子', '辰'], ['巳', '酉', '丑'],
        ['寅', '午', '戌'], ['亥', '卯', '未']
    ];
    
    sanHe.forEach(he => {
        const matchCount = he.filter(z => zhis.includes(z)).length;
        if (matchCount >= 2) {
            combinations.push({
                name: `${he.join('')}三合${getElementByZhi(he[0])}局`,
                effect: matchCount === 3 ? '强' : '弱',
                meaning: `增强${getElementByZhi(he[0])}的力量`
            });
        }
    });
    
    // 检查六合
    const liuHe = {
        '子丑': '土', '寅亥': '木', '卯戌': '火',
        '辰酉': '金', '巳申': '水', '午未': '土'
    };
    
    Object.entries(liuHe).forEach(([he, elem]) => {
        if (zhis.includes(he[0]) && zhis.includes(he[1])) {
            combinations.push({
                name: `${he}六合${elem}`,
                effect: '中',
                meaning: `形成${elem}的合力`
            });
        }
    });
    
    // 生成HTML
    let html = '<p>特殊组合会影响八字五行的力量分布：</p>';
    
    if (combinations.length > 0) {
        html += '<div class="analysis-grid">';
        combinations.forEach(combo => {
            html += `
                <div class="analysis-item">
                    <div class="analysis-item-title">${combo.name}</div>
                    <div class="analysis-item-content">
                        <strong>${combo.effect}度影响</strong> - ${combo.meaning}
                    </div>
                </div>
            `;
        });
        html += '</div>';
    } else {
        html += '<p>您的八字中没有明显的特殊组合。</p>';
    }
    
    document.getElementById('special-combo-analysis').innerHTML = html;
}

// 5. 用神与忌神分析
function generateUsefulHarmfulAnalysis(dayGan, pillars) {
    const dayElement = getElementByGan(dayGan);
    const wuxingRelations = {
        '木': { same: '木', promote: '火', restrict: '土', weaken: '金', feed: '水' },
        // 其他五行关系...
    };
    
    // 简化的用神判断逻辑
    let usefulGods = [], harmfulGods = [];
    
    if (dayElement === '木') {
        usefulGods = ['水', '木'];
        harmfulGods = ['金', '土'];
    }
    // 其他日干的用神判断...
    
    // 生成HTML
    document.getElementById('useful-gods').innerHTML = `
        ${usefulGods.map(god => `<span class="god-tag useful-god">${god}</span>`).join('')}
        <p>用神(${usefulGods.join('、')})能增强命局平衡，在姓名、方位、颜色等方面可多采用。</p>
    `;
    
    document.getElementById('harmful-gods').innerHTML = `
        ${harmfulGods.map(god => `<span class="god-tag harmful-god">${god}</span>`).join('')}
        <p>忌神(${harmfulGods.join('、')})会破坏命局平衡，应适当避免。</p>
    `;
}

// 6. 运势分析
function generateLuckAnalysis(lunar, gender, yearGanZhi) {
    const currentYear = new Date().getFullYear();
    const startYear = parseInt(yearGanZhi.substring(0, 2)) + 1900;
    const age = currentYear - startYear;
    const decade = Math.floor(age / 10) * 10;
    
    // 生成大运
    let decadeLuck = '';
    for (let i = 0; i < 6; i++) {
        const years = `${decade + i * 10}-${decade + (i + 1) * 10}`;
        const ganZhi = getRandomGanZhi(); // 实际应计算大运
        decadeLuck += `
            <div class="timeline-item">
                <div class="timeline-year">${years} (${ganZhi}运)</div>
                <div class="timeline-content">
                    ${i === 0 ? '当前大运，' : ''}${getLuckDescription(ganZhi)}
                </div>
            </div>
        `;
    }
    
    // 生成流年
    let yearLuck = '';
    for (let i = 0; i < 5; i++) {
        const year = currentYear + i;
        const ganZhi = getYearGanZhi(year);
        yearLuck += `
            <div class="analysis-item">
                <div class="analysis-item-title">${year}年 (${ganZhi})</div>
                <div class="analysis-item-content">${getYearLuck(ganZhi)}</div>
            </div>
        `;
    }
    
    // 设置选项卡内容
    document.getElementById('current-luck-analysis').innerHTML = `
        <p>您当前处于${getAgeRange(age)}阶段：</p>
        <div class="timeline-item">
            <div class="timeline-year">${currentYear}年运势</div>
            <div class="timeline-content">${getYearLuck(getYearGanZhi(currentYear))}</div>
        </div>
    `;
    
    document.getElementById('decade-luck-analysis').innerHTML = `
        <p>人生每十年为一个大运周期：</p>
        ${decadeLuck}
    `;
    
    document.getElementById('year-luck-analysis').innerHTML = `
        <p>未来五年流年运势：</p>
        <div class="analysis-grid">${yearLuck}</div>
    `;
}

// 7. 学习建议
function generateLearningSuggestions(dayGan) {
    const element = getElementByGan(dayGan);
    const suggestions = {
        '木': {
            focus: ['基础理论', '系统知识', '经典著作'],
            tips: ['循序渐进', '建立知识体系', '多实践验证']
        },
        // 其他五行的建议...
    }[element] || {
        focus: ['阴阳五行', '十神关系', '大运流年'],
        tips: ['每日一例', '做笔记', '参加讨论']
    };
    
    document.getElementById('learning-suggestions').innerHTML = `
        <p>根据您的八字日主${dayGan}(${element})，推荐以下学习方式：</p>
        <div class="analysis-grid">
            <div class="analysis-item">
                <div class="analysis-item-title"><i class="fas fa-book"></i> 学习重点</div>
                <div class="analysis-item-content">${suggestions.focus.join('<br>')}</div>
            </div>
            <div class="analysis-item">
                <div class="analysis-item-title"><i class="fas fa-lightbulb"></i> 学习技巧</div>
                <div class="analysis-item-content">${suggestions.tips.join('<br>')}</div>
            </div>
        </div>
    `;
}

/* ================ 工具函数 ================ */

// 获取十神关系
function getTenGod(dayGan, target) {
    const ganList = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
    
    // 地支转主气天干
    if (!ganList.includes(target)) {
        target = getMainQi(target);
        if (!target) return '未知';
    }
    
    const dayIndex = ganList.indexOf(dayGan);
    const targetIndex = ganList.indexOf(target);
    if (dayIndex === -1 || targetIndex === -1) return '未知';
    
    const diff = (targetIndex - dayIndex + 10) % 10;
    const tenGods = ['比肩', '劫财', '偏印', '正印', '七杀', '正官', '偏财', '正财', '食神', '伤官'];
    return tenGods[diff] || '未知';
}

// 获取地支藏干
function getHiddenStems(zhi) {
    const map = {
        '子': ['癸'], '丑': ['己', '癸', '辛'], '寅': ['甲', '丙', '戊'],
        '卯': ['乙'], '辰': ['戊', '乙', '癸'], '巳': ['丙', '戊', '庚'],
        '午': ['丁', '己'], '未': ['己', '丁', '乙'], '申': ['庚', '壬', '戊'],
        '酉': ['辛'], '戌': ['戊', '辛', '丁'], '亥': ['壬', '甲']
    };
    return map[zhi] || [];
}

// 获取空亡
function getVoid(zhi) {
    const order = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
    const index = order.indexOf(zhi);
    if (index === -1) return '';
    return order[(index + 10) % 12] + order[(index + 11) % 12];
}

// 获取纳音五行
function getNaYin(ganZhi) {
    const gan = ganZhi.substring(0, 1);
    const zhi = ganZhi.substring(1);
    
    const ganIndex = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'].indexOf(gan);
    const zhiIndex = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'].indexOf(zhi);
    
    if (ganIndex === -1 || zhiIndex === -1) return '';
    
    const table = [
        ['海中金', '海中金', '炉中火', '炉中火', '大林木', '大林木', '路旁土', '路旁土', '剑锋金', '剑锋金', '山头火', '山头火'],
        // 其他纳音...
    ];
    
    return table[Math.floor(ganIndex / 2)][zhiIndex] || '';
}

// 初始化表单提交事件
document.getElementById('bazi-form').addEventListener('submit', function(e) {
    e.preventDefault();
    calculateBazi();
});

// 打印功能
document.getElementById('print-btn').addEventListener('click', function() {
    window.print();
});

// 示例：获取随机干支（实际应计算）
function getRandomGanZhi() {
    const gan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
    const zhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
    return gan[Math.floor(Math.random() * 10)] + zhi[Math.floor(Math.random() * 12)];
}
        
        // 注意：实际应用中需要更完整的lunar.js集成和更精确的八字计算逻辑
    </script>
</body>
</html>
