<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœŸæ€§å˜åŒ–æœˆä»¤å¾—åˆ†æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            border: 1px solid #ddd;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .comparison-table th {
            background: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>åœŸæ€§å˜åŒ–å¯¹æœˆä»¤å¾—åˆ†å½±å“æµ‹è¯•</h1>
        <p>æµ‹è¯•ç”¨æˆ·åé¦ˆçš„å…«å­—æ¡ˆä¾‹ï¼š<strong>å£¬å­ ç™¸ä¸‘ å·±å·³ ç™¸é…‰</strong></p>
        
        <div class="test-case">
            <h3>æµ‹è¯•æ¡ˆä¾‹ï¼šå·±åœŸæ—¥ä¸»ï¼Œä¸‘æœˆ</h3>
            <p><strong>å…«å­—ï¼š</strong>å£¬å­ ç™¸ä¸‘ å·±å·³ ç™¸é…‰</p>
            <p><strong>åˆ†æè¦ç‚¹ï¼š</strong></p>
            <ul>
                <li>å·±åœŸæ—¥ä¸»ï¼Œä¸‘ä¸ºæ¹¿åœŸæœˆä»¤</li>
                <li>å¤©å¹²ä¸‰ç™¸ä¸€å£¬ï¼Œæ°´åŠ¿ææ—º</li>
                <li>å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€ï¼Œä¸‘åœŸè¢«æ‹‰å‘é‡‘æ€§</li>
                <li>ä¸‘åœŸåœ¨å¼ºæ°´ç¯å¢ƒä¸‹åº”åå‘æ°´æ€§ï¼Œå‡å¼±å¯¹å·±åœŸçš„ç”Ÿæ‰¶</li>
            </ul>
            
            <button onclick="testEarthTransformation()">æµ‹è¯•åœŸæ€§å˜åŒ–åˆ†æ</button>
            <button onclick="compareMonthScores()">å¯¹æ¯”æœˆä»¤å¾—åˆ†</button>
            <button onclick="testFullCalculation()">å®Œæ•´èº«å¼ºèº«å¼±æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script src="earth_transformation_calculator.js"></script>
    <script>
        // æµ‹è¯•æ•°æ®
        const testBazi = {
            stems: ['å£¬', 'ç™¸', 'å·±', 'ç™¸'],
            branches: ['å­', 'ä¸‘', 'å·³', 'é…‰'],
            dayStem: 'å·±',
            monthBranch: 'ä¸‘'
        };
        
        // äº”è¡Œæ˜ å°„
        const stemElementMap = {
            'ç”²': 'wood', 'ä¹™': 'wood', 'ä¸™': 'fire', 'ä¸': 'fire',
            'æˆŠ': 'earth', 'å·±': 'earth', 'åºš': 'metal', 'è¾›': 'metal',
            'å£¬': 'water', 'ç™¸': 'water'
        };
        
        const branchElementMap = {
            'å­': 'water', 'ä¸‘': 'earth', 'å¯…': 'wood', 'å¯': 'wood',
            'è¾°': 'earth', 'å·³': 'fire', 'åˆ': 'fire', 'æœª': 'earth',
            'ç”³': 'metal', 'é…‰': 'metal', 'æˆŒ': 'earth', 'äº¥': 'water'
        };
        
        function addResult(content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = content;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // æµ‹è¯•åœŸæ€§å˜åŒ–åˆ†æ
        function testEarthTransformation() {
            addResult('<h3>ğŸŒ åœŸæ€§å˜åŒ–åˆ†ææµ‹è¯•</h3>', 'info');
            
            const earthCalculator = new EarthTransformationCalculator();
            const result = earthCalculator.analyzeEarthTransformation(testBazi.stems, testBazi.branches);
            
            addResult(`<h4>åˆ†æç»“æœï¼š</h4>
                <p><strong>æ˜¯å¦æœ‰åœŸæ€§å˜åŒ–ï¼š</strong>${result.hasAnyTransformation ? 'æ˜¯' : 'å¦'}</p>
                <p><strong>å˜åŒ–è¯¦æƒ…ï¼š</strong></p>
                <pre>${JSON.stringify(result.transformations, null, 2)}</pre>
                <p><strong>äº”è¡Œè°ƒæ•´ï¼š</strong></p>
                <pre>${JSON.stringify(result.elementAdjustments, null, 2)}</pre>`, 'info');
            
            if (result.wetEarthChanges && result.wetEarthChanges.length > 0) {
                addResult(`<h4>æ¹¿åœŸå˜åŒ–è¯¦æƒ…ï¼š</h4>
                    <pre>${JSON.stringify(result.wetEarthChanges, null, 2)}</pre>`, 'success');
            }
            
            if (result.dryEarthChanges && result.dryEarthChanges.length > 0) {
                addResult(`<h4>ç‡¥åœŸå˜åŒ–è¯¦æƒ…ï¼š</h4>
                    <pre>${JSON.stringify(result.dryEarthChanges, null, 2)}</pre>`, 'success');
            }
        }
        
        // å¯¹æ¯”æœˆä»¤å¾—åˆ†
        function compareMonthScores() {
            addResult('<h3>ğŸ“Š æœˆä»¤å¾—åˆ†å¯¹æ¯”æµ‹è¯•</h3>', 'info');
            
            const earthCalculator = new EarthTransformationCalculator();
            const earthResult = earthCalculator.analyzeEarthTransformation(testBazi.stems, testBazi.branches);
            
            // ä¼ ç»Ÿæœˆä»¤å¾—åˆ†è®¡ç®—
            const traditionalScore = calculateTraditionalMonthScore();
            
            // è€ƒè™‘åœŸæ€§å˜åŒ–çš„æœˆä»¤å¾—åˆ†
            const transformedScore = calculateTransformedMonthScore(earthResult);
            
            addResult(`
                <table class="comparison-table">
                    <tr>
                        <th>è®¡ç®—æ–¹å¼</th>
                        <th>æœˆä»¤å¾—åˆ†</th>
                        <th>è®¡ç®—ä¾æ®</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>ä¼ ç»Ÿè®¡ç®—</td>
                        <td>${traditionalScore}åˆ†</td>
                        <td>ä¸‘åœŸç”Ÿå·±åœŸï¼Œå¾—ä»¤</td>
                        <td>æŒ‰ä¸‘åœŸåŸå§‹å±æ€§è®¡ç®—</td>
                    </tr>
                    <tr>
                        <td>åœŸæ€§å˜åŒ–è®¡ç®—</td>
                        <td>${transformedScore}åˆ†</td>
                        <td>ä¸‘åœŸåœ¨æ°´æ—ºç¯å¢ƒä¸‹åœŸæ€§å‡å¼±</td>
                        <td>è€ƒè™‘ç¯å¢ƒå½±å“åçš„å®é™…å¾—åˆ†</td>
                    </tr>
                    <tr>
                        <td>å·®å¼‚</td>
                        <td>${transformedScore - traditionalScore}åˆ†</td>
                        <td colspan="2">${transformedScore < traditionalScore ? 'åœŸæ€§å˜åŒ–æ˜¾è‘—é™ä½æœˆä»¤å¾—åˆ†' : 'æ— æ˜¾è‘—å½±å“'}</td>
                    </tr>
                </table>
            `, 'warning');
        }
        
        // ä¼ ç»Ÿæœˆä»¤å¾—åˆ†è®¡ç®—
        function calculateTraditionalMonthScore() {
            const dayElement = stemElementMap[testBazi.dayStem]; // earth
            const monthElement = branchElementMap[testBazi.monthBranch]; // earth
            
            if (dayElement === monthElement) {
                return 40; // å¾—ä»¤
            }
            return 0;
        }
        
        // è€ƒè™‘åœŸæ€§å˜åŒ–çš„æœˆä»¤å¾—åˆ†è®¡ç®—
        function calculateTransformedMonthScore(earthResult) {
            let score = calculateTraditionalMonthScore();
            
            if (earthResult.hasAnyTransformation) {
                const monthTransformation = earthResult.transformations.find(t => t.branch === testBazi.monthBranch);
                if (monthTransformation && monthTransformation.originalElement === 'earth') {
                    if (monthTransformation.newElement === 'water') {
                        // æ¹¿åœŸè½¬æ°´æ€§ï¼Œå¯¹åœŸæ—¥ä¸»ç”Ÿæ‰¶å¤§å‡
                        score = Math.round(score * 0.2); // å‡å°‘80%
                    } else if (monthTransformation.transformationType === 'weakened') {
                        // åœŸæ€§å‡å¼±
                        score = Math.round(score * 0.5); // å‡å°‘50%
                    }
                }
            }
            
            return score;
        }
        
        // å®Œæ•´èº«å¼ºèº«å¼±æµ‹è¯•
        function testFullCalculation() {
            addResult('<h3>âš–ï¸ å®Œæ•´èº«å¼ºèº«å¼±åˆ†ææµ‹è¯•</h3>', 'info');
            
            // è®¡ç®—äº”è¡Œåˆ†å¸ƒ
            const elements = calculateElements();
            addResult(`<h4>äº”è¡Œåˆ†å¸ƒï¼š</h4>
                <p>æœ¨: ${elements.wood}, ç«: ${elements.fire}, åœŸ: ${elements.earth}, é‡‘: ${elements.metal}, æ°´: ${elements.water}</p>`, 'info');
            
            // åº”ç”¨åœŸæ€§å˜åŒ–
            const earthCalculator = new EarthTransformationCalculator();
            const earthResult = earthCalculator.analyzeEarthTransformation(testBazi.stems, testBazi.branches);
            
            if (earthResult.hasAnyTransformation) {
                Object.keys(earthResult.elementAdjustments).forEach(element => {
                    const adjustment = earthResult.elementAdjustments[element];
                    if (adjustment !== 0) {
                        elements[element] = Math.max(0, elements[element] + adjustment);
                    }
                });
                addResult(`<h4>åœŸæ€§å˜åŒ–åäº”è¡Œåˆ†å¸ƒï¼š</h4>
                    <p>æœ¨: ${elements.wood}, ç«: ${elements.fire}, åœŸ: ${elements.earth}, é‡‘: ${elements.metal}, æ°´: ${elements.water}</p>`, 'success');
            }
            
            // è®¡ç®—ç”Ÿæ‰¶å…‹æ³„åŠ›é‡
            const dayElement = 'earth';
            const supportElements = ['earth', 'fire']; // åœŸç«ç”Ÿæ‰¶åœŸ
            const weakenElements = ['wood', 'metal', 'water']; // æœ¨é‡‘æ°´å…‹æ³„åœŸ
            
            let supportStrength = 0;
            let weakenStrength = 0;
            
            supportElements.forEach(element => {
                supportStrength += elements[element] || 0;
            });
            
            weakenElements.forEach(element => {
                weakenStrength += elements[element] || 0;
            });
            
            // æœˆä»¤å¾—åˆ†
            const monthScore = calculateTransformedMonthScore(earthResult);
            supportStrength += Math.max(0, monthScore / 10); // æœˆä»¤å¾—åˆ†è½¬æ¢ä¸ºåŠ›é‡
            
            // ä¸‰åˆå±€å½±å“
            if (testBazi.branches.includes('å·³') && testBazi.branches.includes('é…‰') && testBazi.branches.includes('ä¸‘')) {
                weakenStrength += 2; // å·³é…‰ä¸‘åˆé‡‘ï¼Œå¢åŠ å…‹æ³„åŠ›é‡
                addResult('<p><strong>ä¸‰åˆå±€å½±å“ï¼š</strong>å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€ï¼Œå¢åŠ å…‹æ³„åŠ›é‡2ç‚¹</p>', 'warning');
            }
            
            const totalStrength = supportStrength + weakenStrength;
            const ratio = totalStrength > 0 ? supportStrength / totalStrength : 0;
            
            let pattern;
            if (ratio <= 0.18) {
                pattern = 'ä»å¼±';
            } else if (ratio >= 0.80) {
                pattern = 'ä»å¼º';
            } else if (ratio >= 0.55) {
                pattern = 'èº«å¼º';
            } else {
                pattern = 'èº«å¼±';
            }
            
            addResult(`
                <table class="comparison-table">
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>æ•°å€¼</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>ç”Ÿæ‰¶åŠ›é‡</td>
                        <td>${supportStrength.toFixed(2)}ç‚¹</td>
                        <td>åœŸç«äº”è¡Œ + æœˆä»¤å¾—åˆ†</td>
                    </tr>
                    <tr>
                        <td>å…‹æ³„åŠ›é‡</td>
                        <td>${weakenStrength.toFixed(2)}ç‚¹</td>
                        <td>æœ¨é‡‘æ°´äº”è¡Œ + ä¸‰åˆå±€å½±å“</td>
                    </tr>
                    <tr>
                        <td>åŠ›é‡æ¯”ä¾‹</td>
                        <td>${(ratio * 100).toFixed(2)}%</td>
                        <td>ç”Ÿæ‰¶åŠ›é‡ / æ€»åŠ›é‡</td>
                    </tr>
                    <tr>
                        <td>æœˆä»¤å¾—åˆ†</td>
                        <td>${monthScore}ç‚¹</td>
                        <td>è€ƒè™‘åœŸæ€§å˜åŒ–å</td>
                    </tr>
                    <tr>
                        <td>åˆ¤æ–­ç»“æœ</td>
                        <td><strong>${pattern}</strong></td>
                        <td>${pattern === 'ä»å¼±' ? 'âœ… ç¬¦åˆç”¨æˆ·é¢„æœŸ' : 'âŒ ä¸ç”¨æˆ·é¢„æœŸä¸ç¬¦'}</td>
                    </tr>
                </table>
            `, pattern === 'ä»å¼±' ? 'success' : 'error');
        }
        
        // è®¡ç®—åŸºç¡€äº”è¡Œåˆ†å¸ƒ
        function calculateElements() {
            const elements = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
            
            // å¤©å¹²
            testBazi.stems.forEach(stem => {
                const element = stemElementMap[stem];
                if (element) elements[element] += 1;
            });
            
            // åœ°æ”¯
            testBazi.branches.forEach(branch => {
                const element = branchElementMap[branch];
                if (element) elements[element] += 1;
            });
            
            return elements;
        }
    </script>
</body>
</html>