<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœˆä»¤å¾—åˆ†ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .info { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
        .success { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
        .warning { background-color: #fff3e0; border-left: 4px solid #ff9800; }
        .error { background-color: #ffebee; border-left: 4px solid #f44336; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        .comparison {
            display: flex;
            gap: 20px;
        }
        .comparison > div {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .before {
            background-color: #ffebee;
        }
        .after {
            background-color: #e8f5e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æœˆä»¤å¾—åˆ†ä¿®å¤éªŒè¯</h1>
        <p><strong>æµ‹è¯•å…«å­—ï¼š</strong>å£¬å­ ç™¸ä¸‘ å·±å·³ ç™¸é…‰</p>
        <p><strong>é—®é¢˜ï¼š</strong>ä¸‘åœŸæœˆä»¤åœ¨æ¹¿åœŸå˜æ°´é€»è¾‘ä¸‹ï¼Œæœˆä»¤å¾—åˆ†åº”è¯¥ä»40åˆ†å˜ä¸º-10åˆ†</p>
        
        <button onclick="testMonthScoreFix()">éªŒè¯æœˆä»¤å¾—åˆ†ä¿®å¤</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        
        <div id="results"></div>
    </div>

    <script src="enhanced_strength_calculation.js"></script>
    <script>
        // æµ‹è¯•å…«å­—æ•°æ®
        const testBazi = {
            stems: ['å£¬', 'ç™¸', 'å·±', 'ç™¸'],
            branches: ['å­', 'ä¸‘', 'å·³', 'é…‰'],
            monthBranch: 'ä¸‘',
            dayStem: 'å·±'
        };
        
        function addResult(content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = content;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // æ¨¡æ‹Ÿæœˆä»¤å¾—åˆ†è®¡ç®—å‡½æ•°
        function getMonthStrength(dayElement, monthBranch) {
            // å·±åœŸç”Ÿäºä¸‘æœˆï¼ŒåŒç±»ç›¸åŠ©
            if (dayElement === 'earth' && monthBranch === 'ä¸‘') {
                return 40; // ä¼ ç»Ÿå¾—åˆ†
            }
            return 0;
        }
        
        // éªŒè¯æœˆä»¤å¾—åˆ†ä¿®å¤
        function testMonthScoreFix() {
            addResult('<h3>ğŸ”§ æœˆä»¤å¾—åˆ†ä¿®å¤éªŒè¯</h3>', 'info');
            
            try {
                const earthCalculator = new EarthTransformationCalculator();
                
                // 1. åˆ†æåœŸæ€§å˜åŒ–
                const earthResult = earthCalculator.analyzeEarthTransformation(testBazi.stems, testBazi.branches);
                
                addResult(`<h4>1. åœŸæ€§å˜åŒ–åˆ†æç»“æœï¼š</h4>
                    <p><strong>æ˜¯å¦æœ‰å˜åŒ–ï¼š</strong>${earthResult.hasTransformation ? 'æ˜¯' : 'å¦'}</p>
                    <p><strong>å˜åŒ–æ•°é‡ï¼š</strong>${earthResult.transformations.length}</p>`, 'info');
                
                // 2. æ£€æŸ¥æœˆæ”¯ä¸‘åœŸçš„å˜åŒ–
                const monthTransformation = earthResult.transformations.find(t => t.branch === 'ä¸‘');
                
                if (monthTransformation) {
                    addResult(`<h4>2. æœˆæ”¯ä¸‘åœŸå˜åŒ–è¯¦æƒ…ï¼š</h4>
                        <p><strong>åœ°æ”¯ï¼š</strong>${monthTransformation.branch}</p>
                        <p><strong>åŸå§‹å…ƒç´ ï¼š</strong>${monthTransformation.originalElement}</p>
                        <p><strong>æ–°å…ƒç´ ï¼š</strong>${monthTransformation.newElement || 'æ— '}</p>
                        <p><strong>å˜åŒ–ç±»å‹ï¼š</strong>${monthTransformation.transformationType || 'æ— '}</p>
                        <p><strong>æ˜¯å¦å˜åŒ–ï¼š</strong>${monthTransformation.hasTransformation ? 'æ˜¯' : 'å¦'}</p>
                        <p><strong>æ°´å½±å“æºï¼š</strong>${monthTransformation.waterSources.join(', ')}</p>
                        <p><strong>å‡å¼±ç‡ï¼š</strong>${monthTransformation.reductionRate}</p>
                        <p><strong>åŸå› ï¼š</strong>${monthTransformation.reason}</p>`, 'success');
                } else {
                    addResult('<h4>âŒ æœˆæ”¯ä¸‘åœŸå˜åŒ–æ£€æµ‹å¤±è´¥</h4><p>æœªæ‰¾åˆ°ä¸‘åœŸçš„å˜åŒ–è®°å½•</p>', 'error');
                    return;
                }
                
                // 3. è®¡ç®—æœˆä»¤å¾—åˆ†
                let monthScore = getMonthStrength('earth', 'ä¸‘');
                const originalScore = monthScore;
                
                addResult(`<h4>3. æœˆä»¤å¾—åˆ†è®¡ç®—ï¼š</h4>
                    <p><strong>ä¼ ç»Ÿæœˆä»¤å¾—åˆ†ï¼š</strong>${originalScore}åˆ†</p>`, 'info');
                
                // 4. åº”ç”¨åœŸæ€§å˜åŒ–é€»è¾‘
                if (earthResult.hasTransformation && monthTransformation && monthTransformation.originalElement === 'earth') {
                    if (monthTransformation.newElement === 'water') {
                        // æ¹¿åœŸè½¬åŒ–ä¸ºæ°´æ€§ï¼Œå¯¹åœŸæ—¥ä¸»å®Œå…¨å¤±å»ç”Ÿæ‰¶ï¼Œå˜ä¸ºå…‹åˆ¶
                        monthScore = -10;
                        addResult(`<h4>4. âœ… åœŸæ€§å˜åŒ–å½±å“ï¼š</h4>
                            <p><strong>å˜åŒ–ç±»å‹ï¼š</strong>æ¹¿åœŸè½¬æ°´æ€§</p>
                            <p><strong>å¯¹åœŸæ—¥ä¸»å½±å“ï¼š</strong>å¤±å»ç”Ÿæ‰¶ï¼Œå˜ä¸ºå…‹åˆ¶</p>
                            <p><strong>è°ƒæ•´åå¾—åˆ†ï¼š</strong>${originalScore} â†’ ${monthScore}åˆ†</p>`, 'success');
                    } else if (monthTransformation.transformationType === 'weakened') {
                        // åœŸæ€§å‡å¼±
                        monthScore = Math.round(monthScore * 0.5);
                        addResult(`<h4>4. âš ï¸ åœŸæ€§å˜åŒ–å½±å“ï¼š</h4>
                            <p><strong>å˜åŒ–ç±»å‹ï¼š</strong>åœŸæ€§å‡å¼±</p>
                            <p><strong>è°ƒæ•´åå¾—åˆ†ï¼š</strong>${originalScore} â†’ ${monthScore}åˆ†</p>`, 'warning');
                    }
                } else {
                    addResult('<h4>âŒ åœŸæ€§å˜åŒ–é€»è¾‘æœªç”Ÿæ•ˆ</h4>', 'error');
                }
                
                // 5. å¯¹æ¯”ç»“æœ
                addResult(`<div class="comparison">
                    <div class="before">
                        <h4>ä¿®å¤å‰</h4>
                        <p><strong>æœˆä»¤å¾—åˆ†ï¼š</strong>40åˆ†</p>
                        <p><strong>é—®é¢˜ï¼š</strong>æœªè€ƒè™‘ä¸‘åœŸæ¹¿åœŸå˜æ°´çš„å½±å“</p>
                    </div>
                    <div class="after">
                        <h4>ä¿®å¤å</h4>
                        <p><strong>æœˆä»¤å¾—åˆ†ï¼š</strong>${monthScore}åˆ†</p>
                        <p><strong>çŠ¶æ€ï¼š</strong>${monthScore === -10 ? 'âœ… ä¿®å¤æˆåŠŸ' : 'âŒ ä»æœ‰é—®é¢˜'}</p>
                    </div>
                </div>`, monthScore === -10 ? 'success' : 'error');
                
                // 6. æ€»ç»“
                if (monthScore === -10) {
                    addResult(`<h4>ğŸ‰ ä¿®å¤éªŒè¯æˆåŠŸï¼</h4>
                        <p>ä¸‘åœŸæœˆä»¤å¾—åˆ†å·²æ­£ç¡®ä»40åˆ†è°ƒæ•´ä¸º-10åˆ†ï¼ŒåœŸæ€§å˜åŒ–é€»è¾‘å·¥ä½œæ­£å¸¸ã€‚</p>`, 'success');
                } else {
                    addResult(`<h4>âŒ ä¿®å¤éªŒè¯å¤±è´¥</h4>
                        <p>æœˆä»¤å¾—åˆ†ä»ä¸º${monthScore}åˆ†ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥é€»è¾‘ã€‚</p>`, 'error');
                }
                
            } catch (error) {
                addResult(`<h4>âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š</h4>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>`, 'error');
            }
        }
    </script>
</body>
</html>