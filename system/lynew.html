<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>六爻占卜系统</title>
    <style>
        /* 基础样式 */
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1, h2, h3 {
            color: #8B4513;
            text-align: center;
        }
        
        /* 铜钱样式 */
        .coin {
            width: 60px;
            height: 60px;
            margin: 5px;
            transition: transform 0.5s ease;
        }
        
        .coin-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        /* 卦象显示 */
        .hexagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }
        
        .line {
            height: 20px;
            margin: 3px 0;
            position: relative;
        }
        
        .yang {
            background-color: #FF4500;
            width: 150px;
        }
        
        .yin {
            background-color: #4682B4;
            width: 150px;
        }
        
        .yin-broken {
            display: flex;
            justify-content: space-between;
            width: 150px;
        }
        
        .yin-part {
            width: 65px;
            background-color: #4682B4;
        }
        
        /* 按钮样式 */
        .btn {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #A0522D;
        }
        
        /* 结果区域 */
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 5px solid #8B4513;
        }
        
        /* 动画效果 */
        @keyframes shake {
            0% { transform: rotate(0deg); }
            10% { transform: rotate(-5deg); }
            20% { transform: rotate(5deg); }
            30% { transform: rotate(-5deg); }
            40% { transform: rotate(5deg); }
            50% { transform: rotate(-5deg); }
            60% { transform: rotate(5deg); }
            70% { transform: rotate(-5deg); }
            80% { transform: rotate(5deg); }
            90% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        
        .shaking {
            animation: shake 0.5s;
        }
        
        /* 选项卡样式 */
        .tab-container {
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: #f1f1f1;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab-btn.active {
            background: #8B4513;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-top: none;
            background: white;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .coin {
                width: 40px;
                height: 40px;
            }
            
            .yang, .yin, .yin-broken {
                width: 100px;
            }
            
            .yin-part {
                width: 45px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>六爻占卜系统</h1>
        <div id="intro">
            <p>六爻是中国古代的一种占卜方法，通过投掷铜钱六次来形成一个卦象，然后根据卦象和爻辞来解读所问之事。本系统模拟传统铜钱占卜过程，为您提供准确的卦象和解读。</p>
        </div>
        
        <div class="coin-container" id="coins">
            <!-- 铜钱将通过JS动态生成 -->
        </div>
        
        <div style="text-align: center;">
            <button class="btn" id="castBtn">开始摇卦</button>
            <button class="btn" id="resetBtn">重新开始</button>
        </div>
        
        <div id="hexagramDisplay" class="hexagram">
            <!-- 卦象将通过JS动态生成 -->
        </div>
        
        <div id="result" class="result" style="display: none;">
            <h2 id="hexagramName"></h2>
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="overview">卦象总览</button>
                    <button class="tab-btn" data-tab="lines">爻辞详解</button>
                    <button class="tab-btn" data-tab="interpretation">卦象解读</button>
                </div>
                
                <div id="overview" class="tab-content active">
                    <h3>卦象基本信息</h3>
                    <p id="hexagramBasic"></p>
                </div>
                
                <div id="lines" class="tab-content">
                    <h3>六爻爻辞</h3>
                    <div id="lineTexts"></div>
                </div>
                
                <div id="interpretation" class="tab-content">
                    <h3>卦象解读</h3>
                    <p id="hexagramInterpretation"></p>
                </div>
            </div>
        </div>
        
        <div id="instructions" style="margin-top: 30px; padding: 15px; background-color: #fff8e1; border-radius: 5px;">
            <h3>使用说明</h3>
            <ol>
                <li>点击"开始摇卦"按钮，系统将自动模拟投掷三枚铜钱六次的过程</li>
                <li>每次投掷结果将显示为铜钱的正反面，并自动记录爻象</li>
                <li>六次投掷完成后，系统将显示完整的卦象和对应的卦名</li>
                <li>您可以在结果区域查看卦象的总览、各爻爻辞以及整体解读</li>
                <li>如需重新占卜，请点击"重新开始"按钮</li>
            </ol>
            <p><strong>注意：</strong>占卜时应保持心境平和，专注于所问之事。占卜结果仅供参考，决策仍需结合实际情况。</p>
        </div>
    </div>

    <script>
        // 64卦数据
        const hexagrams = {
            // 这里只展示部分卦象数据，实际应有64个
            1: {
                name: "乾为天",
                binary: "111111",
                overview: "乾卦象征天，代表着刚健、创始、主动。六爻皆阳，表示纯阳至刚之象。乾卦强调自强不息的精神，提示应效法天的刚健，不断进取。",
                lines: {
                    1: "初九：潜龙勿用。",
                    2: "九二：见龙在田，利见大人。",
                    3: "九三：君子终日乾乾，夕惕若，厉无咎。",
                    4: "九四：或跃在渊，无咎。",
                    5: "九五：飞龙在天，利见大人。",
                    6: "上九：亢龙有悔。"
                },
                interpretation: "乾卦代表创造力和领导力。当前时机适合采取主动，但需注意不要过度。初爻提示应等待时机；二爻表示开始显露；三爻告诫要谨慎；四爻显示可尝试突破；五爻是鼎盛时期；上爻警示过犹不及。整体而言，此卦鼓励积极行动但需把握分寸。"
            },
            2: {
                name: "坤为地",
                binary: "000000",
                overview: "坤卦象征地，代表着柔顺、包容、承载。六爻皆阴，表示纯阴至柔之象。坤卦强调厚德载物的精神，提示应效法地的包容，以柔克刚。",
                lines: {
                    1: "初六：履霜，坚冰至。",
                    2: "六二：直方大，不习无不利。",
                    3: "六三：含章可贞，或从王事，无成有终。",
                    4: "六四：括囊，无咎无誉。",
                    5: "六五：黄裳，元吉。",
                    6: "上六：龙战于野，其血玄黄。"
                },
                interpretation: "坤卦代表接纳和滋养。当前适合采取守势，培养内在力量而非强行推进。初爻提示见微知著；二爻显示自然发展；三爻告诫含蓄收敛；四爻建议谨慎行事；五爻是和谐状态；上爻警示矛盾冲突。整体而言，此卦强调顺应时势、以静制动。"
            },
            // 其他62卦数据...
            63: {
                name: "水火既济",
                binary: "101010",
                overview: "既济卦象征事情已经完成，六爻各得其所，表示成功和圆满的状态。但卦辞提醒'初吉终乱'，警示成功后可能出现的松懈和问题。",
                lines: {
                    1: "初九：曳其轮，濡其尾，无咎。",
                    2: "六二：妇丧其茀，勿逐，七日得。",
                    3: "九三：高宗伐鬼方，三年克之，小人勿用。",
                    4: "六四：繻有衣袽，终日戒。",
                    5: "九五：东邻杀牛，不如西邻之禴祭，实受其福。",
                    6: "上六：濡其首，厉。"
                },
                interpretation: "既济卦表示事情已经成功或接近完成，但提醒成功之后仍需谨慎。初爻表示谨慎行事；二爻显示失而复得；三爻强调坚持和用人得当；四爻告诫保持警惕；五爻比较不同方式的成效；上爻警示过度可能导致危险。整体而言，此卦既肯定成就，又提醒戒骄戒躁。"
            },
            64: {
                name: "火水未济",
                binary: "010101",
                overview: "未济卦象征事情未完成，表示处于过渡阶段或即将成功但尚未完成的状态。六爻皆不当位，但正因如此而有发展变化的可能。",
                lines: {
                    1: "初六：濡其尾，吝。",
                    2: "九二：曳其轮，贞吉。",
                    3: "六三：未济，征凶，利涉大川。",
                    4: "九四：贞吉，悔亡，震用伐鬼方，三年有赏于大国。",
                    5: "六五：贞吉，无悔，君子之光，有孚吉。",
                    6: "上九：有孚于饮酒，无咎，濡其首，有孚失是。"
                },
                interpretation: "未济卦表示事情尚未完成，处于过渡阶段。初爻显示起步困难；二爻表示稳步前进；三爻看似矛盾，实指某些方向不利而另一些有利；四爻强调坚持带来回报；五爻显示内在光辉；上爻警示过度享乐。整体而言，此卦表示即将成功但需继续努力，同时注意选择正确方向。"
            }
        };

        // 全局变量
        let currentLines = [];
        let isCasting = false;
        let currentStep = 0;
        
        // DOM元素
        const coinsContainer = document.getElementById('coins');
        const hexagramDisplay = document.getElementById('hexagramDisplay');
        const resultDiv = document.getElementById('result');
        const hexagramName = document.getElementById('hexagramName');
        const hexagramBasic = document.getElementById('hexagramBasic');
        const lineTexts = document.getElementById('lineTexts');
        const hexagramInterpretation = document.getElementById('hexagramInterpretation');
        const castBtn = document.getElementById('castBtn');
        const resetBtn = document.getElementById('resetBtn');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // 初始化
        function init() {
            // 创建6组铜钱（每组3枚）
            coinsContainer.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const coinGroup = document.createElement('div');
                coinGroup.className = 'coin-group';
                coinGroup.style.display = 'none'; // 初始隐藏
                
                for (let j = 0; j < 3; j++) {
                    const coin = document.createElement('img');
                    coin.className = 'coin';
                    coin.src = '../images/coinb.gif'; // 初始显示反面
                    coin.dataset.side = 'back'; // 记录当前面
                    coinGroup.appendChild(coin);
                }
                
                coinsContainer.appendChild(coinGroup);
            }
            
            // 绑定事件
            castBtn.addEventListener('click', startCasting);
            resetBtn.addEventListener('click', resetSystem);
            
            // 选项卡切换
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    switchTab(tabId);
                });
            });
        }
        
        // 开始摇卦
        function startCasting() {
            if (isCasting) return;
            
            isCasting = true;
            currentStep = 0;
            currentLines = [];
            hexagramDisplay.innerHTML = '';
            resultDiv.style.display = 'none';
            castBtn.disabled = true;
            
            // 显示第一组铜钱
            const coinGroups = document.querySelectorAll('.coin-group');
            coinGroups[0].style.display = 'flex';
            
            // 开始摇卦过程
            castStep(0);
        }
        
        // 摇卦步骤
        function castStep(step) {
            if (step >= 6) {
                finishCasting();
                return;
            }
            
            currentStep = step;
            const coinGroup = document.querySelectorAll('.coin-group')[step];
            const coins = coinGroup.querySelectorAll('.coin');
            
            // 重置硬币状态
            coins.forEach(coin => {
                coin.dataset.side = 'back';
                coin.src = '../images/coinb.gif';
            });
            
            // 摇动动画
            coinGroup.classList.add('shaking');
            
            // 3秒后停止并显示结果
            setTimeout(() => {
                coinGroup.classList.remove('shaking');
                
                // 随机决定硬币正反面（模拟现实概率）
                let yangCount = 0; // 记录正面（有字面）数量
                
                coins.forEach(coin => {
                    // 铜钱概率：正面（有字）30%，反面（无字）70%
                    const random = Math.random();
                    if (random < 0.3) { // 正面（有字）
                        coin.src = '../images/coinf.gif';
                        coin.dataset.side = 'front';
                        yangCount++;
                    } else { // 反面（无字）
                        coin.src = '../images/coinb.gif';
                        coin.dataset.side = 'back';
                    }
                });
                
                // 根据正面数量确定爻象
                /*
                3正面（3阳）：老阳（变爻）→ 阳爻（记录为1）
                2正面（1阳）：少阳 → 阳爻（记录为1）
                1正面（2阳）：少阴 → 阴爻（记录为0）
                0正面（3阳）：老阴（变爻）→ 阴爻（记录为0）
                */
                let lineValue;
                if (yangCount === 3) {
                    lineValue = { value: 1, changing: true }; // 老阳
                } else if (yangCount === 2) {
                    lineValue = { value: 1, changing: false }; // 少阳
                } else if (yangCount === 1) {
                    lineValue = { value: 0, changing: false }; // 少阴
                } else {
                    lineValue = { value: 0, changing: true }; // 老阴
                }
                
                currentLines.push(lineValue);
                displayCurrentHexagram();
                
                // 继续下一步
                if (step < 5) {
                    // 显示下一组铜钱
                    document.querySelectorAll('.coin-group')[step + 1].style.display = 'flex';
                    
                    // 1秒后继续下一步
                    setTimeout(() => {
                        castStep(step + 1);
                    }, 1000);
                } else {
                    finishCasting();
                }
            }, 3000);
        }
        
        // 显示当前卦象（逐步构建）
        function displayCurrentHexagram() {
            hexagramDisplay.innerHTML = '';
            
            // 从下往上显示爻
            for (let i = currentLines.length - 1; i >= 0; i--) {
                const line = currentLines[i];
                const lineDiv = document.createElement('div');
                lineDiv.className = 'line';
                
                if (line.value === 1) { // 阳爻
                    lineDiv.innerHTML = '<div class="yang"></div>';
                    if (line.changing) {
                        lineDiv.innerHTML += '<div style="color:red;text-align:center;">○</div>'; // 标记变爻
                    }
                } else { // 阴爻
                    lineDiv.innerHTML = '<div class="yin-broken"><div class="yin-part"></div><div class="yin-part"></div></div>';
                    if (line.changing) {
                        lineDiv.innerHTML += '<div style="color:red;text-align:center;">×</div>'; // 标记变爻
                    }
                }
                
                hexagramDisplay.appendChild(lineDiv);
            }
        }
        
        // 完成摇卦
        function finishCasting() {
            isCasting = false;
            castBtn.disabled = false;
            
            // 确定卦象
            const binaryString = currentLines.map(line => line.value).join('');
            const hexagram = findHexagram(binaryString);
            
            // 显示结果
            resultDiv.style.display = 'block';
            hexagramName.textContent = hexagram.name;
            hexagramBasic.innerHTML = `<p><strong>卦象：</strong>${hexagram.name}</p><p>${hexagram.overview}</p>`;
            
            // 显示爻辞
            let linesHtml = '';
            for (let i = 1; i <= 6; i++) {
                const lineNum = 6 - i + 1; // 因为爻是从下往上数的
                linesHtml += `<p><strong>第${lineNum}爻：</strong>${hexagram.lines[lineNum]} ${
                    currentLines[lineNum - 1].changing ? '<span style="color:red;">(变爻)</span>' : ''
                }</p>`;
            }
            lineTexts.innerHTML = linesHtml;
            
            // 显示解读
            hexagramInterpretation.textContent = hexagram.interpretation;
            
            // 默认显示第一个选项卡
            switchTab('overview');
        }
        
        // 根据二进制字符串查找卦象
        function findHexagram(binaryString) {
            // 在实际应用中，这里应该有完整的64卦匹配逻辑
            // 简化版：只匹配我们定义的几个卦
            for (const [key, value] of Object.entries(hexagrams)) {
                if (value.binary === binaryString) {
                    return value;
                }
            }
            
            // 如果没有完全匹配的，返回一个默认卦（实际应用中应该处理所有64卦）
            return hexagrams[1];
        }
        
        // 重置系统
        function resetSystem() {
            isCasting = false;
            currentLines = [];
            currentStep = 0;
            hexagramDisplay.innerHTML = '';
            resultDiv.style.display = 'none';
            castBtn.disabled = false;
            
            // 隐藏所有铜钱组
            document.querySelectorAll('.coin-group').forEach(group => {
                group.style.display = 'none';
            });
        }
        
        // 切换选项卡
        function switchTab(tabId) {
            // 移除所有active类
            tabBtns.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // 添加active类到当前选项卡
            document.querySelector(`.tab-btn[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // 初始化系统
        init();
    </script>
</body>
</html>
