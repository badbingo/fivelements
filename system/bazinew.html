<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ä¸“ä¸šå…«å­—é¢„æµ‹ç³»ç»Ÿï¼Œç²¾å‡†æ’ç›˜ï¼Œè¯¦ç»†åˆ†æ">
    <meta name="keywords" content="å…«å­—,å‘½ç†,é¢„æµ‹,æ’ç›˜,äº”è¡Œ">
    <title>ä¸“ä¸šå…«å­—é¢„æµ‹ç³»ç»Ÿ</title>
    
    <!-- å­—ä½“å’Œå›¾æ ‡ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js å’Œæ’ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="../js/wwpay.js" defer></script>
    
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --gold-color: #f39c12;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #e9ecef;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Noto Serif SC', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .card-header i {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-right: 15px;
        }

        .card-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
        }

        .form-group label i {
            margin-right: 8px;
            color: var(--secondary-color);
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            -webkit-appearance: none; /* ä¿®å¤Safariä¸‹æ‹‰æ¡†æ ·å¼ */
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg fill='%232c3e50' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* Form Text Helper */
        .form-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: block;
        }

        /* Button Styles */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-center {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        /* Bazi Table - ä¼˜åŒ–ç‰ˆ */
        .bazi-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 25px 0;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            backdrop-filter: blur(10px);
        }

        .bazi-table th,
        .bazi-table td {
            padding: 15px 12px;
            text-align: center;
            border: none;
            position: relative;
            height: auto;
            vertical-align: middle;
            transition: all 0.3s ease;
        }
        
        .bazi-table tr:not(:last-child) td,
        .bazi-table tr:not(:last-child) th {
            border-bottom: 1px solid rgba(233, 236, 239, 0.8);
        }
        
        .bazi-table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            font-weight: 600;
            letter-spacing: 1px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            padding: 18px 15px;
        }

        .bazi-table td {
            background: transparent;
            font-weight: 500;
        }
        
        .bazi-table td:first-child {
            font-weight: 600;
            background: rgba(52, 152, 219, 0.05);
            border-right: 1px solid rgba(233, 236, 239, 0.8);
        }

        .bazi-table .pillar-header {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .bazi-table .stem {
            position: relative;
            padding: 15px 0;
        }

        .bazi-table .branch {
            position: relative;
            padding: 15px 0;
        }
        
        /* æ·»åŠ æŸ±å­ä¹‹é—´çš„åˆ†éš”çº¿ */
        .bazi-table th:not(:last-child),
        .bazi-table td:not(:last-child) {
            border-right: 1px solid rgba(233, 236, 239, 0.5);
        }
        
        /* é¼ æ ‡æ‚¬åœæ•ˆæœ */
        .bazi-table tbody tr:hover td {
            background-color: rgba(52, 152, 219, 0.05);
        }

        /* Chart Container - ä¼˜åŒ–ç‰ˆ */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 35px 0;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 20px;
            backdrop-filter: blur(5px);
            overflow: hidden;
        }
        
        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
        }

/* Loading Spinner Styles */
.loading-spinner {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 20px;
}

.spinner-circle {
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

        .chart-description {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px);
            border-left: 4px solid var(--secondary-color);
        }
        
        .chart-description h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
        }
        
        .chart-description h4 i {
            margin-right: 10px;
            color: var(--secondary-color);
        }
        
        .chart-description p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .chart-description strong {
            color: var(--primary-color);
        }

        /* Analysis Sections - ä¼˜åŒ–ç‰ˆ */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 35px 0;
        }

        .analysis-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--secondary-color);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }
        
        .analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at top right, rgba(52, 152, 219, 0.1), transparent 70%);
            border-radius: 0 0 0 100%;
        }

        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .analysis-card h3 {
            color: var(--primary-color);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            font-size: 1.4em;
            position: relative;
            padding-bottom: 12px;
        }
        
        .analysis-card h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-color), transparent);
            border-radius: 3px;
        }

        .analysis-card h3 i {
            margin-right: 12px;
            color: var(--secondary-color);
            font-size: 1.1em;
        }
        
        .analysis-card p {
            line-height: 1.7;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(3px);
        }

        .loading-overlay .loading {
            width: 60px;
            height: 60px;
            margin-bottom: 20px;
        }

        .loading-overlay p {
            color: white;
            font-size: 18px;
            margin: 0;
            text-align: center;
        }

        /* Beautiful Spinner */
        .beautiful-spinner {
            width: 20px;
            height: 20px;
            position: relative;
            display: inline-block;
        }

        .beautiful-spinner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid transparent;
            border-top: 2px solid #3498db;
            border-right: 2px solid #e74c3c;
            border-radius: 50%;
            animation: beautiful-spin 1s linear infinite;
        }

        .beautiful-spinner::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: calc(100% - 6px);
            height: calc(100% - 6px);
            border: 2px solid transparent;
            border-top: 2px solid #f39c12;
            border-left: 2px solid #9b59b6;
            border-radius: 50%;
            animation: beautiful-spin 0.8s linear infinite reverse;
        }

        @keyframes beautiful-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tab System - ä¼˜åŒ–ç‰ˆ */
        .tab-container {
            margin: 35px 0;
        }

        .tab-nav {
            display: flex;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            position: relative;
            z-index: 2;
            backdrop-filter: blur(5px);
        }

        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            position: relative;
            overflow: hidden;
            color: var(--text-secondary);
            font-size: 1.05em;
        }
        
        .tab-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-color), rgba(52, 152, 219, 0.5));
            transition: all 0.3s ease;
            transform: translateX(-50%);
            border-radius: 3px 3px 0 0;
        }

        .tab-btn:hover {
            color: var(--primary-color);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .tab-btn:hover::before {
            width: 30%;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, rgba(255,255,255,1), rgba(255,255,255,0.9));
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .tab-btn.active::before {
            width: 80%;
        }

        .tab-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            padding: 35px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: none;
            position: relative;
            z-index: 1;
            margin-top: -1px;
            backdrop-filter: blur(5px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Analysis Button - ä¼˜åŒ–ç‰ˆ */
        .analysis-btn {
            width: 100%;
            padding: 22px 25px;
            margin: 18px 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }
        
        .analysis-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--secondary-color), transparent);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .analysis-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, rgba(255,255,255,1), rgba(255,255,255,0.9));
        }
        
        .analysis-btn:hover::before {
            opacity: 1;
        }

        .analysis-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .analysis-btn-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .analysis-btn-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .analysis-btn:hover .analysis-btn-title {
            color: var(--secondary-color);
            transform: translateX(5px);
        }

        .analysis-btn-title i {
            margin-right: 12px;
            color: var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        .analysis-btn:hover .analysis-btn-title i {
            transform: scale(1.2);
        }

        .analysis-btn-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        
        .analysis-btn:hover .analysis-btn-desc {
            color: var(--text-primary);
        }

        .analysis-content {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .analysis-content.show {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            body {
                overflow-x: auto;
            }
            
            .page-container {
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 15px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tab-nav {
                flex-direction: column;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            /* ç§»åŠ¨è®¾å¤‡ä¸Šçš„è¡¨å•å…ƒç´ æ ·å¼è°ƒæ•´ */
            .form-group input,
            .form-group select {
                font-size: 16px; /* é˜²æ­¢iOSä¸Šè‡ªåŠ¨ç¼©æ”¾ */
                padding: 12px 40px 12px 15px; /* å¢åŠ å³ä¾§paddingï¼Œä¸ºä¸‹æ‹‰ç®­å¤´ç•™å‡ºç©ºé—´ */
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }
            
            /* ç¡®ä¿ä¸‹æ‹‰ç®­å¤´åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯è§ */
            .form-group select {
                background-position: right 15px center;
                background-size: 16px;
            }
            
            /* è°ƒæ•´å¡ç‰‡å†…è¾¹è· */
            .card {
                padding: 20px 15px;
            }
        }
        
        /* å°å±å¹•è®¾å¤‡çš„é¢å¤–è°ƒæ•´ */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .card-header h2 {
                font-size: 1.3rem;
            }
            
            .btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            /* ç¡®ä¿è¡¨å•å…ƒç´ åœ¨å°å±å¹•ä¸Šæ›´æ˜“äºç‚¹å‡» */
            .form-group input,
            .form-group select {
                height: 48px; /* å¢åŠ é«˜åº¦ä½¿è§¦æ‘¸æ›´å®¹æ˜“ */
            }
        }

        /* Bazi Q&A Styles */
        .bazi-qa-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .bazi-qa-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .bazi-qa-header h3 {
            color: var(--primary-color);
            font-size: 1.5em;
            margin: 0 0 8px 0;
            font-weight: 600;
        }
        
        .bazi-qa-header h3 i {
            margin-right: 8px;
            color: var(--secondary-color);
        }
        
        .bazi-qa-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0;
            line-height: 1.5;
        }
        
        .bazi-qa-input-section {
            margin-bottom: 20px;
        }
        
        .bazi-qa-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        
        #bazi-qa-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid rgba(52, 152, 219, 0.2);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            height: 48px;
            background: rgba(255,255,255,0.9);
            transition: all 0.3s ease;
        }
        
        #bazi-qa-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            background: rgba(255,255,255,1);
        }
        
        .bazi-qa-submit {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 48px;
        }
        
        .bazi-qa-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .bazi-qa-submit:active {
            transform: translateY(0);
        }
        
        .bazi-qa-response {
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
            margin-top: 15px;
            line-height: 1.6;
        }
        
        .bazi-qa-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .qa-answer {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .qa-answer h4 {
            color: #007bff;
            margin: 0 0 15px 0;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .qa-answer h4 i {
            font-size: 1.2em;
        }
        
        .qa-content {
            line-height: 1.6;
            color: #333;
            font-size: 0.95em;
        }
        
        .qa-content br {
            margin-bottom: 8px;
        }
        
        .qa-content h1, .qa-content h2, .qa-content h3 {
            color: #2c3e50;
            margin: 15px 0 10px 0;
            font-weight: 600;
        }
        
        .qa-content h1 {
            font-size: 1.4em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .qa-content h2 {
            font-size: 1.2em;
            color: #34495e;
        }
        
        .qa-content h3 {
            font-size: 1.1em;
            color: #7f8c8d;
        }
        
        .qa-content strong {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .qa-content em {
            color: #8e44ad;
            font-style: italic;
        }
        
        .qa-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .qa-content li {
            margin: 5px 0;
            list-style-type: disc;
        }
        
        .qa-content p {
            margin: 10px 0;
            text-align: justify;
        }
        
        /* ç§»åŠ¨è®¾å¤‡é€‚é… */
        @media (max-width: 768px) {
            .bazi-qa-input-wrapper {
                flex-direction: column;
                align-items: stretch;
            }
            
            .bazi-qa-submit {
                justify-content: center;
            }
        }

        /* Hidden by default */
        .result-section {
            display: none;
        }

        .result-section.show {
            display: block;
        }
    /* æ·»åŠ å¤–å±‚å®¹å™¨ */
    .page-container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        overflow-x: hidden;
    }
    
    /* å†…éƒ¨å®¹å™¨ä½¿ç”¨100%å®½åº¦ */
    .container {
        width: 100%;
        margin: 0 auto;
        padding: 20px;
    }
    
    /* Safariç‰¹å®šæ ·å¼ */
    @media not all and (min-resolution:.001dpcm) { 
        @supports (-webkit-appearance:none) {
            .form-group select {
                background-color: white; /* ç¡®ä¿èƒŒæ™¯è‰²ä¸ºç™½è‰² */
                text-indent: 1px; /* ä¿®å¤æ–‡æœ¬å¯¹é½é—®é¢˜ */
                text-overflow: ''; /* å¤„ç†æ–‡æœ¬æº¢å‡º */
                padding-right: 30px; /* ä¸ºä¸‹æ‹‰ç®­å¤´ç•™å‡ºç©ºé—´ */
            }
            
            /* ä¿®å¤Safariä¸Šçš„è§¦æ‘¸äº‹ä»¶ */
            .form-group select:hover,
            .form-group select:focus {
                cursor: pointer;
                border-color: var(--secondary-color);
            }
        }
    }
    </style>
</head>
<body>
    <!-- åŠ è½½é®ç½© -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading beautiful-spinner"></div>
        <p id="loadingMessage">æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...</p>
    </div>
    
    <div class="page-container">
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-yin-yang"></i> ä¸“ä¸šå…«å­—é¢„æµ‹ç³»ç»Ÿ</h1>
            <p>ç²¾å‡†æ’ç›˜ Â· è¯¦ç»†åˆ†æ Â· ä¸“ä¸šé¢„æµ‹</p>
        </header>

        <!-- Input Section -->
        <section class="input-section" id="input-section">
            <div class="card">
                <div class="card-header" style="position: relative;">
                    <i class="fas fa-user-edit"></i>
                    <h2>è¯·è¾“å…¥æ‚¨çš„å‡ºç”Ÿä¿¡æ¯</h2>
                    <div class="user-area" id="bazi-user-area" style="position: absolute; top: 10px; right: 10px; display: flex; align-items: center; gap: 10px; font-size: 0.9em;">
                        <span id="userName" style="font-weight: bold; color: var(--primary-color);">æœªç™»å½•</span>
                        <span id="userBalance" style="display: none; color: var(--gold-color);">ä½™é¢: <span id="balanceAmount">0.00</span></span>
                        <button id="loginRegisterBtn" class="btn-small" style="background-color: var(--secondary-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ç™»å½•/æ³¨å†Œ</button>
                        <button id="rechargeBtn" class="btn-small" style="background-color: var(--success-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; display: none;">å……å€¼</button>
                        <button id="manageBtn" class="btn-small" style="background-color: var(--primary-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; display: none;">ç®¡ç†</button>
                        <button id="logoutBtn" class="btn-small" style="background-color: var(--danger-color); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; display: none;">é€€å‡º</button>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name"><i class="fas fa-user"></i> å§“å</label>
                        <input type="text" id="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender"><i class="fas fa-venus-mars"></i> æ€§åˆ«</label>
                        <select id="gender" required>
                            <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="birth-date"><i class="fas fa-calendar-alt"></i> å‡ºç”Ÿæ—¥æœŸ</label>
                        <input type="date" id="birth-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="birth-time"><i class="fas fa-clock"></i> å‡ºç”Ÿæ—¶é—´</label>
                        <input type="time" id="birth-time" placeholder="è¯·è¾“å…¥å‡ºç”Ÿæ—¶é—´" required>
                        <small class="form-text">è¯·è¾“å…¥24å°æ—¶åˆ¶æ—¶é—´ï¼Œä¾‹å¦‚ï¼š08:30ã€15:45</small>
                    </div>
                    </div>
                </div>
                
                <div class="btn-center">
                    <button class="btn btn-primary" id="calculate-btn">
                        <i class="fas fa-calculator"></i> å¼€å§‹å…«å­—æµ‹ç®—
                    </button>
                </div>
            </div>
        </section>

        <!-- Result Section -->
        <section class="result-section" id="result-section">
            <!-- Basic Info -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-user-circle"></i>
                    <h2 id="user-info-title">åŸºæœ¬ä¿¡æ¯</h2>
                </div>
                <div id="basic-info-content">
                    <!-- åŸºæœ¬ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>

            <!-- Bazi Chart -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-table"></i>
                    <h2>å…«å­—æ’ç›˜</h2>
                </div>
                <div id="bazi-chart">
                    <!-- å…«å­—æ’ç›˜è¡¨æ ¼å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>

            <!-- Five Elements Chart -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-pie"></i>
                    <h2>äº”è¡ŒåŠ›é‡åˆ†å¸ƒä¸åˆ†æ</h2>
                </div>
                <div class="elements-analysis-frame" style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
                    <div class="chart-container" style="width: 100%; min-height: 350px; margin: 0 auto;">
                        <canvas id="elements-chart"></canvas>
                    </div>
                    <div id="elements-summary" style="width: 100%; background-color: #f9f9f9; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin: 0 auto;">
                        <!-- äº”è¡Œåˆ†å¸ƒæ¦‚è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                    <div class="chart-description" id="elements-description" style="width: 100%; background-color: #f9f9f9; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin: 0 auto;">
                        <!-- äº”è¡Œåˆ†ææè¿° -->
                    </div>
                </div>
            </div>

            <!-- Strength Analysis -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-balance-scale"></i>
                    <h2>èº«å¼ºèº«å¼±åˆ†æ</h2>
                </div>
                <div class="strength-analysis-frame" style="display: flex; flex-direction: row; gap: 20px; flex-wrap: wrap;">
                    <div class="chart-container" style="flex: 1; min-width: 300px; min-height: 350px;">
                        <canvas id="strength-chart"></canvas>
                    </div>
                    <div class="chart-description" id="strength-description" style="flex: 1; min-width: 300px; background-color: #f9f9f9; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <!-- èº«å¼ºèº«å¼±åˆ†ææè¿° -->
                    </div>
                </div>
            </div>

            <!-- Luck Starting Time -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-hourglass-start"></i>
                    <h2>èµ·è¿æ—¶é—´</h2>
                </div>
                <div id="luck-timing">
                    <!-- èµ·è¿æ—¶é—´åˆ†æ -->
                </div>
            </div>

            <!-- unlock section -->
            <div id="unlock-section" style="margin: 32px 0 24px 0; padding: 24px; background: #fffbe6; border: 1px solid #ffe58f; border-radius: 8px; text-align: center;">
                <div style="font-size: 18px; font-weight: bold; color: #d48806; margin-bottom: 12px;">ğŸ”’ è¯¦æ‰¹å…«å­—å†…å®¹å·²åŠ å¯†</div>
                <div style="font-size: 15px; color: #ad6800; margin-bottom: 18px;">æ”¯ä»˜åå¯è§£é”å‘½æ ¼ç­‰çº§ã€è´¢å¯Œç­‰çº§ã€å…«å­—é—®ç­”åŠè¯¦ç»†åˆ†æå†…å®¹</div>
                <button id="unlock-btn" class="btn btn-warning" style="font-size: 17px; padding: 8px 32px; border-radius: 6px;">ğŸ”“ è¯¦æ‰¹å…«å­—</button>
            </div>

            <!-- Fate Level Analysis -->
            <div id="paid-section" style="display: none;">
            <div class="analysis-grid">
                <div class="analysis-card">
                    <h3><i class="fas fa-star"></i> å‘½æ ¼ç­‰çº§</h3>
                    <div id="fate-level-content">
                        <!-- å‘½æ ¼ç­‰çº§åˆ†æ -->
                    </div>
                </div>
                
                <div class="analysis-card">
                    <h3><i class="fas fa-coins"></i> è´¢å¯Œç­‰çº§</h3>
                    <div id="wealth-level-content">
                        <!-- è´¢å¯Œç­‰çº§åˆ†æ -->
                    </div>
                </div>
            </div>

            <!-- Bazi Q&A Section -->
            <div class="bazi-qa-container">
                <div class="bazi-qa-header">
                    <h3><i class="fas fa-question-circle"></i> å…«å­—é—®ç­”</h3>
                    <p class="bazi-qa-subtitle">åŸºäºæ‚¨çš„å…«å­—ä¿¡æ¯ï¼Œè¯¢é—®ä»»ä½•å…«å­—ç›¸å…³é—®é¢˜</p>
                </div>
                <div class="bazi-qa-input-section">
                    <div class="bazi-qa-input-wrapper">
                        <input type="text" id="bazi-qa-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å…«å­—ç›¸å…³é—®é¢˜ï¼Œä¾‹å¦‚ï¼šæˆ‘çš„äº‹ä¸šè¿åŠ¿å¦‚ä½•ï¼Ÿä»€ä¹ˆæ—¶å€™é€‚åˆç»“å©šï¼Ÿè´¢è¿æ–¹é¢éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" />
                        <button class="bazi-qa-submit" id="bazi-qa-submit">
                            <i class="fas fa-paper-plane"></i> æé—®
                        </button>
                    </div>
                </div>
                <div id="bazi-qa-response" class="bazi-qa-response" style="display: none;">
                    <!-- å›ç­”å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                <div id="bazi-qa-loading" class="bazi-qa-loading" style="display: none;">
                    <div class="loading beautiful-spinner"></div>
                    <span>å‘½ç†å¤§å¸ˆæ€è€ƒä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...</span>
                </div>
            </div>

            <!-- Analysis Tabs -->
            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="fortune"><i class="fas fa-chart-line"></i> è¿åŠ¿åˆ†æ</button>
                    <button class="tab-btn" data-tab="personality"><i class="fas fa-user-astronaut"></i> ä¸ªäººåˆ†æ</button>
                </div>
                
                <div class="tab-content active" id="fortune-tab">
                    <div class="analysis-btn" data-analysis="full-analysis">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-magic"></i> å‘½ç†å…¨è§£
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">å…¨é¢è§£æå…«å­—å‘½ç†ï¼ŒåŒ…å«æ€§æ ¼ã€äº‹ä¸šã€è´¢è¿ã€å©šå§»ç­‰å¤šæ–¹é¢</div>
                    </div>
                    <div class="analysis-content" id="full-analysis-content"></div>
                    
                    <div class="analysis-btn" data-analysis="annual-fortune">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-calendar-alt"></i> æµå¹´åˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">åˆ†æå½“å‰æµå¹´å¯¹å‘½å±€çš„å½±å“å’Œè¿åŠ¿å˜åŒ–</div>
                    </div>
                    <div class="analysis-content" id="annual-fortune-content"></div>
                    
                    <div class="analysis-btn" data-analysis="monthly-fortune">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-calendar-day"></i> æµæœˆåˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">é¢„æµ‹å½“å‰å¹´ä»½æ¯æœˆçš„è¿åŠ¿èµ·ä¼</div>
                    </div>
                    <div class="analysis-content" id="monthly-fortune-content"></div>
                    
                    <div class="analysis-btn" data-analysis="decade-fortune">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-hourglass-half"></i> åå¹´å¤§è¿åˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">åˆ†æä¸€ç”Ÿä¸­å„é˜¶æ®µå¤§è¿èµ°åŠ¿</div>
                    </div>
                    <div class="analysis-content" id="decade-fortune-content"></div>
                </div>
                
                <div class="tab-content" id="personality-tab">
                    <div class="analysis-btn" data-analysis="personality">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-brain"></i> æ€§æ ¼åˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">æ ¹æ®å…«å­—åˆ†ææ€§æ ¼ç‰¹å¾å’Œä¼˜ç¼ºç‚¹</div>
                    </div>
                    <div class="analysis-content" id="personality-content"></div>
                    
                    <div class="analysis-btn" data-analysis="career">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-briefcase"></i> äº‹ä¸šè´¢å¯Œ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">åˆ†æé€‚åˆçš„èŒä¸šæ–¹å‘å’Œè´¢å¯Œæ ¼å±€</div>
                    </div>
                    <div class="analysis-content" id="career-content"></div>
                    
                    <div class="analysis-btn" data-analysis="marriage">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-heart"></i> å©šå§»åˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">åˆ†æå©šå§»çŠ¶å†µå’Œé…å¶ç‰¹å¾</div>
                    </div>
                    <div class="analysis-content" id="marriage-content"></div>
                    
                    <div class="analysis-btn" data-analysis="children">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-baby"></i> å­å¥³åˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">åˆ†æå­å¥³ç¼˜åˆ†å’Œæ•™è‚²æ–¹å‘</div>
                    </div>
                    <div class="analysis-content" id="children-content"></div>
                    
                    <div class="analysis-btn" data-analysis="health">
                        <div class="analysis-btn-header">
                            <div class="analysis-btn-title">
                                <i class="fas fa-heartbeat"></i> å¥åº·åˆ†æ
                            </div>
                            <div class="loading" style="display: none;"></div>
                        </div>
                        <div class="analysis-btn-desc">æ ¹æ®äº”è¡Œå¹³è¡¡åˆ†æå¥åº·çŠ¶å†µ</div>
                    </div>
                    <div class="analysis-content" id="health-content"></div>
                </div>
            </div>
            
            <div class="btn-center">
                <button class="btn btn-primary" id="recalculate-btn">
                    <i class="fas fa-redo"></i> é‡æ–°æµ‹ç®—
                </button>
            </div>
            </div><!-- /paid-section -->
        </section>
    </div>

    <!-- Scripts -->
    <script src="../js/lunar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentBaziData = null;
        let elementsChart = null;
        let strengthChart = null;

        // DOMå…ƒç´ 
        const inputSection = document.getElementById('input-section');
        const resultSection = document.getElementById('result-section');
        const calculateBtn = document.getElementById('calculate-btn');
        const recalculateBtn = document.getElementById('recalculate-btn');
        const birthTimeInput = document.getElementById('birth-time');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupTabSystem();
            setupAnalysisButtons();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            calculateBtn.addEventListener('click', handleCalculate);
            recalculateBtn.addEventListener('click', handleRecalculate);
            setupBaziQA();
        }
        
        // è®¾ç½®å…«å­—é—®ç­”åŠŸèƒ½
        function setupBaziQA() {
            const qaInput = document.getElementById('bazi-qa-input');
            const qaSubmit = document.getElementById('bazi-qa-submit');
            const qaResponse = document.getElementById('bazi-qa-response');
            const qaLoading = document.getElementById('bazi-qa-loading');
            
            if (qaSubmit) {
                qaSubmit.addEventListener('click', handleBaziQA);
            }
            
            if (qaInput) {
                qaInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                        e.preventDefault();
                        handleBaziQA();
                    }
                });
            }
        }
        
        // å¤„ç†å…«å­—é—®ç­”
        async function handleBaziQA() {
            const qaInput = document.getElementById('bazi-qa-input');
            const qaResponse = document.getElementById('bazi-qa-response');
            const qaLoading = document.getElementById('bazi-qa-loading');
            const qaSubmit = document.getElementById('bazi-qa-submit');
            
            const question = qaInput.value.trim();
            if (!question) {
                alert('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²è®¡ç®—å…«å­—
            if (!window.currentBaziData) {
                alert('è¯·å…ˆè®¡ç®—å…«å­—ä¿¡æ¯');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            qaLoading.style.display = 'flex';
            qaResponse.style.display = 'none';
            qaSubmit.disabled = true;
            
            try {
                const response = await callBaziQAAPI(question, window.currentBaziData);
                
                // æ˜¾ç¤ºå›ç­”
                qaResponse.innerHTML = response;
                qaResponse.style.display = 'block';
                qaLoading.style.display = 'none';
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                qaInput.value = '';
                
            } catch (error) {
                console.error('å…«å­—é—®ç­”APIè°ƒç”¨å¤±è´¥:', error);
                qaResponse.innerHTML = '<p style="color: #e74c3c;">æŠ±æ­‰ï¼Œé—®ç­”æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚</p>';
                qaResponse.style.display = 'block';
                qaLoading.style.display = 'none';
            } finally {
                qaSubmit.disabled = false;
            }
        }



        // è®¾ç½®æ ‡ç­¾é¡µç³»ç»Ÿ
        function setupTabSystem() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€
                    this.classList.add('active');
                    document.getElementById(targetTab + '-tab').classList.add('active');
                });
            });
        }

        // è®¾ç½®åˆ†ææŒ‰é’®
        function setupAnalysisButtons() {
            const analysisBtns = document.querySelectorAll('.analysis-btn');
            
            analysisBtns.forEach(btn => {
                btn.addEventListener('click', async function() {
                    const analysisType = this.dataset.analysis;
                    const contentElement = document.getElementById(analysisType + '-content');
                    const loadingElement = this.querySelector('.loading');
                    
                    if (contentElement.classList.contains('show')) {
                        // å¦‚æœå·²ç»æ˜¾ç¤ºï¼Œåˆ™éšè—
                        contentElement.classList.remove('show');
                    } else {
                        // æ£€æŸ¥æ˜¯å¦æœ‰å…«å­—æ•°æ®
                        if (!currentBaziData) {
                            alert('è¯·å…ˆè¿›è¡Œå…«å­—æµ‹ç®—');
                            return;
                        }
                        
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        loadingElement.innerHTML = '<span style="display: flex; align-items: center; justify-content: center; width: 100%; margin: 0;"><i class="fas fa-spinner fa-spin" style="color: #3498db; font-size: 2.5em;"></i></span>';
                        loadingElement.style.display = 'flex';
                        loadingElement.style.position = 'absolute';
                        loadingElement.style.top = '0';
                        loadingElement.style.left = '0';
                        loadingElement.style.width = '100%';
                        loadingElement.style.height = '100%';
                        loadingElement.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                        loadingElement.style.borderRadius = '12px';
                        loadingElement.style.zIndex = '10';
                        // ç§»é™¤ this.classList.add('loading'); ä»¥é¿å…æ½œåœ¨çš„æ—‹è½¬æ•ˆæœ
                        
                        try {
                            // ä½¿ç”¨æœ¬åœ°å·²è·å–çš„å…«å­—ä¿¡æ¯ã€èº«å¼ºèº«å¼±ä¿¡æ¯å’Œèµ·è¿æ—¶é—´ä¿¡æ¯
                            // é€šè¿‡DeepSeek APIè·å–ä¸“ä¸šå‘½ç†åˆ†æ
                            const analysisContent = await getBaziAnalysisFromDeepSeek(analysisType, currentBaziData);
                            
                            // éšè—åŠ è½½çŠ¶æ€
                            loadingElement.style.display = 'none';
                            this.classList.remove('loading');
                            
                            // æ˜¾ç¤ºåˆ†æå†…å®¹
                            contentElement.innerHTML = marked.parse(analysisContent);
contentElement.classList.add('show');
                            contentElement.classList.add('show');
                            console.log('æˆåŠŸè·å–APIåˆ†æå†…å®¹:', analysisType);
                        } catch (error) {
                            console.error('è·å–åˆ†æå†…å®¹å¤±è´¥:', error);
                            
                            // éšè—åŠ è½½çŠ¶æ€
                            loadingElement.style.display = 'none';
                            this.classList.remove('loading');
                            
                            // æ˜¾ç¤ºé”™è¯¯æç¤ºå’Œå¤‡ç”¨å†…å®¹
                            const errorMessage = `<div class="api-error-message">APIè°ƒç”¨å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}ï¼Œä½¿ç”¨å¤‡ç”¨å†…å®¹</div>`;
                            contentElement.innerHTML = errorMessage + marked.parse(getAnalysisContent(analysisType));
                            contentElement.classList.add('show');
                        }
                    }
                });
            });
        }

        // å¤„ç†è®¡ç®—æŒ‰é’®ç‚¹å‡»
        async function handleCalculate() {
            if (!validateForm()) {
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            calculateBtn.innerHTML = '<div class="loading"></div> <span>è®¡ç®—ä¸­...</span>';
            calculateBtn.disabled = true;
            
            // æ˜¾ç¤ºå…¨å±€åŠ è½½é®ç½©
            showLoading('æ­£åœ¨è¿›è¡Œå…«å­—æµ‹ç®—ï¼Œè¯·ç¨å€™...');
            
            try {
                // è·å–è¡¨å•æ•°æ®
                const formData = getFormData();
                
                // è®¡ç®—å…«å­—
                const baziData = await calculateBazi(formData);
                currentBaziData = baziData;
                window.currentBaziData = baziData;
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(baziData);
                
                // åˆ‡æ¢åˆ°ç»“æœé¡µé¢
                inputSection.style.display = 'none';
                resultSection.classList.add('show');
                
            } catch (error) {
                console.error('è®¡ç®—å¤±è´¥:', error);
                alert('è®¡ç®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯åé‡è¯•');
            } finally {
                calculateBtn.innerHTML = '<i class="fas fa-calculator"></i> å¼€å§‹å…«å­—æµ‹ç®—';
                calculateBtn.disabled = false;
                
                // éšè—å…¨å±€åŠ è½½é®ç½©
                hideLoading();
            }
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(message = 'æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...') {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingMessage = document.getElementById('loadingMessage');
            
            if (loadingMessage) {
                loadingMessage.textContent = message;
            }
            
            loadingOverlay.style.display = 'flex';
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.display = 'none';
        }
        
        // å¤„ç†é‡æ–°è®¡ç®—
        function handleRecalculate() {
            inputSection.style.display = 'block';
            resultSection.classList.remove('show');
            
            // æ¸…ç©ºAPIåé¦ˆå†…å®¹çš„ç¼“å­˜
            const cacheKeys = [
                'full-analysis', 'annual-fortune', 'monthly-fortune', 'decade-fortune',
                'personality', 'career', 'wealth', 'marriage', 
                'health', 'luck', 'children', 'disaster'
            ];
            cacheKeys.forEach(analysisType => {
                // æ¸…ç©ºlocalStorageä¸­çš„ç¼“å­˜
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.includes(analysisType)) {
                        localStorage.removeItem(key);
                    }
                });
                
                // æ¸…ç©ºé¡µé¢æ˜¾ç¤ºå†…å®¹
                const contentElement = document.getElementById(analysisType + '-content');
                if (contentElement) {
                    contentElement.innerHTML = '';
                    contentElement.classList.remove('show');
                }
            });
            
            // é‡ç½®å½“å‰å…«å­—æ•°æ®
            currentBaziData = null;
            window.currentBaziData = null;
            
            // é‡ç½®è¡¨å•
            document.getElementById('name').value = '';
            document.getElementById('gender').value = '';
            document.getElementById('birth-date').value = '';
            document.getElementById('birth-time').value = '';
        }

        // éªŒè¯è¡¨å•
        function validateForm() {
            const name = document.getElementById('name').value.trim();
            const gender = document.getElementById('gender').value;
            const birthDate = document.getElementById('birth-date').value;
            const birthTime = document.getElementById('birth-time').value;
            
            if (!name) {
                alert('è¯·è¾“å…¥å§“å');
                return false;
            }
            
            if (!gender) {
                alert('è¯·é€‰æ‹©æ€§åˆ«');
                return false;
            }
            
            if (!birthDate) {
                alert('è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ');
                return false;
            }
            
            if (!birthTime) {
                alert('è¯·è¾“å…¥å‡ºç”Ÿæ—¶é—´');
                return false;
            }
            
            // éªŒè¯æ—¶é—´æ ¼å¼
            const timePattern = /^([01]?[0-9]|2[0-3]):([0-5][0-9])$/;
            if (!timePattern.test(birthTime)) {
                alert('å‡ºç”Ÿæ—¶é—´æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨24å°æ—¶åˆ¶ï¼ˆå¦‚ï¼š08:30ã€15:45ï¼‰');
                return false;
            }
            
            return true;
        }

        // è·å–è¡¨å•æ•°æ®
        function getFormData() {
            return {
                name: document.getElementById('name').value.trim(),
                gender: document.getElementById('gender').value,
                birthDate: document.getElementById('birth-date').value,
                birthTime: document.getElementById('birth-time').value
            };
        }

        // è®¡ç®—å…«å­—
        async function calculateBazi(formData) {
            const { birthDate, birthTime } = formData;
            const [hour, minute] = birthTime.split(':').map(Number);
            
            // éªŒè¯æ—¶é—´æ ¼å¼
            if (isNaN(hour) || isNaN(minute) || hour < 0 || hour > 23 || minute < 0 || minute > 59) {
                throw new Error('å‡ºç”Ÿæ—¶é—´æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨24å°æ—¶åˆ¶ï¼ˆå¦‚ï¼š08:30ã€15:45ï¼‰');
            }
            
            const date = new Date(birthDate + 'T00:00:00');
            date.setHours(hour, minute, 0, 0);
            
            // ä½¿ç”¨lunar.jsè®¡ç®—å…«å­—
            const solar = Solar.fromDate(date);
            const lunar = solar.getLunar();
            const eightChar = lunar.getEightChar();
            
            // è·å–å››æŸ±ä¿¡æ¯
            const yearPillar = eightChar.getYear();
            const monthPillar = eightChar.getMonth();
            const dayPillar = eightChar.getDay();
            const hourPillar = eightChar.getTime();
            
            // ç¡®ä¿å››æŸ±æ˜¯å­—ç¬¦ä¸²
            const yearStr = typeof yearPillar === 'string' ? yearPillar : String(yearPillar);
            const monthStr = typeof monthPillar === 'string' ? monthPillar : String(monthPillar);
            const dayStr = typeof dayPillar === 'string' ? dayPillar : String(dayPillar);
            const hourStr = typeof hourPillar === 'string' ? hourPillar : String(hourPillar);
            
            // è®¡ç®—è—å¹²
            const hiddenStems = {
                year: yearStr.length > 1 ? getHiddenStems(yearStr.charAt(1)) : [],
                month: monthStr.length > 1 ? getHiddenStems(monthStr.charAt(1)) : [],
                day: dayStr.length > 1 ? getHiddenStems(dayStr.charAt(1)) : [],
                hour: hourStr.length > 1 ? getHiddenStems(hourStr.charAt(1)) : []
            };
            
            // è®¡ç®—äº”è¡Œåˆ†å¸ƒ
            const elements = calculateElements(yearStr, monthStr, dayStr, hourStr, hiddenStems);
            
            // è®¡ç®—èº«å¼ºèº«å¼±
            // è®¡ç®—èµ·è¿æ—¶é—´
            const luckTiming = calculateLuckTiming(formData.gender, lunar);
            
            // å®šä¹‰å››æŸ±å¯¹è±¡
            const pillars = {
                year: yearStr,
                month: monthStr,
                day: dayStr,
                hour: hourStr
            };
            
            // å°†å››æŸ±ä¿¡æ¯ä¿å­˜åˆ°windowå¯¹è±¡ï¼Œä¾›å…¶ä»–å‡½æ•°ä½¿ç”¨
            window.currentPillars = pillars;
            
            // æå–åœ°æ”¯å¹¶ä¿å­˜åˆ°windowå¯¹è±¡ï¼Œä¾›ä¸‰åˆå±€æ£€æµ‹ä½¿ç”¨
            const allBranches = [];
            if (yearStr.length > 1) allBranches.push(yearStr.charAt(1));
            if (monthStr.length > 1) allBranches.push(monthStr.charAt(1));
            if (dayStr.length > 1) allBranches.push(dayStr.charAt(1));
            if (hourStr.length > 1) allBranches.push(hourStr.charAt(1));
            window.allBranches = allBranches;
            console.log('è®¾ç½®å…«å­—åœ°æ”¯:', window.allBranches);
            
            // è®¡ç®—èº«å¼ºèº«å¼±
            const strengthAnalysis = calculateStrength(dayStr, elements, monthStr, allBranches);
            
            // è®¡ç®—å‘½æ ¼ç­‰çº§
            const fateLevel = calculateFateLevel(pillars);
            
            // è®¡ç®—è´¢å¯Œç­‰çº§
            const wealthLevel = calculateWealthLevel(pillars);
            
            return {
                name: formData.name,
                gender: formData.gender,
                birthDate: formData.birthDate,
                birthTime: formData.birthTime,
                solar: solar,
                lunar: lunar,
                pillars: {
                    year: yearStr,
                    month: monthStr,
                    day: dayStr,
                    hour: hourStr
                },
                hiddenStems: hiddenStems,
                elements: elements,
                strengthAnalysis: strengthAnalysis,
                luckTiming: luckTiming,
                fateLevel: fateLevel,
                wealthLevel: wealthLevel,
                // APIè°ƒç”¨æ‰€éœ€çš„æ ¼å¼åŒ–æ•°æ®
                formattedBirthDate: `${lunar.getYear()}å¹´${lunar.getMonth()}æœˆ${lunar.getDay()}æ—¥`,
                formattedBirthTime: `${formData.birthTime}æ—¶`,
                baziString: `${yearPillar} ${monthPillar} ${dayPillar} ${hourPillar}`
            };
        }

        // è·å–åœ°æ”¯è—å¹²
        function getHiddenStems(branch) {
            const hiddenStemsMap = {
                'å­': ['ç™¸'],
                'ä¸‘': ['å·±', 'ç™¸', 'è¾›'],
                'å¯…': ['ç”²', 'ä¸™', 'æˆŠ'],
                'å¯': ['ä¹™'],
                'è¾°': ['æˆŠ', 'ä¹™', 'ç™¸'],
                'å·³': ['ä¸™', 'åºš', 'æˆŠ'],
                'åˆ': ['ä¸', 'å·±'],
                'æœª': ['å·±', 'ä¸', 'ä¹™'],
                'ç”³': ['åºš', 'å£¬', 'æˆŠ'],
                'é…‰': ['è¾›'],
                'æˆŒ': ['æˆŠ', 'è¾›', 'ä¸'],
                'äº¥': ['å£¬', 'ç”²']
            };
            return hiddenStemsMap[branch] || [];
        }

        // è®¡ç®—äº”è¡Œåˆ†å¸ƒ
        function calculateElements(year, month, day, hour, hiddenStems) {
            const elementMap = {
                'ç”²': 'wood', 'ä¹™': 'wood',
                'ä¸™': 'fire', 'ä¸': 'fire',
                'æˆŠ': 'earth', 'å·±': 'earth',
                'åºš': 'metal', 'è¾›': 'metal',
                'å£¬': 'water', 'ç™¸': 'water',
                'å¯…': 'wood', 'å¯': 'wood',
                'å·³': 'fire', 'åˆ': 'fire',
                'è¾°': 'earth', 'æˆŒ': 'earth', 'ä¸‘': 'earth', 'æœª': 'earth',
                'ç”³': 'metal', 'é…‰': 'metal',
                'å­': 'water', 'äº¥': 'water'
            };
            
            const elements = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
            
            // ç¡®ä¿å››æŸ±æ˜¯å­—ç¬¦ä¸²
            const pillars = [
                typeof year === 'string' ? year : String(year),
                typeof month === 'string' ? month : String(month),
                typeof day === 'string' ? day : String(day),
                typeof hour === 'string' ? hour : String(hour)
            ];
            
            // è®¡ç®—å¤©å¹²åœ°æ”¯
            const pillarWeights = [1.0, 1.2, 1.0, 0.8]; // å¹´æœˆæ—¥æ—¶çš„æƒé‡
            pillars.forEach((pillar, index) => {
                if (pillar && pillar.length >= 2) {
                    const stem = pillar.charAt(0);
                    const branch = pillar.charAt(1);
                    const weight = pillarWeights[index];
                    
                    if (elementMap[stem]) elements[elementMap[stem]] += 2 * weight; // å¤©å¹²æƒé‡2ï¼Œä¹˜ä»¥æŸ±ä½æƒé‡
                    if (elementMap[branch]) elements[elementMap[branch]] += 1 * weight; // åœ°æ”¯æƒé‡1ï¼Œä¹˜ä»¥æŸ±ä½æƒé‡
                }
            });
            
            // è®¡ç®—è—å¹²
            const hiddenStemWeights = [0.5, 0.6, 0.5, 0.4]; // å¹´æœˆæ—¥æ—¶è—å¹²çš„æƒé‡
            Object.entries(hiddenStems).forEach(([pillar, stems], index) => {
                stems.forEach(stem => {
                    if (elementMap[stem]) {
                        const weight = hiddenStemWeights[index];
                        elements[elementMap[stem]] += 0.5 * weight; // è—å¹²æƒé‡0.5ï¼Œä¹˜ä»¥æŸ±ä½æƒé‡
                    }
                });
            });
            
            // æ‰“å°è°ƒè¯•ä¿¡æ¯
            console.log('äº”è¡Œåˆ†å¸ƒè®¡ç®—ç»“æœ:', elements);
            
            return elements;
        }

        // è®¡ç®—èº«å¼ºèº«å¼±
        function calculateStrength(dayStem, elements, monthBranch, passedBranches = []) {
            // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
            dayStem = typeof dayStem === 'string' ? dayStem : String(dayStem);
            monthBranch = typeof monthBranch === 'string' ? monthBranch : String(monthBranch);
            
            // è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºå¤©å¹²
            dayStem = dayStem.charAt(0);
            // è·å–ç¬¬äºŒä¸ªå­—ç¬¦ä½œä¸ºåœ°æ”¯
            monthBranch = monthBranch.length > 1 ? monthBranch.charAt(1) : monthBranch;
            
            const stemElementMap = {
                'ç”²': 'wood', 'ä¹™': 'wood',
                'ä¸™': 'fire', 'ä¸': 'fire',
                'æˆŠ': 'earth', 'å·±': 'earth',
                'åºš': 'metal', 'è¾›': 'metal',
                'å£¬': 'water', 'ç™¸': 'water'
            };
            
            const dayElement = stemElementMap[dayStem];
            
            // è·å–å…«å­—ä¸­çš„æ‰€æœ‰åœ°æ”¯
            let allBranches = [];
            try {
                // ä»å››æŸ±ä¸­è·å–åœ°æ”¯
                const pillars = window.currentPillars || {};
                console.log('å½“å‰å››æŸ±ä¿¡æ¯:', pillars);
                
                if (pillars.year && pillars.year.length > 1) allBranches.push(pillars.year.charAt(1));
                if (pillars.month && pillars.month.length > 1) allBranches.push(pillars.month.charAt(1));
                if (pillars.day && pillars.day.length > 1) allBranches.push(pillars.day.charAt(1));
                if (pillars.hour && pillars.hour.length > 1) allBranches.push(pillars.hour.charAt(1));
                
                // å¦‚æœæ— æ³•ä»currentPillarsè·å–ï¼Œå°è¯•ä»eightCharè·å–
                if (allBranches.length === 0) {
                    console.log('å°è¯•ä»eightCharè·å–åœ°æ”¯');
                    const eightChar = window.eightChar || {};
                    if (eightChar.getYear && typeof eightChar.getYear === 'function') {
                        const year = eightChar.getYear();
                        if (year && year.length > 1) allBranches.push(year.charAt(1));
                    }
                    if (eightChar.getMonth && typeof eightChar.getMonth === 'function') {
                        const month = eightChar.getMonth();
                        if (month && month.length > 1) allBranches.push(month.charAt(1));
                    }
                    if (eightChar.getDay && typeof eightChar.getDay === 'function') {
                        const day = eightChar.getDay();
                        if (day && day.length > 1) allBranches.push(day.charAt(1));
                    }
                    if (eightChar.getTime && typeof eightChar.getTime === 'function') {
                        const time = eightChar.getTime();
                        if (time && time.length > 1) allBranches.push(time.charAt(1));
                    }
                }
            } catch (e) {
                console.error('è·å–å…«å­—åœ°æ”¯å¤±è´¥:', e);
            }
            
            // å¦‚æœæ— æ³•ä»é¡µé¢è·å–ï¼Œåˆ™ä½¿ç”¨ä¼ å…¥çš„æœˆæ”¯
            if (allBranches.length === 0 && monthBranch) {
                console.log('ä½¿ç”¨ä¼ å…¥çš„æœˆæ”¯:', monthBranch);
                allBranches.push(monthBranch);
            }
            
            // æ‰“å°è°ƒè¯•ä¿¡æ¯
            console.log('å…«å­—åœ°æ”¯:', allBranches);
            
            // å°†åœ°æ”¯æ•°ç»„ä¿å­˜åˆ°windowå¯¹è±¡ï¼Œä¾›å…¶ä»–å‡½æ•°ä½¿ç”¨
            window.allBranches = allBranches;
            
            // æ£€æŸ¥åˆåŒ–æƒ…å†µ
            const combined = checkCombinations(dayStem, monthBranch, passedBranches);

            // ä¿å­˜æ—¥ä¸»å¤©å¹²åˆ°combinedå¯¹è±¡ï¼Œä¾›getMonthStrengthä½¿ç”¨
            combined.dayStem = dayStem;
            
            // è®¡ç®—æœˆä»¤å¾—åˆ† (æƒé‡40%)
            let monthScore = getMonthStrength(dayElement, monthBranch, combined);
            
            console.log(`æœˆä»¤å¾—åˆ†è®¡ç®— - æ—¥ä¸»:${dayStem}(${dayElement}), æœˆæ”¯:${monthBranch}, å¾—åˆ†:${monthScore}`);
            
            // è®¡ç®—ç”Ÿæ‰¶åŠ›é‡ï¼ˆç”Ÿæˆ‘ã€åŠ©æˆ‘ï¼‰
            const supportElements = getSupportElements(dayElement);
            let supportStrength = 0;
            supportElements.forEach(element => {
                supportStrength += elements[element];
            });
            
            // è®¡ç®—å…‹æ³„åŠ›é‡ï¼ˆå…‹æˆ‘ã€æ³„æˆ‘ã€è€—æˆ‘ï¼‰
            const weakenElements = getWeakenElements(dayElement);
            let weakenStrength = 0;
            weakenElements.forEach(element => {
                weakenStrength += elements[element];
            });
            
            // ç»Ÿä¸€å¤„ç†æ‰€æœ‰åˆåŒ–çš„åŠ å‡åˆ†
            let combinationDeduction = 0;
            const combinationTypes = ['tianGanWuHe', 'diZhiLiuHe', 'diZhiSanHe'];
            combinationTypes.forEach(type => {
                combined[type].forEach(comb => {
                    const heElement = comb.element;
                    let multiplier = (type === 'diZhiSanHe' ? (comb.count === 3 ? 5 : 3) : (type === 'tianGanWuHe' ? 3 : 2));
                    if (getSupportElements(dayElement).includes(heElement)) {
                        supportStrength += multiplier;
                        combinationDeduction += multiplier; // å¢å¼ºï¼Œæ­£å€¼
                        console.log(`${type} ${comb.gan1 || comb.zhi1 || comb.type || comb.branches} åˆåŒ–${heElement} ç”ŸåŠ©æ—¥ä¸»ï¼Œå¢åŠ ç”Ÿæ‰¶ ${multiplier}`);
                    } else if (getWeakenElements(dayElement).includes(heElement)) {
                        supportStrength -= multiplier;
                        combinationDeduction -= multiplier; // å‰Šå¼±ï¼Œè´Ÿå€¼
                        console.log(`${type} ${comb.gan1 || comb.zhi1 || comb.type || comb.branches} åˆåŒ–${heElement} å…‹æ³„æ—¥ä¸»ï¼Œå‡å°‘ç”Ÿæ‰¶ ${multiplier}`);
                    } else {
                        console.log(`${type} ${comb.gan1 || comb.zhi1 || comb.type || comb.branches} åˆåŒ–${heElement} ä¸­æ€§å½±å“`);
                    }
                });
            });
            combined.deduction = combinationDeduction;
            // è®¾ç½®æ•´ä½“effect
            if (combinationDeduction > 0) {
                combined.effect = 'strengthen';
            } else if (combinationDeduction < 0) {
                combined.effect = 'weaken';
            } else {
                combined.effect = 'neutral';
            }
            
            // ç¡®ä¿åˆåŒ–ä¿¡æ¯æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š
            window.combinedInfo = combined;
            
            // ç§»é™¤é€šç”¨effectè°ƒæ•´ï¼Œå·²åœ¨å…·ä½“åˆåŒ–ä¸­å¤„ç†
            
            // ä¸‰åˆåŠ å‡å·²åœ¨ç»Ÿä¸€å¤„ç†ä¸­å®Œæˆï¼Œä¿ç•™ç‰¹åˆ«å¤„ç†
            if (combined.hasOwnProperty('sanhe')) {
                if (combined.sanhe.type === 'å·³é…‰ä¸‘' && dayStem === 'å·±') {
                    weakenStrength += 3;
                    console.log('å·³é…‰ä¸‘ä¸‰åˆé‡‘å¯¹å·±åœŸæ—¥ä¸»çš„ç‰¹æ®Šå½±å“ï¼Œé¢å¤–å¢åŠ å…‹æ³„åŠ›é‡ 3');
                }
            }
            
            // è®¡ç®—æ€»åˆ†
            const totalScore = monthScore + supportStrength - weakenStrength;
            
            // åˆ¤æ–­èº«å¼ºèº«å¼±
            const strengthRatio = supportStrength / (supportStrength + weakenStrength);
            
            // æ‰“å°è°ƒè¯•ä¿¡æ¯
            console.log(`èº«å¼ºèº«å¼±è®¡ç®— - æ—¥ä¸»:${dayStem}(${dayElement}), ç”Ÿæ‰¶åŠ›é‡:${supportStrength}, å…‹æ³„åŠ›é‡:${weakenStrength}, æ¯”ä¾‹:${(strengthRatio * 100).toFixed(1)}%, æœˆä»¤å¾—åˆ†:${monthScore}`);
            
            let type, description;
            
            // åˆ¤æ–­æ˜¯å¦ä»æ ¼
            const isFollowing = checkFollowingPattern(dayElement, monthBranch, strengthRatio, supportStrength, weakenStrength, monthScore);
            
            if (isFollowing.isFollowing) {
                type = isFollowing.type;
                description = isFollowing.description;
            } else if (strengthRatio >= 0.60) { // è°ƒæ•´é˜ˆå€¼ï¼Œä½¿èº«å¼ºåˆ¤æ–­æ›´å‡†ç¡®
                type = 'èº«å¼º';
                description = 'æ—¥ä¸»åŠ›é‡å¼ºæ—ºï¼Œèƒ½å¤Ÿæ‰¿æ‹…è´¢å®˜ï¼Œé€‚åˆä¸»åŠ¨å‡ºå‡»ï¼Œå–œç”¨è´¢å®˜ã€‚';
            } else if (strengthRatio >= 0.40 && strengthRatio < 0.60) { // è°ƒæ•´å‡è¡¡èŒƒå›´
                type = 'å‡è¡¡';
                description = 'æ—¥ä¸»åŠ›é‡é€‚ä¸­ï¼Œäº”è¡Œè¾ƒä¸ºå¹³è¡¡ï¼Œè¿åŠ¿å¹³ç¨³ï¼Œå–œç”¨å°æ¯”ã€‚';
            } else {
                type = 'èº«å¼±';
                description = 'æ—¥ä¸»åŠ›é‡åå¼±ï¼Œéœ€è¦ç”Ÿæ‰¶ï¼Œå®œå®ˆä¸å®œæ”»ï¼Œå–œç”¨å°æ¯”ã€‚';
            }
            
            return {
                type: type,
                ratio: strengthRatio,
                supportStrength: supportStrength,
                weakenStrength: weakenStrength,
                description: description,
                monthScore: monthScore,
                totalScore: totalScore,
                combined: combined
            };
        }
        
        // æ£€æŸ¥åˆåŒ–æƒ…å†µ
        function checkCombinations(dayStem, monthBranch, branches) {
            const combined = {
                tianGanWuHe: [],
                diZhiLiuHe: [],
                diZhiSanHe: [],
                deduction: 0 // åˆåŒ–æ‰£åˆ†
            };
            
            const stemElementMap = {
                'ç”²': 'wood', 'ä¹™': 'wood',
                'ä¸™': 'fire', 'ä¸': 'fire',
                'æˆŠ': 'earth', 'å·±': 'earth',
                'åºš': 'metal', 'è¾›': 'metal',
                'å£¬': 'water', 'ç™¸': 'water'
            };
            
            // å¤©å¹²äº”åˆè§„åˆ™
            const tianGanHeHua = {
                'ç”²å·±': 'earth',
                'ä¹™åºš': 'metal',
                'ä¸™è¾›': 'water',
                'ä¸å£¬': 'wood',
                'æˆŠç™¸': 'fire'
            };
            
            // åœ°æ”¯å…­åˆè§„åˆ™
            const diZhiLiuHe = {
                'å­ä¸‘': 'earth',
                'å¯…äº¥': 'wood',
                'å¯æˆŒ': 'fire',
                'è¾°é…‰': 'metal',
                'å·³ç”³': 'water',
                'åˆæœª': 'earth'
            };
            
            // åœ°æ”¯ä¸‰åˆè§„åˆ™
            const diZhiSanHe = [
                {branches: ['ç”³', 'å­', 'è¾°'], element: 'water'}, // ä¸‰åˆæ°´å±€
                {branches: ['äº¥', 'å¯', 'æœª'], element: 'wood'},  // ä¸‰åˆæœ¨å±€
                {branches: ['å¯…', 'åˆ', 'æˆŒ'], element: 'fire'},  // ä¸‰åˆç«å±€
                {branches: ['å·³', 'é…‰', 'ä¸‘'], element: 'metal'}  // ä¸‰åˆé‡‘å±€
            ];
            
            // è·å–å…«å­—å››æŸ±
            let allStems = [];
            let allBranches = [];
            
            try {
                const pillars = window.currentPillars || {};
                if (pillars.year) {
                    allStems.push(pillars.year.charAt(0));
                    allBranches.push(pillars.year.charAt(1));
                }
                if (pillars.month) {
                    allStems.push(pillars.month.charAt(0));
                    allBranches.push(pillars.month.charAt(1));
                }
                if (pillars.day) {
                    allStems.push(pillars.day.charAt(0));
                    allBranches.push(pillars.day.charAt(1));
                }
                if (pillars.hour) {
                    allStems.push(pillars.hour.charAt(0));
                    allBranches.push(pillars.hour.charAt(1));
                }
            } catch (e) {
                console.error('è·å–å…«å­—ä¿¡æ¯å¤±è´¥:', e);
            }
            
            // æ£€æŸ¥ç›¸é‚»å¤©å¹²äº”åˆ
            for (let i = 0; i < allStems.length - 1; i++) {
                const stem1 = allStems[i];
                const stem2 = allStems[i+1];
                const pair1 = stem1 + stem2;
                const pair2 = stem2 + stem1;
                
                if (tianGanHeHua[pair1] || tianGanHeHua[pair2]) {
                    const hehuaElement = tianGanHeHua[pair1] || tianGanHeHua[pair2];
                    combined.tianGanWuHe.push({
                        gan1: stem1,
                        gan2: stem2,
                        element: hehuaElement,
                        positions: [i, i+1]
                    });
                    console.log(`å‘ç°ç›¸é‚»å¤©å¹²äº”åˆ: ${stem1}${stem2} åˆåŒ–ä¸º${hehuaElement}`);
                }
            }
            
            // æ£€æŸ¥ç›¸é‚»åœ°æ”¯å…­åˆ
            for (let i = 0; i < allBranches.length - 1; i++) {
                const branch1 = allBranches[i];
                const branch2 = allBranches[i+1];
                const pair1 = branch1 + branch2;
                const pair2 = branch2 + branch1;
                
                if (diZhiLiuHe[pair1] || diZhiLiuHe[pair2]) {
                    const hehuaElement = diZhiLiuHe[pair1] || diZhiLiuHe[pair2];
                    combined.diZhiLiuHe.push({
                        zhi1: branch1,
                        zhi2: branch2,
                        element: hehuaElement,
                        positions: [i, i+1]
                    });
                    console.log(`å‘ç°ç›¸é‚»åœ°æ”¯å…­åˆ: ${branch1}${branch2} åˆåŒ–ä¸º${hehuaElement}`);
                }
            }
            
            // ä¿å­˜åœ°æ”¯æ•°ç»„ä¾›ä¸‰åˆæ£€æµ‹ä½¿ç”¨
            window.allBranches = allBranches;
            
            const elementMap = {
                'wood': 'æœ¨',
                'fire': 'ç«',
                'earth': 'åœŸ',
                'metal': 'é‡‘',
                'water': 'æ°´'
            };
            
            // æ£€æŸ¥è¿ç»­åœ°æ”¯ä¸‰åˆï¼ˆåªæ£€æŸ¥å…¨ä¸‰åˆï¼Œè¿ç»­ä¸‰ä¸ªä½ç½®çš„åœ°æ”¯setåŒ¹é…ï¼‰
            if (allBranches && allBranches.length >= 3) {
                console.log('æ£€æŸ¥è¿ç»­ä¸‰åˆå±€ï¼Œåœ°æ”¯:', branches);
                
                let bestMatch = null;
                
                for (let i = 0; i <= allBranches.length - 3; i++) {
                    const trio = allBranches.slice(i, i+3).sort().join('');
                    for (const sanhe of diZhiSanHe) {
                        const sanheSorted = sanhe.branches.sort().join('');
                        if (trio === sanheSorted) {
                            bestMatch = {
                                type: sanhe.branches.join(''),
                                element: sanhe.element,
                                count: 3,
                                branches: allBranches.slice(i, i+3).join(''),
                                isFullSanhe: true
                            };
                            combined.diZhiSanHe.push(bestMatch);
                            console.log(`å‘ç°è¿ç»­å…¨ä¸‰åˆå±€: ${bestMatch.branches} åˆåŒ–ä¸º${sanhe.element}`);
                            break;
                        }
                    }
                    if (bestMatch) break; // åªè®°å½•ä¸€ä¸ªæœ€ä½³
                }
                
                if (bestMatch) {
                    combined.sanhe = bestMatch;
                }
            }
            
            // ç§»é™¤åŠä¸‰åˆå’Œç‰¹åˆ«æ£€æŸ¥ï¼Œåªå…¨è¿ç»­ä¸‰åˆ
            
            // ç®€åŒ–çš„åˆåŒ–åˆ¤æ–­
            const dayElement = stemElementMap[dayStem];
            
            // åˆ¤æ–­åˆåŒ–æ˜¯å¦æœ‰åˆ©äºæ—¥ä¸»
            if (dayElement && !combined.effect) {
                // æ£€æŸ¥æ‰€æœ‰åˆåŒ–çš„å½±å“
                let hasStrengthening = false;
                let hasWeakening = false;
                
                // æ£€æŸ¥å¤©å¹²äº”åˆ
                combined.tianGanWuHe.forEach(comb => {
                    if (getSupportElements(dayElement).includes(comb.element)) {
                        hasStrengthening = true;
                        console.log(`å¤©å¹²äº”åˆ ${comb.gan1}${comb.gan2} åˆåŒ–${comb.element} ç”ŸåŠ©æ—¥ä¸»`);
                    } else if (getWeakenElements(dayElement).includes(comb.element)) {
                        hasWeakening = true;
                        console.log(`å¤©å¹²äº”åˆ ${comb.gan1}${comb.gan2} åˆåŒ–${comb.element} å…‹æ³„æ—¥ä¸»`);
                    }
                });
                
                // æ£€æŸ¥åœ°æ”¯å…­åˆ
                combined.diZhiLiuHe.forEach(comb => {
                    if (getSupportElements(dayElement).includes(comb.element)) {
                        hasStrengthening = true;
                        console.log(`åœ°æ”¯å…­åˆ ${comb.zhi1}${comb.zhi2} åˆåŒ–${comb.element} ç”ŸåŠ©æ—¥ä¸»`);
                    } else if (getWeakenElements(dayElement).includes(comb.element)) {
                        hasWeakening = true;
                        console.log(`åœ°æ”¯å…­åˆ ${comb.zhi1}${comb.zhi2} åˆåŒ–${comb.element} å…‹æ³„æ—¥ä¸»`);
                    }
                });
                
                // æ£€æŸ¥åœ°æ”¯ä¸‰åˆ
                combined.diZhiSanHe.forEach(comb => {
                    if (getSupportElements(dayElement).includes(comb.element)) {
                        hasStrengthening = true;
                        console.log(`åœ°æ”¯ä¸‰åˆ ${comb.type || comb.branches} åˆåŒ–${comb.element} ç”ŸåŠ©æ—¥ä¸»`);
                    } else if (getWeakenElements(dayElement).includes(comb.element)) {
                        hasWeakening = true;
                        console.log(`åœ°æ”¯ä¸‰åˆ ${comb.type || comb.branches} åˆåŒ–${comb.element} å…‹æ³„æ—¥ä¸»`);
                    }
                });
                
                // è®¾ç½®æœ€ç»ˆå½±å“
                if (hasStrengthening && !hasWeakening) {
                    combined.effect = 'strengthen';
                    console.log('åˆåŒ–æ€»ä½“å¯¹æ—¥ä¸»å½±å“: å¢å¼º');
                } else if (hasWeakening && !hasStrengthening) {
                    combined.effect = 'weaken';
                    console.log('åˆåŒ–æ€»ä½“å¯¹æ—¥ä¸»å½±å“: å‰Šå¼±');
                } else if (hasStrengthening && hasWeakening) {
                    combined.effect = 'mixed';
                    console.log('åˆåŒ–æ€»ä½“å¯¹æ—¥ä¸»å½±å“: æ··åˆ');
                } else {
                    combined.effect = 'neutral';
                    console.log('åˆåŒ–æ€»ä½“å¯¹æ—¥ä¸»å½±å“: ä¸­æ€§');
                }
            }
            
            return combined;
        }
        
        // è·å–æœˆä»¤å¼ºåº¦
        function getMonthStrength(dayElement, monthBranch, combined) {
            const branchElementMap = {
                'å­': 'water', 'ä¸‘': 'earth',
                'å¯…': 'wood', 'å¯': 'wood',
                'è¾°': 'earth', 'å·³': 'fire',
                'åˆ': 'fire', 'æœª': 'earth',
                'ç”³': 'metal', 'é…‰': 'metal',
                'æˆŒ': 'earth', 'äº¥': 'water'
            };
            
            // å¦‚æœæœˆæ”¯è¢«åˆåŒ–ï¼Œä½¿ç”¨åˆåŒ–åçš„å…ƒç´ 
            let monthElement = combined.hasOwnProperty('monthElement') ? 
                combined.monthElement : branchElementMap[monthBranch];
            
            // è€ƒè™‘ä¸‰åˆçš„å½±å“
            if (combined.hasOwnProperty('sanhe')) {
                // å¦‚æœæœ‰ä¸‰åˆå±€ï¼Œè€ƒè™‘ä¸‰åˆçš„å½±å“
                const sanhe = combined.sanhe;
                if (sanhe.count === 3) { // å…¨ä¸‰åˆï¼Œå½±å“æ›´å¤§
                    monthElement = sanhe.element; // ä½¿ç”¨ä¸‰åˆçš„äº”è¡Œ
                }
            }
            
            if (!monthElement) return 0; // å¦‚æœæ— æ³•ç¡®å®šæœˆä»¤å…ƒç´ ï¼Œè¿”å›0
            
            // è·å–ç”Ÿæ‰¶å’Œå…‹æ³„å…ƒç´ åˆ—è¡¨
            const supportElements = getSupportElements(dayElement);
            const weakenElements = getWeakenElements(dayElement);
            
            // ç‰¹åˆ«å¤„ç†å·³é…‰ä¸‘ä¸‰åˆé‡‘å¯¹å·±åœŸæ—¥ä¸»çš„å½±å“
            if (combined.hasOwnProperty('sanhe') && 
                combined.sanhe.type === 'å·³é…‰ä¸‘' && 
                dayElement === 'earth') {
                console.log('ç‰¹åˆ«å¤„ç†ï¼šå·³é…‰ä¸‘ä¸‰åˆé‡‘å¯¹å·±åœŸæ—¥ä¸»çš„å½±å“ï¼Œæœˆä»¤å¾—åˆ† -30');
                return -30; // ä¸‰åˆé‡‘å¯¹åœŸçš„å…‹åˆ¶æ›´å¼º
            }
            
            let score = 0;
            
            if (monthElement === dayElement) {
                score = 40;  // å¾—ä»¤
                console.log(`æœˆä»¤å¾—åˆ†ï¼š${score} (å¾—ä»¤ï¼Œæœˆä»¤äº”è¡Œä¸æ—¥ä¸»ç›¸åŒ)`);
            } else if (supportElements.includes(monthElement)) {
                score = 20;  // å¾—ç”Ÿ
                console.log(`æœˆä»¤å¾—åˆ†ï¼š${score} (å¾—ç”Ÿï¼Œæœˆä»¤äº”è¡Œç”Ÿæ‰¶æ—¥ä¸»)`);
            } else if (weakenElements.includes(monthElement)) {
                score = -20; // è¢«å…‹
                console.log(`æœˆä»¤å¾—åˆ†ï¼š${score} (è¢«å…‹ï¼Œæœˆä»¤äº”è¡Œå…‹æ³„æ—¥ä¸»)`);
            } else {
                score = 0;   // ä¸å¾—ä»¤
                console.log(`æœˆä»¤å¾—åˆ†ï¼š${score} (ä¸å¾—ä»¤ï¼Œæœˆä»¤äº”è¡Œä¸æ—¥ä¸»æ— å…³)`);
            }
            
            // è€ƒè™‘ç‰¹æ®Šæƒ…å†µï¼šæˆŠå·±åœŸæ—¥ä¸»åœ¨å­æœˆã€è¾°æœˆã€æˆŒæœˆçš„ç‰¹æ®Šè¡¨ç°
            if ((dayElement === 'earth') && (['å­', 'è¾°', 'æˆŒ'].includes(monthBranch))) {
                // æˆŠåœŸåœ¨å­æœˆã€è¾°æœˆã€æˆŒæœˆåå¼º
                if (combined.dayStem === 'æˆŠ') {
                    score += 10;
                    console.log(`ç‰¹æ®Šæƒ…å†µï¼šæˆŠåœŸåœ¨${monthBranch}æœˆåå¼ºï¼Œæœˆä»¤å¾—åˆ†è°ƒæ•´ä¸º ${score}`);
                }
            }
            
            return score;
        }
        
        // æ£€æŸ¥æ˜¯å¦ä»æ ¼
        function checkFollowingPattern(dayElement, monthBranch, strengthRatio, supportStrength, weakenStrength, monthScore) {
            const effective_weaken = weakenStrength + (monthScore < 0 ? -monthScore : 0);
            if (supportStrength <= 5 && effective_weaken >= 15) {
                console.log(`ä»å¼±æ ¼åˆ¤æ–­: ç”Ÿæ‰¶åŠ›é‡${supportStrength} <= 5, æœ‰æ•ˆå…‹æ³„åŠ›é‡${effective_weaken} >= 15`);
                return {
                    isFollowing: true,
                    type: 'ä»å¼±',
                    description: 'æ—¥ä¸»æå¼±ï¼Œç”Ÿæ‰¶åŠ›é‡ä¸è¶³ï¼Œå‘½å±€ä»¥å…‹æ³„æ—¥ä¸»çš„äº”è¡Œä¸ºç”¨ç¥ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œå–œç”¨è´¢å®˜ã€‚'
                };
            }
            const branchElementMap = {
                'å­': 'water', 'ä¸‘': 'earth',
                'å¯…': 'wood', 'å¯': 'wood',
                'è¾°': 'earth', 'å·³': 'fire',
                'åˆ': 'fire', 'æœª': 'earth',
                'ç”³': 'metal', 'é…‰': 'metal',
                'æˆŒ': 'earth', 'äº¥': 'water'
            };
            
            const monthElement = branchElementMap[monthBranch];
            if (!monthElement) return { isFollowing: false };
            
            // è·å–ç”Ÿæ‰¶å’Œå…‹æ³„å…ƒç´ åˆ—è¡¨
            const supportElements = getSupportElements(dayElement);
            const weakenElements = getWeakenElements(dayElement);
            
            // ä»å¼±æ ¼ï¼šç”Ÿæ‰¶åŠ›é‡å°äºç­‰äº5ä¸”å…‹æ³„åŠ›é‡å¤§äºç­‰äº15
            if (supportStrength <= 5 && weakenStrength >= 15) {
                console.log(`ä»å¼±æ ¼åˆ¤æ–­: ç”Ÿæ‰¶åŠ›é‡${supportStrength} <= 5, å…‹æ³„åŠ›é‡${weakenStrength} >= 15`);
                return {
                    isFollowing: true,
                    type: 'ä»å¼±',
                    description: 'æ—¥ä¸»æå¼±ï¼Œç”Ÿæ‰¶åŠ›é‡ä¸è¶³ï¼Œå‘½å±€ä»¥å…‹æ³„æ—¥ä¸»çš„äº”è¡Œä¸ºç”¨ç¥ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œå–œç”¨è´¢å®˜ã€‚'
                };
            }
            
            // ä¼ ç»Ÿä»å¼±æ ¼åˆ¤æ–­ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
            if (strengthRatio < 0.3 && weakenElements.includes(monthElement)) {
                console.log(`ä¼ ç»Ÿä»å¼±æ ¼åˆ¤æ–­: æ¯”ä¾‹${(strengthRatio * 100).toFixed(1)}% < 30%, æœˆä»¤å…‹æ³„æ—¥ä¸»`);
                return {
                    isFollowing: true,
                    type: 'ä»å¼±',
                    description: 'æ—¥ä¸»åå¼±ï¼Œä½†å‘½å±€ä»¥å…‹æ³„æ—¥ä¸»çš„äº”è¡Œä¸ºç”¨ç¥ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œå–œç”¨è´¢å®˜ã€‚'
                };
            }
            
            // ä»å¼ºæ ¼ï¼šèº«å¼ºè€Œç”¨ç”Ÿæ‰¶
            if (strengthRatio > 0.7 && supportElements.includes(monthElement)) {
                console.log(`ä»å¼ºæ ¼åˆ¤æ–­: æ¯”ä¾‹${(strengthRatio * 100).toFixed(1)}% > 70%, æœˆä»¤ç”Ÿæ‰¶æ—¥ä¸»`);
                return {
                    isFollowing: true,
                    type: 'ä»å¼º',
                    description: 'æ—¥ä¸»åå¼ºï¼Œä½†å‘½å±€ä»¥ç”Ÿæ‰¶æ—¥ä¸»çš„äº”è¡Œä¸ºç”¨ç¥ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œå–œç”¨å°æ¯”ã€‚'
                };
            }
            
            return { isFollowing: false };
        }

        // è·å–ç”Ÿæ‰¶äº”è¡Œ
        function getSupportElements(element) {
            const supportMap = {
                'wood': ['water', 'wood'],
                'fire': ['wood', 'fire'],
                'earth': ['fire', 'earth'],
                'metal': ['earth', 'metal'],
                'water': ['metal', 'water']
            };
            return supportMap[element] || [];
        }

        // è·å–å…‹æ³„äº”è¡Œ
        function getWeakenElements(element) {
            const weakenMap = {
                'wood': ['metal', 'fire', 'earth'],
                'fire': ['water', 'earth', 'metal'],
                'earth': ['wood', 'metal', 'water'],
                'metal': ['fire', 'water', 'wood'],
                'water': ['earth', 'wood', 'fire']
            };
            return weakenMap[element] || [];
        }

        // è®¡ç®—èµ·è¿æ—¶é—´ - æ ¹æ®æ­£ç¡®çš„å…«å­—èµ·è¿ç®—æ³•
        function calculateLuckTiming(gender, lunar) {
            try {
                // è·å–å‡ºç”Ÿæ—¶é—´ä¿¡æ¯
                const solar = lunar.getSolar();
                const birthDate = new Date(
                    solar.getYear(),
                    solar.getMonth() - 1,
                    solar.getDay(),
                    solar.getHour(),
                    solar.getMinute(),
                    solar.getSecond()
                );
                
                // è·å–å¹´æŸ±å¤©å¹²
                const eightChar = lunar.getEightChar();
                const yearPillar = eightChar.getYear();
                const yearStr = typeof yearPillar === 'string' ? yearPillar : String(yearPillar);
                const yearGan = yearStr.charAt(0);
                
                // 1. åˆ¤æ–­å¹´æŸ±é˜´é˜³ä¸é¡ºé€†æ’
                const yangTianGan = ['ç”²', 'ä¸™', 'æˆŠ', 'åºš', 'å£¬'];
                const yinTianGan = ['ä¹™', 'ä¸', 'å·±', 'è¾›', 'ç™¸'];
                const isMale = gender === 'male';
                
                let direction;
                if ((yangTianGan.includes(yearGan) && isMale) || (yinTianGan.includes(yearGan) && !isMale)) {
                    direction = 'é¡ºæ’'; // é˜³å¹´ç”· or é˜´å¹´å¥³
                } else {
                    direction = 'é€†æ’'; // é˜´å¹´ç”· or é˜³å¹´å¥³
                }
                
                // 2. è®¡ç®—å‡ºç”Ÿæ—¥åˆ°æœ€è¿‘èŠ‚æ°”çš„å¤©æ•°å·®
                const daysDiff = getDaysToJieQi(birthDate, direction, solar.getYear());
                
                // 3. èµ·è¿å¹´é¾„è®¡ç®—
                const years = Math.floor(daysDiff / 3); // 3å¤© = 1å²
                const months = Math.round((daysDiff / 3 - years) * 12); // å°æ•°éƒ¨åˆ†è½¬æœˆä»½
                
                return {
                    age: years,
                    months: months,
                    direction: direction,
                    daysDiff: daysDiff.toFixed(2),
                    description: `${direction}ï¼Œ${years}å²${months}ä¸ªæœˆèµ·è¿`
                };
            } catch (error) {
                console.error('èµ·è¿è®¡ç®—é”™è¯¯:', error);
                // è¿”å›é»˜è®¤å€¼
                return {
                    age: 8,
                    months: 0,
                    direction: 'é¡ºæ’',
                    daysDiff: '24.00',
                    description: '8å²0ä¸ªæœˆèµ·è¿ï¼ˆé»˜è®¤å€¼ï¼‰'
                };
            }
        }
        
        // è®¡ç®—å‡ºç”Ÿæ—¥åˆ°æœ€è¿‘èŠ‚æ°”çš„å¤©æ•°å·®
        function getDaysToJieQi(birthDate, direction, birthYear) {
            try {
                // è·å–å½“å¹´çš„èŠ‚æ°”è¡¨
                const solar = Solar.fromYmd(birthYear, 6, 1);
                const lunar = solar.getLunar();
                const jieQiTable = lunar.getJieQiTable();
                
                // å…«å­—æ¢æœˆèŠ‚æ°”åˆ—è¡¨ï¼ˆç”¨äºèµ·è¿è®¡ç®—ï¼‰
                const monthlyJieQi = [
                    'ç«‹æ˜¥', 'æƒŠè›°', 'æ¸…æ˜', 'ç«‹å¤', 'èŠ’ç§', 'å°æš‘',
                    'ç«‹ç§‹', 'ç™½éœ²', 'å¯’éœ²', 'ç«‹å†¬', 'å¤§é›ª', 'å°å¯’'
                ];
                
                let targetJieQi = null;
                let minDiff = Infinity;
                
                // æ£€æŸ¥å½“å¹´å’Œå‰åä¸€å¹´çš„èŠ‚æ°”
                for (let yearOffset = -1; yearOffset <= 1; yearOffset++) {
                    const checkYear = birthYear + yearOffset;
                    
                    for (const jieQiName of monthlyJieQi) {
                        const jieQiSolar = getJieQiTime(checkYear, jieQiName);
                        if (!jieQiSolar) continue;
                        
                        const jieQiDate = new Date(
                            jieQiSolar.getYear(),
                            jieQiSolar.getMonth() - 1,
                            jieQiSolar.getDay(),
                            jieQiSolar.getHour(),
                            jieQiSolar.getMinute(),
                            jieQiSolar.getSecond()
                        );
                        
                        const timeDiff = jieQiDate.getTime() - birthDate.getTime();
                        
                        if (direction === 'é¡ºæ’') {
                            // æ‰¾ä¸‹ä¸€ä¸ªèŠ‚æ°”
                            if (timeDiff > 0 && timeDiff < minDiff) {
                                minDiff = timeDiff;
                                targetJieQi = jieQiDate;
                            }
                        } else {
                            // æ‰¾ä¸Šä¸€ä¸ªèŠ‚æ°”
                            if (timeDiff < 0 && Math.abs(timeDiff) < minDiff) {
                                minDiff = Math.abs(timeDiff);
                                targetJieQi = jieQiDate;
                            }
                        }
                    }
                }
                
                if (targetJieQi) {
                    const diffMs = Math.abs(targetJieQi.getTime() - birthDate.getTime());
                    return diffMs / (1000 * 60 * 60 * 24); // è½¬æ¢ä¸ºå¤©æ•°
                }
                
                // å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„èŠ‚æ°”ï¼Œè¿”å›é»˜è®¤å€¼
                return 24;
                
            } catch (error) {
                console.error('è·å–èŠ‚æ°”æ—¶é—´é”™è¯¯:', error);
                return 24; // é»˜è®¤å€¼
            }
        }
        
        // è·å–æŒ‡å®šå¹´ä»½çš„èŠ‚æ°”æ—¶é—´
        function getJieQiTime(year, jieQiName) {
            try {
                const solar = Solar.fromYmd(year, 6, 1);
                const lunar = solar.getLunar();
                const jieQiTable = lunar.getJieQiTable();
                
                return jieQiTable[jieQiName] || null;
            } catch (error) {
                console.error(`è·å–${year}å¹´${jieQiName}èŠ‚æ°”æ—¶é—´å¤±è´¥:`, error);
                return null;
            }
        }

        // å…¨å±€å˜é‡å­˜å‚¨åˆ†æ•°è¯¦æƒ…
        let fateScoreDetails = {};
        let wealthScoreDetails = {};
        let fateScoreValue = 0;
        let wealthScoreValue = 0;

        // è®¡ç®—å‘½æ ¼ç­‰çº§ - ä¸“ä¸šç‰ˆ
        function calculateFateLevel(pillars) {
            const score = calculateFateScore(pillars);
            const levelInfo = getFateLevel(score);
            
            return {
                score: score,
                level: levelInfo.name,
                description: getFateDescription(score),
                details: fateScoreDetails
            };
        }

        // è®¡ç®—å‘½æ ¼åˆ†æ•°
        function calculateFateScore(pillars) {
            if (fateScoreValue === 0) {
                // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
                const dayStr = typeof pillars.day === 'string' ? pillars.day : String(pillars.day);
                const monthStr = typeof pillars.month === 'string' ? pillars.month : String(pillars.month);
                const yearStr = typeof pillars.year === 'string' ? pillars.year : String(pillars.year);
                const hourStr = typeof pillars.hour === 'string' ? pillars.hour : String(pillars.hour);
                
                // ä½¿ç”¨å®‰å…¨çš„å­—ç¬¦ä¸²æ–¹æ³•
                const seasonScore = calculateSeasonScore(
                    dayStr.length > 0 ? dayStr.charAt(0) : '', 
                    monthStr.length > 1 ? monthStr.charAt(1) : ''
                );
                // åˆ›å»ºå®‰å…¨çš„pillarså¯¹è±¡
                const safePillars = {
                    year: yearStr,
                    month: monthStr,
                    day: dayStr,
                    hour: hourStr
                };
                
                const balanceScore = calculateBalanceScore(safePillars);
                const patternScore = calculatePatternScore(safePillars);
                const godsScore = calculateGodsScore(safePillars);
                const combinationScore = calculateCombinationScore(safePillars);
                const total = seasonScore + balanceScore + patternScore + godsScore + combinationScore;
                fateScoreDetails = {
                    seasonScore,
                    balanceScore,
                    patternScore,
                    godsScore,
                    combinationScore,
                    total
                };
                fateScoreValue = Math.round(total);
            }
            return fateScoreValue;
        }

        // è®¡ç®—å­£èŠ‚åˆ†æ•°
        function calculateSeasonScore(dayStem, monthBranch) {
            const seasonMap = {
                'ç”²': ['å¯…', 'å¯', 'è¾°'],
                'ä¹™': ['å¯…', 'å¯', 'è¾°'],
                'ä¸™': ['å·³', 'åˆ', 'æœª'],
                'ä¸': ['å·³', 'åˆ', 'æœª'],
                'æˆŠ': ['è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'å·±': ['è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'åºš': ['ç”³', 'é…‰', 'æˆŒ'],
                'è¾›': ['ç”³', 'é…‰', 'æˆŒ'],
                'å£¬': ['äº¥', 'å­', 'ä¸‘'],
                'ç™¸': ['äº¥', 'å­', 'ä¸‘']
            };
            if (seasonMap[dayStem] && seasonMap[dayStem].includes(monthBranch)) {
                return 30;
            }
            return 15;
        }

        // è®¡ç®—å¹³è¡¡åˆ†æ•°
        function calculateBalanceScore(pillars) {
            const elements = {
                'æœ¨': 0,
                'ç«': 0,
                'åœŸ': 0,
                'é‡‘': 0,
                'æ°´': 0
            };
            const stemElements = {
                'ç”²': 'æœ¨', 'ä¹™': 'æœ¨',
                'ä¸™': 'ç«', 'ä¸': 'ç«',
                'æˆŠ': 'åœŸ', 'å·±': 'åœŸ',
                'åºš': 'é‡‘', 'è¾›': 'é‡‘',
                'å£¬': 'æ°´', 'ç™¸': 'æ°´'
            };
            const branchElements = {
                'å¯…': 'æœ¨', 'å¯': 'æœ¨',
                'åˆ': 'ç«', 'å·³': 'ç«',
                'è¾°': 'åœŸ', 'æˆŒ': 'åœŸ', 'ä¸‘': 'åœŸ', 'æœª': 'åœŸ',
                'ç”³': 'é‡‘', 'é…‰': 'é‡‘',
                'å­': 'æ°´', 'äº¥': 'æ°´'
            };
            elements[stemElements[pillars.year.charAt(0)]]++;
            elements[stemElements[pillars.month.charAt(0)]]++;
            elements[stemElements[pillars.day.charAt(0)]]++;
            elements[stemElements[pillars.hour.charAt(0)]]++;
            elements[branchElements[pillars.year.charAt(1)]]++;
            elements[branchElements[pillars.month.charAt(1)]]++;
            elements[branchElements[pillars.day.charAt(1)]]++;
            elements[branchElements[pillars.hour.charAt(1)]]++;
            const values = Object.values(elements);
            const max = Math.max(...values);
            const min = Math.min(...values);
            const balance = 25 - (max - min) * 2;
            return Math.max(0, balance);
        }

        // è®¡ç®—æ ¼å±€åˆ†æ•°
        function calculatePatternScore(pillars) {
            if (isCongGe(pillars)) {
                return 20;
            }
            if (isZhuanWangGe(pillars)) {
                return 15;
            }
            return 5;
        }

        // åˆ¤æ–­ä»æ ¼
        function isCongGe(pillars) {
            const dayStem = pillars.day.charAt(0);
            const stems = [
                pillars.year.charAt(0),
                pillars.month.charAt(0),
                pillars.hour.charAt(0)
            ];
            const branches = [
                pillars.year.charAt(1),
                pillars.month.charAt(1),
                pillars.day.charAt(1),
                pillars.hour.charAt(1)
            ];
            if (isCongQiangGe(dayStem, stems, branches)) {
                return true;
            }
            if (isCongRuoGe(dayStem, stems, branches)) {
                return true;
            }
            return false;
        }

        // åˆ¤æ–­ä»å¼ºæ ¼
        function isCongQiangGe(dayStem, stems, branches) {
            let count = 0;
            stems.forEach(function(stem) {
                if (isSameElement(stem, dayStem) || isGenerateElement(stem, dayStem)) {
                    count++;
                }
            });
            branches.forEach(function(branch) {
                if (isSameElement(branch, dayStem) || isGenerateElement(branch, dayStem)) {
                    count++;
                }
            });
            return count >= 6;
        }

        // åˆ¤æ–­ä»å¼±æ ¼
        function isCongRuoGe(dayStem, stems, branches) {
            let count = 0;
            stems.forEach(function(stem) {
                if (isSameElement(stem, dayStem) || isGenerateElement(stem, dayStem)) {
                    count++;
                }
            });
            branches.forEach(function(branch) {
                if (isSameElement(branch, dayStem) || isGenerateElement(branch, dayStem)) {
                    count++;
                }
            });
            return count <= 1;
        }

        // åˆ¤æ–­ä¸“æ—ºæ ¼
        function isZhuanWangGe(pillars) {
            const dayStem = pillars.day.charAt(0);
            const stems = [
                pillars.year.charAt(0),
                pillars.month.charAt(0),
                pillars.hour.charAt(0)
            ];
            const branches = [
                pillars.year.charAt(1),
                pillars.month.charAt(1),
                pillars.day.charAt(1),
                pillars.hour.charAt(1)
            ];
            let sameCount = 0;
            let otherCount = 0;
            stems.forEach(function(stem) {
                if (isSameElement(stem, dayStem)) {
                    sameCount++;
                } else {
                    otherCount++;
                }
            });
            branches.forEach(function(branch) {
                if (isSameElement(branch, dayStem)) {
                    sameCount++;
                } else {
                    otherCount++;
                }
            });
            return sameCount >= 5 && otherCount <= 2;
        }

        // åˆ¤æ–­ç›¸åŒå…ƒç´ 
        function isSameElement(a, b) {
            const elementMap = {
                'ç”²': 'æœ¨', 'ä¹™': 'æœ¨',
                'ä¸™': 'ç«', 'ä¸': 'ç«',
                'æˆŠ': 'åœŸ', 'å·±': 'åœŸ',
                'åºš': 'é‡‘', 'è¾›': 'é‡‘',
                'å£¬': 'æ°´', 'ç™¸': 'æ°´',
                'å¯…': 'æœ¨', 'å¯': 'æœ¨',
                'åˆ': 'ç«', 'å·³': 'ç«',
                'è¾°': 'åœŸ', 'æˆŒ': 'åœŸ', 'ä¸‘': 'åœŸ', 'æœª': 'åœŸ',
                'ç”³': 'é‡‘', 'é…‰': 'é‡‘',
                'å­': 'æ°´', 'äº¥': 'æ°´'
            };
            return elementMap[a] === elementMap[b];
        }

        // åˆ¤æ–­ç”Ÿæˆå…ƒç´ 
        function isGenerateElement(a, b) {
            const elementMap = {
                'ç”²': 'æœ¨', 'ä¹™': 'æœ¨',
                'ä¸™': 'ç«', 'ä¸': 'ç«',
                'æˆŠ': 'åœŸ', 'å·±': 'åœŸ',
                'åºš': 'é‡‘', 'è¾›': 'é‡‘',
                'å£¬': 'æ°´', 'ç™¸': 'æ°´',
                'å¯…': 'æœ¨', 'å¯': 'æœ¨',
                'åˆ': 'ç«', 'å·³': 'ç«',
                'è¾°': 'åœŸ', 'æˆŒ': 'åœŸ', 'ä¸‘': 'åœŸ', 'æœª': 'åœŸ',
                'ç”³': 'é‡‘', 'é…‰': 'é‡‘',
                'å­': 'æ°´', 'äº¥': 'æ°´'
            };
            const aElement = elementMap[a];
            const bElement = elementMap[b];
            const generateMap = {
                'æœ¨': 'ç«',
                'ç«': 'åœŸ',
                'åœŸ': 'é‡‘',
                'é‡‘': 'æ°´',
                'æ°´': 'æœ¨'
            };
            return generateMap[aElement] === bElement;
        }

        // è®¡ç®—åç¥åˆ†æ•°
        function calculateGodsScore(pillars) {
            return 10;
        }

        // è®¡ç®—ç»„åˆåˆ†æ•°
        function calculateCombinationScore(pillars) {
            const branches = [
                pillars.year.charAt(1),
                pillars.month.charAt(1),
                pillars.day.charAt(1),
                pillars.hour.charAt(1)
            ];
            if (hasSanHe(branches)) {
                return 8;
            }
            if (hasLiuHe(branches)) {
                return 5;
            }
            return 2;
        }

        // åˆ¤æ–­ä¸‰åˆ
        function hasSanHe(branches) {
            const sanHeGroups = [
                ['ç”³', 'å­', 'è¾°'],
                ['äº¥', 'å¯', 'æœª'],
                ['å¯…', 'åˆ', 'æˆŒ'],
                ['å·³', 'é…‰', 'ä¸‘']
            ];
            for (const group of sanHeGroups) {
                let count = 0;
                for (const branch of branches) {
                    if (group.includes(branch)) {
                        count++;
                    }
                }
                if (count >= 2) {
                    return true;
                }
            }
            return false;
        }

        // åˆ¤æ–­å…­åˆ
        function hasLiuHe(branches) {
            const liuHePairs = [
                ['å­', 'ä¸‘'],
                ['å¯…', 'äº¥'],
                ['å¯', 'æˆŒ'],
                ['è¾°', 'é…‰'],
                ['å·³', 'ç”³'],
                ['åˆ', 'æœª']
            ];
            for (const pair of liuHePairs) {
                if (branches.includes(pair[0]) && branches.includes(pair[1])) {
                    return true;
                }
            }
            return false;
        }

        // è·å–å‘½è¿ç­‰çº§
        function getFateLevel(score) {
            if (score >= 85) return { name: "å¤©èµé¸¿è¿ â˜…â˜…â˜…â˜…â˜…", class: "excellent" };
            if (score >= 70) return { name: "ç¦æ˜Ÿé«˜ç…§ â˜…â˜…â˜…â˜…â˜†", class: "good" };
            if (score >= 50) return { name: "å®‰å¸¸å®ˆåˆ† â˜…â˜…â˜…â˜†â˜†", class: "average" };
            if (score >= 30) return { name: "å‹¤èƒ½è¡¥æ‹™ â˜…â˜…â˜†â˜†â˜†", class: "struggling" };
            return { name: "é€†æ°´è¡ŒèˆŸ â˜…â˜†â˜†â˜†â˜†", class: "needs-improvement" };
        }

        // è·å–å‘½æ ¼æè¿°
        function getFateDescription(score) {
            if (score >= 85) return 'å¤©èµ‹å¼‚ç¦€ï¼Œç¦æ³½æ·±åšï¼Œä¸€ç”Ÿè¿åŠ¿æä½³';
            if (score >= 70) return 'èªæ˜æ‰æ™ºï¼Œè¿åŠ¿è¾ƒä½³ï¼Œå‘å±•å‰æ™¯è‰¯å¥½';
            if (score >= 50) return 'èµ„è´¨è‰¯å¥½ï¼Œå‘å±•å¹³ç¨³ï¼Œéœ€è¦åŠªåŠ›è¿›å–';
            if (score >= 30) return 'æ™®é€šå‘½æ ¼ï¼Œéœ€è¦å‹¤å¥‹åŠªåŠ›æ–¹èƒ½æˆåŠŸ';
            return 'å‘½é€”åå·ï¼Œéœ€è¦åšæŒä¸æ‡ˆï¼Œé€†å¢ƒæ±‚ç”Ÿ';
        }

        // è®¡ç®—è´¢å¯Œç­‰çº§ - ä¸“ä¸šç‰ˆ
        function calculateWealthLevel(pillars) {
            const score = calculateWealthScore(pillars);
            const levelInfo = getWealthLevel(score);
            
            return {
                score: score,
                level: levelInfo.name,
                description: getWealthDescription(score),
                details: wealthScoreDetails
            };
        }

        // è®¡ç®—è´¢å¯Œåˆ†æ•°
        function calculateWealthScore(pillars) {
            if (wealthScoreValue === 0) {
                // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
                const dayStr = typeof pillars.day === 'string' ? pillars.day : String(pillars.day);
                const monthStr = typeof pillars.month === 'string' ? pillars.month : String(pillars.month);
                const yearStr = typeof pillars.year === 'string' ? pillars.year : String(pillars.year);
                const hourStr = typeof pillars.hour === 'string' ? pillars.hour : String(pillars.hour);
                
                // åˆ›å»ºå®‰å…¨çš„pillarså¯¹è±¡
                const safePillars = {
                    year: yearStr,
                    month: monthStr,
                    day: dayStr,
                    hour: hourStr
                };
                
                const wealthStarScore = calculateWealthStarScore(safePillars);
                const wealthPositionScore = calculateWealthPositionScore(safePillars);
                const wealthDamageScore = calculateWealthDamageScore(safePillars);
                const wealthSupportScore = calculateWealthSupportScore(safePillars);
                const fortuneScore = calculateFortuneScore(safePillars);
                const total = wealthStarScore + wealthPositionScore + (20 - wealthDamageScore) + wealthSupportScore + fortuneScore;
                wealthScoreDetails = {
                    wealthStarScore,
                    wealthPositionScore,
                    wealthDamageScore: 20 - wealthDamageScore,
                    wealthSupportScore,
                    fortuneScore,
                    total
                };
                wealthScoreValue = Math.round(total);
            }
            return wealthScoreValue;
        }

        // è®¡ç®—è´¢æ˜Ÿåˆ†æ•°
        function calculateWealthStarScore(pillars) {
            // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²
            const dayStr = typeof pillars.day === 'string' ? pillars.day : String(pillars.day);
            const monthStr = typeof pillars.month === 'string' ? pillars.month : String(pillars.month);
            const yearStr = typeof pillars.year === 'string' ? pillars.year : String(pillars.year);
            const hourStr = typeof pillars.hour === 'string' ? pillars.hour : String(pillars.hour);
            
            const dayStem = dayStr.length > 0 ? dayStr.charAt(0) : '';
            let wealthCount = 0;
            const stems = [
                yearStr.length > 0 ? yearStr.charAt(0) : '',
                monthStr.length > 0 ? monthStr.charAt(0) : '',
                hourStr.length > 0 ? hourStr.charAt(0) : ''
            ];
            const branches = [
                yearStr.length > 1 ? yearStr.charAt(1) : '',
                monthStr.length > 1 ? monthStr.charAt(1) : '',
                dayStr.length > 1 ? dayStr.charAt(1) : '',
                hourStr.length > 1 ? hourStr.charAt(1) : ''
            ];
            const wealthStars = getWealthStars(dayStem);
            stems.forEach(function(stem) {
                if (wealthStars.includes(stem)) {
                    wealthCount++;
                }
            });
            branches.forEach(function(branch) {
                if (wealthStars.includes(branch)) {
                    wealthCount++;
                }
            });
            if (wealthCount >= 3) return 30;
            if (wealthCount === 2) return 20;
            if (wealthCount === 1) return 10;
            return 5;
        }

        // è·å–è´¢æ˜Ÿ
        function getWealthStars(dayStem) {
            const wealthMap = {
                'ç”²': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'ä¹™': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'ä¸™': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
                'ä¸': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
                'æˆŠ': ['å£¬', 'ç™¸', 'å­', 'äº¥'],
                'å·±': ['å£¬', 'ç™¸', 'å­', 'äº¥'],
                'åºš': ['ç”²', 'ä¹™', 'å¯…', 'å¯'],
                'è¾›': ['ç”²', 'ä¹™', 'å¯…', 'å¯'],
                'å£¬': ['ä¸™', 'ä¸', 'åˆ', 'å·³'],
                'ç™¸': ['ä¸™', 'ä¸', 'åˆ', 'å·³']
            };
            return wealthMap[dayStem] || [];
        }

        // è®¡ç®—è´¢ä½åˆ†æ•°
        function calculateWealthPositionScore(pillars) {
            const dayStem = pillars.day.charAt(0);
            const wealthStars = getWealthStars(dayStem);
            let score = 0;
            if (wealthStars.includes(pillars.month.charAt(1))) {
                score += 15;
            }
            if (wealthStars.includes(pillars.day.charAt(1))) {
                score += 5;
            }
            if (wealthStars.includes(pillars.hour.charAt(1))) {
                score += 5;
            }
            return Math.min(25, score);
        }

        // è®¡ç®—è´¢æŸåˆ†æ•°
        function calculateWealthDamageScore(pillars) {
            const dayStem = pillars.day.charAt(0);
            const wealthStars = getWealthStars(dayStem);
            let damageCount = 0;
            const stems = [
                pillars.year.charAt(0),
                pillars.month.charAt(0),
                pillars.hour.charAt(0)
            ];
            const branches = [
                pillars.year.charAt(1),
                pillars.month.charAt(1),
                pillars.day.charAt(1),
                pillars.hour.charAt(1)
            ];
            const damageStars = getDamageStars(dayStem);
            stems.forEach(function(stem) {
                if (damageStars.includes(stem)) {
                    damageCount++;
                }
            });
            branches.forEach(function(branch) {
                if (damageStars.includes(branch)) {
                    damageCount++;
                }
            });
            return Math.min(20, damageCount * 5);
        }

        // è·å–æŸæ˜Ÿ
        function getDamageStars(dayStem) {
            const damageMap = {
                'ç”²': ['ç”²', 'ä¹™', 'å¯…', 'å¯'],
                'ä¹™': ['ç”²', 'ä¹™', 'å¯…', 'å¯'],
                'ä¸™': ['ä¸™', 'ä¸', 'åˆ', 'å·³'],
                'ä¸': ['ä¸™', 'ä¸', 'åˆ', 'å·³'],
                'æˆŠ': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'å·±': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'åºš': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
                'è¾›': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
                'å£¬': ['å£¬', 'ç™¸', 'å­', 'äº¥'],
                'ç™¸': ['å£¬', 'ç™¸', 'å­', 'äº¥']
            };
            return damageMap[dayStem] || [];
        }

        // è®¡ç®—è´¢åŠ©åˆ†æ•°
        function calculateWealthSupportScore(pillars) {
            const dayStem = pillars.day.charAt(0);
            const wealthStars = getWealthStars(dayStem);
            const generateStars = getGenerateStars(dayStem);
            let supportCount = 0;
            const stems = [
                pillars.year.charAt(0),
                pillars.month.charAt(0),
                pillars.hour.charAt(0)
            ];
            const branches = [
                pillars.year.charAt(1),
                pillars.month.charAt(1),
                pillars.day.charAt(1),
                pillars.hour.charAt(1)
            ];
            stems.forEach(function(stem) {
                if (generateStars.includes(stem)) {
                    supportCount++;
                }
            });
            branches.forEach(function(branch) {
                if (generateStars.includes(branch)) {
                    supportCount++;
                }
            });
            if (supportCount >= 2) return 15;
            if (supportCount === 1) return 8;
            return 3;
        }

        // è·å–ç”Ÿæ˜Ÿ
        function getGenerateStars(dayStem) {
            const generateMap = {
                'ç”²': ['ä¸™', 'ä¸', 'åˆ', 'å·³'],
                'ä¹™': ['ä¸™', 'ä¸', 'åˆ', 'å·³'],
                'ä¸™': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'ä¸': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
                'æˆŠ': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
                'å·±': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
                'åºš': ['å£¬', 'ç™¸', 'å­', 'äº¥'],
                'è¾›': ['å£¬', 'ç™¸', 'å­', 'äº¥'],
                'å£¬': ['ç”²', 'ä¹™', 'å¯…', 'å¯'],
                'ç™¸': ['ç”²', 'ä¹™', 'å¯…', 'å¯']
            };
            return generateMap[dayStem] || [];
        }

        // è®¡ç®—è¿åŠ¿åˆ†æ•°
        function calculateFortuneScore(pillars) {
            return 5;
        }

        // è·å–è´¢å¯Œç­‰çº§
        function getWealthLevel(score) {
            if (score >= 90) return { name: "å¤©ç¦„ç›ˆé—¨ â˜…â˜…â˜…â˜…â˜…", class: "ultra-rich" };
            if (score >= 80) return { name: "æœ±ç´«æ»¡ç®± â˜…â˜…â˜…â˜…â˜†", class: "very-rich" };
            if (score >= 60) return { name: "ç²Ÿé™ˆè´¯æœ½ â˜…â˜…â˜…â˜†â˜†", class: "moderately-rich" };
            if (score >= 40) return { name: "å²ç¨”å¹´ä¸° â˜…â˜…â˜†â˜†â˜†", class: "somewhat-rich" };
            return { name: "è¥è¥é€é€ â˜…â˜†â˜†â˜†â˜†", class: "wealth-average" };
        }

        // è·å–è´¢å¯Œæè¿°
        function getWealthDescription(score) {
            if (score >= 90) return 'è´¢è¿äº¨é€šï¼Œå¯Œè´µåŒå…¨ï¼Œä¸€ç”Ÿè´¢å¯Œä¸°åš';
            if (score >= 80) return 'è´¢è¿ä¸é”™ï¼Œç”Ÿæ´»å¯Œè¶³ï¼Œè´¢å¯Œç¨³æ­¥å¢é•¿';
            if (score >= 60) return 'è´¢è¿å¹³å¹³ï¼Œæ¸©é¥±æ— å¿§ï¼Œéœ€è¦åŠªåŠ›ç§¯ç´¯';
            if (score >= 40) return 'è´¢è¿è¾ƒå¼±ï¼Œéœ€è¦å‹¤ä¿­æŒå®¶ï¼Œè°¨æ…ç†è´¢';
            return 'è´¢è¿åå¼±ï¼Œéœ€è¦ç‰¹åˆ«åŠªåŠ›ï¼Œé‡å…¥ä¸ºå‡º';
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(baziData) {
            displayBasicInfo(baziData);
            displayBaziChart(baziData);
            displayElementsChart(baziData);
            displayStrengthChart(baziData);
            displayLuckTiming(baziData);
            displayFateLevel(baziData);
            displayWealthLevel(baziData);
        }

        // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        function displayBasicInfo(baziData) {
            const userInfoTitle = document.getElementById('user-info-title');
            const basicInfoContent = document.getElementById('basic-info-content');
            
            userInfoTitle.textContent = `${baziData.name} - ${baziData.gender === 'male' ? 'ç”·' : 'å¥³'}`;
            
            const solarDate = baziData.solar.toYmd();
            const lunarDate = baziData.lunar.toString();
            
            basicInfoContent.innerHTML = `
                <div class="info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div class="info-item">
                        <strong>é˜³å†ï¼š</strong>${solarDate}
                    </div>
                    <div class="info-item">
                        <strong>å†œå†ï¼š</strong>${lunarDate}
                    </div>
                    <div class="info-item">
                        <strong>æ€§åˆ«ï¼š</strong>${baziData.gender === 'male' ? 'ç”·' : 'å¥³'}
                    </div>
                    <div class="info-item">
                        <strong>æ—¶è¾°ï¼š</strong>${baziData.birthTime}
                    </div>
                </div>
            `;
        }

        // æ˜¾ç¤ºå…«å­—æ’ç›˜
        function displayBaziChart(baziData) {
            const baziChart = document.getElementById('bazi-chart');
            const { pillars, hiddenStems } = baziData;
            const dayStem = pillars.day[0]; // æ—¥ä¸»å¤©å¹²
            
            // äº”è¡Œé¢œè‰²æ˜ å°„
            const elementColors = {
                'æœ¨': '#27ae60', // ç»¿è‰²
                'ç«': '#e74c3c', // çº¢è‰²
                'åœŸ': '#f39c12', // é»„è‰²
                'é‡‘': '#95a5a6', // é“¶è‰²
                'æ°´': '#3498db'  // è“è‰²
            };
            
            // å¤©å¹²åœ°æ”¯äº”è¡Œæ˜ å°„
            const elementMap = {
                'ç”²': 'æœ¨', 'ä¹™': 'æœ¨',
                'ä¸™': 'ç«', 'ä¸': 'ç«',
                'æˆŠ': 'åœŸ', 'å·±': 'åœŸ',
                'åºš': 'é‡‘', 'è¾›': 'é‡‘',
                'å£¬': 'æ°´', 'ç™¸': 'æ°´',
                'å¯…': 'æœ¨', 'å¯': 'æœ¨',
                'å·³': 'ç«', 'åˆ': 'ç«',
                'è¾°': 'åœŸ', 'æˆŒ': 'åœŸ', 'ä¸‘': 'åœŸ', 'æœª': 'åœŸ',
                'ç”³': 'é‡‘', 'é…‰': 'é‡‘',
                'å­': 'æ°´', 'äº¥': 'æ°´'
            };
            
            // åç¥è®¡ç®—å‡½æ•°
            function getTenGod(dayStem, target) {
                const ganList = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
                
                // å¦‚æœæ˜¯åœ°æ”¯ï¼Œè·å–å…¶ä¸»æ°”å¤©å¹²
                if (!ganList.includes(target)) {
                    const mainQiMap = {
                        'å­': 'ç™¸', 'ä¸‘': 'å·±', 'å¯…': 'ç”²', 'å¯': 'ä¹™',
                        'è¾°': 'æˆŠ', 'å·³': 'ä¸™', 'åˆ': 'ä¸', 'æœª': 'å·±',
                        'ç”³': 'åºš', 'é…‰': 'è¾›', 'æˆŒ': 'æˆŠ', 'äº¥': 'å£¬'
                    };
                    target = mainQiMap[target];
                    if (!target) return 'æœªçŸ¥';
                }
                
                const dayIndex = ganList.indexOf(dayStem);
                const targetIndex = ganList.indexOf(target);
                
                if (dayIndex === -1 || targetIndex === -1) return 'æœªçŸ¥';
                
                const diff = (targetIndex - dayIndex + 10) % 10;
                
                // åç¥é¡ºåº
                const tenGods = [
                    'æ¯”è‚©', 'åŠ«è´¢', 'é£Ÿç¥', 'ä¼¤å®˜', 
                    'åè´¢', 'æ­£è´¢', 'ä¸ƒæ€', 'æ­£å®˜', 
                    'åå°', 'æ­£å°'
                ];
                
                return tenGods[diff] || 'æœªçŸ¥';
            }
            
            // ç”Ÿæˆå¸¦é¢œè‰²å’Œåç¥çš„å¤©å¹²
                function coloredStem(stem, isDay = false) {
                    const element = elementMap[stem] || '';
                    const color = elementColors[element] || '#000';
                    const tenGod = isDay ? '' : getTenGod(dayStem, stem);
                    const tenGodText = isDay ? '' : `<small style="display:block;font-size:0.5em;color:#666;margin-top:3px;text-align:center;">${tenGod}</small>`;
                    const bgColor = isDay ? `background:linear-gradient(135deg, rgba(${getElementRGB(element)}, 0.15), rgba(${getElementRGB(element)}, 0.05));` : '';
                    return `<div style="display:inline-block;${bgColor}border-radius:8px;padding:5px 10px;">
                        <span style="color:${color};font-weight:bold;font-size:1.8em;font-family:'SimHei','é»‘ä½“',sans-serif;text-shadow:0 1px 2px rgba(0,0,0,0.1);">${stem}</span>
                        ${tenGodText}
                    </div>`;
                }
                
                // ç”Ÿæˆå¸¦é¢œè‰²å’Œåç¥çš„åœ°æ”¯
                function coloredBranch(branch) {
                    const element = elementMap[branch] || '';
                    const color = elementColors[element] || '#000';
                    const tenGod = getTenGod(dayStem, branch);
                    return `<div style="display:inline-block;border-radius:8px;padding:5px 10px;">
                        <span style="color:${color};font-weight:bold;font-size:1.8em;font-family:'SimHei','é»‘ä½“',sans-serif;text-shadow:0 1px 2px rgba(0,0,0,0.1);">${branch}</span>
                        <small style="display:block;font-size:0.5em;color:#666;margin-top:3px;text-align:center;">${tenGod}</small>
                    </div>`;
                }
                
                // ç”Ÿæˆå¸¦é¢œè‰²å’Œåç¥çš„è—å¹²
                function coloredHiddenStems(stems) {
                    return stems.map((stem, index) => {
                        const element = elementMap[stem] || '';
                        const color = elementColors[element] || '#000';
                        const tenGod = getTenGod(dayStem, stem);
                        return `<div style="display:inline-block;margin:0 2px;border-radius:6px;padding:3px 6px;background:rgba(${getElementRGB(element)}, 0.05);">
                            <span style="color:${color};font-size:1.3em;font-family:'SimHei','é»‘ä½“',sans-serif;text-shadow:0 1px 1px rgba(0,0,0,0.05);">${stem}</span>
                            <small style="display:block;font-size:0.5em;color:#666;margin-top:2px;text-align:center;">${tenGod}</small>
                        </div>`;
                    }).join('');
                }
                
                // è·å–äº”è¡Œå¯¹åº”çš„RGBå€¼
                function getElementRGB(element) {
                    switch(element) {
                        case 'æœ¨': return '39, 174, 96'; // ç»¿è‰²
                        case 'ç«': return '231, 76, 60'; // çº¢è‰²
                        case 'åœŸ': return '243, 156, 18'; // é»„è‰²
                        case 'é‡‘': return '149, 165, 166'; // é“¶è‰²
                        case 'æ°´': return '52, 152, 219'; // è“è‰²
                        default: return '0, 0, 0';
                    }
                }
            
            baziChart.innerHTML = `
                <table class="bazi-table">
                    <thead>
                        <tr>
                            <th>å››æŸ±</th>
                            <th class="pillar-header">å¹´æŸ±</th>
                            <th class="pillar-header">æœˆæŸ±</th>
                            <th class="pillar-header">æ—¥æŸ±</th>
                            <th class="pillar-header">æ—¶æŸ±</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>å¤©å¹²</strong></td>
                            <td class="stem">${coloredStem(pillars.year[0])}</td>
                            <td class="stem">${coloredStem(pillars.month[0])}</td>
                            <td class="stem">${coloredStem(pillars.day[0], true)}</td>
                            <td class="stem">${coloredStem(pillars.hour[0])}</td>
                        </tr>
                        <tr>
                            <td><strong>åœ°æ”¯</strong></td>
                            <td class="branch">${coloredBranch(pillars.year[1])}</td>
                            <td class="branch">${coloredBranch(pillars.month[1])}</td>
                            <td class="branch">${coloredBranch(pillars.day[1])}</td>
                            <td class="branch">${coloredBranch(pillars.hour[1])}</td>
                        </tr>
                        <tr>
                            <td><strong>è—å¹²</strong></td>
                            <td>${coloredHiddenStems(hiddenStems.year)}</td>
                            <td>${coloredHiddenStems(hiddenStems.month)}</td>
                            <td>${coloredHiddenStems(hiddenStems.day)}</td>
                            <td>${coloredHiddenStems(hiddenStems.hour)}</td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7)); border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); backdrop-filter: blur(5px);">
                    <div style="display: flex; flex-wrap: wrap; justify-content: space-around; align-items: center;">
                        <div style="flex: 1; min-width: 200px; padding: 10px; text-align: center; border-right: 1px solid rgba(233, 236, 239, 0.5);">
                            <div style="font-size: 0.9em; color: #7f8c8d; margin-bottom: 5px;">å¹´å‘½çº³éŸ³</div>
                            <div style="font-size: 1.3em; font-weight: 600; color: #2c3e50;">${baziData.lunar.getYearNaYin()}</div>
                        </div>
                        <div style="flex: 1; min-width: 200px; padding: 10px; text-align: center;">
                            <div style="font-size: 0.9em; color: #7f8c8d; margin-bottom: 5px;">æ—¥ä¸»</div>
                            <div style="font-size: 1.3em; font-weight: 600;">
                                <span style="display: inline-block; padding: 5px 15px; border-radius: 20px; background: linear-gradient(135deg, rgba(${getElementRGB(elementMap[pillars.day[0]])}, 0.2), rgba(${getElementRGB(elementMap[pillars.day[0]])}, 0.05)); color: ${elementColors[elementMap[pillars.day[0]]] || '#000'}; text-shadow: 0 1px 1px rgba(0,0,0,0.1);">
                                    ${pillars.day[0]}${getElementName(pillars.day[0])}å‘½
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // è·å–äº”è¡Œåç§°
        function getElementName(stem) {
            const elementMap = {
                'ç”²': 'æœ¨', 'ä¹™': 'æœ¨',
                'ä¸™': 'ç«', 'ä¸': 'ç«',
                'æˆŠ': 'åœŸ', 'å·±': 'åœŸ',
                'åºš': 'é‡‘', 'è¾›': 'é‡‘',
                'å£¬': 'æ°´', 'ç™¸': 'æ°´'
            };
            return elementMap[stem] || '';
        }

        // æ˜¾ç¤ºäº”è¡Œå›¾è¡¨
        function displayElementsChart(baziData) {
            const ctx = document.getElementById('elements-chart').getContext('2d');
            const elements = baziData.elements;
            
            if (elementsChart) {
                elementsChart.destroy();
            }
            
            // å¢å¼ºçš„äº”è¡Œé¢œè‰² - æ›´ä¸“ä¸šçš„é…è‰²æ–¹æ¡ˆ
            const elementColors = {
                wood: {
                    main: '#2ecc71',
                    light: 'rgba(46, 204, 113, 0.8)',
                    border: 'rgba(46, 204, 113, 1)',
                    gradient: ['rgba(46, 204, 113, 0.9)', 'rgba(39, 174, 96, 0.9)']
                },
                fire: {
                    main: '#e74c3c',
                    light: 'rgba(231, 76, 60, 0.8)',
                    border: 'rgba(231, 76, 60, 1)',
                    gradient: ['rgba(231, 76, 60, 0.9)', 'rgba(192, 57, 43, 0.9)']
                },
                earth: {
                    main: '#f39c12',
                    light: 'rgba(243, 156, 18, 0.8)',
                    border: 'rgba(243, 156, 18, 1)',
                    gradient: ['rgba(243, 156, 18, 0.9)', 'rgba(211, 84, 0, 0.9)']
                },
                metal: {
                    main: '#95a5a6',
                    light: 'rgba(149, 165, 166, 0.8)',
                    border: 'rgba(149, 165, 166, 1)',
                    gradient: ['rgba(149, 165, 166, 0.9)', 'rgba(127, 140, 141, 0.9)']
                },
                water: {
                    main: '#3498db',
                    light: 'rgba(52, 152, 219, 0.8)',
                    border: 'rgba(52, 152, 219, 1)',
                    gradient: ['rgba(52, 152, 219, 0.9)', 'rgba(41, 128, 185, 0.9)']
                }
            };
            
            // æ³¨å†ŒChart.jsæ’ä»¶
            Chart.register(ChartDataLabels);
            
            // è®¡ç®—æ€»åˆ†
            const total = Object.values(elements).reduce((sum, val) => sum + val, 0);
            
            // åˆ›å»ºæ¸å˜èƒŒæ™¯
            const createGradient = (ctx, colors) => {
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, colors[0]);
                gradient.addColorStop(1, colors[1]);
                return gradient;
            };
            
            // åˆ›å»ºå¢å¼ºçš„ç¯å½¢å›¾
            elementsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'],
                    datasets: [{
                        data: [elements.wood, elements.fire, elements.earth, elements.metal, elements.water],
                        backgroundColor: [
                            createGradient(ctx, elementColors.wood.gradient),
                            createGradient(ctx, elementColors.fire.gradient),
                            createGradient(ctx, elementColors.earth.gradient),
                            createGradient(ctx, elementColors.metal.gradient),
                            createGradient(ctx, elementColors.water.gradient)
                        ],
                        borderColor: [
                            elementColors.wood.border,
                            elementColors.fire.border,
                            elementColors.earth.border,
                            elementColors.metal.border,
                            elementColors.water.border
                        ],
                        borderWidth: 2,
                        hoverBorderWidth: 4,
                        hoverBorderColor: '#fff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%', // ç¨å¾®å‡å°ä¸­å¿ƒå­”ï¼Œä½¿å›¾è¡¨æ›´åŠ çªå‡º
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: "'Noto Serif SC', serif"
                                },
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#333',
                            bodyColor: '#333',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            cornerRadius: 10,
                            padding: 15,
                            boxPadding: 8,
                            usePointStyle: true,
                            titleFont: {
                                size: 16,
                                weight: 'bold',
                                family: "'Noto Serif SC', serif"
                            },
                            bodyFont: {
                                size: 14,
                                family: "'Noto Serif SC', serif"
                            },
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed}ç‚¹ (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            textShadow: '0 1px 2px rgba(0,0,0,0.2)',
                            font: {
                                weight: 'bold',
                                size: 16,
                                family: "'Noto Serif SC', serif"
                            },
                            formatter: (value, ctx) => {
                                const percentage = ((value / total) * 100).toFixed(0);
                                return percentage > 5 ? `${percentage}%` : '';
                            },
                            anchor: 'center',
                            align: 'center',
                            offset: 0,
                            borderWidth: 2,
                            borderRadius: 4,
                            backgroundColor: function(context) {
                                return context.dataset.backgroundColor[context.dataIndex];
                            },
                            opacity: 0.9
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 2000,
                        easing: 'easeOutQuart'
                    }
                }
            });
            
            // æ˜¾ç¤ºå¢å¼ºçš„äº”è¡Œåˆ†ææè¿°
            const description = document.getElementById('elements-description');
            const summary = document.getElementById('elements-summary');
            const strongest = Object.keys(elements).reduce((a, b) => elements[a] > elements[b] ? a : b);
            const weakest = Object.keys(elements).reduce((a, b) => elements[a] < elements[b] ? a : b);
            
            const elementNames = {
                wood: 'æœ¨', fire: 'ç«', earth: 'åœŸ', metal: 'é‡‘', water: 'æ°´'
            };
            
            // å¢å¼ºçš„äº”è¡Œç‰¹æ€§
            const elementProperties = {
                wood: {
                    nature: 'ç”Ÿé•¿ã€å‘ä¸Šã€æ‰©å±•',
                    character: 'ä»çˆ±ã€æ­£ç›´ã€è¿›å–ã€åˆ›æ–°ã€çµæ´»ã€å–„å˜',
                    career: 'æ•™è‚²ã€æ–‡åŒ–ã€è‰ºæœ¯ã€æ³•å¾‹ã€ç¯ä¿ã€æ¤ç‰©ç›¸å…³è¡Œä¸šã€åˆ›æ„è®¾è®¡ã€æ–°å…´äº§ä¸š',
                    health: 'è‚èƒ†ç³»ç»Ÿã€çœ¼ç›ã€è‚Œè…±ã€ç¥ç»ã€å¤´éƒ¨',
                    favorable: 'ä¸œæ–¹ã€ç»¿è‰²ç¯å¢ƒã€æ˜¥å­£ã€æ¸…æ™¨',
                    icon: 'fa-tree',
                    personality: 'æ€ç»´æ´»è·ƒï¼Œåˆ›æ–°èƒ½åŠ›å¼ºï¼Œå–„äºè§„åˆ’ï¼Œæœ‰è¿œè§ï¼Œä½†å¯èƒ½ç¼ºä¹è€å¿ƒï¼Œæƒ…ç»ªæ³¢åŠ¨è¾ƒå¤§',
                    career_detail: 'é€‚åˆéœ€è¦åˆ›é€ åŠ›å’Œå˜é©çš„å·¥ä½œï¼Œä¸é€‚åˆå›ºå®šæ¨¡å¼çš„å·¥ä½œ',
                    health_advice: 'æ³¨æ„æƒ…ç»ªç®¡ç†ï¼Œé¿å…è¿‡åº¦ç´§å¼ å’Œå‹åŠ›ï¼Œä¿æŒè§„å¾‹ä½œæ¯ï¼Œå¤šåšèˆ’ç¼“è¿åŠ¨'
                },
                fire: {
                    nature: 'ä¸Šå‡ã€æ‰©å¼ ã€çƒ­çƒˆ',
                    character: 'çƒ­æƒ…ã€æ´»åŠ›ã€ç›´è§‰ã€è¡¨è¾¾åŠ›å¼ºã€ä¹è§‚ã€å†²åŠ¨',
                    career: 'å¨±ä¹ã€é¤é¥®ã€ç…§æ˜ã€èƒ½æºã€ä¼ åª’ã€è¥é”€ã€è¡¨æ¼”ã€å…¬å…³',
                    health: 'å¿ƒè„ã€è¡€æ¶²å¾ªç¯ã€çœ¼ç›ã€é¢éƒ¨ã€å°è‚ ',
                    favorable: 'å—æ–¹ã€é˜³å…‰å……è¶³ç¯å¢ƒã€å¤å­£ã€ä¸­åˆ',
                    icon: 'fa-fire',
                    personality: 'çƒ­æƒ…æ´‹æº¢ï¼Œå¯Œæœ‰æ„ŸæŸ“åŠ›ï¼Œç›´è§‰æ•é”ï¼Œå–„äºè¡¨è¾¾ï¼Œä½†å¯èƒ½å†²åŠ¨ï¼Œç¼ºä¹è€å¿ƒ',
                    career_detail: 'é€‚åˆéœ€è¦çƒ­æƒ…å’Œè¡¨ç°åŠ›çš„å·¥ä½œï¼Œä¸é€‚åˆéœ€è¦å†·é™åˆ†æçš„å·¥ä½œ',
                    health_advice: 'æ³¨æ„å¿ƒè„å¥åº·ï¼Œé¿å…æƒ…ç»ªè¿‡åº¦æ¿€åŠ¨ï¼Œä¿æŒå……è¶³ç¡çœ ï¼Œé€‚å½“æ§åˆ¶é¥®é£Ÿ'
                },
                earth: {
                    nature: 'ç¨³å®šã€ä¸­å’Œã€åŒ…å®¹',
                    character: 'è¸å®ã€ç¨³é‡ã€åŒ…å®¹ã€å¿ è¯šã€ä¿å®ˆã€å›ºæ‰§',
                    career: 'æˆ¿åœ°äº§ã€å†œä¸šã€é£Ÿå“ã€ä¿é™©ã€æœåŠ¡ä¸šã€åŒ»ç–—ã€æ•™è‚²ã€è¡Œæ”¿ç®¡ç†',
                    health: 'è„¾èƒƒã€æ¶ˆåŒ–ç³»ç»Ÿã€è‚Œè‚‰ã€å£è…”',
                    favorable: 'ä¸­å¤®ä½ç½®ã€é»„è‰²ç¯å¢ƒã€å­£èŠ‚äº¤æ›¿æ—¶æœŸã€ä¸‹åˆ',
                    icon: 'fa-mountain',
                    personality: 'ç¨³é‡è¸å®ï¼Œè´£ä»»æ„Ÿå¼ºï¼Œå¿ è¯šå¯é ï¼Œä½†å¯èƒ½å›ºæ‰§ï¼Œç¼ºä¹å˜é€š',
                    career_detail: 'é€‚åˆéœ€è¦è€å¿ƒå’Œç¨³å®šçš„å·¥ä½œï¼Œä¸é€‚åˆéœ€è¦é¢‘ç¹å˜åŠ¨çš„å·¥ä½œ',
                    health_advice: 'æ³¨æ„æ¶ˆåŒ–ç³»ç»Ÿå¥åº·ï¼Œä¿æŒè§„å¾‹é¥®é£Ÿï¼Œé¿å…è¿‡åº¦æ€è™‘ï¼Œé€‚å½“è¿åŠ¨'
                },
                metal: {
                    nature: 'æ”¶æ•›ã€å‘å†…ã€åšç¡¬',
                    character: 'æœæ–­ã€å…¬æ­£ã€æ¡ç†ã€è‡ªå¾‹ã€ç†æ€§ã€åˆšæ¯…',
                    career: 'é‡‘èã€ITã€æœºæ¢°ã€æ±½è½¦ã€ç å®ã€å†›è­¦ã€æ³•å¾‹ã€ç²¾å¯†å·¥ä¸š',
                    health: 'è‚ºéƒ¨ã€å¤§è‚ ã€çš®è‚¤ã€é¼»å­ã€å‘¼å¸ç³»ç»Ÿ',
                    favorable: 'è¥¿æ–¹ã€ç™½è‰²ç¯å¢ƒã€ç§‹å­£ã€å‚æ™š',
                    icon: 'fa-coins',
                    personality: 'æ¡ç†åˆ†æ˜ï¼Œåšäº‹æœæ–­ï¼Œå…¬æ­£ä¸¥æ˜ï¼Œä½†å¯èƒ½è¿‡äºåˆšç¡¬ï¼Œç¼ºä¹æŸ”æ€§',
                    career_detail: 'é€‚åˆéœ€è¦ç²¾ç¡®å’Œè§„èŒƒçš„å·¥ä½œï¼Œä¸é€‚åˆéœ€è¦çµæ´»å˜é€šçš„å·¥ä½œ',
                    health_advice: 'æ³¨æ„å‘¼å¸ç³»ç»Ÿå¥åº·ï¼Œä¿æŒç¯å¢ƒæ¸…æ´ï¼Œé¿å…è¿‡åº¦å‹æŠ‘æƒ…ç»ªï¼Œé€‚å½“æ”¾æ¾'
                },
                water: {
                    nature: 'å‘ä¸‹ã€æµåŠ¨ã€é€‚åº”',
                    character: 'æ™ºæ…§ã€çµæ´»ã€äº¤é™…ã€é€‚åº”åŠ›å¼ºã€æ·±æ²‰ã€å¤šå˜',
                    career: 'è´¸æ˜“ã€è¿è¾“ã€æ—…æ¸¸ã€æ°´äº§ã€å¤–äº¤ã€é”€å”®ã€å’¨è¯¢ã€ä¿¡æ¯ä¼ æ’­',
                    health: 'è‚¾è„ã€è†€èƒ±ã€è€³æœµã€éª¨éª¼ã€ç”Ÿæ®–ç³»ç»Ÿ',
                    favorable: 'åŒ—æ–¹ã€æ°´åŸŸç¯å¢ƒã€å†¬å­£ã€å¤œæ™š',
                    icon: 'fa-water',
                    personality: 'æ€ç»´çµæ´»ï¼Œé€‚åº”åŠ›å¼ºï¼Œå–„äºæ²Ÿé€šï¼Œä½†å¯èƒ½å¤šè™‘ï¼Œç¼ºä¹å†³æ–­',
                    career_detail: 'é€‚åˆéœ€è¦äº¤æµå’Œå˜é€šçš„å·¥ä½œï¼Œä¸é€‚åˆå›ºå®šæ¨¡å¼çš„å·¥ä½œ',
                    health_advice: 'æ³¨æ„è‚¾è„å¥åº·ï¼Œä¿æŒå……è¶³ç¡çœ ï¼Œé¿å…è¿‡åº¦ç–²åŠ³ï¼Œä¿æŒæ°´åˆ†æ‘„å…¥'
                }
            };
            
            // è®¡ç®—äº”è¡Œå¹³è¡¡åº¦
            const avg = total / 5;
            const deviation = Object.values(elements).reduce((sum, val) => sum + Math.abs(val - avg), 0) / total;
            const balancePercentage = (1 - deviation) * 100;
            let balanceLevel;
            if (balancePercentage >= 85) balanceLevel = 'æä½³';
            else if (balancePercentage >= 70) balanceLevel = 'è‰¯å¥½';
            else if (balancePercentage >= 50) balanceLevel = 'ä¸€èˆ¬';
            else balanceLevel = 'å¤±è¡¡';
            
            // è·å–ç¬¬äºŒå¼ºå’Œç¬¬äºŒå¼±çš„äº”è¡Œ
            const sortedElements = Object.entries(elements).sort((a, b) => b[1] - a[1]);
            const secondStrongest = sortedElements[1][0];
            const secondWeakest = sortedElements[3][0];
            
            // æ˜¾ç¤ºäº”è¡Œåˆ†å¸ƒæ¦‚è§ˆï¼ˆæ”¾åœ¨å›¾è¡¨ä¸‹æ–¹ï¼‰
            summary.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.7)); padding: 15px; border-radius: 10px; box-shadow: 0 3px 8px rgba(0,0,0,0.08);">
                    <div style="display: flex; justify-content: space-between; flex-wrap: wrap; margin-bottom: 12px;">
                        <div style="min-width: 120px; margin-bottom: 8px;">
                            <span style="font-weight: bold; color: ${elementColors[strongest].main};">æœ€å¼ºäº”è¡Œï¼š</span>
                            <span style="background: linear-gradient(135deg, ${elementColors[strongest].gradient[0]}, ${elementColors[strongest].gradient[1]}); padding: 3px 10px; border-radius: 20px; color: #fff; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                ${elementNames[strongest]} (${((elements[strongest]/total)*100).toFixed(1)}%)
                            </span>
                        </div>
                        <div style="min-width: 120px; margin-bottom: 8px;">
                            <span style="font-weight: bold; color: ${elementColors[weakest].main};">æœ€å¼±äº”è¡Œï¼š</span>
                            <span style="background: linear-gradient(135deg, ${elementColors[weakest].gradient[0]}, ${elementColors[weakest].gradient[1]}); padding: 3px 10px; border-radius: 20px; color: #fff; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                ${elementNames[weakest]} (${((elements[weakest]/total)*100).toFixed(1)}%)
                            </span>
                        </div>
                        <div style="min-width: 120px; margin-bottom: 8px;">
                            <span style="font-weight: bold; color: #2c3e50;">å¹³è¡¡åº¦ï¼š</span>
                            <span style="background: linear-gradient(135deg, ${balanceLevel === 'æä½³' ? 'rgba(39, 174, 96, 0.9), rgba(46, 204, 113, 0.9)' : balanceLevel === 'è‰¯å¥½' ? 'rgba(46, 204, 113, 0.9), rgba(39, 174, 96, 0.9)' : balanceLevel === 'ä¸€èˆ¬' ? 'rgba(243, 156, 18, 0.9), rgba(230, 126, 34, 0.9)' : 'rgba(231, 76, 60, 0.9), rgba(192, 57, 43, 0.9)'}); padding: 3px 10px; border-radius: 20px; color: #fff; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                ${balanceLevel} (${balancePercentage.toFixed(0)}%)
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 12px;">
                        <p style="margin: 0; line-height: 1.6; font-size: 0.95rem;">
                            <strong>äº”è¡Œåˆ†å¸ƒï¼š</strong><br>
                            <span style="display: inline-block; margin: 5px 5px 5px 0; padding: 4px 10px; background-color: ${elementColors.wood.light}; color: white; border-radius: 15px; font-weight: bold;">æœ¨ ${elements.wood}ç‚¹ (${((elements.wood/total)*100).toFixed(1)}%)</span>
                            <span style="display: inline-block; margin: 5px 5px 5px 0; padding: 4px 10px; background-color: ${elementColors.fire.light}; color: white; border-radius: 15px; font-weight: bold;">ç« ${elements.fire}ç‚¹ (${((elements.fire/total)*100).toFixed(1)}%)</span>
                            <span style="display: inline-block; margin: 5px 5px 5px 0; padding: 4px 10px; background-color: ${elementColors.earth.light}; color: white; border-radius: 15px; font-weight: bold;">åœŸ ${elements.earth}ç‚¹ (${((elements.earth/total)*100).toFixed(1)}%)</span>
                            <span style="display: inline-block; margin: 5px 5px 5px 0; padding: 4px 10px; background-color: ${elementColors.metal.light}; color: white; border-radius: 15px; font-weight: bold;">é‡‘ ${elements.metal}ç‚¹ (${((elements.metal/total)*100).toFixed(1)}%)</span>
                            <span style="display: inline-block; margin: 5px 5px 5px 0; padding: 4px 10px; background-color: ${elementColors.water.light}; color: white; border-radius: 15px; font-weight: bold;">æ°´ ${elements.water}ç‚¹ (${((elements.water/total)*100).toFixed(1)}%)</span>
                        </p>
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºäº”è¡Œåˆ†ææè¿°
            description.innerHTML = `
                <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2rem; border-bottom: 2px solid #3498db; padding-bottom: 8px;">
                    <i class="fas fa-chart-bar"></i> äº”è¡Œåˆ†æ
                </h4>
                
                <div style="margin-bottom: 18px;">
                    <h5 style="color: ${elementColors[strongest].main}; font-size: 1.1rem; margin-bottom: 10px; display: flex; align-items: center;">
                        <i class="fas ${elementProperties[strongest].icon}" style="margin-right: 8px;"></i> ${elementNames[strongest]}çš„ç‰¹æ€§ä¸å½±å“
                    </h5>
                    <div style="background: linear-gradient(135deg, rgba(${strongest === 'wood' ? '46, 204, 113, 0.15' : strongest === 'fire' ? '231, 76, 60, 0.15' : strongest === 'earth' ? '243, 156, 18, 0.15' : strongest === 'metal' ? '149, 165, 166, 0.15' : '52, 152, 219, 0.15'}, 1), rgba(${strongest === 'wood' ? '46, 204, 113, 0.05' : strongest === 'fire' ? '231, 76, 60, 0.05' : strongest === 'earth' ? '243, 156, 18, 0.05' : strongest === 'metal' ? '149, 165, 166, 0.05' : '52, 152, 219, 0.05'}, 1)); padding: 15px; border-radius: 10px; margin-bottom: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border-left: 4px solid ${elementColors[strongest].main};">
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>æ€§è´¨ï¼š</strong>${elementProperties[strongest].nature}</p>
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>æ€§æ ¼ç‰¹ç‚¹ï¼š</strong>${elementProperties[strongest].character}</p>
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>æ€§æ ¼åˆ†æï¼š</strong>${elementProperties[strongest].personality}</p>
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>äº‹ä¸šæ–¹å‘ï¼š</strong>${elementProperties[strongest].career}</p>
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>äº‹ä¸šç‰¹ç‚¹ï¼š</strong>${elementProperties[strongest].career_detail}</p>
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>å¥åº·å…³æ³¨ï¼š</strong>${elementProperties[strongest].health}</p>
                        <p style="margin: 0 0 8px 0; font-size: 0.95rem;"><strong>å¥åº·å»ºè®®ï¼š</strong>${elementProperties[strongest].health_advice}</p>
                        <p style="margin: 0; font-size: 0.95rem;"><strong>æœ‰åˆ©ç¯å¢ƒï¼š</strong>${elementProperties[strongest].favorable}</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 18px;">
                    <h5 style="color: #2c3e50; font-size: 1.1rem; margin-bottom: 10px; display: flex; align-items: center;">
                        <i class="fas fa-balance-scale" style="margin-right: 8px;"></i> äº”è¡Œå¹³è¡¡å»ºè®®
                    </h5>
                    <div style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(52, 152, 219, 0.05)); padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border-left: 4px solid #3498db;">
                        <p style="margin: 0 0 10px 0; font-size: 0.95rem;">${getFiveElementsAdvice(strongest, weakest)}</p>
                        <p style="margin: 0 0 10px 0; font-size: 0.95rem;"><strong>äº”è¡Œç»„åˆç‰¹ç‚¹ï¼š</strong>
                            ${strongest}${secondStrongest !== strongest ? `å’Œ${secondStrongest}` : ''}è¾ƒå¼ºï¼Œè¡¨ç°ä¸º${elementProperties[strongest].character.split('ã€')[0]}${secondStrongest !== strongest ? `å’Œ${elementProperties[secondStrongest].character.split('ã€')[0]}` : ''}çš„ç‰¹è´¨çªå‡ºã€‚
                            ${weakest === strongest ? '' : `${weakest}è¾ƒå¼±ï¼Œå¯èƒ½ç¼ºä¹${elementProperties[weakest].character.split('ã€')[0]}çš„ç‰¹è´¨ã€‚`}
                        </p>
                        <p style="margin: 0; font-size: 0.95rem;"><strong>è¡¥å……${elementNames[weakest]}çš„æ–¹æ³•ï¼š</strong>
                            ${weakest === 'wood' ? 'å¤šæ¥è§¦ç»¿è‰²æ¤ç‰©ï¼Œåœ¨ä¸œæ–¹ä½ç½®æ´»åŠ¨ï¼Œæ˜¥å­£å‡ºè¡Œï¼Œä½©æˆ´ç»¿è‰²é¥°å“ï¼Œå¤šåƒç»¿è‰²è”¬èœ' : 
                              weakest === 'fire' ? 'å¢åŠ çº¢è‰²è£…é¥°ï¼Œåœ¨å—æ–¹ä½ç½®æ´»åŠ¨ï¼Œå¤å­£å‡ºè¡Œï¼Œä½©æˆ´çº¢è‰²é¥°å“ï¼Œé€‚å½“æ™’å¤ªé˜³' : 
                              weakest === 'earth' ? 'ä½¿ç”¨é»„è‰²ã€æ£•è‰²ç‰©å“ï¼Œåœ¨ä¸­å¤®ä½ç½®æ´»åŠ¨ï¼Œå­£èŠ‚äº¤æ›¿æ—¶å¤šå‡ºé—¨ï¼Œå¤šåƒé»„è‰²é£Ÿç‰©' : 
                              weakest === 'metal' ? 'ä½©æˆ´é‡‘å±é¥°å“ï¼Œåœ¨è¥¿æ–¹ä½ç½®æ´»åŠ¨ï¼Œç§‹å­£å‡ºè¡Œï¼Œä½¿ç”¨ç™½è‰²ç‰©å“ï¼Œä¿æŒç¯å¢ƒæ•´æ´' : 
                              'å¤šå–æ°´ï¼Œåœ¨åŒ—æ–¹ä½ç½®æ´»åŠ¨ï¼Œå†¬å­£å‡ºè¡Œï¼Œä½¿ç”¨è“è‰²æˆ–é»‘è‰²ç‰©å“ï¼Œæ¥è§¦æ°´åŸŸç¯å¢ƒ'}
                        </p>
                    </div>
                </div>
                

            `;
        }

        // è·å–äº”è¡Œå»ºè®®
        function getFiveElementsAdvice(strongest, weakest) {
            const adviceMap = {
                wood: 'å®œä»äº‹ä¸æœ¨ç›¸å…³çš„è¡Œä¸šï¼Œå¦‚æ—ä¸šã€å›­è‰ºã€æ–‡æ•™ç­‰',
                fire: 'å®œä»äº‹ä¸ç«ç›¸å…³çš„è¡Œä¸šï¼Œå¦‚èƒ½æºã€é¤é¥®ã€å¨±ä¹ç­‰',
                earth: 'å®œä»äº‹ä¸åœŸç›¸å…³çš„è¡Œä¸šï¼Œå¦‚æˆ¿åœ°äº§ã€å†œä¸šã€å»ºç­‘ç­‰',
                metal: 'å®œä»äº‹ä¸é‡‘ç›¸å…³çš„è¡Œä¸šï¼Œå¦‚é‡‘èã€æœºæ¢°ã€æ±½è½¦ç­‰',
                water: 'å®œä»äº‹ä¸æ°´ç›¸å…³çš„è¡Œä¸šï¼Œå¦‚èˆªè¿ã€æ°´åˆ©ã€è´¸æ˜“ç­‰'
            };
            
            return `äº”è¡Œ${strongest === 'wood' ? 'æœ¨' : strongest === 'fire' ? 'ç«' : strongest === 'earth' ? 'åœŸ' : strongest === 'metal' ? 'é‡‘' : 'æ°´'}æœ€å¼ºï¼Œ${adviceMap[strongest]}ã€‚éœ€è¦è¡¥å……${weakest === 'wood' ? 'æœ¨' : weakest === 'fire' ? 'ç«' : weakest === 'earth' ? 'åœŸ' : weakest === 'metal' ? 'é‡‘' : 'æ°´'}å…ƒç´ ã€‚`;
        }

        // æ˜¾ç¤ºèº«å¼ºèº«å¼±å›¾è¡¨
        function displayStrengthChart(baziData) {
            console.log('æ˜¾ç¤ºèº«å¼ºèº«å¼±åˆ†æï¼Œæ•°æ®:', baziData.strengthAnalysis);
            
            // ä½¿ç”¨window.combinedInfoè·å–æœ€æ–°çš„åˆåŒ–ä¿¡æ¯
            if (window.combinedInfo) {
                console.log('ä»window.combinedInfoè·å–åˆåŒ–ä¿¡æ¯:', window.combinedInfo);
                baziData.strengthAnalysis.combined = window.combinedInfo;
            } else {
                console.log('åˆåŒ–ä¿¡æ¯:', baziData.strengthAnalysis.combined);
            }
            
            // æ‰“å°å®Œæ•´çš„strengthAnalysiså¯¹è±¡ï¼Œç”¨äºè°ƒè¯•
            console.log('å®Œæ•´çš„strengthAnalysiså¯¹è±¡:', JSON.stringify(baziData.strengthAnalysis, null, 2));
            
            // æ£€æŸ¥å…«å­—ä¸­æ˜¯å¦æœ‰å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€
            const branches = window.allBranches || [];
            console.log('å½“å‰å…«å­—åœ°æ”¯:', branches);
            
            // ç‰¹åˆ«æ£€æŸ¥å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€
            const metalCombo = 'å·³é…‰ä¸‘';
            const metalMatches = [];
            let metalMatchCount = 0;
            
            for (const char of metalCombo) {
                if (branches.includes(char)) {
                    metalMatchCount++;
                    metalMatches.push(char);
                }
            }
            
            console.log(`ç‰¹åˆ«æ£€æŸ¥å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€:`, metalMatches, metalMatchCount);
            
            if (baziData.strengthAnalysis.combined && baziData.strengthAnalysis.combined.sanhe) {
                console.log('ä¸‰åˆå±€è¯¦æƒ…:', baziData.strengthAnalysis.combined.sanhe);
            } else {
                console.log('æ²¡æœ‰æ£€æµ‹åˆ°ä¸‰åˆå±€');
                
                // å¦‚æœç³»ç»Ÿæ²¡æœ‰æ£€æµ‹åˆ°ä¸‰åˆå±€ï¼Œä½†å®é™…ä¸Šæœ‰å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€
                if (metalMatchCount >= 2) {
                    console.log('æ‰‹åŠ¨æ£€æµ‹åˆ°å·³é…‰ä¸‘ä¸‰åˆé‡‘å±€:', metalMatches.join(''));
                    
                    // æ‰‹åŠ¨æ·»åŠ ä¸‰åˆå±€ä¿¡æ¯
                    if (!baziData.strengthAnalysis.combined) {
                        baziData.strengthAnalysis.combined = {};
                    }
                    
                    baziData.strengthAnalysis.combined.sanhe = {
                        type: 'å·³é…‰ä¸‘',
                        element: 'metal',
                        count: metalMatchCount,
                        branches: metalMatches.join(''),
                        isFullSanhe: metalMatchCount === 3
                    };
                    
                    // ç§»é™¤ç‰¹æ®Šå¤„ç†ï¼Œä½¿ç”¨ç»Ÿä¸€effect
                }
            }
            
            const ctx = document.getElementById('strength-chart').getContext('2d');
            const strengthAnalysis = baziData.strengthAnalysis;
            
            if (strengthChart) {
                strengthChart.destroy();
            }
            
            strengthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ç”Ÿæ‰¶åŠ›é‡', 'å…‹æ³„åŠ›é‡'],
                    datasets: [{
                        label: 'åŠ›é‡å¯¹æ¯”',
                        data: [strengthAnalysis.supportStrength, strengthAnalysis.weakenStrength],
                        backgroundColor: [
                            '#27ae60', // ç”Ÿæ‰¶ - ç»¿è‰²
                            '#e74c3c'  // å…‹æ³„ - çº¢è‰²
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                     return `${context.label}: ${context.parsed.y}ç‚¹`;
                                 }
                             }
                         }
                     },
                     scales: {
                         y: {
                             beginAtZero: true,
                             title: {
                                 display: true,
                                 text: 'åŠ›é‡å€¼'
                             }
                         }
                     }
                 }
             });
             
             // æ˜¾ç¤ºèº«å¼ºèº«å¼±åˆ†ææè¿°
             const description = document.getElementById('strength-description');
             
             // æ ¹æ®ä¸åŒç±»å‹è®¾ç½®ä¸åŒçš„å›¾æ ‡å’Œé¢œè‰²
             let typeIcon, typeColor;
             switch(strengthAnalysis.type) {
                 case 'èº«å¼º':
                     typeIcon = 'fa-fire';
                     typeColor = '#e74c3c';
                     break;
                 case 'èº«å¼±':
                     typeIcon = 'fa-snowflake';
                     typeColor = '#3498db';
                     break;
                 case 'å‡è¡¡':
                     typeIcon = 'fa-balance-scale';
                     typeColor = '#f39c12';
                     break;
                 case 'ä»å¼º':
                     typeIcon = 'fa-arrow-up';
                     typeColor = '#9b59b6';
                     break;
                 case 'ä»å¼±':
                     typeIcon = 'fa-arrow-down';
                     typeColor = '#2ecc71';
                     break;
                 default:
                     typeIcon = 'fa-balance-scale';
                     typeColor = '#7f8c8d';
             }
             
             description.innerHTML = `
                 <h4><i class="fas fa-balance-scale"></i> èº«å¼ºèº«å¼±åˆ†æ</h4>
                 <div style="display: flex; align-items: center; margin-bottom: 10px;">
                     <div style="background-color: ${typeColor}; color: white; padding: 5px 10px; border-radius: 5px; margin-right: 10px;">
                         <i class="fas ${typeIcon}"></i> ${strengthAnalysis.type}
                     </div>
                     <div>åŠ›é‡æ¯”ä¾‹: ${(strengthAnalysis.ratio * 100).toFixed(1)}%</div>
                 </div>
                 <p><strong>ç”Ÿæ‰¶åŠ›é‡:</strong> ${strengthAnalysis.supportStrength.toFixed(1)}ç‚¹</p>
                 <p><strong>å…‹æ³„åŠ›é‡:</strong> ${strengthAnalysis.weakenStrength.toFixed(1)}ç‚¹</p>
                 ${strengthAnalysis.monthScore ? `<p><strong>æœˆä»¤å¾—åˆ†:</strong> ${strengthAnalysis.monthScore}ç‚¹</p>` : ''}
                 ${strengthAnalysis.combined && strengthAnalysis.combined.effect ? `<p><strong>åˆåŒ–å½±å“:</strong> ${strengthAnalysis.combined.effect === 'strengthen' ? 'å¢å¼ºæ—¥ä¸»' : 'å‰Šå¼±æ—¥ä¸»'}</p>` : ''}
                 ${strengthAnalysis.combined && strengthAnalysis.combined.deduction ? `<p><strong>åˆåŒ–æ‰£åˆ†:</strong> <span style="color: #e74c3c; font-weight: bold;">${strengthAnalysis.combined.deduction}ç‚¹</span></p>` : ''}
                 <div class="hehua-info">
                 ${strengthAnalysis.combined && (strengthAnalysis.combined.tianGanWuHe.length > 0 || strengthAnalysis.combined.diZhiLiuHe.length > 0 || strengthAnalysis.combined.diZhiSanHe.length > 0) ? 
                    `<div style="background-color: #e8f4fc; padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid #3498db; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h5 style="color: #3498db; margin-top: 0; font-size: 16px;"><i class="fas fa-link"></i> åˆåŒ–ä¿¡æ¯</h5>
                        ${strengthAnalysis.combined.tianGanWuHe.length > 0 ? 
                            `<div style="margin-bottom: 10px;">
                                <p><strong>å¤©å¹²äº”åˆ:</strong> ${strengthAnalysis.combined.tianGanWuHe.map(h => `${h.gan1}${h.gan2}åˆ${h.element === 'wood' ? 'æœ¨' : h.element === 'fire' ? 'ç«' : h.element === 'earth' ? 'åœŸ' : h.element === 'metal' ? 'é‡‘' : 'æ°´'}`).join('ã€')}</p>
                            </div>` : ''}
                        ${strengthAnalysis.combined.diZhiLiuHe.length > 0 ? 
                            `<div style="margin-bottom: 10px;">
                                <p><strong>åœ°æ”¯å…­åˆ:</strong> ${strengthAnalysis.combined.diZhiLiuHe.map(h => `${h.zhi1}${h.zhi2}åˆ${h.element === 'wood' ? 'æœ¨' : h.element === 'fire' ? 'ç«' : h.element === 'earth' ? 'åœŸ' : h.element === 'metal' ? 'é‡‘' : 'æ°´'}`).join('ã€')}</p>
                            </div>` : ''}
                        ${strengthAnalysis.combined.diZhiSanHe.length > 0 ? 
                            `<div style="margin-bottom: 10px;">
                                <p><strong>åœ°æ”¯ä¸‰åˆ:</strong> ${strengthAnalysis.combined.diZhiSanHe.map(h => `${h.type}ä¸‰åˆ${h.element === 'wood' ? 'æœ¨' : h.element === 'fire' ? 'ç«' : h.element === 'earth' ? 'åœŸ' : h.element === 'metal' ? 'é‡‘' : 'æ°´'}(${h.count === 3 ? 'å…¨ä¸‰åˆ' : 'åŠä¸‰åˆ'})`).join('ã€')}</p>
                            </div>` : ''}
                        <p><strong>å¯¹æ—¥ä¸»å½±å“:</strong> <span style="color: ${strengthAnalysis.combined.effect === 'strengthen' ? '#27ae60' : strengthAnalysis.combined.effect === 'weaken' ? '#e74c3c' : '#7f8c8d'}; font-weight: bold;">${strengthAnalysis.combined.effect === 'strengthen' ? 'å¢å¼ºæ—¥ä¸»' : strengthAnalysis.combined.effect === 'weaken' ? 'å‰Šå¼±æ—¥ä¸»' : 'å½±å“ä¸­æ€§'}</span></p>
                        ${strengthAnalysis.combined.deduction ? `<p><strong>åŠ›é‡æ‰£å‡:</strong> <span style="color: #e74c3c; font-weight: bold;">${strengthAnalysis.combined.deduction}ç‚¹</span> (åˆåŒ–å½±å“)</p>` : ''}
                    </div>` : `<div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px dashed #ccc;">
                        <p style="color: #7f8c8d; margin: 0;"><i class="fas fa-info-circle"></i> æœªæ£€æµ‹åˆ°åˆåŒ–</p>
                    </div>`}
                 </div>
                 <p><strong>åˆ†æè¯´æ˜:</strong> ${strengthAnalysis.description}</p>
             `;
             
             // è°ƒæ•´å›¾è¡¨å®¹å™¨å’Œæè¿°å®¹å™¨çš„æ ·å¼ï¼Œç¡®ä¿å·¦å³å¹¶æ’æ˜¾ç¤º
             const strengthAnalysisFrame = document.querySelector('.strength-analysis-frame');
             const chartContainer = document.querySelector('.chart-container');
             const descriptionContainer = document.getElementById('strength-description');
             
             if (strengthAnalysisFrame && chartContainer && descriptionContainer) {
                 // ç¡®ä¿å·¦å³å¹¶æ’æ˜¾ç¤º
                 strengthAnalysisFrame.style.display = 'flex';
                 strengthAnalysisFrame.style.flexDirection = 'row';
                 strengthAnalysisFrame.style.gap = '20px';
                 strengthAnalysisFrame.style.flexWrap = 'wrap';
                 
                 // è®¾ç½®å›¾è¡¨å®¹å™¨æ ·å¼
                 chartContainer.style.flex = '1';
                 chartContainer.style.minWidth = '300px';
                 chartContainer.style.minHeight = '350px';
                 chartContainer.style.backgroundColor = '#ffffff';
                 chartContainer.style.padding = '15px';
                 chartContainer.style.borderRadius = '8px';
                 chartContainer.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                 
                 // è®¾ç½®æè¿°å®¹å™¨æ ·å¼
                 descriptionContainer.style.flex = '1';
                 descriptionContainer.style.minWidth = '300px';
                 descriptionContainer.style.padding = '15px';
                 descriptionContainer.style.backgroundColor = '#f9f9f9';
                 descriptionContainer.style.borderRadius = '8px';
                 descriptionContainer.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
             }
         }

         // æ˜¾ç¤ºèµ·è¿æ—¶é—´
         function displayLuckTiming(baziData) {
             const luckTiming = document.getElementById('luck-timing');
             const timing = baziData.luckTiming;
             
             luckTiming.innerHTML = `
                 <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                     <div class="analysis-card">
                         <h4><i class="fas fa-clock"></i> èµ·è¿å¹´é¾„</h4>
                         <p style="font-size: 2rem; font-weight: bold; color: var(--secondary-color); margin: 10px 0;">
                             ${timing.age}å²${timing.months}ä¸ªæœˆ
                         </p>
                         <p style="color: var(--primary-color); font-weight: 600;">${timing.description}</p>
                         <div style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                             <p><strong>æ’åˆ—æ–¹å¼ï¼š</strong>${timing.direction}</p>
                             <p><strong>èŠ‚æ°”å¤©æ•°ï¼š</strong>${timing.daysDiff}å¤©</p>
                         </div>
                     </div>
                     <div class="analysis-card">
                         <h4><i class="fas fa-info-circle"></i> èµ·è¿è¯´æ˜</h4>
                         <p>èµ·è¿æ—¶é—´æ˜¯å‘½ç†å­¦ä¸­çš„é‡è¦æ¦‚å¿µï¼Œæ ‡å¿—ç€äººç”Ÿè¿åŠ¿çš„æ­£å¼å¼€å§‹ã€‚</p>
                         <p>è®¡ç®—æ–¹æ³•ï¼šæ ¹æ®å¹´æŸ±å¤©å¹²é˜´é˜³å’Œæ€§åˆ«ç¡®å®šé¡ºæ’æˆ–é€†æ’ï¼Œç„¶åè®¡ç®—å‡ºç”Ÿæ—¥åˆ°æœ€è¿‘èŠ‚æ°”çš„å¤©æ•°ï¼Œ3å¤©æŠ˜åˆ1å²ã€‚</p>
                         <p>åœ¨èµ·è¿ä¹‹å‰ï¼Œä¸»è¦å—çˆ¶æ¯å’Œå®¶åº­ç¯å¢ƒå½±å“ï¼›èµ·è¿ä¹‹åï¼Œä¸ªäººè¿åŠ¿å¼€å§‹å‘æŒ¥ä¸»å¯¼ä½œç”¨ã€‚</p>
                     </div>
                 </div>
             `;
         }

         // æ˜¾ç¤ºå‘½æ ¼ç­‰çº§
         function displayFateLevel(baziData) {
             const fateLevelContent = document.getElementById('fate-level-content');
             const fateLevel = baziData.fateLevel;
             
             fateLevelContent.innerHTML = `
                 <div style="text-align: center; margin-bottom: 10px;">
                     <div style="font-size: 2.5rem; font-weight: bold; color: var(--gold-color); margin-bottom: 5px;">
                         ${fateLevel.score}åˆ†
                     </div>
                     <div style="font-size: 1.3rem; font-weight: 600; color: var(--primary-color); margin-bottom: 5px;">
                         ${fateLevel.level}
                     </div>
                     <div style="color: var(--text-secondary); font-size: 0.95rem;">
                         ${fateLevel.description}
                     </div>
                 </div>
                 <div style="background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05)); backdrop-filter: blur(10px); padding: 15px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2); margin-top: 10px;">
                     <div style="display: flex; align-items: center; margin-bottom: 10px;">
                         <div style="width: 4px; height: 20px; background: linear-gradient(to bottom, var(--primary-color), var(--gold-color)); border-radius: 2px; margin-right: 8px;"></div>
                         <h5 style="color: var(--primary-color); font-weight: 700; margin: 0; font-size: 1.1rem;">å‘½æ ¼åˆ†æè¯´æ˜</h5>
                     </div>
                     
                     <div style="background: rgba(255,255,255,0.08); border-radius: 8px; padding: 10px; margin-bottom: 10px; border-left: 3px solid var(--primary-color);">
                         <p style="margin: 0; color: var(--text-color); font-size: 0.9rem; line-height: 1.4;">æ‚¨çš„å‘½æ ¼è¯„åˆ†ç»¼åˆäº†äº”ä¸ªå…³é”®ç»´åº¦ï¼Œå…¨é¢åæ˜ äº†æ‚¨çš„å…ˆå¤©å‘½å±€ç‰¹è´¨ä¸æ½œèƒ½ã€‚</p>
                     </div>
                     
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                         <div style="background: rgba(var(--primary-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--primary-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--primary-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--primary-color); font-weight: 600; font-size: 0.8rem;">01</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">æ—¥ä¸»çŠ¶æ€</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">è¯„ä¼°æ‚¨çš„æ—¥ä¸»æ˜¯å¦å¤„äºæœ‰åˆ©å­£èŠ‚ï¼Œè¿™å†³å®šäº†æ‚¨å…ˆå¤©èƒ½é‡çš„å¼ºå¼±å’ŒåŸºç¡€è¿åŠ¿ã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--primary-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--primary-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--primary-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--primary-color); font-weight: 600; font-size: 0.8rem;">02</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">äº”è¡Œåè°ƒ</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">åæ˜ æ‚¨å‘½ç›˜ä¸­äº”è¡Œèƒ½é‡çš„å¹³è¡¡ç¨‹åº¦ï¼Œè¶Šåè°ƒè¡¨ç¤ºæ€§æ ¼è¶Šå…¨é¢ï¼Œé€‚åº”èƒ½åŠ›è¶Šå¼ºã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--primary-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--primary-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--primary-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--primary-color); font-weight: 600; font-size: 0.8rem;">03</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">å‘½å±€æ ¼å±€</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">åˆ†ææ‚¨å…«å­—ä¸­æ˜¯å¦å­˜åœ¨ç‰¹æ®Šæ ¼å±€ï¼Œè¿™äº›æ ¼å±€å¾€å¾€é¢„ç¤ºç€ç‰¹æ®Šçš„äººç”Ÿé™…é‡å’Œæ‰èƒ½ã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--primary-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--primary-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--primary-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--primary-color); font-weight: 600; font-size: 0.8rem;">04</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">åç¥å½±å“</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">ä½“ç°æ‚¨å‘½ç›˜ä¸­å„ç§äººé™…å…³ç³»å’Œå¤–éƒ¨ç¯å¢ƒå¯¹æ‚¨çš„å½±å“åŠ›å’Œç›¸äº’ä½œç”¨ã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--primary-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--primary-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--primary-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--primary-color); font-weight: 600; font-size: 0.8rem;">05</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">åœ°æ”¯å…³ç³»</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">è¯„ä¼°æ‚¨å‘½ç›˜ä¸­åœ°æ”¯ä¹‹é—´çš„ç›¸äº’ä½œç”¨ï¼Œè¿™å½±å“ç€æ‚¨çš„äººç”Ÿæœºé‡å’Œè´µäººç›¸åŠ©çš„å¯èƒ½æ€§ã€‚</p>
                         </div>
                     </div>
                 </div>
             `;
         }

         // æ˜¾ç¤ºè´¢å¯Œç­‰çº§
         function displayWealthLevel(baziData) {
             const wealthLevelContent = document.getElementById('wealth-level-content');
             const wealthLevel = baziData.wealthLevel;
             
             wealthLevelContent.innerHTML = `
                 <div style="text-align: center; margin-bottom: 10px;">
                     <div style="font-size: 2.5rem; font-weight: bold; color: var(--success-color); margin-bottom: 5px;">
                         ${wealthLevel.score}åˆ†
                     </div>
                     <div style="font-size: 1.3rem; font-weight: 600; color: var(--primary-color); margin-bottom: 5px;">
                         ${wealthLevel.level}
                     </div>
                     <div style="color: var(--text-secondary); font-size: 0.95rem;">
                         ${wealthLevel.description}
                     </div>
                 </div>
                 <div style="background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05)); backdrop-filter: blur(10px); padding: 15px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2); margin-top: 10px;">
                     <div style="display: flex; align-items: center; margin-bottom: 10px;">
                         <div style="width: 4px; height: 20px; background: linear-gradient(to bottom, var(--primary-color), var(--success-color)); border-radius: 2px; margin-right: 8px;"></div>
                         <h5 style="color: var(--primary-color); font-weight: 700; margin: 0; font-size: 1.1rem;">è´¢å¯Œåˆ†æè¯´æ˜</h5>
                     </div>
                     
                     <div style="background: rgba(255,255,255,0.08); border-radius: 8px; padding: 10px; margin-bottom: 10px; border-left: 3px solid var(--success-color);">
                         <p style="margin: 0; color: var(--text-color); font-size: 0.9rem; line-height: 1.4;">æ‚¨çš„è´¢å¯Œè¯„åˆ†ç»¼åˆäº†äº”ä¸ªå…³é”®ç»´åº¦ï¼Œå…¨é¢åæ˜ äº†æ‚¨çš„è´¢å¯Œè·å–èƒ½åŠ›ä¸æ½œåœ¨æœºä¼šã€‚</p>
                     </div>
                     
                     <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                         <div style="background: rgba(var(--success-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--success-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--success-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--success-color); font-weight: 600; font-size: 0.8rem;">01</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--success-color); font-weight: 600; font-size: 0.9rem;">è´¢å¯Œæ½œåŠ›</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">è¯„ä¼°æ‚¨å‘½ç›˜ä¸­è´¢å¯Œæ˜Ÿçš„æ•°é‡å’Œå¼ºåº¦ï¼Œè¿™å†³å®šäº†æ‚¨è·å–è´¢å¯Œçš„åŸºæœ¬æ½œåŠ›å’Œèƒ½åŠ›ã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--success-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--success-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--success-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--success-color); font-weight: 600; font-size: 0.8rem;">02</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--success-color); font-weight: 600; font-size: 0.9rem;">è´¢å¯Œæ—¶æœº</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">åˆ†æè´¢å¯Œæ˜Ÿåœ¨å‘½ç›˜ä¸­çš„ä½ç½®ï¼Œè¿™å½±å“æ‚¨åœ¨ä¸åŒäººç”Ÿé˜¶æ®µçš„è´¢è¿å¼ºå¼±å’Œè´¢å¯Œç§¯ç´¯æ—¶æœºã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--success-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--success-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--success-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--success-color); font-weight: 600; font-size: 0.8rem;">03</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--success-color); font-weight: 600; font-size: 0.9rem;">è´¢å¯Œé˜»ç¢</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">è¯„ä¼°å‘½ç›˜ä¸­å¯¹è´¢è¿äº§ç”Ÿä¸åˆ©å½±å“çš„å› ç´ ï¼Œè¿™å¯èƒ½å¯¼è‡´è´¢å¯Œæµå¤±æˆ–ç§¯ç´¯å›°éš¾çš„æƒ…å†µã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--success-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--success-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--success-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--success-color); font-weight: 600; font-size: 0.8rem;">04</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--success-color); font-weight: 600; font-size: 0.9rem;">è´¢å¯ŒåŠ©åŠ›</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">åˆ†æå‘½ç›˜ä¸­æœ‰åŠ©äºè´¢å¯Œç§¯ç´¯çš„å› ç´ ï¼Œè¿™äº›å› ç´ èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°æŠŠæ¡è´¢å¯Œæœºä¼šå’Œå¢å¼ºè´¢è¿ã€‚</p>
                         </div>
                         
                         <div style="background: rgba(var(--success-rgb), 0.05); border-radius: 8px; padding: 10px; transition: all 0.3s ease; border: 1px solid rgba(var(--success-rgb), 0.1);">
                             <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                 <div style="width: 24px; height: 24px; border-radius: 50%; background: rgba(var(--success-rgb), 0.15); display: flex; justify-content: center; align-items: center; margin-right: 8px;">
                                     <span style="color: var(--success-color); font-weight: 600; font-size: 0.8rem;">05</span>
                                 </div>
                                 <h6 style="margin: 0; color: var(--success-color); font-weight: 600; font-size: 0.9rem;">è¿åŠ¿å½±å“</h6>
                             </div>
                             <p style="margin: 0; color: var(--text-color); line-height: 1.4; padding-left: 32px; font-size: 0.85rem;">è€ƒè™‘å½“å‰å¤§è¿å’Œæµå¹´å¯¹æ‚¨è´¢è¿çš„å½±å“ï¼Œè¿™å†³å®šäº†è¿‘æœŸè´¢å¯Œæœºä¼šçš„å¤šå°‘å’Œè´¢è¿çš„å¼ºå¼±ã€‚</p>
                         </div>
                     </div>
                 </div>
             `;
         }

         // è·å–åˆ†æå†…å®¹ï¼ˆå¤‡ç”¨å†…å®¹ï¼Œå½“APIè°ƒç”¨å¤±è´¥æ—¶ä½¿ç”¨ï¼‰
         function getAnalysisContent(analysisType) {
             const analysisData = {
                 'full-analysis': {
                     title: 'å‘½ç†å…¨è§£',
                     content: `
                         <h4>å…«å­—å‘½ç†å…¨é¢è§£æ</h4>
                         <div style="padding: 15px; margin-bottom: 15px; background: #f0f8ff; border-left: 4px solid #3498db; border-radius: 8px;">
                             <h5><i class="fas fa-user"></i> æ€§æ ¼ç‰¹è´¨</h5>
                             <p>æ€§æ ¼æ¸©å’Œç¨³é‡ï¼Œåšäº‹è®¤çœŸè´Ÿè´£ï¼Œå…·æœ‰è¾ƒå¼ºçš„è´£ä»»æ„Ÿå’Œä½¿å‘½æ„Ÿã€‚æ€ç»´ç¼œå¯†ï¼Œå–„äºåˆ†æé—®é¢˜ï¼Œä½†æœ‰æ—¶è¿‡äºè¿½æ±‚å®Œç¾ã€‚</p>
                         </div>
                         <div style="padding: 15px; margin-bottom: 15px; background: #fff5eb; border-left: 4px solid #e67e22; border-radius: 8px;">
                             <h5><i class="fas fa-briefcase"></i> äº‹ä¸šå‘å±•</h5>
                             <p>é€‚åˆä»äº‹éœ€è¦è€å¿ƒå’Œç»†è‡´çš„å·¥ä½œï¼Œå¦‚æ•™è‚²ã€åŒ»ç–—ã€é‡‘èç­‰é¢†åŸŸã€‚èŒä¸šç”Ÿæ¶¯ä¸­æœŸå°†è¿æ¥é‡è¦è½¬æŠ˜ç‚¹ï¼Œæœ‰æœ›è·å¾—æ™‹å‡æˆ–åˆ›ä¸šæœºä¼šã€‚</p>
                         </div>
                         <div style="padding: 15px; margin-bottom: 15px; background: #f9f9f9; border-left: 4px solid #f1c40f; border-radius: 8px;">
                             <h5><i class="fas fa-coins"></i> è´¢å¯Œè¿åŠ¿</h5>
                             <p>è´¢è¿ç¨³å¥ï¼Œæ”¶å…¥æ¥æºä¸»è¦ä¸ºå·¥ä½œè–ªèµ„ï¼Œä¸­å¹´åæœ‰æœºä¼šè·å¾—é¢å¤–è´¢å¯Œã€‚æŠ•èµ„æ–¹é¢å®œç¨³å¥ä¸ºä¸»ï¼Œé¿å…é«˜é£é™©æŠ•æœºã€‚</p>
                         </div>
                         <div style="padding: 15px; margin-bottom: 15px; background: #ffebee; border-left: 4px solid #e74c3c; border-radius: 8px;">
                             <h5><i class="fas fa-heart"></i> æ„Ÿæƒ…å©šå§»</h5>
                             <p>æ„Ÿæƒ…ç”Ÿæ´»è¾ƒä¸ºç¨³å®šï¼Œå©šåå®¶åº­å’Œç¦ã€‚ä¸ä¼´ä¾£ç›¸å¤„éœ€æ³¨é‡æ²Ÿé€šï¼Œé¿å…å› å·¥ä½œå¿™ç¢Œè€Œå¿½ç•¥å®¶åº­ã€‚</p>
                         </div>
                         <div style="padding: 15px; margin-bottom: 15px; background: #e8f5e9; border-left: 4px solid #27ae60; border-radius: 8px;">
                             <h5><i class="fas fa-heartbeat"></i> å¥åº·çŠ¶å†µ</h5>
                             <p>ä½“è´¨ä¸­ç­‰ï¼Œéœ€è¦æ³¨æ„æ¶ˆåŒ–ç³»ç»Ÿå’Œå‘¼å¸ç³»ç»Ÿçš„ä¿å…»ã€‚å»ºè®®ä¿æŒè§„å¾‹ä½œæ¯ï¼Œé€‚å½“è¿åŠ¨ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚</p>
                         </div>
                         <div style="padding: 15px; background: #e3f2fd; border-left: 4px solid #3498db; border-radius: 8px;">
                             <h5><i class="fas fa-star"></i> äººç”Ÿå»ºè®®</h5>
                             <p>1. äº‹ä¸šä¸Šä¿æŒç¨³å¥å‘å±•ï¼ŒåŒæ—¶ä¸è¦é”™è¿‡å…³é”®æœºé‡</p>
                             <p>2. è´¢åŠ¡ç®¡ç†æ³¨é‡é•¿æœŸè§„åˆ’ï¼Œå»ºç«‹å¤šå…ƒåŒ–æ”¶å…¥</p>
                             <p>3. æ„Ÿæƒ…ä¸Šå¢åŠ æ²Ÿé€šï¼Œå¹³è¡¡å·¥ä½œä¸å®¶åº­</p>
                             <p>4. å¥åº·æ–¹é¢å®šæœŸä½“æ£€ï¼Œä¿æŒè‰¯å¥½ç”Ÿæ´»ä¹ æƒ¯</p>
                         </div>
                     `
                 },
                 'annual-fortune': {
                     title: 'æµå¹´åˆ†æ',
                     content: `
                         <h4>å½“å‰æµå¹´è¿åŠ¿åˆ†æ</h4>
                         <p><strong>æ•´ä½“è¿åŠ¿ï¼š</strong>ä»Šå¹´è¿åŠ¿è¾ƒä¸ºå¹³ç¨³ï¼Œæœ‰å°å¹…ä¸Šå‡è¶‹åŠ¿ã€‚ç”²æœ¨é‡è¾°åœŸï¼Œéœ€è¦æ³¨æ„è„¾èƒƒå¥åº·ã€‚</p>
                         <p><strong>äº‹ä¸šè¿ï¼š</strong>å·¥ä½œä¸Šä¼šæœ‰æ–°çš„æœºé‡å‡ºç°ï¼Œä½†éœ€è¦è°¨æ…æŠŠæ¡ï¼Œä¸å®œå†’è¿›ã€‚</p>
                         <p><strong>è´¢è¿ï¼š</strong>è´¢è¿ä¸­ç­‰ï¼Œæ­£è´¢ç¨³å®šï¼Œåè´¢éœ€è°¨æ…ã€‚</p>
                         <p><strong>æ„Ÿæƒ…è¿ï¼š</strong>æ„Ÿæƒ…è¿åŠ¿å¹³ç¨³ï¼Œå·²å©šè€…å¤«å¦»å’Œç¦ï¼Œå•èº«è€…æœ‰æœºä¼šé‡åˆ°åˆé€‚å¯¹è±¡ã€‚</p>
                         <p><strong>å¥åº·è¿ï¼š</strong>æ³¨æ„æ¶ˆåŒ–ç³»ç»Ÿå¥åº·ï¼Œé€‚å½“è¿åŠ¨ï¼Œä¿æŒè‰¯å¥½ä½œæ¯ã€‚</p>
                     `
                 },
                 'monthly-fortune': {
                     title: 'æµæœˆåˆ†æ',
                     content: `
                         <h4>å½“å‰å¹´ä»½å„æœˆè¿åŠ¿é¢„æµ‹</h4>
                         <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                             <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                 <h5>æ˜¥å­£ï¼ˆ1-3æœˆï¼‰</h5>
                                 <p>è¿åŠ¿å›å‡ï¼Œé€‚åˆå¼€å±•æ–°é¡¹ç›®</p>
                             </div>
                             <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                 <h5>å¤å­£ï¼ˆ4-6æœˆï¼‰</h5>
                                 <p>è¿åŠ¿æ—ºç››ï¼Œäº‹ä¸šè´¢è¿åŒä¸°æ”¶</p>
                             </div>
                             <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                 <h5>ç§‹å­£ï¼ˆ7-9æœˆï¼‰</h5>
                                 <p>è¿åŠ¿å¹³ç¨³ï¼Œéœ€è¦ç¨³æ‰ç¨³æ‰“</p>
                             </div>
                             <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                 <h5>å†¬å­£ï¼ˆ10-12æœˆï¼‰</h5>
                                 <p>è¿åŠ¿ç•¥æœ‰ä¸‹æ»‘ï¼Œå®œä¿å®ˆè¡Œäº‹</p>
                             </div>
                         </div>
                     `
                 },
                 'decade-fortune': {
                     title: 'åå¹´å¤§è¿åˆ†æ',
                     content: `
                         <h4>äººç”Ÿå„é˜¶æ®µå¤§è¿èµ°åŠ¿</h4>
                         <div style="margin-top: 15px;">
                             <div style="padding: 15px; margin-bottom: 15px; background: #e8f5e8; border-left: 4px solid #27ae60; border-radius: 8px;">
                                 <h5>é’å¹´æœŸï¼ˆ20-30å²ï¼‰</h5>
                                 <p>å­¦ä¸šè¿ä½³ï¼Œé€‚åˆæ·±é€ å’ŒæŠ€èƒ½æå‡ã€‚äº‹ä¸šèµ·æ­¥é˜¶æ®µï¼Œéœ€è¦ç§¯ç´¯ç»éªŒã€‚</p>
                             </div>
                             <div style="padding: 15px; margin-bottom: 15px; background: #fff3cd; border-left: 4px solid #f39c12; border-radius: 8px;">
                                 <h5>å£®å¹´æœŸï¼ˆ30-40å²ï¼‰</h5>
                                 <p>äº‹ä¸šå‘å±•çš„é»„é‡‘æœŸï¼Œè´¢è¿é€æ¸å¥½è½¬ï¼Œé€‚åˆåˆ›ä¸šæˆ–æŠ•èµ„ã€‚</p>
                             </div>
                             <div style="padding: 15px; margin-bottom: 15px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 8px;">
                                 <h5>ä¸­å¹´æœŸï¼ˆ40-50å²ï¼‰</h5>
                                 <p>è¿åŠ¿è¾¾åˆ°é¡¶å³°ï¼Œäº‹ä¸šæœ‰æˆï¼Œè´¢å¯Œç§¯ç´¯ä¸°åšï¼Œå®¶åº­å’Œç¦ã€‚</p>
                             </div>
                             <div style="padding: 15px; background: #cce5ff; border-left: 4px solid #007bff; border-radius: 8px;">
                                 <h5>æ™šå¹´æœŸï¼ˆ50å²ä»¥åï¼‰</h5>
                                 <p>è¿åŠ¿å¹³ç¨³ï¼Œäº«å—äººç”Ÿï¼Œæ³¨é‡å¥åº·å…»ç”Ÿï¼Œå­å¥³å­é¡ºã€‚</p>
                             </div>
                         </div>
                     `
                 },
                 'personality': {
                     title: 'æ€§æ ¼åˆ†æ',
                     content: `
                         <h4>æ€§æ ¼ç‰¹å¾åˆ†æ</h4>
                         <p><strong>æ ¸å¿ƒæ€§æ ¼ï¼š</strong>æ€§æ ¼æ¸©å’Œï¼Œå¾…äººçœŸè¯šï¼Œæœ‰è´£ä»»å¿ƒï¼Œåšäº‹è®¤çœŸè´Ÿè´£ã€‚</p>
                         <p><strong>ä¼˜ç‚¹ï¼š</strong></p>
                         <ul>
                             <li>å–„è‰¯æ­£ç›´ï¼Œå“å¾·é«˜å°š</li>
                             <li>å‹¤å¥‹åŠªåŠ›ï¼Œä¸æ€•åƒè‹¦</li>
                             <li>æœ‰è€å¿ƒï¼Œèƒ½å¤ŸåšæŒ</li>
                             <li>é‡è§†å®¶åº­ï¼Œå­é¡ºçˆ¶æ¯</li>
                         </ul>
                         <p><strong>éœ€è¦æ”¹è¿›ï¼š</strong></p>
                         <ul>
                             <li>æœ‰æ—¶è¿‡äºä¿å®ˆï¼Œç¼ºä¹å†’é™©ç²¾ç¥</li>
                             <li>å®¹æ˜“çŠ¹è±«ä¸å†³ï¼Œé”™å¤±æœºä¼š</li>
                             <li>å¯¹è‡ªå·±è¦æ±‚è¿‡é«˜ï¼Œå‹åŠ›è¾ƒå¤§</li>
                         </ul>
                         <p><strong>å»ºè®®ï¼š</strong>é€‚å½“å¢å¼ºè‡ªä¿¡å¿ƒï¼Œå‹‡äºå°è¯•æ–°äº‹ç‰©ï¼Œå­¦ä¼šé€‚åº¦æ”¾æ¾ã€‚</p>
                     `
                 },
                 'career': {
                     title: 'äº‹ä¸šè´¢å¯Œåˆ†æ',
                     content: `
                         <h4>äº‹ä¸šå‘å±•æ–¹å‘</h4>
                         <p><strong>é€‚åˆè¡Œä¸šï¼š</strong>æ•™è‚²ã€æ–‡åŒ–ã€åŒ»ç–—ã€æœåŠ¡ä¸šã€å…¬åŠ¡å‘˜ç­‰ç¨³å®šæ€§è¡Œä¸šã€‚</p>
                         <p><strong>èŒä¸šç‰¹è´¨ï¼š</strong>é€‚åˆéœ€è¦è€å¿ƒå’Œè´£ä»»å¿ƒçš„å·¥ä½œï¼Œä¸é€‚åˆé«˜é£é™©é«˜å‹åŠ›çš„è¡Œä¸šã€‚</p>
                         <p><strong>è´¢å¯Œæ ¼å±€ï¼š</strong></p>
                         <ul>
                             <li>æ­£è´¢è¿è¾ƒå¥½ï¼Œé€‚åˆç¨³å®šæ”¶å…¥çš„å·¥ä½œ</li>
                             <li>åè´¢è¿ä¸€èˆ¬ï¼Œä¸å®œæŠ•æœºå–å·§</li>
                             <li>ç†è´¢èƒ½åŠ›å¼ºï¼Œå–„äºç§¯ç´¯è´¢å¯Œ</li>
                             <li>æ™šå¹´è´¢è¿æ›´ä½³ï¼Œè¶Šè€è¶Šå¯Œ</li>
                         </ul>
                         <p><strong>æŠ•èµ„å»ºè®®ï¼š</strong>é€‰æ‹©ç¨³å¥çš„æŠ•èµ„æ–¹å¼ï¼Œå¦‚å®šæœŸå­˜æ¬¾ã€å›½å€ºã€è“ç­¹è‚¡ç­‰ã€‚</p>
                     `
                 },
                 'marriage': {
                     title: 'å©šå§»åˆ†æ',
                     content: `
                         <h4>å©šå§»æ„Ÿæƒ…åˆ†æ</h4>
                         <p><strong>å©šå§»è¿åŠ¿ï¼š</strong>å©šå§»è¿åŠ¿è¾ƒå¥½ï¼Œèƒ½å¤Ÿæ‰¾åˆ°åˆé€‚çš„ä¼´ä¾£ï¼Œå©šåç”Ÿæ´»å’Œç¦ã€‚</p>
                         <p><strong>é…å¶ç‰¹å¾ï¼š</strong></p>
                         <ul>
                             <li>æ€§æ ¼æ¸©å’Œï¼Œå–„è§£äººæ„</li>
                             <li>æœ‰ä¸€å®šçš„ç»æµåŸºç¡€</li>
                             <li>é‡è§†å®¶åº­ï¼Œé¡¾å®¶</li>
                             <li>å¯èƒ½ä»äº‹ç¨³å®šçš„èŒä¸š</li>
                         </ul>
                         <p><strong>æœ€ä½³ç»“å©šå¹´é¾„ï¼š</strong>25-30å²ä¹‹é—´ï¼Œæ­¤æ—¶è¿åŠ¿è¾ƒå¥½ï¼Œå®¹æ˜“é‡åˆ°åˆé€‚å¯¹è±¡ã€‚</p>
                         <p><strong>å©šå§»å»ºè®®ï¼š</strong>ä¿æŒæ²Ÿé€šï¼Œç›¸äº’ç†è§£ï¼Œå…±åŒç»è¥å®¶åº­ï¼Œé¿å…å› å°äº‹äº‰åµã€‚</p>
                     `
                 },
                 'children': {
                     title: 'å­å¥³åˆ†æ',
                     content: `
                         <h4>å­å¥³ç¼˜åˆ†åˆ†æ</h4>
                         <p><strong>å­å¥³è¿ï¼š</strong>å­å¥³è¿è¾ƒå¥½ï¼Œèƒ½å¤Ÿæ‹¥æœ‰å¥åº·èªæ˜çš„å­©å­ã€‚</p>
                         <p><strong>å­å¥³ç‰¹å¾ï¼š</strong></p>
                         <ul>
                             <li>èªæ˜ä¼¶ä¿ï¼Œå­¦ä¹ èƒ½åŠ›å¼º</li>
                             <li>æ€§æ ¼æ´»æ³¼ï¼Œå¯Œæœ‰åˆ›é€ åŠ›</li>
                             <li>å­é¡ºæ‡‚äº‹ï¼Œä¸çˆ¶æ¯å…³ç³»èæ´½</li>
                             <li>æœªæ¥å‘å±•å‰æ™¯è‰¯å¥½</li>
                         </ul>
                         <p><strong>æ•™è‚²å»ºè®®ï¼š</strong></p>
                         <ul>
                             <li>æ³¨é‡å“å¾·æ•™è‚²ï¼ŒåŸ¹å…»æ­£ç¡®ä»·å€¼è§‚</li>
                             <li>å‘æ˜å­©å­çš„å…´è¶£çˆ±å¥½ï¼Œå› ææ–½æ•™</li>
                             <li>ç»™äºˆé€‚å½“çš„è‡ªç”±ç©ºé—´ï¼ŒåŸ¹å…»ç‹¬ç«‹æ€§</li>
                             <li>ä¿æŒè‰¯å¥½çš„äº²å­æ²Ÿé€š</li>
                         </ul>
                     `
                 },
                 'health': {
                     title: 'å¥åº·åˆ†æ',
                     content: `
                         <h4>å¥åº·çŠ¶å†µåˆ†æ</h4>
                         <p><strong>æ•´ä½“å¥åº·ï¼š</strong>ä½“è´¨è¾ƒå¥½ï¼Œä½†éœ€è¦æ³¨æ„æŸäº›æ–¹é¢çš„ä¿å…»ã€‚</p>
                         <p><strong>éœ€è¦å…³æ³¨çš„å¥åº·é—®é¢˜ï¼š</strong></p>
                         <ul>
                             <li>æ¶ˆåŒ–ç³»ç»Ÿï¼šæ³¨æ„é¥®é£Ÿè§„å¾‹ï¼Œé¿å…æš´é¥®æš´é£Ÿ</li>
                             <li>å¿ƒè¡€ç®¡ï¼šé€‚å½“è¿åŠ¨ï¼Œæ§åˆ¶æƒ…ç»ªæ³¢åŠ¨</li>
                             <li>å‘¼å¸ç³»ç»Ÿï¼šé¿å…å¸çƒŸï¼Œæ³¨æ„ç©ºæ°”è´¨é‡</li>
                             <li>ç²¾ç¥çŠ¶æ€ï¼šå­¦ä¼šæ”¾æ¾ï¼Œé¿å…è¿‡åº¦å‹åŠ›</li>
                         </ul>
                         <p><strong>å…»ç”Ÿå»ºè®®ï¼š</strong></p>
                         <ul>
                             <li>ä¿æŒè§„å¾‹ä½œæ¯ï¼Œæ—©ç¡æ—©èµ·</li>
                             <li>é€‚å½“è¿åŠ¨ï¼Œå¦‚æ•£æ­¥ã€å¤ªæç­‰</li>
                             <li>é¥®é£Ÿæ¸…æ·¡ï¼Œå¤šåƒè”¬èœæ°´æœ</li>
                             <li>å®šæœŸä½“æ£€ï¼Œé¢„é˜²ç–¾ç—…</li>
                         </ul>
                     `
                 }
             };
             
             return analysisData[analysisType]?.content || '<p>åˆ†æå†…å®¹æ­£åœ¨ç”Ÿæˆä¸­...</p>';
         }
         
         // Markdownå†…å®¹æ ¼å¼åŒ–å‡½æ•°
         function formatMarkdownContent(content) {
             // åŸºæœ¬çš„Markdownè½¬HTMLå¤„ç†
             let formatted = content
                 // ç§»é™¤æ‰€æœ‰#å­—ç¬¦
                 .replace(/#/g, '')
                 // å¤„ç†æ ‡é¢˜ï¼ˆä¸æ˜¾ç¤º#ç¬¦å·ï¼‰
                 .replace(/^\s*(.*?)\s*$/gm, function(match, text) {
                     // æ£€æµ‹æ˜¯å¦ä¸ºæ ‡é¢˜æ ¼å¼ï¼ˆè¿ç»­çš„å¤§å†™å­—æ¯æˆ–é‡è¦å…³é”®è¯ï¼‰
                     if (text.match(/^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åã€]+[ã€.]/) || 
                         text.match(/^\d+[ã€.]/) ||
                         text.match(/^(æ€»ç»“|ç»“è®º|å»ºè®®|åˆ†æ|æ¦‚è¿°|è¦ç‚¹|é‡ç‚¹|æ³¨æ„|æé†’)[:ï¼š]?/)) {
                         return '<h3>' + text + '</h3>';
                     }
                     return text;
                 })
                 // å¤„ç†ç²—ä½“
                 .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                 // å¤„ç†æ–œä½“
                 .replace(/\*(.*?)\*/g, '<em>$1</em>')
                 // å¤„ç†åˆ—è¡¨é¡¹
                 .replace(/^- (.*$)/gm, '<li>$1</li>')
                 .replace(/^\* (.*$)/gm, '<li>$1</li>')
                 .replace(/^\d+\. (.*$)/gm, '<li>$1</li>')
                 // å¤„ç†æ¢è¡Œ
                 .replace(/\n\n/g, '</p><p>')
                 .replace(/\n/g, '<br>');
             
             // åŒ…è£…åˆ—è¡¨é¡¹
             formatted = formatted.replace(/(<li>.*?<\/li>)/gs, function(match) {
                 if (!match.includes('<ul>') && !match.includes('<ol>')) {
                     return '<ul>' + match + '</ul>';
                 }
                 return match;
             });
             
             // åŒ…è£…æ®µè½
             if (!formatted.startsWith('<h') && !formatted.startsWith('<ul') && !formatted.startsWith('<ol')) {
                 formatted = '<p>' + formatted + '</p>';
             }
             
             return formatted;
         }
         
         // å…«å­—é—®ç­”APIè°ƒç”¨
         async function callBaziQAAPI(question, data) {
             // ç”Ÿæˆç¼“å­˜é”®ï¼ˆå¤„ç†ä¸­æ–‡å­—ç¬¦ï¼‰
             const questionHash = encodeURIComponent(question).slice(0, 50).replace(/%/g, '_');
             const cacheKey = `qa:${generateBaziHashKey(data)}:${questionHash}`;
             
             // æ£€æŸ¥ç¼“å­˜
             const cachedResponse = localStorage.getItem(cacheKey);
             if (cachedResponse) {
                 return cachedResponse;
             }
             
             // æ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©API URL
             const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
             const apiUrl = isLocalhost ? 'http://localhost:3001/api/deepseek' : 'https://deepseek-api-proxy.owenjass.workers.dev/api/deepseek';
             // ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼Œä¸ç›´æ¥æš´éœ²API Key
             const apiKey = 'placeholder_key_for_local_dev_only';
             
             // è·å–å½“å‰æ—¥æœŸå’Œå¹´ä»½ä¿¡æ¯
             const today = new Date();
             const currentDateStr = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;
             const currentLunar = Lunar.fromDate(today);
             const currentYearGanZhi = currentLunar.getYearInGanZhi();
             const currentYear = today.getFullYear();
             
             // ä»dataå¯¹è±¡ä¸­è·å–å…«å­—ä¿¡æ¯
             const userName = data.name || 'ç”¨æˆ·';
             const genderStr = data.gender === 'male' ? 'ç”·' : (data.gender === 'female' ? 'å¥³' : 'æœªçŸ¥');
             const yearPillarStr = data.pillars?.year || 'å¹´æŸ±æœªçŸ¥';
             const monthPillarStr = data.pillars?.month || 'æœˆæŸ±æœªçŸ¥';
             const dayPillarStr = data.pillars?.day || 'æ—¥æŸ±æœªçŸ¥';
             const hourPillarStr = data.pillars?.hour || 'æ—¶æŸ±æœªçŸ¥';
             const strengthStr = data.strengthAnalysis?.type || 'èº«å¼ºèº«å¼±æœªçŸ¥';
             const startingAgeStr = data.luckTiming?.description || 'èµ·è¿æ—¶é—´æœªçŸ¥';
             
             // æ„å»ºprompt
             let prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å…«å­—å‘½ç†å¤§å¸ˆï¼Œè¯·åŸºäºä»¥ä¸‹å‡†ç¡®çš„å…«å­—ä¿¡æ¯å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚\n\n`;
             prompt += `ã€åŸºæœ¬ä¿¡æ¯ã€‘\n`;
             prompt += `å§“åï¼š${userName}\n`;
             prompt += `æ€§åˆ«ï¼š${genderStr}\n`;
             prompt += `å½“å‰æ—¥æœŸï¼š${currentDateStr}\n`;
             prompt += `å½“å‰æµå¹´ï¼š${currentYear}å¹´${currentYearGanZhi}å¹´\n\n`;
             
             prompt += `ã€å…«å­—ä¿¡æ¯ã€‘\n`;
             prompt += `å¹´æŸ±ï¼š${yearPillarStr}\n`;
             prompt += `æœˆæŸ±ï¼š${monthPillarStr}\n`;
             prompt += `æ—¥æŸ±ï¼š${dayPillarStr}\n`;
             prompt += `æ—¶æŸ±ï¼š${hourPillarStr}\n`;
             prompt += `èº«å¼ºèº«å¼±ï¼š${strengthStr}\n`;
             prompt += `èµ·è¿æ—¶é—´ï¼š${startingAgeStr}\n\n`;
             
             prompt += `ã€ç”¨æˆ·é—®é¢˜ã€‘\n${question}\n\n`;
             
             prompt += `ã€å›ç­”è¦æ±‚ã€‘\n`;
             prompt += `1. è¯·åŸºäºä»¥ä¸Šå‡†ç¡®çš„å…«å­—ä¿¡æ¯å›ç­”é—®é¢˜ï¼Œä¸è¦é‡æ–°è®¡ç®—å…«å­—\n`;
             prompt += `2. å›ç­”è¦ä¸“ä¸šã€å‡†ç¡®ã€å…·ä½“ï¼Œé¿å…æ¨¡ç³Šçš„è¡¨è¿°\n`;
             prompt += `3. å¦‚æœé—®é¢˜æ¶‰åŠæ—¶é—´é¢„æµ‹ï¼Œè¯·ç»“åˆå½“å‰æµå¹´${currentYear}å¹´${currentYearGanZhi}å¹´è¿›è¡Œåˆ†æ\n`;
             prompt += `4. ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šï¼Œè®©æ™®é€šäººä¹Ÿèƒ½ç†è§£\n`;
             prompt += `5. å¦‚æœé—®é¢˜ä¸æ˜¯å…«å­—ç›¸å…³çš„ï¼Œè¯·ç¤¼è²Œåœ°æé†’ç”¨æˆ·åªèƒ½å›ç­”å…«å­—å‘½ç†ç›¸å…³é—®é¢˜\n`;
             prompt += `6. å›ç­”è¦æœ‰å»ºè®¾æ€§ï¼Œæä¾›å®ç”¨çš„å»ºè®®å’ŒæŒ‡å¯¼\n`;
             
             try {
                 console.log('å¼€å§‹è°ƒç”¨å…«å­—é—®ç­”API...');
                 console.log('API URL:', apiUrl);
                 console.log('è¯·æ±‚æ•°æ®:', {
                     model: "deepseek-chat",
                     messages: [{ role: "user", content: prompt.substring(0, 200) + '...' }],
                     temperature: 0.7,
                     max_tokens: 1500
                 });
                 
                 const response = await fetch(apiUrl, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                         'Authorization': `Bearer ${apiKey}`
                     },
                     body: JSON.stringify({
                         model: "deepseek-chat",
                         messages: [
                             {
                                 role: "user",
                                 content: prompt
                             }
                         ],
                         temperature: 0.7,
                         max_tokens: 1500
                     })
                 });
                 
                 console.log('APIå“åº”çŠ¶æ€:', response.status, response.statusText);
                 
                 if (!response.ok) {
                     const errorText = await response.text();
                     console.error('APIé”™è¯¯å“åº”:', errorText);
                     throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${response.statusText}`);
                 }
                 
                 const responseData = await response.json();
                 console.log('APIå“åº”æ•°æ®:', responseData);
                 
                 if (!responseData.choices || !responseData.choices[0] || !responseData.choices[0].message || !responseData.choices[0].message.content) {
                     console.error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯:', responseData);
                     throw new Error('APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                 }
                 
                 const answerContent = responseData.choices[0].message.content;
                 
                 if (!answerContent.trim()) {
                     throw new Error('APIè¿”å›å†…å®¹ä¸ºç©º');
                 }
                 
                 console.log('APIè°ƒç”¨æˆåŠŸï¼Œè¿”å›å†…å®¹é•¿åº¦:', answerContent.length);
                 
                 // æ ¼å¼åŒ–å›ç­”å†…å®¹ï¼ˆæ”¯æŒMarkdownï¼‰
                 const formattedAnswer = `<div class="qa-answer">\n<h4><i class="fas fa-lightbulb"></i> å‘½ç†è§£ç­”</h4>\n<div class="qa-content">${formatMarkdownContent(answerContent)}</div>\n</div>`;
                 
                 // ç¼“å­˜ç»“æœï¼ˆç¼“å­˜æ—¶é—´è¾ƒçŸ­ï¼Œå› ä¸ºé—®ç­”å†…å®¹å¯èƒ½éœ€è¦æ›´æ–°ï¼‰
                 localStorage.setItem(cacheKey, formattedAnswer);
                 
                 return formattedAnswer;
             } catch (error) {
                 console.error('å…«å­—é—®ç­”APIè°ƒç”¨å¤±è´¥ - è¯¦ç»†é”™è¯¯:', error);
                 console.error('é”™è¯¯å †æ ˆ:', error.stack);
                 throw error;
             }
         }
         
         // é€šè¿‡DeepSeek APIè·å–å…«å­—åˆ†æ
         async function getBaziAnalysisFromDeepSeek(analysisType, data) {
             // ç”Ÿæˆç¼“å­˜é”®
             const cacheKey = `${generateBaziHashKey(data)}:${analysisType}`;
             
             // æ£€æŸ¥ç¼“å­˜
             const cachedResponse = localStorage.getItem(cacheKey);
             if (cachedResponse) {
                 return cachedResponse;
             }
             
             // ä½¿ç”¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨
             const apiUrl = 'https://deepseek-api-proxy.owenjass.workers.dev/api/deepseek'
             // ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼Œä¸ç›´æ¥æš´éœ²API Key
             const apiKey = 'placeholder_key_for_local_dev_only';
             
             // è·å–å½“å‰æ—¥æœŸ
             const today = new Date();
             const currentDateStr = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;
             
             // è·å–å½“å‰å¹´ä»½çš„å¤©å¹²åœ°æ”¯
             const currentLunar = Lunar.fromDate(today);
             const currentYearGanZhi = currentLunar.getYearInGanZhi();
             const currentYear = today.getFullYear();
             
             // ä»dataå¯¹è±¡ä¸­è·å–å…«å­—ä¿¡æ¯
             const userName = data.name || 'ç”¨æˆ·';
             const genderStr = data.gender === 'male' ? 'ç”·' : (data.gender === 'female' ? 'å¥³' : 'æœªçŸ¥');
             const yearPillarStr = data.pillars?.year || 'å¹´æŸ±æœªçŸ¥';
             const monthPillarStr = data.pillars?.month || 'æœˆæŸ±æœªçŸ¥';
             const dayPillarStr = data.pillars?.day || 'æ—¥æŸ±æœªçŸ¥';
             const hourPillarStr = data.pillars?.hour || 'æ—¶æŸ±æœªçŸ¥';
             const strengthStr = data.strengthAnalysis?.type || 'èº«å¼ºèº«å¼±æœªçŸ¥';
             const startingAgeStr = data.luckTiming?.description || 'èµ·è¿æ—¶é—´æœªçŸ¥';
             
            const baziFullInfo = `${userName}ï¼Œ${genderStr}ï¼Œå…«å­—ä¿¡æ¯æ˜¯ï¼š${yearPillarStr}ï¼Œ${monthPillarStr}ï¼Œ${dayPillarStr}ï¼Œ${hourPillarStr}ï¼Œå‘½ä¸»ä¸º${strengthStr}ï¼Œ${startingAgeStr}ã€‚`;
            const baziInfo = {
            baziFullInfo,
            yearPillar: yearPillarStr,
            monthPillar: monthPillarStr,
            dayPillar: dayPillarStr,
            hourPillar: hourPillarStr,
            strength: strengthStr,
            startingAge: startingAgeStr,
            elementsDistribution: data.elementsDistribution || {}
            };
             
             // æ ¹æ®åˆ†æç±»å‹æ„å»ºæç¤ºè¯
             let prompt = `è¯·ä½œä¸ºä¸“ä¸šå‘½ç†å¸ˆï¼Œä½¿ç”¨æ ‡å‡†Markdownè¯­æ³•ï¼ŒåŸºäºä»¥ä¸‹æœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯è¿›è¡Œæ·±åº¦åˆ†æã€‚å½“å‰æ—¥æœŸï¼š${currentDateStr}\n\n`;
             
             // æ·»åŠ å…«å­—æ ¸å¿ƒä¿¡æ¯ï¼ˆä½¿ç”¨å®Œæ•´çš„baziFullInfoï¼‰
             prompt += `### å…«å­—ä¿¡æ¯\n`;
             prompt += `${baziFullInfo}\n\n`;
             
             // æ·»åŠ äº”è¡Œåˆ†å¸ƒä¿¡æ¯
             if (baziInfo.elementsDistribution && Object.keys(baziInfo.elementsDistribution).length > 0) {
                 prompt += `- äº”è¡Œåˆ†å¸ƒï¼š`;
                 Object.entries(baziInfo.elementsDistribution).forEach(([element, count]) => {
                     prompt += `${element}${count}ä¸ª `;
                 });
                 prompt += `\n\n`;
             }
             
             prompt += `**é‡è¦è¯´æ˜ï¼šä»¥ä¸Šå…«å­—ã€èº«å¼ºèº«å¼±åˆ¤æ–­å’Œèµ·è¿æ—¶é—´å‡ä¸ºæœ¬åœ°ç²¾ç¡®è®¡ç®—ç»“æœã€‚æ‚¨å¿…é¡»ä¸¥æ ¼åŸºäºè¿™äº›ä¿¡æ¯è¿›è¡Œåˆ†æï¼Œç»å¯¹ä¸è¦è‡ªè¡Œé‡æ–°è®¡ç®—æˆ–ä½¿ç”¨å…¶ä»–å€¼ã€‚**\n\n`;
             
             // æ ¹æ®åˆ†æç±»å‹æ·»åŠ ç‰¹å®šæç¤º
             switch (analysisType) {
                 case 'full-analysis':
                     prompt += `è¯·åŸºäºä»¥ä¸Šå…«å­—ä¿¡æ¯ï¼Œè¿›è¡Œå…¨é¢çš„å‘½ç†è§£æã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. æ€§æ ¼ç‰¹è´¨ä¸å¤©èµ‹æ‰èƒ½åˆ†æ\n`;
                     prompt += `2. äº‹ä¸šå‘å±•æ–¹å‘ä¸èŒä¸šè§„åˆ’å»ºè®®\n`;
                     prompt += `3. è´¢å¯Œè¿åŠ¿ä¸ç†è´¢æŠ•èµ„æŒ‡å¯¼\n`;
                     prompt += `4. æ„Ÿæƒ…å©šå§»çŠ¶å†µä¸ä¼´ä¾£ç‰¹å¾\n`;
                     prompt += `5. å¥åº·çŠ¶å†µè¯„ä¼°ä¸å…»ç”Ÿå»ºè®®\n`;
                     prompt += `6. äººç”Ÿå„é˜¶æ®µé‡è¦è½¬æŠ˜ç‚¹é¢„æµ‹\n`;
                     prompt += `7. æå‡è¿åŠ¿çš„å®ç”¨æ–¹æ³•ä¸å»ºè®®\n`;
                     break;
                     
                 case 'annual-fortune':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„æµå¹´è¿åŠ¿åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. ${currentYear}å¹´${currentYearGanZhi}å¹´æ•´ä½“è¿åŠ¿æ¦‚è¿°\n`;
                     prompt += `2. äº‹ä¸šå‘å±•ä¸å·¥ä½œæœºé‡åˆ†æ\n`;
                     prompt += `3. è´¢è¿åˆ†æï¼ˆæ­£è´¢ä¸åè´¢ï¼‰\n`;
                     prompt += `4. æ„Ÿæƒ…ä¸äººé™…å…³ç³»è¿åŠ¿\n`;
                     prompt += `5. å¥åº·çŠ¶å†µé¢„è­¦ä¸å»ºè®®\n`;
                     prompt += `6. æµå¹´å‰å‡¶æœˆä»½é¢„æµ‹\n`;
                     prompt += `7. åŒ–è§£ä¸åˆ©å› ç´ çš„å®ç”¨å»ºè®®\n`;
                     break;
                     
                 case 'monthly-fortune':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„æµæœˆè¿åŠ¿åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. ${currentYear}å¹´å„æœˆè¿åŠ¿æ€»ä½“è¶‹åŠ¿\n`;
                     prompt += `2. æŒ‰å­£èŠ‚åˆ†æï¼ˆæ˜¥ã€å¤ã€ç§‹ã€å†¬ï¼‰å„æœˆè¿åŠ¿ç‰¹ç‚¹\n`;
                     prompt += `3. é‡ç‚¹æœˆä»½çš„æœºé‡ä¸æŒ‘æˆ˜\n`;
                     prompt += `4. æ¯æœˆäº‹ä¸šã€è´¢è¿ã€æ„Ÿæƒ…ã€å¥åº·å…³é”®ç‚¹\n`;
                     prompt += `5. æœˆä»½å‰å‡¶æ—¥é¢„æµ‹æ–¹æ³•\n`;
                     prompt += `6. ä¸åŒæœˆä»½çš„è¡ŒåŠ¨å»ºè®®\n`;
                     break;
                     
                 case 'decade-fortune':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„åå¹´å¤§è¿åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. äººç”Ÿå„é˜¶æ®µå¤§è¿èµ°åŠ¿æ¦‚è¿°\n`;
                     prompt += `2. é’å¹´æœŸï¼ˆ20-30å²ï¼‰è¿åŠ¿ä¸å‘å±•æ–¹å‘\n`;
                     prompt += `3. å£®å¹´æœŸï¼ˆ30-40å²ï¼‰äº‹ä¸šä¸è´¢å¯Œé«˜å³°æœŸåˆ†æ\n`;
                     prompt += `4. ä¸­å¹´æœŸï¼ˆ40-50å²ï¼‰ç¨³å®šå‘å±•æœŸç‰¹ç‚¹\n`;
                     prompt += `5. æ™šå¹´æœŸï¼ˆ50å²ä»¥åï¼‰è¿åŠ¿å˜åŒ–\n`;
                     prompt += `6. å¤§è¿äº¤æ¥æœŸçš„æ³¨æ„äº‹é¡¹\n`;
                     prompt += `7. å¦‚ä½•æŠŠæ¡å„é˜¶æ®µæœºé‡çš„å»ºè®®\n`;
                     break;
                     
                 case 'personality':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„æ€§æ ¼åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. æ ¸å¿ƒæ€§æ ¼ç‰¹è´¨ä¸å¤©èµ‹æ‰èƒ½\n`;
                     prompt += `2. æ€§æ ¼ä¼˜åŠ¿ä¸ç‰¹é•¿è¯¦è§£\n`;
                     prompt += `3. æ€§æ ¼ä¸­éœ€è¦æ³¨æ„çš„å¼±ç‚¹\n`;
                     prompt += `4. äººé™…äº¤å¾€æ¨¡å¼ä¸æ²Ÿé€šé£æ ¼\n`;
                     prompt += `5. æ€ç»´æ–¹å¼ä¸å†³ç­–ç‰¹ç‚¹\n`;
                     prompt += `6. æƒ…ç»ªç®¡ç†èƒ½åŠ›åˆ†æ\n`;
                     prompt += `7. æ€§æ ¼å‘å±•ä¸è‡ªæˆ‘æå‡å»ºè®®\n`;
                     break;
                     
                 case 'career':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„äº‹ä¸šè´¢å¯Œåˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. æœ€é€‚åˆçš„èŒä¸šé¢†åŸŸä¸è¡Œä¸š\n`;
                     prompt += `2. èŒä¸šå‘å±•è·¯å¾„ä¸å…³é”®è½¬æŠ˜ç‚¹\n`;
                     prompt += `3. äº‹ä¸šæˆåŠŸçš„å…³é”®å› ç´ \n`;
                     prompt += `4. è´¢å¯Œæ¥æºä¸ç§¯ç´¯æ¨¡å¼\n`;
                     prompt += `5. æ­£è´¢ä¸åè´¢è¿åŠ¿åˆ†æ\n`;
                     prompt += `6. æŠ•èµ„ç†è´¢å»ºè®®ä¸é£é™©æç¤º\n`;
                     prompt += `7. äº‹ä¸šä¸è´¢å¯Œå¹³è¡¡çš„äººç”Ÿè§„åˆ’\n`;
                     break;
                     
                 case 'marriage':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„å©šå§»åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. å©šå§»è¿åŠ¿ä¸ç¼˜åˆ†æ€»ä½“è¯„ä¼°\n`;
                     prompt += `2. ç†æƒ³ä¼´ä¾£çš„æ€§æ ¼ä¸ç‰¹è´¨æè¿°\n`;
                     prompt += `3. å©šå§»ç”Ÿæ´»çš„ç‰¹ç‚¹ä¸æ¨¡å¼\n`;
                     prompt += `4. å©šå§»ä¸­å¯èƒ½é¢ä¸´çš„æŒ‘æˆ˜\n`;
                     prompt += `5. æœ€ä½³å©šå§»æ—¶æœºä¸å¹´é¾„æ®µ\n`;
                     prompt += `6. å©šå§»å…³ç³»ç»è¥çš„å»ºè®®\n`;
                     prompt += `7. æå‡å©šå§»è´¨é‡çš„å®ç”¨æ–¹æ³•\n`;
                     break;
                     
                 case 'children':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„å­å¥³åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. å­å¥³ç¼˜åˆ†ä¸æ•°é‡é¢„æµ‹\n`;
                     prompt += `2. å­å¥³å¯èƒ½çš„æ€§æ ¼ç‰¹ç‚¹\n`;
                     prompt += `3. äº²å­å…³ç³»çš„ç‰¹ç‚¹ä¸äº’åŠ¨æ¨¡å¼\n`;
                     prompt += `4. å­å¥³æ•™è‚²çš„æœ€ä½³æ–¹å¼\n`;
                     prompt += `5. å­å¥³æˆé•¿ä¸­çš„å…³é”®é˜¶æ®µ\n`;
                     prompt += `6. å¦‚ä½•åŸ¹å…»å­å¥³çš„å¤©èµ‹ä¸èƒ½åŠ›\n`;
                     prompt += `7. äº²å­å…³ç³»å’Œè°çš„å®ç”¨å»ºè®®\n`;
                     break;
                     
                 case 'health':
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œè¯¦ç»†çš„å¥åº·åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚åˆ†æå†…å®¹åº”åŒ…æ‹¬ï¼š\n`;
                     prompt += `1. å…ˆå¤©ä½“è´¨ä¸å¥åº·çŠ¶å†µè¯„ä¼°\n`;
                     prompt += `2. éœ€è¦ç‰¹åˆ«å…³æ³¨çš„èº«ä½“ç³»ç»Ÿ\n`;
                     prompt += `3. ä¸åŒå¹´é¾„æ®µçš„å¥åº·é£é™©\n`;
                     prompt += `4. å­£èŠ‚æ€§å¥åº·å˜åŒ–ä¸æ³¨æ„äº‹é¡¹\n`;
                     prompt += `5. é€‚åˆçš„è¿åŠ¨ä¸é”»ç‚¼æ–¹å¼\n`;
                     prompt += `6. é¥®é£Ÿè°ƒç†ä¸è¥å…»å»ºè®®\n`;
                     prompt += `7. é¢„é˜²ç–¾ç—…çš„å…»ç”Ÿä¿å¥æ–¹æ³•\n`;
                     break;
                     
                 default:
                     prompt += `è¯·åŸºäºä»¥ä¸Šæœ¬åœ°è®¡ç®—çš„å‡†ç¡®å…«å­—ä¿¡æ¯ï¼ˆåŒ…æ‹¬èº«å¼ºèº«å¼±å’Œèµ·è¿æ—¶é—´ï¼‰ï¼Œè¿›è¡Œå…¨é¢çš„å‘½ç†åˆ†æã€‚è¯·ä¸è¦é‡æ–°è®¡ç®—å…«å­—ã€èº«å¼ºèº«å¼±æˆ–èµ·è¿æ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨æä¾›çš„ä¿¡æ¯ã€‚\n`;
             }
             
             prompt += `\nè¯·ç”¨äººæ€§åŒ–ã€æ¸…æ™°çš„è¯­è¨€è¡¨è¾¾ï¼Œé¿å…è¿‡äºä¸“ä¸šçš„æœ¯è¯­ï¼Œä½¿æ™®é€šäººä¹Ÿèƒ½ç†è§£ã€‚åˆ†æè¦å…¨é¢ã€æ·±å…¥ã€å…·ä½“ï¼Œä¸è¦ç¬¼ç»Ÿã€‚`;
             
             try {
                 // è°ƒç”¨DeepSeek API
                 const response = await fetch(apiUrl, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                         'Authorization': `Bearer ${apiKey}`
                     },
                     body: JSON.stringify({
                         model: "deepseek-chat",
                         messages: [
                             {
                                 role: "user",
                                 content: prompt
                             }
                         ],
                         temperature: 0.7,
                         max_tokens: 2000
                     })
                 });
                 
                 if (!response.ok) {
                     throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                 }
                 
                 const data = await response.json();
                 
                 if (!data.choices || !data.choices[0] || !data.choices[0].message || !data.choices[0].message.content) {
                     throw new Error('APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                 }
                 
                 const analysisContent = data.choices[0].message.content;
                 
                 // æ£€æŸ¥å†…å®¹æ˜¯å¦ä¸ºç©º
                 if (!analysisContent.trim()) {
                     throw new Error('APIè¿”å›å†…å®¹ä¸ºç©º');
                 }
                 
                 // ç¼“å­˜ç»“æœ
                 localStorage.setItem(cacheKey, analysisContent);
                 
                 return analysisContent;
             } catch (error) {
                 console.error('DeepSeek APIè°ƒç”¨å¤±è´¥:', error);
                 throw error;
             }
         }
         
         // ç”Ÿæˆå…«å­—å“ˆå¸Œé”®ï¼ˆç”¨äºç¼“å­˜ï¼‰
         function generateBaziHashKey(data) {
             return `${data.name}-${data.gender}-${data.birthDate}-${data.birthTime}`;
         }
     </script>
    <script>
      // é…ç½®åç«¯åœ°å€ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
      const API_BASE = 'https://bazi-backend.owenjass.workers.dev';
      const API_URL = `${API_BASE}/api`;

      document.addEventListener('DOMContentLoaded', function() {
          // ç”¨æˆ·è®¤è¯ã€ä½™é¢å’Œå……å€¼ç›¸å…³çš„ JavaScript ä»£ç 
          const userNameEl = document.getElementById('userName');
          const userBalanceEl = document.getElementById('userBalance');
          const balanceAmountEl = document.getElementById('balanceAmount');
          const loginRegisterBtn = document.getElementById('loginRegisterBtn');
          const rechargeBtn = document.getElementById('rechargeBtn');
          const manageBtn = document.getElementById('manageBtn');
          const logoutBtn = document.getElementById('logoutBtn');
          const authModal = document.getElementById('authModal');
          const closeAuth = document.getElementById('closeAuth');
          const loginTab = document.getElementById('loginTab');
          const registerTab = document.getElementById('registerTab');
          const loginForm = document.getElementById('loginForm');
          const registerForm = document.getElementById('registerForm');
          const rechargeModal = document.getElementById('rechargeModal');
          const closeRecharge = document.getElementById('closeRecharge');
          const rechargeForm = document.getElementById('rechargeForm');
          const payModal = document.getElementById('pay-modal');
          const closePayModal = payModal.querySelector('.close-button');
          const unlockBtn = document.getElementById('unlock-btn');
          const paidSection = document.getElementById('paid-section');
          const recalculateBtn = document.getElementById('calculate-btn'); // é‡æ–°æµ‹ç®—æŒ‰é’®

          // æ£€æŸ¥WWPayç±»æ˜¯å¦å¯ç”¨
          if (typeof WWPay === 'undefined') {
              console.error('WWPayç±»æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥wwpay.jsæ˜¯å¦åŠ è½½æˆåŠŸ');
              // å¯ä»¥é€‰æ‹©ç¦ç”¨ç›¸å…³åŠŸèƒ½æˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
          } else {
              window.wwPay = new WWPay();
          }

          function updateAuthUI() {
              const token = localStorage.getItem('token');
              const username = localStorage.getItem('username');

              if (token && username) {
                  userNameEl.textContent = username;
                  userBalanceEl.style.display = 'inline-block';
                  loginRegisterBtn.style.display = 'none';
                  rechargeBtn.style.display = 'inline-block';
                  manageBtn.style.display = 'inline-block';
                  logoutBtn.style.display = 'inline-block';
                  updateBalance();
              } else {
                  userNameEl.textContent = 'æœªç™»å½•';
                  userBalanceEl.style.display = 'none';
                  loginRegisterBtn.style.display = 'inline-block';
                  rechargeBtn.style.display = 'none';
                  manageBtn.style.display = 'none';
                  logoutBtn.style.display = 'none';
              }
          }

          async function updateBalance() {
              const token = localStorage.getItem('token');
              if (!token) return;
              try {
                  const response = await fetch(`${API_URL}/user/balance`, {
                      headers: {
                          'Authorization': `Bearer ${token}`
                      }
                  });
                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }
                  const data = await response.json();
                  if (data.balance !== undefined) {
                      balanceAmountEl.textContent = data.balance.toFixed(2);
                      document.getElementById('current-balance').textContent = data.balance.toFixed(2);
                  } else {
                      console.error('APIå“åº”ä¸­ç¼ºå°‘balanceå­—æ®µ');
                  }
              } catch (error) {
                  console.error('è·å–ä½™é¢å¤±è´¥:', error);
                  balanceAmountEl.textContent = 'è·å–å¤±è´¥';
                  document.getElementById('current-balance').textContent = 'è·å–å¤±è´¥';
              }
          }

          // ç™»å½•/æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
          loginRegisterBtn.addEventListener('click', function() {
              authModal.style.display = 'block';
          });

          // å…³é—­è®¤è¯å¼¹çª—
          closeAuth.addEventListener('click', function() {
              authModal.style.display = 'none';
          });

          // åˆ‡æ¢ç™»å½•/æ³¨å†Œè¡¨å•
          loginTab.addEventListener('click', function() {
              loginTab.classList.add('active');
              registerTab.classList.remove('active');
              loginForm.classList.add('active');
              registerForm.classList.remove('active');
          });

          registerTab.addEventListener('click', function() {
              registerTab.classList.add('active');
              loginTab.classList.remove('active');
              registerForm.classList.add('active');
              loginForm.classList.remove('active');
          });

          // ç™»å½•è¡¨å•æäº¤
          loginForm.addEventListener('submit', async function(e) {
              e.preventDefault();
              const username = document.getElementById('loginUsername').value;
              const password = document.getElementById('loginPassword').value;
              try {
                  const response = await fetch(`${API_URL}/auth/login`, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({ username, password })
                  });
                  const data = await response.json();
                  if (response.ok) {
                      localStorage.setItem('token', data.token);
                      localStorage.setItem('username', username);
                      updateAuthUI();
                      authModal.style.display = 'none';
                      alert('ç™»å½•æˆåŠŸï¼');
                  } else {
                      alert(data.message || 'ç™»å½•å¤±è´¥');
                  }
              } catch (error) {
                  console.error('ç™»å½•è¯·æ±‚å¤±è´¥:', error);
                  alert('ç™»å½•è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚');
              }
          });

          // æ³¨å†Œè¡¨å•æäº¤
          registerForm.addEventListener('submit', async function(e) {
              e.preventDefault();
              const username = document.getElementById('registerUsername').value;
              const password = document.getElementById('registerPassword').value;
              const confirmPassword = document.getElementById('confirmPassword').value;

              if (password !== confirmPassword) {
                  alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼');
                  return;
              }

              try {
                  const response = await fetch(`${API_URL}/auth/register`, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({ username, password })
                  });
                  const data = await response.json();
                  if (response.ok) {
                      alert('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•ã€‚');
                      loginTab.click(); // åˆ‡æ¢åˆ°ç™»å½•ç•Œé¢
                  } else {
                      alert(data.message || 'æ³¨å†Œå¤±è´¥');
                  }
              } catch (error) {
                  console.error('æ³¨å†Œè¯·æ±‚å¤±è´¥:', error);
                  alert('æ³¨å†Œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚');
              }
          });

          // å……å€¼æŒ‰é’®ç‚¹å‡»äº‹ä»¶
          rechargeBtn.addEventListener('click', function() {
              rechargeModal.style.display = 'block';
              updateBalance(); // ç¡®ä¿å……å€¼å¼¹çª—æ˜¾ç¤ºæœ€æ–°ä½™é¢
          });

          // å…³é—­å……å€¼å¼¹çª—
          closeRecharge.addEventListener('click', function() {
              rechargeModal.style.display = 'none';
          });

          // å¤„ç†å……å€¼è¡¨å•æäº¤
          rechargeForm.addEventListener('submit', async function(e) {
              e.preventDefault();
              const amount = document.getElementById('rechargeAmount').value;
              const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
              const rechargeSpinner = document.getElementById('rechargeSpinner');
              const rechargeText = document.getElementById('rechargeText');
              const rechargeMessage = document.getElementById('rechargeMessage');

              rechargeSpinner.style.display = 'inline-block';
              rechargeText.style.display = 'none';
              rechargeMessage.textContent = '';

              try {
                  if (typeof WWPay === 'undefined') {
                      throw new Error('WWPayç±»æœªå®šä¹‰ï¼Œæ— æ³•è¿›è¡Œå……å€¼ã€‚');
                  }
                  const orderResponse = await window.wwPay.createRechargeOrder(amount, paymentMethod);
                  await window.wwPay.redirectToPaymentGateway(orderResponse);
                  rechargeMessage.textContent = 'æ­£åœ¨è·³è½¬æ”¯ä»˜å¹³å°...';
                  rechargeMessage.style.color = 'white';
              } catch (error) {
                  rechargeMessage.textContent = error.message;
                  rechargeMessage.style.color = 'red';
              } finally {
                  rechargeSpinner.style.display = 'none';
                  rechargeText.style.display = 'inline';
              }
          });

          // ç™»å‡ºæŒ‰é’®ç‚¹å‡»äº‹ä»¶
          logoutBtn.addEventListener('click', function() {
              localStorage.removeItem('token');
              localStorage.removeItem('username');
              updateAuthUI();
              alert('æ‚¨å·²æˆåŠŸé€€å‡ºç™»å½•ã€‚');
              // é‡ç½®ä»˜è´¹å†…å®¹æ˜¾ç¤ºçŠ¶æ€
              paidSection.style.display = 'none';
              unlockBtn.style.display = 'block';
          });

          // ç®¡ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶ (ç›®å‰ä»…ä¸ºå ä½ç¬¦)
          manageBtn.addEventListener('click', function() {
              alert('ç®¡ç†åŠŸèƒ½å¾…å¼€å‘ã€‚');
          });

          // è§£é”æŒ‰é’®ç‚¹å‡»äº‹ä»¶
          unlockBtn.addEventListener('click', function() {
              if (!localStorage.getItem('token')) {
                  alert('è¯·å…ˆç™»å½•ä»¥è§£é”å†…å®¹ï¼');
                  authModal.style.display = 'block';
                  return;
              }
              payModal.style.display = 'block';
              updateBalance(); // æ›´æ–°æ”¯ä»˜å¼¹çª—ä¸­çš„ä½™é¢æ˜¾ç¤º
          });

          // å…³é—­æ”¯ä»˜å¼¹çª—
          closePayModal.addEventListener('click', function() {
              payModal.style.display = 'none';
          });

          // æ”¯ä»˜æŒ‰é’®ç‚¹å‡»äº‹ä»¶ (åœ¨æ”¯ä»˜å¼¹çª—å†…éƒ¨)
          payModal.querySelector('.pay-button').addEventListener('click', async function() {
              const paymentMethod = payModal.querySelector('input[name="payment-method"]:checked').value;
              const amount = 20; // å›ºå®šä»·æ ¼20å…ƒ
              const token = localStorage.getItem('token');

              if (!token) {
                  alert('è¯·å…ˆç™»å½•ï¼');
                  authModal.style.display = 'block';
                  return;
              }

              try {
                  if (paymentMethod === 'balancepay') {
                      const response = await fetch(`${API_URL}/payment/deduct-balance`, {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                              'Authorization': `Bearer ${token}`
                          },
                          body: JSON.stringify({ amount, description: 'å…«å­—è¯¦æ‰¹è§£é”' })
                      });
                      const data = await response.json();
                      if (response.ok) {
                          alert('ä½™é¢æ”¯ä»˜æˆåŠŸï¼å†…å®¹å·²è§£é”ã€‚');
                          payModal.style.display = 'none';
                          unlockContent();
                          updateBalance(); // æ›´æ–°ä½™é¢æ˜¾ç¤º
                      } else {
                          alert(data.message || 'ä½™é¢æ”¯ä»˜å¤±è´¥ã€‚');
                      }
                  } else {
                      // æ”¯ä»˜å®æˆ–å¾®ä¿¡æ”¯ä»˜
                      if (typeof WWPay === 'undefined') {
                          throw new Error('WWPayç±»æœªå®šä¹‰ï¼Œæ— æ³•è¿›è¡Œæ”¯ä»˜ã€‚');
                      }
                      const orderResponse = await window.wwPay.createPaymentOrder(amount, paymentMethod, 'å…«å­—è¯¦æ‰¹è§£é”');
                      await window.wwPay.redirectToPaymentGateway(orderResponse);
                      // å‡è®¾å¤–éƒ¨æ”¯ä»˜æˆåŠŸåä¼šå›è°ƒæˆ–ç”¨æˆ·æ‰‹åŠ¨ç¡®è®¤
                      alert('è¯·å®Œæˆå¤–éƒ¨æ”¯ä»˜ã€‚æ”¯ä»˜æˆåŠŸåè¯·åˆ·æ–°é¡µé¢æˆ–é‡æ–°è¿›å…¥ã€‚');
                      payModal.style.display = 'none';
                      // å®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢æœºåˆ¶
                  }
              } catch (error) {
                  console.error('æ”¯ä»˜è¯·æ±‚å¤±è´¥:', error);
                  alert('æ”¯ä»˜è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚');
              }
          });

          function unlockContent() {
              paidSection.style.display = 'block';
              unlockBtn.style.display = 'none';
              localStorage.setItem('baziPaid', 'true'); // æ ‡è®°ä¸ºå·²æ”¯ä»˜
          }

          // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ”¯ä»˜çŠ¶æ€
          if (localStorage.getItem('baziPaid') === 'true') {
              unlockContent();
          }

          // é‡æ–°æµ‹ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
          recalculateBtn.addEventListener('click', function() {
              localStorage.removeItem('baziPaid'); // é‡ç½®æ”¯ä»˜çŠ¶æ€
              paidSection.style.display = 'none';
              unlockBtn.style.display = 'block';
              // å…¶ä»–é‡ç½®é€»è¾‘ï¼Œä¾‹å¦‚æ¸…ç©ºè¡¨å•ã€éšè—ç»“æœç­‰
              document.getElementById('input-section').style.display = 'block';
              document.getElementById('result-section').style.display = 'none';
              document.getElementById('bazi-qa-response').style.display = 'none';
              document.getElementById('bazi-qa-input').value = '';
              // æ¸…ç©ºæ‰€æœ‰åˆ†æå†…å®¹
              document.getElementById('basic-info-content').innerHTML = '';
              document.getElementById('bazi-chart').innerHTML = '';
              document.getElementById('elements-summary').innerHTML = '';
              document.getElementById('elements-description').innerHTML = '';
              document.getElementById('strength-description').innerHTML = '';
              document.getElementById('luck-timing').innerHTML = '';
              document.getElementById('fate-level-content').innerHTML = '';
              document.getElementById('wealth-level-content').innerHTML = '';
              // é‡ç½®å›¾è¡¨
              if (window.elementsChart) window.elementsChart.destroy();
              if (window.strengthChart) window.strengthChart.destroy();
          });

          // åˆå§‹åŒ–UI
          updateAuthUI();
          setInterval(updateBalance, 30000); // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡ä½™é¢
      });
    </script>
    </div> <!-- é—­åˆ container -->
    </div> <!-- é—­åˆ page-container -->
    <!-- Payment Modal -->
    <div id="pay-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>è§£é”è¯¦æ‰¹å…«å­—</h2>
            <p class="modal-description">æ”¯ä»˜20å…ƒå³å¯è§£é”å‘½æ ¼ç­‰çº§ã€è´¢å¯Œç­‰çº§ã€å…«å­—é—®ç­”åŠè¯¦ç»†åˆ†æå†…å®¹ã€‚</p>
            <div class="payment-options">
                <div class="payment-option">
                    <input type="radio" id="alipay" name="payment-method" value="alipay" checked>
                    <label for="alipay"><img src="../images/alipay.png" alt="Alipay"> æ”¯ä»˜å®</label>
                </div>
                <div class="payment-option">
                    <input type="radio" id="wechatpay" name="payment-method" value="wechatpay">
                    <label for="wechatpay"><img src="../images/wechat.png" alt="WeChat Pay"> å¾®ä¿¡æ”¯ä»˜</label>
                </div>
                <div class="payment-option">
                    <input type="radio" id="balancepay" name="payment-method" value="balancepay">
                    <label for="balancepay"><i class="fas fa-wallet"></i> ä½™é¢æ”¯ä»˜ (<span id="current-balance">0</span> å…ƒ)</label>
                </div>
            </div>
            <button id="confirm-pay-btn" class="btn btn-primary">ç¡®è®¤æ”¯ä»˜</button>
            <div id="payment-message" class="payment-message"></div>
        </div>
    </div>

</body>
</html>
